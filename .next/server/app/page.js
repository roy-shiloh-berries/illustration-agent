(()=>{var e={};e.id=974,e.ids=[974],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},33873:e=>{"use strict";e.exports=require("path")},23687:(e,t,n)=>{"use strict";n.r(t),n.d(t,{GlobalError:()=>s.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c});var r=n(70260),i=n(28203),o=n(25155),s=n.n(o),a=n(67292),l={};for(let e in a)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>a[e]);n.d(t,l);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(n.bind(n,61377)),"/Users/berriesdesign/Documents/repos/illustration-agent/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(n.bind(n,71354)),"/Users/berriesdesign/Documents/repos/illustration-agent/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(n.t.bind(n,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(n.t.bind(n,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(n.t.bind(n,41485,23)),"next/dist/client/components/unauthorized-error"]}],d=["/Users/berriesdesign/Documents/repos/illustration-agent/src/app/page.tsx"],u={require:n,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},97835:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,13219,23)),Promise.resolve().then(n.t.bind(n,34863,23)),Promise.resolve().then(n.t.bind(n,25155,23)),Promise.resolve().then(n.t.bind(n,40802,23)),Promise.resolve().then(n.t.bind(n,9350,23)),Promise.resolve().then(n.t.bind(n,48530,23)),Promise.resolve().then(n.t.bind(n,88921,23))},97155:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,66959,23)),Promise.resolve().then(n.t.bind(n,33875,23)),Promise.resolve().then(n.t.bind(n,88903,23)),Promise.resolve().then(n.t.bind(n,57174,23)),Promise.resolve().then(n.t.bind(n,84178,23)),Promise.resolve().then(n.t.bind(n,87190,23)),Promise.resolve().then(n.t.bind(n,61365,23))},49361:()=>{},14513:()=>{},20982:(e,t,n)=>{Promise.resolve().then(n.bind(n,61377))},16254:(e,t,n)=>{Promise.resolve().then(n.bind(n,11304))},38224:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw TypeError("The listener must be a function");var a=new i(r,o||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var l,c,d=this._events[a],u=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),u){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,o),!0;case 6:return d.fn.call(d.context,t,r,i,o,s),!0}for(c=1,l=Array(u-1);c<u;c++)l[c-1]=arguments[c];d.fn.apply(d.context,l)}else{var h,p=d.length;for(c=0;c<p;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),u){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,r);break;case 4:d[c].fn.call(d[c].context,t,r,i);break;default:if(!l)for(h=1,l=Array(u-1);h<u;h++)l[h-1]=arguments[h];d[c].fn.apply(d[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var l=0,c=[],d=a.length;l<d;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[o]=1===c.length?c[0]:c:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},97702:(e,t,n)=>{e=n.nmd(e);var r,i,o="__lodash_hash_undefined__",s="[object Arguments]",a="[object Array]",l="[object Boolean]",c="[object Date]",d="[object Error]",u="[object Function]",h="[object Map]",p="[object Number]",f="[object Object]",g="[object Promise]",m="[object RegExp]",y="[object Set]",b="[object String]",x="[object WeakMap]",v="[object ArrayBuffer]",w="[object DataView]",S=/^\[object .+?Constructor\]$/,k=/^(?:0|[1-9]\d*)$/,C={};C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C[s]=C[a]=C[v]=C[l]=C[w]=C[c]=C[d]=C[u]=C[h]=C[p]=C[f]=C[m]=C[y]=C[b]=C[x]=!1;var P="object"==typeof global&&global&&global.Object===Object&&global,_="object"==typeof self&&self&&self.Object===Object&&self,I=P||_||Function("return this")(),E=t&&!t.nodeType&&t,j=E&&e&&!e.nodeType&&e,T=j&&j.exports===E,M=T&&P.process,A=function(){try{return M&&M.binding&&M.binding("util")}catch(e){}}(),O=A&&A.isTypedArray;function L(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function D(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var z=Array.prototype,R=Function.prototype,N=Object.prototype,F=I["__core-js_shared__"],$=R.toString,B=N.hasOwnProperty,U=function(){var e=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),V=N.toString,H=RegExp("^"+$.call(B).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),K=T?I.Buffer:void 0,W=I.Symbol,G=I.Uint8Array,q=N.propertyIsEnumerable,Y=z.splice,X=W?W.toStringTag:void 0,Z=Object.getOwnPropertySymbols,Q=K?K.isBuffer:void 0,J=(r=Object.keys,i=Object,function(e){return r(i(e))}),ee=eC(I,"DataView"),et=eC(I,"Map"),en=eC(I,"Promise"),er=eC(I,"Set"),ei=eC(I,"WeakMap"),eo=eC(Object,"create"),es=eI(ee),ea=eI(et),el=eI(en),ec=eI(er),ed=eI(ei),eu=W?W.prototype:void 0,eh=eu?eu.valueOf:void 0;function ep(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function ef(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function eg(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function em(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new eg;++t<n;)this.add(e[t])}function ey(e){var t=this.__data__=new ef(e);this.size=t.size}function eb(e,t){for(var n=e.length;n--;)if(eE(e[n][0],t))return n;return -1}function ex(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":X&&X in Object(e)?function(e){var t=B.call(e,X),n=e[X];try{e[X]=void 0;var r=!0}catch(e){}var i=V.call(e);return r&&(t?e[X]=n:delete e[X]),i}(e):V.call(e)}function ev(e){return eD(e)&&ex(e)==s}function ew(e,t,n,r,i,o){var s=1&n,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var d=-1,u=!0,h=2&n?new em:void 0;for(o.set(e,t),o.set(t,e);++d<a;){var p=e[d],f=t[d];if(r)var g=s?r(f,p,d,t,e,o):r(p,f,d,e,t,o);if(void 0!==g){if(g)continue;u=!1;break}if(h){if(!function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}(t,function(e,t){if(!h.has(t)&&(p===e||i(p,e,n,r,o)))return h.push(t)})){u=!1;break}}else if(!(p===f||i(p,f,n,r,o))){u=!1;break}}return o.delete(e),o.delete(t),u}function eS(e){var t;return t=function(e){return null!=e&&eO(e.length)&&!eA(e)?function(e,t){var n,r=eT(e),i=!r&&ej(e),o=!r&&!i&&eM(e),s=!r&&!i&&!o&&ez(e),a=r||i||o||s,l=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=l.length;for(var d in e)B.call(e,d)&&!(a&&("length"==d||o&&("offset"==d||"parent"==d)||s&&("buffer"==d||"byteLength"==d||"byteOffset"==d)||(n=null==(n=c)?0x1fffffffffffff:n)&&("number"==typeof d||k.test(d))&&d>-1&&d%1==0&&d<n))&&l.push(d);return l}(e):function(e){if(t=e&&e.constructor,e!==("function"==typeof t&&t.prototype||N))return J(e);var t,n=[];for(var r in Object(e))B.call(e,r)&&"constructor"!=r&&n.push(r);return n}(e)}(e),eT(e)?t:function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}(t,eP(e))}function ek(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function eC(e,t){var n=null==e?void 0:e[t];return!(!eL(n)||U&&U in n)&&(eA(n)?H:S).test(eI(n))?n:void 0}ep.prototype.clear=function(){this.__data__=eo?eo(null):{},this.size=0},ep.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ep.prototype.get=function(e){var t=this.__data__;if(eo){var n=t[e];return n===o?void 0:n}return B.call(t,e)?t[e]:void 0},ep.prototype.has=function(e){var t=this.__data__;return eo?void 0!==t[e]:B.call(t,e)},ep.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=eo&&void 0===t?o:t,this},ef.prototype.clear=function(){this.__data__=[],this.size=0},ef.prototype.delete=function(e){var t=this.__data__,n=eb(t,e);return!(n<0)&&(n==t.length-1?t.pop():Y.call(t,n,1),--this.size,!0)},ef.prototype.get=function(e){var t=this.__data__,n=eb(t,e);return n<0?void 0:t[n][1]},ef.prototype.has=function(e){return eb(this.__data__,e)>-1},ef.prototype.set=function(e,t){var n=this.__data__,r=eb(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},eg.prototype.clear=function(){this.size=0,this.__data__={hash:new ep,map:new(et||ef),string:new ep}},eg.prototype.delete=function(e){var t=ek(this,e).delete(e);return this.size-=t?1:0,t},eg.prototype.get=function(e){return ek(this,e).get(e)},eg.prototype.has=function(e){return ek(this,e).has(e)},eg.prototype.set=function(e,t){var n=ek(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},em.prototype.add=em.prototype.push=function(e){return this.__data__.set(e,o),this},em.prototype.has=function(e){return this.__data__.has(e)},ey.prototype.clear=function(){this.__data__=new ef,this.size=0},ey.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},ey.prototype.get=function(e){return this.__data__.get(e)},ey.prototype.has=function(e){return this.__data__.has(e)},ey.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ef){var r=n.__data__;if(!et||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new eg(r)}return n.set(e,t),this.size=n.size,this};var eP=Z?function(e){return null==e?[]:function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}(Z(e=Object(e)),function(t){return q.call(e,t)})}:function(){return[]},e_=ex;function eI(e){if(null!=e){try{return $.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function eE(e,t){return e===t||e!=e&&t!=t}(ee&&e_(new ee(new ArrayBuffer(1)))!=w||et&&e_(new et)!=h||en&&e_(en.resolve())!=g||er&&e_(new er)!=y||ei&&e_(new ei)!=x)&&(e_=function(e){var t=ex(e),n=t==f?e.constructor:void 0,r=n?eI(n):"";if(r)switch(r){case es:return w;case ea:return h;case el:return g;case ec:return y;case ed:return x}return t});var ej=ev(function(){return arguments}())?ev:function(e){return eD(e)&&B.call(e,"callee")&&!q.call(e,"callee")},eT=Array.isArray,eM=Q||function(){return!1};function eA(e){if(!eL(e))return!1;var t=ex(e);return t==u||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function eO(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff}function eL(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eD(e){return null!=e&&"object"==typeof e}var ez=O?function(e){return O(e)}:function(e){return eD(e)&&eO(e.length)&&!!C[ex(e)]};e.exports=function(e,t){return function e(t,n,r,i,o){return t===n||(null!=t&&null!=n&&(eD(t)||eD(n))?function(e,t,n,r,i,o){var u=eT(e),g=eT(t),x=u?a:e_(e),S=g?a:e_(t);x=x==s?f:x,S=S==s?f:S;var k=x==f,C=S==f,P=x==S;if(P&&eM(e)){if(!eM(t))return!1;u=!0,k=!1}if(P&&!k)return o||(o=new ey),u||ez(e)?ew(e,t,n,r,i,o):function(e,t,n,r,i,o,s){switch(n){case w:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case v:if(e.byteLength!=t.byteLength||!o(new G(e),new G(t)))break;return!0;case l:case c:case p:return eE(+e,+t);case d:return e.name==t.name&&e.message==t.message;case m:case b:return e==t+"";case h:var a=L;case y:var u=1&r;if(a||(a=D),e.size!=t.size&&!u)break;var f=s.get(e);if(f)return f==t;r|=2,s.set(e,t);var g=ew(a(e),a(t),r,i,o,s);return s.delete(e),g;case"[object Symbol]":if(eh)return eh.call(e)==eh.call(t)}return!1}(e,t,x,n,r,i,o);if(!(1&n)){var _=k&&B.call(e,"__wrapped__"),I=C&&B.call(t,"__wrapped__");if(_||I){var E=_?e.value():e,j=I?t.value():t;return o||(o=new ey),i(E,j,n,r,o)}}return!!P&&(o||(o=new ey),function(e,t,n,r,i,o){var s=1&n,a=eS(e),l=a.length;if(l!=eS(t).length&&!s)return!1;for(var c=l;c--;){var d=a[c];if(!(s?d in t:B.call(t,d)))return!1}var u=o.get(e);if(u&&o.get(t))return u==t;var h=!0;o.set(e,t),o.set(t,e);for(var p=s;++c<l;){var f=e[d=a[c]],g=t[d];if(r)var m=s?r(g,f,d,t,e,o):r(f,g,d,e,t,o);if(!(void 0===m?f===g||i(f,g,n,r,o):m)){h=!1;break}p||(p="constructor"==d)}if(h&&!p){var y=e.constructor,b=t.constructor;y!=b&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b)&&(h=!1)}return o.delete(e),o.delete(t),h}(e,t,n,r,i,o))}(t,n,r,i,e,o):t!=t&&n!=n)}(e,t)}},87634:e=>{var t="Expected a function",n=0/0,r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,a=parseInt,l="object"==typeof global&&global&&global.Object===Object&&global,c="object"==typeof self&&self&&self.Object===Object&&self,d=l||c||Function("return this")(),u=Object.prototype.toString,h=Math.max,p=Math.min,f=function(){return d.Date.now()};function g(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function m(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||t&&"object"==typeof t&&"[object Symbol]"==u.call(t))return n;if(g(e)){var t,l="function"==typeof e.valueOf?e.valueOf():e;e=g(l)?l+"":l}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var c=o.test(e);return c||s.test(e)?a(e.slice(2),c?2:8):i.test(e)?n:+e}e.exports=function(e,n,r){var i=!0,o=!0;if("function"!=typeof e)throw TypeError(t);return g(r)&&(i="leading"in r?!!r.leading:i,o="trailing"in r?!!r.trailing:o),function(e,n,r){var i,o,s,a,l,c,d=0,u=!1,y=!1,b=!0;if("function"!=typeof e)throw TypeError(t);function x(t){var n=i,r=o;return i=o=void 0,d=t,a=e.apply(r,n)}function v(e){var t=e-c,r=e-d;return void 0===c||t>=n||t<0||y&&r>=s}function w(){var e,t,r,i=f();if(v(i))return S(i);l=setTimeout(w,(e=i-c,t=i-d,r=n-e,y?p(r,s-t):r))}function S(e){return(l=void 0,b&&i)?x(e):(i=o=void 0,a)}function k(){var e,t=f(),r=v(t);if(i=arguments,o=this,c=t,r){if(void 0===l)return d=e=c,l=setTimeout(w,n),u?x(e):a;if(y)return l=setTimeout(w,n),x(c)}return void 0===l&&(l=setTimeout(w,n)),a}return n=m(n)||0,g(r)&&(u=!!r.leading,s=(y="maxWait"in r)?h(m(r.maxWait)||0,n):s,b="trailing"in r?!!r.trailing:b),k.cancel=function(){void 0!==l&&clearTimeout(l),d=0,i=c=o=l=void 0},k.flush=function(){return void 0===l?a:S(f())},k}(e,n,{leading:i,maxWait:n,trailing:o})}},62063:e=>{var t="__lodash_hash_undefined__",n=/^\[object .+?Constructor\]$/,r="object"==typeof global&&global&&global.Object===Object&&global,i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();function s(e,t){return!!(e?e.length:0)&&function(e,t,n){if(t!=t)return function(e,t,n,r){for(var i=e.length,o=-1;++o<i;)if(t(e[o],o,e))return o;return -1}(e,a,0);for(var r=-1,i=e.length;++r<i;)if(e[r]===t)return r;return -1}(e,t,0)>-1}function a(e){return e!=e}function l(e,t){return e.has(t)}function c(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var d=Array.prototype,u=Function.prototype,h=Object.prototype,p=o["__core-js_shared__"],f=function(){var e=/[^.]+$/.exec(p&&p.keys&&p.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),g=u.toString,m=h.hasOwnProperty,y=h.toString,b=RegExp("^"+g.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),x=d.splice,v=T(o,"Map"),w=T(o,"Set"),S=T(Object,"create");function k(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function C(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function P(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function _(e){var t=-1,n=e?e.length:0;for(this.__data__=new P;++t<n;)this.add(e[t])}function I(e,t){for(var n,r=e.length;r--;)if((n=e[r][0])===t||n!=n&&t!=t)return r;return -1}k.prototype.clear=function(){this.__data__=S?S(null):{}},k.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},k.prototype.get=function(e){var n=this.__data__;if(S){var r=n[e];return r===t?void 0:r}return m.call(n,e)?n[e]:void 0},k.prototype.has=function(e){var t=this.__data__;return S?void 0!==t[e]:m.call(t,e)},k.prototype.set=function(e,n){return this.__data__[e]=S&&void 0===n?t:n,this},C.prototype.clear=function(){this.__data__=[]},C.prototype.delete=function(e){var t=this.__data__,n=I(t,e);return!(n<0)&&(n==t.length-1?t.pop():x.call(t,n,1),!0)},C.prototype.get=function(e){var t=this.__data__,n=I(t,e);return n<0?void 0:t[n][1]},C.prototype.has=function(e){return I(this.__data__,e)>-1},C.prototype.set=function(e,t){var n=this.__data__,r=I(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},P.prototype.clear=function(){this.__data__={hash:new k,map:new(v||C),string:new k}},P.prototype.delete=function(e){return j(this,e).delete(e)},P.prototype.get=function(e){return j(this,e).get(e)},P.prototype.has=function(e){return j(this,e).has(e)},P.prototype.set=function(e,t){return j(this,e).set(e,t),this},_.prototype.add=_.prototype.push=function(e){return this.__data__.set(e,t),this},_.prototype.has=function(e){return this.__data__.has(e)};var E=w&&1/c(new w([,-0]))[1]==1/0?function(e){return new w(e)}:function(){};function j(e,t){var n,r=e.__data__;return("string"==(n=typeof t)||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function T(e,t){var r,i=null==e?void 0:e[t];return!(!M(i)||f&&f in i)&&("[object Function]"==(r=M(i)?y.call(i):"")||"[object GeneratorFunction]"==r||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(i)?b:n).test(function(e){if(null!=e){try{return g.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(i))?i:void 0}function M(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return e&&e.length?function(e,t,n){var r=-1,i=s,o=e.length,a=!0,d=[],u=d;if(o>=200){var h=E(e);if(h)return c(h);a=!1,i=l,u=new _}else u=d;e:for(;++r<o;){var p=e[r],f=p;if(p=0!==p?p:0,a&&f==f){for(var g=u.length;g--;)if(u[g]===f)continue e;t&&u.push(f),d.push(p)}else i(u,f,void 0)||(u!==d&&u.push(f),d.push(p))}return d}(e):[]}},99716:(e,t,n)=>{var r,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function i(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var o={compressToBase64:function(e){if(null==e)return"";var n=o._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,function(n){return i(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":o._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),r=0,i=t.length;r<i;r++){var s=t.charCodeAt(r);n[2*r]=s>>>8,n[2*r+1]=s%256}return n},decompressFromUint8Array:function(t){if(null==t)return o.decompress(t);for(var n=Array(t.length/2),r=0,i=n.length;r<i;r++)n[r]=256*t[2*r]+t[2*r+1];var s=[];return n.forEach(function(t){s.push(e(t))}),o.decompress(s.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,function(t){return i(n,e.charAt(t))}))},compress:function(t){return o._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(null==e)return"";var r,i,o,s={},a={},l="",c="",d="",u=2,h=3,p=2,f=[],g=0,m=0;for(o=0;o<e.length;o+=1)if(l=e.charAt(o),Object.prototype.hasOwnProperty.call(s,l)||(s[l]=h++,a[l]=!0),c=d+l,Object.prototype.hasOwnProperty.call(s,c))d=c;else{if(Object.prototype.hasOwnProperty.call(a,d)){if(256>d.charCodeAt(0)){for(r=0;r<p;r++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(r=0,i=d.charCodeAt(0);r<8;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}else{for(r=0,i=1;r<p;r++)g=g<<1|i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i=0;for(r=0,i=d.charCodeAt(0);r<16;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}0==--u&&(u=Math.pow(2,p),p++),delete a[d]}else for(r=0,i=s[d];r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;0==--u&&(u=Math.pow(2,p),p++),s[c]=h++,d=String(l)}if(""!==d){if(Object.prototype.hasOwnProperty.call(a,d)){if(256>d.charCodeAt(0)){for(r=0;r<p;r++)g<<=1,m==t-1?(m=0,f.push(n(g)),g=0):m++;for(r=0,i=d.charCodeAt(0);r<8;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}else{for(r=0,i=1;r<p;r++)g=g<<1|i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i=0;for(r=0,i=d.charCodeAt(0);r<16;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1}0==--u&&(u=Math.pow(2,p),p++),delete a[d]}else for(r=0,i=s[d];r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;0==--u&&(u=Math.pow(2,p),p++)}for(r=0,i=2;r<p;r++)g=g<<1|1&i,m==t-1?(m=0,f.push(n(g)),g=0):m++,i>>=1;for(;;){if(g<<=1,m==t-1){f.push(n(g));break}m++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,r){var i,o,s,a,l,c,d,u=[],h=4,p=4,f=3,g="",m=[],y={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)u[i]=i;for(s=0,l=4,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;switch(s){case 0:for(s=0,l=256,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;d=e(s);break;case 1:for(s=0,l=65536,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;d=e(s);break;case 2:return""}for(u[3]=d,o=d,m.push(d);;){if(y.index>t)return"";for(s=0,l=Math.pow(2,f),c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;switch(d=s){case 0:for(s=0,l=256,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;u[p++]=e(s),d=p-1,h--;break;case 1:for(s=0,l=65536,c=1;c!=l;)a=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),s|=(a>0?1:0)*c,c<<=1;u[p++]=e(s),d=p-1,h--;break;case 2:return m.join("")}if(0==h&&(h=Math.pow(2,f),f++),u[d])g=u[d];else{if(d!==p)return null;g=o+o.charAt(0)}m.push(g),u[p++]=o+g.charAt(0),h--,o=g,0==h&&(h=Math.pow(2,f),f++)}}};return o}();void 0!==(r=(function(){return i}).call(t,n,t,e))&&(e.exports=r)},75614:(e,t,n)=>{"use strict";var r,i,o=n(51583),s=n(14205),a=n(20100);function l(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var c=Symbol.for("react.element"),d=Symbol.for("react.transitional.element"),u=Symbol.for("react.portal"),h=Symbol.for("react.fragment"),p=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),g=Symbol.for("react.provider"),m=Symbol.for("react.consumer"),y=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),w=Symbol.for("react.memo"),S=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var k=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var C=Symbol.for("react.memo_cache_sentinel"),P=Symbol.iterator;function _(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=P&&e[P]||e["@@iterator"])?e:null}var I,E,j=Symbol.for("react.client.reference"),T=s.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,M=Object.assign;function A(e){if(void 0===I)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);I=t&&t[1]||"",E=-1<e.stack.indexOf("\n    at")?" (<anonymous>)":-1<e.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+I+e+E}var O=!1;function L(e,t){if(!e||O)return"";O=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var r={DetermineComponentFrameRoot:function(){try{if(t){var n=function(){throw Error()};if(Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(n,[])}catch(e){var r=e}Reflect.construct(e,[],n)}else{try{n.call()}catch(e){r=e}e.call(n.prototype)}}else{try{throw Error()}catch(e){r=e}(n=e())&&"function"==typeof n.catch&&n.catch(function(){})}}catch(e){if(e&&r&&"string"==typeof e.stack)return[e.stack,r.stack]}return[null,null]}};r.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(r.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(r.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var o=r.DetermineComponentFrameRoot(),s=o[0],a=o[1];if(s&&a){var l=s.split("\n"),c=a.split("\n");for(i=r=0;r<l.length&&!l[r].includes("DetermineComponentFrameRoot");)r++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(r===l.length||i===c.length)for(r=l.length-1,i=c.length-1;1<=r&&0<=i&&l[r]!==c[i];)i--;for(;1<=r&&0<=i;r--,i--)if(l[r]!==c[i]){if(1!==r||1!==i)do if(r--,i--,0>i||l[r]!==c[i]){var d="\n"+l[r].replace(" at new "," at ");return e.displayName&&d.includes("<anonymous>")&&(d=d.replace("<anonymous>",e.displayName)),d}while(1<=r&&0<=i);break}}}finally{O=!1,Error.prepareStackTrace=n}return(n=e?e.displayName||e.name:"")?A(n):""}function D(e){try{var t="";do t+=function(e){switch(e.tag){case 26:case 27:case 5:return A(e.type);case 16:return A("Lazy");case 13:return A("Suspense");case 19:return A("SuspenseList");case 0:case 15:return e=L(e.type,!1);case 11:return e=L(e.type.render,!1);case 1:return e=L(e.type,!0);default:return""}}(e),e=e.return;while(e);return t}catch(e){return"\nError generating stack: "+e.message+"\n"+e.stack}}function z(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do 0!=(4098&(t=e).flags)&&(n=t.return),e=t.return;while(e)}return 3===t.tag?n:null}function R(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&null!==(e=e.alternate)&&(t=e.memoizedState),null!==t)return t.dehydrated}return null}function N(e){if(z(e)!==e)throw Error(l(188))}var F=Array.isArray,$=a.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,B={pending:!1,data:null,method:null,action:null},U=[],V=-1;function H(e){return{current:e}}function K(e){0>V||(e.current=U[V],U[V]=null,V--)}function W(e,t){U[++V]=e.current,e.current=t}var G=H(null),q=H(null),Y=H(null),X=H(null);function Z(e,t){switch(W(Y,t),W(q,e),W(G,null),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)&&(t=t.namespaceURI)?l9(t):0;break;default:if(t=(e=8===e?t.parentNode:t).tagName,e=e.namespaceURI)t=l7(e=l9(e),t);else switch(t){case"svg":t=1;break;case"math":t=2;break;default:t=0}}K(G),W(G,t)}function Q(){K(G),K(q),K(Y)}function J(e){null!==e.memoizedState&&W(X,e);var t=G.current,n=l7(t,e.type);t!==n&&(W(q,e),W(G,n))}function ee(e){q.current===e&&(K(G),K(q)),X.current===e&&(K(X),cF._currentValue=B)}var et=Object.prototype.hasOwnProperty,en=o.unstable_scheduleCallback,er=o.unstable_cancelCallback,ei=o.unstable_shouldYield,eo=o.unstable_requestPaint,es=o.unstable_now,ea=o.unstable_getCurrentPriorityLevel,el=o.unstable_ImmediatePriority,ec=o.unstable_UserBlockingPriority,ed=o.unstable_NormalPriority,eu=o.unstable_LowPriority,eh=o.unstable_IdlePriority,ep=o.log,ef=o.unstable_setDisableYieldValue,eg=null,em=null;function ey(e){if("function"==typeof ep&&ef(e),em&&"function"==typeof em.setStrictMode)try{em.setStrictMode(eg,e)}catch(e){}}var eb=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(ex(e)/ev|0)|0},ex=Math.log,ev=Math.LN2,ew=128,eS=4194304;function ek(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194176&e;case 4194304:case 8388608:case 0x1000000:case 0x2000000:return 0x3c00000&e;case 0x4000000:return 0x4000000;case 0x8000000:return 0x8000000;case 0x10000000:return 0x10000000;case 0x20000000:return 0x20000000;case 0x40000000:return 0;default:return e}}function eC(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=e.warmLanes;e=0!==e.finishedLanes;var a=0x7ffffff&n;return 0!==a?0!=(n=a&~i)?r=ek(n):0!=(o&=a)?r=ek(o):e||0!=(s=a&~s)&&(r=ek(s)):0!=(a=n&~i)?r=ek(a):0!==o?r=ek(o):e||0!=(s=n&~s)&&(r=ek(s)),0===r?0:0!==t&&t!==r&&0==(t&i)&&((i=r&-r)>=(s=t&-t)||32===i&&0!=(4194176&s))?t:r}function eP(e,t){return 0==(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function e_(){var e=ew;return 0==(4194176&(ew<<=1))&&(ew=128),e}function eI(){var e=eS;return 0==(0x3c00000&(eS<<=1))&&(eS=4194304),e}function eE(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function ej(e,t){e.pendingLanes|=t,0x10000000!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function eT(e,t,n){e.pendingLanes|=t,e.suspendedLanes&=~t;var r=31-eb(t);e.entangledLanes|=t,e.entanglements[r]=0x40000000|e.entanglements[r]|4194218&n}function eM(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-eb(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}function eA(e){return 2<(e&=-e)?8<e?0!=(0x7ffffff&e)?32:0x10000000:8:2}function eO(){var e=$.p;return 0!==e?e:void 0===(e=window.event)?32:cQ(e.type)}var eL=Math.random().toString(36).slice(2),eD="__reactFiber$"+eL,ez="__reactProps$"+eL,eR="__reactContainer$"+eL,eN="__reactEvents$"+eL,eF="__reactListeners$"+eL,e$="__reactHandles$"+eL,eB="__reactResources$"+eL,eU="__reactMarker$"+eL;function eV(e){delete e[eD],delete e[ez],delete e[eN],delete e[eF],delete e[e$]}function eH(e){var t=e[eD];if(t)return t;for(var n=e.parentNode;n;){if(t=n[eR]||n[eD]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=cu(e);null!==e;){if(n=e[eD])return n;e=cu(e)}return t}n=(e=n).parentNode}return null}function eK(e){if(e=e[eD]||e[eR]){var t=e.tag;if(5===t||6===t||13===t||26===t||27===t||3===t)return e}return null}function eW(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(l(33))}function eG(e){var t=e[eB];return t||(t=e[eB]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function eq(e){e[eU]=!0}var eY=new Set,eX={};function eZ(e,t){eQ(e,t),eQ(e+"Capture",t)}function eQ(e,t){for(eX[e]=t,e=0;e<t.length;e++)eY.add(t[e])}var eJ=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),e0=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),e1={},e2={};function e3(e,t,n){if(et.call(e2,t)||!et.call(e1,t)&&(e0.test(t)?e2[t]=!0:(e1[t]=!0,!1))){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":e.removeAttribute(t);return;case"boolean":var r=t.toLowerCase().slice(0,5);if("data-"!==r&&"aria-"!==r){e.removeAttribute(t);return}}e.setAttribute(t,""+n)}}}function e5(e,t,n){if(null===n)e.removeAttribute(t);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(t);return}e.setAttribute(t,""+n)}}function e4(e,t,n,r){if(null===r)e.removeAttribute(n);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":e.removeAttribute(n);return}e.setAttributeNS(t,n,""+r)}}function e6(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function e8(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function e9(e){e._valueTracker||(e._valueTracker=function(e){var t=e8(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==n&&"function"==typeof n.get&&"function"==typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function e7(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=e8(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function te(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var tt=/[\n"\\]/g;function tn(e){return e.replace(tt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function tr(e,t,n,r,i,o,s,a){e.name="",null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s?e.type=s:e.removeAttribute("type"),null!=t?"number"===s?(0===t&&""===e.value||e.value!=t)&&(e.value=""+e6(t)):e.value!==""+e6(t)&&(e.value=""+e6(t)):"submit"!==s&&"reset"!==s||e.removeAttribute("value"),null!=t?to(e,s,e6(t)):null!=n?to(e,s,e6(n)):null!=r&&e.removeAttribute("value"),null==i&&null!=o&&(e.defaultChecked=!!o),null!=i&&(e.checked=i&&"function"!=typeof i&&"symbol"!=typeof i),null!=a&&"function"!=typeof a&&"symbol"!=typeof a&&"boolean"!=typeof a?e.name=""+e6(a):e.removeAttribute("name")}function ti(e,t,n,r,i,o,s,a){if(null!=o&&"function"!=typeof o&&"symbol"!=typeof o&&"boolean"!=typeof o&&(e.type=o),null!=t||null!=n){if(!("submit"!==o&&"reset"!==o||null!=t))return;n=null!=n?""+e6(n):"",t=null!=t?""+e6(t):n,a||t===e.value||(e.value=t),e.defaultValue=t}r="function"!=typeof(r=null!=r?r:i)&&"symbol"!=typeof r&&!!r,e.checked=a?e.checked:!!r,e.defaultChecked=!!r,null!=s&&"function"!=typeof s&&"symbol"!=typeof s&&"boolean"!=typeof s&&(e.name=s)}function to(e,t,n){"number"===t&&te(e.ownerDocument)===e||e.defaultValue===""+n||(e.defaultValue=""+n)}function ts(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(i=0,n=""+e6(n),t=null;i<e.length;i++){if(e[i].value===n){e[i].selected=!0,r&&(e[i].defaultSelected=!0);return}null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function ta(e,t,n){if(null!=t&&((t=""+e6(t))!==e.value&&(e.value=t),null==n)){e.defaultValue!==t&&(e.defaultValue=t);return}e.defaultValue=null!=n?""+e6(n):""}function tl(e,t,n,r){if(null==t){if(null!=r){if(null!=n)throw Error(l(92));if(F(r)){if(1<r.length)throw Error(l(93));r=r[0]}n=r}null==n&&(n=""),t=n}n=e6(t),e.defaultValue=n,(r=e.textContent)===n&&""!==r&&null!==r&&(e.value=r)}function tc(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType){n.nodeValue=t;return}}e.textContent=t}var td=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function tu(e,t,n){var r=0===t.indexOf("--");null==n||"boolean"==typeof n||""===n?r?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":r?e.setProperty(t,n):"number"!=typeof n||0===n||td.has(t)?"float"===t?e.cssFloat=n:e[t]=(""+n).trim():e[t]=n+"px"}function th(e,t,n){if(null!=t&&"object"!=typeof t)throw Error(l(62));if(e=e.style,null!=n){for(var r in n)!n.hasOwnProperty(r)||null!=t&&t.hasOwnProperty(r)||(0===r.indexOf("--")?e.setProperty(r,""):"float"===r?e.cssFloat="":e[r]="");for(var i in t)r=t[i],t.hasOwnProperty(i)&&n[i]!==r&&tu(e,i,r)}else for(var o in t)t.hasOwnProperty(o)&&tu(e,o,t[o])}function tp(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tf=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),tg=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function tm(e){return tg.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}var ty=null;function tb(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var tx=null,tv=null;function tw(e){var t=eK(e);if(t&&(e=t.stateNode)){var n=e[ez]||null;switch(e=t.stateNode,t.type){case"input":if(tr(e,n.value,n.defaultValue,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll('input[name="'+tn(""+t)+'"][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=r[ez]||null;if(!i)throw Error(l(90));tr(r,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<n.length;t++)(r=n[t]).form===e.form&&e7(r)}break;case"textarea":ta(e,n.value,n.defaultValue);break;case"select":null!=(t=n.value)&&ts(e,!!n.multiple,t,!1)}}}var tS=!1;function tk(e,t,n){if(tS)return e(t,n);tS=!0;try{return e(t)}finally{if(tS=!1,(null!==tx||null!==tv)&&(a9(),tx&&(t=tx,e=tv,tv=tx=null,tw(t),e)))for(t=0;t<e.length;t++)tw(e[t])}}function tC(e,t){var n=e.stateNode;if(null===n)return null;var r=n[ez]||null;if(null===r)return null;switch(n=r[t],t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break;default:e=!1}if(e)return null;if(n&&"function"!=typeof n)throw Error(l(231,t,typeof n));return n}var tP=!1;if(eJ)try{var t_={};Object.defineProperty(t_,"passive",{get:function(){tP=!0}}),window.addEventListener("test",t_,t_),window.removeEventListener("test",t_,t_)}catch(e){tP=!1}var tI=null,tE=null,tj=null;function tT(){if(tj)return tj;var e,t,n=tE,r=n.length,i="value"in tI?tI.value:tI.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return tj=i.slice(e,1<t?1-t:void 0)}function tM(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function tA(){return!0}function tO(){return!1}function tL(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?tA:tO,this.isPropagationStopped=tO,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=tA)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=tA)},persist:function(){},isPersistent:tA}),t}var tD,tz,tR,tN={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},tF=tL(tN),t$=M({},tN,{view:0,detail:0}),tB=tL(t$),tU=M({},t$,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tJ,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==tR&&(tR&&"mousemove"===e.type?(tD=e.screenX-tR.screenX,tz=e.screenY-tR.screenY):tz=tD=0,tR=e),tD)},movementY:function(e){return"movementY"in e?e.movementY:tz}}),tV=tL(tU),tH=tL(M({},tU,{dataTransfer:0})),tK=tL(M({},t$,{relatedTarget:0})),tW=tL(M({},tN,{animationName:0,elapsedTime:0,pseudoElement:0})),tG=tL(M({},tN,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),tq=tL(M({},tN,{data:0})),tY={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tX={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},tZ={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tQ(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=tZ[e])&&!!t[e]}function tJ(){return tQ}var t0=tL(M({},t$,{key:function(e){if(e.key){var t=tY[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tM(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?tX[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tJ,charCode:function(e){return"keypress"===e.type?tM(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tM(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),t1=tL(M({},tU,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),t2=tL(M({},t$,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tJ})),t3=tL(M({},tN,{propertyName:0,elapsedTime:0,pseudoElement:0})),t5=tL(M({},tU,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),t4=tL(M({},tN,{newState:0,oldState:0})),t6=[9,13,27,32],t8=eJ&&"CompositionEvent"in window,t9=null;eJ&&"documentMode"in document&&(t9=document.documentMode);var t7=eJ&&"TextEvent"in window&&!t9,ne=eJ&&(!t8||t9&&8<t9&&11>=t9),nt=!1;function nn(e,t){switch(e){case"keyup":return -1!==t6.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nr(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var ni=!1,no={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ns(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!no[e.type]:"textarea"===t}function na(e,t,n,r){tx?tv?tv.push(r):tv=[r]:tx=r,0<(t=lq(t,"onChange")).length&&(n=new tF("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var nl=null,nc=null;function nd(e){l$(e,0)}function nu(e){if(e7(eW(e)))return e}function nh(e,t){if("change"===e)return t}var np=!1;if(eJ){if(eJ){var nf="oninput"in document;if(!nf){var ng=document.createElement("div");ng.setAttribute("oninput","return;"),nf="function"==typeof ng.oninput}r=nf}else r=!1;np=r&&(!document.documentMode||9<document.documentMode)}function nm(){nl&&(nl.detachEvent("onpropertychange",ny),nc=nl=null)}function ny(e){if("value"===e.propertyName&&nu(nc)){var t=[];na(t,nc,e,tb(e)),tk(nd,t)}}function nb(e,t,n){"focusin"===e?(nm(),nl=t,nc=n,nl.attachEvent("onpropertychange",ny)):"focusout"===e&&nm()}function nx(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return nu(nc)}function nv(e,t){if("click"===e)return nu(t)}function nw(e,t){if("input"===e||"change"===e)return nu(t)}var nS="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t};function nk(e,t){if(nS(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!et.call(t,i)||!nS(e[i],t[i]))return!1}return!0}function nC(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function nP(e,t){var n,r=nC(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}t:{for(;r;){if(r.nextSibling){r=r.nextSibling;break t}r=r.parentNode}r=void 0}r=nC(r)}}function n_(e){e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window;for(var t=te(e.document);t instanceof e.HTMLIFrameElement;){try{var n="string"==typeof t.contentWindow.location.href}catch(e){n=!1}if(n)e=t.contentWindow;else break;t=te(e.document)}return t}function nI(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var nE=eJ&&"documentMode"in document&&11>=document.documentMode,nj=null,nT=null,nM=null,nA=!1;function nO(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;nA||null==nj||nj!==te(r)||(r="selectionStart"in(r=nj)&&nI(r)?{start:r.selectionStart,end:r.selectionEnd}:{anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},nM&&nk(nM,r)||(nM=r,0<(r=lq(nT,"onSelect")).length&&(t=new tF("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=nj)))}function nL(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var nD={animationend:nL("Animation","AnimationEnd"),animationiteration:nL("Animation","AnimationIteration"),animationstart:nL("Animation","AnimationStart"),transitionrun:nL("Transition","TransitionRun"),transitionstart:nL("Transition","TransitionStart"),transitioncancel:nL("Transition","TransitionCancel"),transitionend:nL("Transition","TransitionEnd")},nz={},nR={};function nN(e){if(nz[e])return nz[e];if(!nD[e])return e;var t,n=nD[e];for(t in n)if(n.hasOwnProperty(t)&&t in nR)return nz[e]=n[t];return e}eJ&&(nR=document.createElement("div").style,"AnimationEvent"in window||(delete nD.animationend.animation,delete nD.animationiteration.animation,delete nD.animationstart.animation),"TransitionEvent"in window||delete nD.transitionend.transition);var nF=nN("animationend"),n$=nN("animationiteration"),nB=nN("animationstart"),nU=nN("transitionrun"),nV=nN("transitionstart"),nH=nN("transitioncancel"),nK=nN("transitionend"),nW=new Map,nG="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll scrollEnd toggle touchMove waiting wheel".split(" ");function nq(e,t){nW.set(e,t),eZ(t,[e])}var nY=[],nX=0,nZ=0;function nQ(){for(var e=nX,t=nZ=nX=0;t<e;){var n=nY[t];nY[t++]=null;var r=nY[t];nY[t++]=null;var i=nY[t];nY[t++]=null;var o=nY[t];if(nY[t++]=null,null!==r&&null!==i){var s=r.pending;null===s?i.next=i:(i.next=s.next,s.next=i),r.pending=i}0!==o&&n2(n,i,o)}}function nJ(e,t,n,r){nY[nX++]=e,nY[nX++]=t,nY[nX++]=n,nY[nX++]=r,nZ|=r,e.lanes|=r,null!==(e=e.alternate)&&(e.lanes|=r)}function n0(e,t,n,r){return nJ(e,t,n,r),n3(e)}function n1(e,t){return nJ(e,null,null,t),n3(e)}function n2(e,t,n){e.lanes|=n;var r=e.alternate;null!==r&&(r.lanes|=n);for(var i=!1,o=e.return;null!==o;)o.childLanes|=n,null!==(r=o.alternate)&&(r.childLanes|=n),22===o.tag&&(null===(e=o.stateNode)||1&e._visibility||(i=!0)),e=o,o=o.return;i&&null!==t&&3===e.tag&&(o=e.stateNode,i=31-eb(n),null===(e=(o=o.hiddenUpdates)[i])?o[i]=[t]:e.push(t),t.lane=0x20000000|n)}function n3(e){if(50<aJ)throw aJ=0,a0=null,Error(l(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var n5={},n4=new WeakMap;function n6(e,t){if("object"==typeof e&&null!==e){var n=n4.get(e);return void 0!==n?n:(t={value:e,source:t,stack:D(t)},n4.set(e,t),t)}return{value:e,source:t,stack:D(t)}}var n8=[],n9=0,n7=null,re=0,rt=[],rn=0,rr=null,ri=1,ro="";function rs(e,t){n8[n9++]=re,n8[n9++]=n7,n7=e,re=t}function ra(e,t,n){rt[rn++]=ri,rt[rn++]=ro,rt[rn++]=rr,rr=e;var r=ri;e=ro;var i=32-eb(r)-1;r&=~(1<<i),n+=1;var o=32-eb(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,ri=1<<32-eb(t)+i|n<<i|r,ro=o+e}else ri=1<<o|n<<i|r,ro=e}function rl(e){null!==e.return&&(rs(e,1),ra(e,1,0))}function rc(e){for(;e===n7;)n7=n8[--n9],n8[n9]=null,re=n8[--n9],n8[n9]=null;for(;e===rr;)rr=rt[--rn],rt[rn]=null,ro=rt[--rn],rt[rn]=null,ri=rt[--rn],rt[rn]=null}var rd=null,ru=null,rh=!1,rp=null,rf=!1,rg=Error(l(519));function rm(e){throw rw(n6(Error(l(418,"")),e)),rg}function ry(e){var t=e.stateNode,n=e.type,r=e.memoizedProps;switch(t[eD]=e,t[ez]=r,n){case"dialog":lB("cancel",t),lB("close",t);break;case"iframe":case"object":case"embed":lB("load",t);break;case"video":case"audio":for(n=0;n<lN.length;n++)lB(lN[n],t);break;case"source":lB("error",t);break;case"img":case"image":case"link":lB("error",t),lB("load",t);break;case"details":lB("toggle",t);break;case"input":lB("invalid",t),ti(t,r.value,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name,!0),e9(t);break;case"select":lB("invalid",t);break;case"textarea":lB("invalid",t),tl(t,r.value,r.defaultValue,r.children),e9(t)}"string"!=typeof(n=r.children)&&"number"!=typeof n&&"bigint"!=typeof n||t.textContent===""+n||!0===r.suppressHydrationWarning||l0(t.textContent,n)?(null!=r.popover&&(lB("beforetoggle",t),lB("toggle",t)),null!=r.onScroll&&lB("scroll",t),null!=r.onScrollEnd&&lB("scrollend",t),null!=r.onClick&&(t.onclick=l1),t=!0):t=!1,t||rm(e)}function rb(e){for(rd=e.return;rd;)switch(rd.tag){case 3:case 27:rf=!0;return;case 5:case 13:rf=!1;return;default:rd=rd.return}}function rx(e){if(e!==rd)return!1;if(!rh)return rb(e),rh=!0,!1;var t,n=!1;if((t=3!==e.tag&&27!==e.tag)&&((t=5===e.tag)&&(t=!("form"!==(t=e.type)&&"button"!==t)||ce(e.type,e.memoizedProps)),t=!t),t&&(n=!0),n&&ru&&rm(e),rb(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(l(317));t:{for(n=0,e=e.nextSibling;e;){if(8===e.nodeType){if("/$"===(t=e.data)){if(0===n){ru=cd(e.nextSibling);break t}n--}else"$"!==t&&"$!"!==t&&"$?"!==t||n++}e=e.nextSibling}ru=null}}else ru=rd?cd(e.stateNode.nextSibling):null;return!0}function rv(){ru=rd=null,rh=!1}function rw(e){null===rp?rp=[e]:rp.push(e)}var rS=Error(l(460)),rk=Error(l(474)),rC=Error(l(542)),rP={then:function(){}};function r_(e){return"fulfilled"===(e=e.status)||"rejected"===e}function rI(){}function rE(e,t,n){switch(void 0===(n=e[n])?e.push(t):n!==t&&(t.then(rI,rI),t=n),t.status){case"fulfilled":return t.value;case"rejected":throw rM(e=t.reason),e;default:if("string"==typeof t.status)t.then(rI,rI);else{if(null!==(e=a_)&&100<e.shellSuspendCounter)throw Error(l(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var n=t;n.status="fulfilled",n.value=e}},function(e){if("pending"===t.status){var n=t;n.status="rejected",n.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw rM(e=t.reason),e}throw rj=t,rS}}var rj=null;function rT(){if(null===rj)throw Error(l(459));var e=rj;return rj=null,e}function rM(e){if(e===rS||e===rC)throw Error(l(483))}var rA="undefined"!=typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,n){e.push(n)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},rO=o.unstable_scheduleCallback,rL=o.unstable_NormalPriority,rD={$$typeof:y,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function rz(){return{controller:new rA,data:new Map,refCount:0}}function rR(e){e.refCount--,0===e.refCount&&rO(rL,function(){e.controller.abort()})}var rN=null,rF=0,r$=0,rB=null;function rU(){if(0==--rF&&null!==rN){null!==rB&&(rB.status="fulfilled");var e=rN;rN=null,r$=0,rB=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var rV=H(null),rH=H(0);function rK(e,t){W(rH,e=aL),W(rV,t),aL=e|t.baseLanes}function rW(){W(rH,aL),W(rV,rV.current)}function rG(){aL=rH.current,K(rV),K(rH)}var rq=T.S;T.S=function(e,t){"object"==typeof t&&null!==t&&"function"==typeof t.then&&function(e,t){if(null===rN){var n=rN=[];rF=0,r$=lO(),rB={status:"pending",value:void 0,then:function(e){n.push(e)}}}rF++,t.then(rU,rU)}(0,t),null!==rq&&rq(e,t)};var rY=H(null);function rX(){var e=rY.current;return null!==e?e:a_.pooledCache}function rZ(e,t){null===t?W(rY,rY.current):W(rY,t.pool)}function rQ(){var e=rX();return null===e?null:{parent:rD._currentValue,pool:e}}var rJ=0,r0=null,r1=null,r2=null,r3=!1,r5=!1,r4=!1,r6=0,r8=0,r9=null,r7=0;function ie(){throw Error(l(321))}function it(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!nS(e[n],t[n]))return!1;return!0}function ir(e,t,n,r,i,o){return rJ=o,r0=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,T.H=null===e||null===e.memoizedState?oc:od,r4=!1,o=n(r,i),r4=!1,r5&&(o=io(t,n,r,i)),ii(e),o}function ii(e){T.H=ol;var t=null!==r1&&null!==r1.next;if(rJ=0,r2=r1=r0=null,r3=!1,r8=0,r9=null,t)throw Error(l(300));null===e||oH||null!==(e=e.dependencies)&&sp(e)&&(oH=!0)}function io(e,t,n,r){r0=e;var i=0;do{if(r5&&(r9=null),r8=0,r5=!1,25<=i)throw Error(l(301));if(i+=1,r2=r1=null,null!=e.updateQueue){var o=e.updateQueue;o.lastEffect=null,o.events=null,o.stores=null,null!=o.memoCache&&(o.memoCache.index=0)}T.H=ou,o=t(n,r)}while(r5);return o}function is(){var e=T.H,t=e.useState()[0];return t="function"==typeof t.then?ih(t):t,e=e.useState()[0],(null!==r1?r1.memoizedState:null)!==e&&(r0.flags|=1024),t}function ia(){var e=0!==r6;return r6=0,e}function il(e,t,n){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~n}function ic(e){if(r3){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}r3=!1}rJ=0,r2=r1=r0=null,r5=!1,r8=r6=0,r9=null}function id(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===r2?r0.memoizedState=r2=e:r2=r2.next=e,r2}function iu(){if(null===r1){var e=r0.alternate;e=null!==e?e.memoizedState:null}else e=r1.next;var t=null===r2?r0.memoizedState:r2.next;if(null!==t)r2=t,r1=e;else{if(null===e){if(null===r0.alternate)throw Error(l(467));throw Error(l(310))}e={memoizedState:(r1=e).memoizedState,baseState:r1.baseState,baseQueue:r1.baseQueue,queue:r1.queue,next:null},null===r2?r0.memoizedState=r2=e:r2=r2.next=e}return r2}function ih(e){var t=r8;return r8+=1,null===r9&&(r9=[]),e=rE(r9,e,t),t=r0,null===(null===r2?t.memoizedState:r2.next)&&(t=t.alternate,T.H=null===t||null===t.memoizedState?oc:od),e}function ip(e){if(null!==e&&"object"==typeof e){if("function"==typeof e.then)return ih(e);if(e.$$typeof===y)return sg(e)}throw Error(l(438,String(e)))}function ig(e){var t=null,n=r0.updateQueue;if(null!==n&&(t=n.memoCache),null==t){var r=r0.alternate;null!==r&&null!==(r=r.updateQueue)&&null!=(r=r.memoCache)&&(t={data:r.data.map(function(e){return e.slice()}),index:0})}if(null==t&&(t={data:[],index:0}),null===n&&(n=i(),r0.updateQueue=n),n.memoCache=t,void 0===(n=t.data[t.index]))for(n=t.data[t.index]=Array(e),r=0;r<e;r++)n[r]=C;return t.index++,n}function im(e,t){return"function"==typeof t?t(e):t}function iy(e){return ib(iu(),r1,e)}function ib(e,t,n){var r=e.queue;if(null===r)throw Error(l(311));r.lastRenderedReducer=n;var i=e.baseQueue,o=r.pending;if(null!==o){if(null!==i){var s=i.next;i.next=o.next,o.next=s}t.baseQueue=i=o,r.pending=null}if(o=e.baseState,null===i)e.memoizedState=o;else{t=i.next;var a=s=null,c=null,d=t,u=!1;do{var h=-0x20000001&d.lane;if(h!==d.lane?(aE&h)===h:(rJ&h)===h){var p=d.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),h===r$&&(u=!0);else if((rJ&p)===p){d=d.next,p===r$&&(u=!0);continue}else h={lane:0,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(a=c=h,s=o):c=c.next=h,r0.lanes|=p,az|=p;h=d.action,r4&&n(o,h),o=d.hasEagerState?d.eagerState:n(o,h)}else p={lane:h,revertLane:d.revertLane,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null},null===c?(a=c=p,s=o):c=c.next=p,r0.lanes|=h,az|=h;d=d.next}while(null!==d&&d!==t);if(null===c?s=o:c.next=a,!nS(o,e.memoizedState)&&(oH=!0,u&&null!==(n=rB)))throw n;e.memoizedState=o,e.baseState=s,e.baseQueue=c,r.lastRenderedState=o}return null===i&&(r.lanes=0),[e.memoizedState,r.dispatch]}function ix(e){var t=iu(),n=t.queue;if(null===n)throw Error(l(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,o=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do o=e(o,s.action),s=s.next;while(s!==i);nS(o,t.memoizedState)||(oH=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function iv(e,t,n){var r=r0,i=iu(),o=rh;if(o){if(void 0===n)throw Error(l(407));n=n()}else n=t();var s=!nS((r1||i).memoizedState,n);if(s&&(i.memoizedState=n,oH=!0),i=i.queue,iW(ik.bind(null,r,i,e),[e]),i.getSnapshot!==t||s||null!==r2&&1&r2.memoizedState.tag){if(r.flags|=2048,i$(9,iB(),iS.bind(null,r,i,n,t),null),null===a_)throw Error(l(349));o||0!=(60&rJ)||iw(r,t,n)}return n}function iw(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=r0.updateQueue)?(t=i(),r0.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function iS(e,t,n,r){t.value=n,t.getSnapshot=r,iC(t)&&iP(e)}function ik(e,t,n){return n(function(){iC(t)&&iP(e)})}function iC(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!nS(e,n)}catch(e){return!0}}function iP(e){var t=n1(e,2);null!==t&&a3(t,e,2)}function i_(e){var t=id();if("function"==typeof e){var n=e;if(e=n(),r4){ey(!0);try{n()}finally{ey(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:im,lastRenderedState:e},t}function iI(e,t,n,r){return e.baseState=n,ib(e,r1,"function"==typeof r?r:im)}function iE(e,t,n,r,i){if(oo(e))throw Error(l(485));if(null!==(e=t.action)){var o={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){o.listeners.push(e)}};null!==T.T?n(!0):o.isTransition=!1,r(o),null===(n=t.pending)?(o.next=t.pending=o,ij(t,o)):(o.next=n.next,t.pending=n.next=o)}}function ij(e,t){var n=t.action,r=t.payload,i=e.state;if(t.isTransition){var o=T.T,s={};T.T=s;try{var a=n(i,r),l=T.S;null!==l&&l(s,a),iT(e,t,a)}catch(n){iA(e,t,n)}finally{T.T=o}}else try{o=n(i,r),iT(e,t,o)}catch(n){iA(e,t,n)}}function iT(e,t,n){null!==n&&"object"==typeof n&&"function"==typeof n.then?n.then(function(n){iM(e,t,n)},function(n){return iA(e,t,n)}):iM(e,t,n)}function iM(e,t,n){t.status="fulfilled",t.value=n,iO(t),e.state=n,null!==(t=e.pending)&&((n=t.next)===t?e.pending=null:(n=n.next,t.next=n,ij(e,n)))}function iA(e,t,n){var r=e.pending;if(e.pending=null,null!==r){r=r.next;do t.status="rejected",t.reason=n,iO(t),t=t.next;while(t!==r)}e.action=null}function iO(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function iL(e,t){return t}function iD(e,t){if(rh){var n=a_.formState;if(null!==n){t:{var r=r0;if(rh){if(ru){n:{for(var i=ru,o=rf;8!==i.nodeType;)if(!o||null===(i=cd(i.nextSibling))){i=null;break n}i="F!"===(o=i.data)||"F"===o?i:null}if(i){ru=cd(i.nextSibling),r="F!"===i.data;break t}}rm(r)}r=!1}r&&(t=n[0])}}return(n=id()).memoizedState=n.baseState=t,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:iL,lastRenderedState:t},n.queue=r,n=on.bind(null,r0,r),r.dispatch=n,r=i_(!1),o=oi.bind(null,r0,!1,r.queue),r=id(),i={state:t,dispatch:null,action:e,pending:null},r.queue=i,n=iE.bind(null,r0,i,o,n),i.dispatch=n,r.memoizedState=e,[t,n,!1]}function iz(e){return iR(iu(),r1,e)}function iR(e,t,n){if(t=ib(e,t,iL)[0],e=iy(im)[0],"object"==typeof t&&null!==t&&"function"==typeof t.then)try{var r=ih(t)}catch(e){if(e===rS)throw rC;throw e}else r=t;var i=(t=iu()).queue,o=i.dispatch;return n!==t.memoizedState&&(r0.flags|=2048,i$(9,iB(),iN.bind(null,i,n),null)),[r,o,e]}function iN(e,t){e.action=t}function iF(e){var t=iu(),n=r1;if(null!==n)return iR(t,n,e);iu(),t=t.memoizedState;var r=(n=iu()).queue.dispatch;return n.memoizedState=e,[t,r,!1]}function i$(e,t,n,r){return e={tag:e,create:n,deps:r,inst:t,next:null},null===(t=r0.updateQueue)&&(t=i(),r0.updateQueue=t),null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function iB(){return{destroy:void 0,resource:void 0}}function iU(){return iu().memoizedState}function iV(e,t,n,r){var i=id();r=void 0===r?null:r,r0.flags|=e,i.memoizedState=i$(1|t,iB(),n,r)}function iH(e,t,n,r){var i=iu();r=void 0===r?null:r;var o=i.memoizedState.inst;null!==r1&&null!==r&&it(r,r1.memoizedState.deps)?i.memoizedState=i$(t,o,n,r):(r0.flags|=e,i.memoizedState=i$(1|t,o,n,r))}function iK(e,t){iV(8390656,8,e,t)}function iW(e,t){iH(2048,8,e,t)}function iG(e,t){return iH(4,2,e,t)}function iq(e,t){return iH(4,4,e,t)}function iY(e,t){if("function"==typeof t){var n=t(e=e());return function(){"function"==typeof n?n():t(null)}}if(null!=t)return e=e(),t.current=e,function(){t.current=null}}function iX(e,t,n){n=null!=n?n.concat([e]):null,iH(4,4,iY.bind(null,t,e),n)}function iZ(){}function iQ(e,t){var n=iu();t=void 0===t?null:t;var r=n.memoizedState;return null!==t&&it(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function iJ(e,t){var n=iu();t=void 0===t?null:t;var r=n.memoizedState;if(null!==t&&it(t,r[1]))return r[0];if(r=e(),r4){ey(!0);try{e()}finally{ey(!1)}}return n.memoizedState=[r,t],r}function i0(e,t,n){return void 0===n||0!=(0x40000000&rJ)?e.memoizedState=t:(e.memoizedState=n,e=a2(),r0.lanes|=e,az|=e,n)}function i1(e,t,n,r){return nS(n,t)?n:null!==rV.current?(nS(e=i0(e,n,r),t)||(oH=!0),e):0==(42&rJ)?(oH=!0,e.memoizedState=n):(e=a2(),r0.lanes|=e,az|=e,t)}function i2(e,t,n,r,i){var o=$.p;$.p=0!==o&&8>o?o:8;var s=T.T,a={};T.T=a,oi(e,!1,t,n);try{var l=i(),c=T.S;if(null!==c&&c(a,l),null!==l&&"object"==typeof l&&"function"==typeof l.then){var d,u,h=(d=[],u={status:"pending",value:null,reason:null,then:function(e){d.push(e)}},l.then(function(){u.status="fulfilled",u.value=r;for(var e=0;e<d.length;e++)(0,d[e])(r)},function(e){for(u.status="rejected",u.reason=e,e=0;e<d.length;e++)(0,d[e])(void 0)}),u);or(e,t,h,a1(e))}else or(e,t,r,a1(e))}catch(n){or(e,t,{then:function(){},status:"rejected",reason:n},a1())}finally{$.p=o,T.T=s}}function i3(){}function i5(e,t,n,r){if(5!==e.tag)throw Error(l(476));var i=i4(e).queue;i2(e,i,t,B,null===n?i3:function(){return i6(e),n(r)})}function i4(e){var t=e.memoizedState;if(null!==t)return t;var n={};return(t={memoizedState:B,baseState:B,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:im,lastRenderedState:B},next:null}).next={memoizedState:n,baseState:n,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:im,lastRenderedState:n},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function i6(e){var t=i4(e).next.queue;or(e,t,{},a1())}function i8(){return sg(cF)}function i9(){return iu().memoizedState}function i7(){return iu().memoizedState}function oe(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var n=a1(),r=sS(t,e=sw(n),n);null!==r&&(a3(r,t,n),sk(r,t,n)),t={cache:rz()},e.payload=t;return}t=t.return}}function ot(e,t,n){var r=a1();n={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null},oo(e)?os(t,n):null!==(n=n0(e,t,n,r))&&(a3(n,e,r),oa(n,t,r))}function on(e,t,n){or(e,t,n,a1())}function or(e,t,n,r){var i={lane:r,revertLane:0,action:n,hasEagerState:!1,eagerState:null,next:null};if(oo(e))os(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,nS(a,s))return nJ(e,t,i,0),null===a_&&nQ(),!1}catch(e){}finally{}if(null!==(n=n0(e,t,i,r)))return a3(n,e,r),oa(n,t,r),!0}return!1}function oi(e,t,n,r){if(r={lane:2,revertLane:lO(),action:r,hasEagerState:!1,eagerState:null,next:null},oo(e)){if(t)throw Error(l(479))}else null!==(t=n0(e,n,r,2))&&a3(t,e,2)}function oo(e){var t=e.alternate;return e===r0||null!==t&&t===r0}function os(e,t){r5=r3=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function oa(e,t,n){if(0!=(4194176&n)){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,eM(e,n)}}i=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}};var ol={readContext:sg,use:ip,useCallback:ie,useContext:ie,useEffect:ie,useImperativeHandle:ie,useLayoutEffect:ie,useInsertionEffect:ie,useMemo:ie,useReducer:ie,useRef:ie,useState:ie,useDebugValue:ie,useDeferredValue:ie,useTransition:ie,useSyncExternalStore:ie,useId:ie};ol.useCacheRefresh=ie,ol.useMemoCache=ie,ol.useHostTransitionStatus=ie,ol.useFormState=ie,ol.useActionState=ie,ol.useOptimistic=ie;var oc={readContext:sg,use:ip,useCallback:function(e,t){return id().memoizedState=[e,void 0===t?null:t],e},useContext:sg,useEffect:iK,useImperativeHandle:function(e,t,n){n=null!=n?n.concat([e]):null,iV(4194308,4,iY.bind(null,t,e),n)},useLayoutEffect:function(e,t){return iV(4194308,4,e,t)},useInsertionEffect:function(e,t){iV(4,2,e,t)},useMemo:function(e,t){var n=id();t=void 0===t?null:t;var r=e();if(r4){ey(!0);try{e()}finally{ey(!1)}}return n.memoizedState=[r,t],r},useReducer:function(e,t,n){var r=id();if(void 0!==n){var i=n(t);if(r4){ey(!0);try{n(t)}finally{ey(!1)}}}else i=t;return r.memoizedState=r.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},r.queue=e,e=e.dispatch=ot.bind(null,r0,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},id().memoizedState=e},useState:function(e){var t=(e=i_(e)).queue,n=on.bind(null,r0,t);return t.dispatch=n,[e.memoizedState,n]},useDebugValue:iZ,useDeferredValue:function(e,t){return i0(id(),e,t)},useTransition:function(){var e=i_(!1);return e=i2.bind(null,r0,e.queue,!0,!1),id().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,n){var r=r0,i=id();if(rh){if(void 0===n)throw Error(l(407));n=n()}else{if(n=t(),null===a_)throw Error(l(349));0!=(60&aE)||iw(r,t,n)}i.memoizedState=n;var o={value:n,getSnapshot:t};return i.queue=o,iK(ik.bind(null,r,o,e),[e]),r.flags|=2048,i$(9,iB(),iS.bind(null,r,o,n,t),null),n},useId:function(){var e=id(),t=a_.identifierPrefix;if(rh){var n=ro,r=ri;t=":"+t+"R"+(n=(r&~(1<<32-eb(r)-1)).toString(32)+n),0<(n=r6++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=r7++).toString(32)+":";return e.memoizedState=t},useCacheRefresh:function(){return id().memoizedState=oe.bind(null,r0)}};oc.useMemoCache=ig,oc.useHostTransitionStatus=i8,oc.useFormState=iD,oc.useActionState=iD,oc.useOptimistic=function(e){var t=id();t.memoizedState=t.baseState=e;var n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=n,t=oi.bind(null,r0,!0,n),n.dispatch=t,[e,t]};var od={readContext:sg,use:ip,useCallback:iQ,useContext:sg,useEffect:iW,useImperativeHandle:iX,useInsertionEffect:iG,useLayoutEffect:iq,useMemo:iJ,useReducer:iy,useRef:iU,useState:function(){return iy(im)},useDebugValue:iZ,useDeferredValue:function(e,t){return i1(iu(),r1.memoizedState,e,t)},useTransition:function(){var e=iy(im)[0],t=iu().memoizedState;return["boolean"==typeof e?e:ih(e),t]},useSyncExternalStore:iv,useId:i9};od.useCacheRefresh=i7,od.useMemoCache=ig,od.useHostTransitionStatus=i8,od.useFormState=iz,od.useActionState=iz,od.useOptimistic=function(e,t){return iI(iu(),r1,e,t)};var ou={readContext:sg,use:ip,useCallback:iQ,useContext:sg,useEffect:iW,useImperativeHandle:iX,useInsertionEffect:iG,useLayoutEffect:iq,useMemo:iJ,useReducer:ix,useRef:iU,useState:function(){return ix(im)},useDebugValue:iZ,useDeferredValue:function(e,t){var n=iu();return null===r1?i0(n,e,t):i1(n,r1.memoizedState,e,t)},useTransition:function(){var e=ix(im)[0],t=iu().memoizedState;return["boolean"==typeof e?e:ih(e),t]},useSyncExternalStore:iv,useId:i9};ou.useCacheRefresh=i7,ou.useMemoCache=ig,ou.useHostTransitionStatus=i8,ou.useFormState=iF,ou.useActionState=iF,ou.useOptimistic=function(e,t){var n=iu();return null!==r1?iI(n,r1,e,t):(n.baseState=e,[e,n.queue.dispatch])};var oh=null,op=0;function of(e){var t=op;return op+=1,null===oh&&(oh=[]),rE(oh,e,t)}function og(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function om(e,t){if(t.$$typeof===c)throw Error(l(525));throw Error(l(31,"[object Object]"===(e=Object.prototype.toString.call(t))?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function oy(e){return(0,e._init)(e._payload)}function ob(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=ad(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return(t.index=r,e)?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=0x2000002,n):r:(t.flags|=0x2000002,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=0x2000002),t}function a(e,t,n,r){return null===t||6!==t.tag?(t=ag(n,e.mode,r)).return=e:(t=i(t,n)).return=e,t}function c(e,t,n,r){var o=n.type;return o===h?f(e,t,n.props.children,r,n.key):(null!==t&&(t.elementType===o||"object"==typeof o&&null!==o&&o.$$typeof===S&&oy(o)===t.type)?og(t=i(t,n.props),n):og(t=ah(n.type,n.key,n.props,null,e.mode,r),n),t.return=e,t)}function p(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?(t=am(n,e.mode,r)).return=e:(t=i(t,n.children||[])).return=e,t}function f(e,t,n,r,o){return null===t||7!==t.tag?(t=ap(n,e.mode,r,o)).return=e:(t=i(t,n)).return=e,t}function g(e,t,n){if("string"==typeof t&&""!==t||"number"==typeof t||"bigint"==typeof t)return(t=ag(""+t,e.mode,n)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case d:return og(n=ah(t.type,t.key,t.props,null,e.mode,n),t),n.return=e,n;case u:return(t=am(t,e.mode,n)).return=e,t;case S:return g(e,t=(0,t._init)(t._payload),n)}if(F(t)||_(t))return(t=ap(t,e.mode,n,null)).return=e,t;if("function"==typeof t.then)return g(e,of(t),n);if(t.$$typeof===y)return g(e,sm(e,t),n);om(e,t)}return null}function m(e,t,n,r){var i=null!==t?t.key:null;if("string"==typeof n&&""!==n||"number"==typeof n||"bigint"==typeof n)return null!==i?null:a(e,t,""+n,r);if("object"==typeof n&&null!==n){switch(n.$$typeof){case d:return n.key===i?c(e,t,n,r):null;case u:return n.key===i?p(e,t,n,r):null;case S:return m(e,t,n=(i=n._init)(n._payload),r)}if(F(n)||_(n))return null!==i?null:f(e,t,n,r,null);if("function"==typeof n.then)return m(e,t,of(n),r);if(n.$$typeof===y)return m(e,t,sm(e,n),r);om(e,n)}return null}function b(e,t,n,r,i){if("string"==typeof r&&""!==r||"number"==typeof r||"bigint"==typeof r)return a(t,e=e.get(n)||null,""+r,i);if("object"==typeof r&&null!==r){switch(r.$$typeof){case d:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case u:return p(t,e=e.get(null===r.key?n:r.key)||null,r,i);case S:return b(e,t,n,r=(0,r._init)(r._payload),i)}if(F(r)||_(r))return f(t,e=e.get(n)||null,r,i,null);if("function"==typeof r.then)return b(e,t,n,of(r),i);if(r.$$typeof===y)return b(e,t,n,sm(t,r),i);om(t,r)}return null}return function(a,c,p,f){try{op=0;var x=function a(c,p,f,x){if("object"==typeof f&&null!==f&&f.type===h&&null===f.key&&(f=f.props.children),"object"==typeof f&&null!==f){switch(f.$$typeof){case d:t:{for(var v=f.key;null!==p;){if(p.key===v){if((v=f.type)===h){if(7===p.tag){n(c,p.sibling),(x=i(p,f.props.children)).return=c,c=x;break t}}else if(p.elementType===v||"object"==typeof v&&null!==v&&v.$$typeof===S&&oy(v)===p.type){n(c,p.sibling),og(x=i(p,f.props),f),x.return=c,c=x;break t}n(c,p);break}t(c,p),p=p.sibling}f.type===h?(x=ap(f.props.children,c.mode,x,f.key)).return=c:(og(x=ah(f.type,f.key,f.props,null,c.mode,x),f),x.return=c),c=x}return s(c);case u:t:{for(v=f.key;null!==p;){if(p.key===v){if(4===p.tag&&p.stateNode.containerInfo===f.containerInfo&&p.stateNode.implementation===f.implementation){n(c,p.sibling),(x=i(p,f.children||[])).return=c,c=x;break t}n(c,p);break}t(c,p),p=p.sibling}(x=am(f,c.mode,x)).return=c,c=x}return s(c);case S:return a(c,p,f=(v=f._init)(f._payload),x)}if(F(f))return function(i,s,a,l){for(var c=null,d=null,u=s,h=s=0,p=null;null!==u&&h<a.length;h++){u.index>h?(p=u,u=null):p=u.sibling;var f=m(i,u,a[h],l);if(null===f){null===u&&(u=p);break}e&&u&&null===f.alternate&&t(i,u),s=o(f,s,h),null===d?c=f:d.sibling=f,d=f,u=p}if(h===a.length)return n(i,u),rh&&rs(i,h),c;if(null===u){for(;h<a.length;h++)null!==(u=g(i,a[h],l))&&(s=o(u,s,h),null===d?c=u:d.sibling=u,d=u);return rh&&rs(i,h),c}for(u=r(u);h<a.length;h++)null!==(p=b(u,i,h,a[h],l))&&(e&&null!==p.alternate&&u.delete(null===p.key?h:p.key),s=o(p,s,h),null===d?c=p:d.sibling=p,d=p);return e&&u.forEach(function(e){return t(i,e)}),rh&&rs(i,h),c}(c,p,f,x);if(_(f)){if("function"!=typeof(v=_(f)))throw Error(l(150));return function(i,s,a,c){if(null==a)throw Error(l(151));for(var d=null,u=null,h=s,p=s=0,f=null,y=a.next();null!==h&&!y.done;p++,y=a.next()){h.index>p?(f=h,h=null):f=h.sibling;var x=m(i,h,y.value,c);if(null===x){null===h&&(h=f);break}e&&h&&null===x.alternate&&t(i,h),s=o(x,s,p),null===u?d=x:u.sibling=x,u=x,h=f}if(y.done)return n(i,h),rh&&rs(i,p),d;if(null===h){for(;!y.done;p++,y=a.next())null!==(y=g(i,y.value,c))&&(s=o(y,s,p),null===u?d=y:u.sibling=y,u=y);return rh&&rs(i,p),d}for(h=r(h);!y.done;p++,y=a.next())null!==(y=b(h,i,p,y.value,c))&&(e&&null!==y.alternate&&h.delete(null===y.key?p:y.key),s=o(y,s,p),null===u?d=y:u.sibling=y,u=y);return e&&h.forEach(function(e){return t(i,e)}),rh&&rs(i,p),d}(c,p,f=v.call(f),x)}if("function"==typeof f.then)return a(c,p,of(f),x);if(f.$$typeof===y)return a(c,p,sm(c,f),x);om(c,f)}return"string"==typeof f&&""!==f||"number"==typeof f||"bigint"==typeof f?(f=""+f,null!==p&&6===p.tag?(n(c,p.sibling),(x=i(p,f)).return=c):(n(c,p),(x=ag(f,c.mode,x)).return=c),s(c=x)):n(c,p)}(a,c,p,f);return oh=null,x}catch(e){if(e===rS||e===rC)throw e;var v=al(29,e,null,a.mode);return v.lanes=f,v.return=a,v}finally{}}}var ox=ob(!0),ov=ob(!1),ow=H(null),oS=null;function ok(e){var t=e.alternate;W(oI,1&oI.current),W(ow,e),null===oS&&(null===t||null!==rV.current?oS=e:null!==t.memoizedState&&(oS=e))}function oC(e){if(22===e.tag){if(W(oI,oI.current),W(ow,e),null===oS){var t=e.alternate;null!==t&&null!==t.memoizedState&&(oS=e)}}else oP(e)}function oP(){W(oI,oI.current),W(ow,ow.current)}function o_(e){K(ow),oS===e&&(oS=null),K(oI)}var oI=H(0);function oE(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||cc(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function oj(e,t,n,r){n=null==(n=n(r,t=e.memoizedState))?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var oT={isMounted:function(e){return!!(e=e._reactInternals)&&z(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=a1(),i=sw(r);i.payload=t,null!=n&&(i.callback=n),null!==(t=sS(e,i,r))&&(a3(t,e,r),sk(t,e,r))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=a1(),i=sw(r);i.tag=1,i.payload=t,null!=n&&(i.callback=n),null!==(t=sS(e,i,r))&&(a3(t,e,r),sk(t,e,r))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=a1(),r=sw(n);r.tag=2,null!=t&&(r.callback=t),null!==(t=sS(e,r,n))&&(a3(t,e,n),sk(t,e,n))}};function oM(e,t,n,r,i,o,s){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||!nk(n,r)||!nk(i,o)}function oA(e,t,n,r){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&oT.enqueueReplaceState(t,t.state,null)}function oO(e,t){var n=t;if("ref"in t)for(var r in n={},t)"ref"!==r&&(n[r]=t[r]);if(e=e.defaultProps)for(var i in n===t&&(n=M({},n)),e)void 0===n[i]&&(n[i]=e[i]);return n}var oL="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit){process.emit("uncaughtException",e);return}console.error(e)};function oD(e){oL(e)}function oz(e){console.error(e)}function oR(e){oL(e)}function oN(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(e){setTimeout(function(){throw e})}}function oF(e,t,n){try{(0,e.onCaughtError)(n.value,{componentStack:n.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(e){setTimeout(function(){throw e})}}function o$(e,t,n){return(n=sw(n)).tag=3,n.payload={element:null},n.callback=function(){oN(e,t)},n}function oB(e){return(e=sw(e)).tag=3,e}function oU(e,t,n,r){var i=n.type.getDerivedStateFromError;if("function"==typeof i){var o=r.value;e.payload=function(){return i(o)},e.callback=function(){oF(t,n,r)}}var s=n.stateNode;null!==s&&"function"==typeof s.componentDidCatch&&(e.callback=function(){oF(t,n,r),"function"!=typeof i&&(null===aG?aG=new Set([this]):aG.add(this));var e=r.stack;this.componentDidCatch(r.value,{componentStack:null!==e?e:""})})}var oV=Error(l(461)),oH=!1;function oK(e,t,n,r){t.child=null===e?ov(t,null,n,r):ox(t,e.child,n,r)}function oW(e,t,n,r,i){n=n.render;var o=t.ref;if("ref"in r){var s={};for(var a in r)"ref"!==a&&(s[a]=r[a])}else s=r;return(sf(t),r=ir(e,t,n,s,o,i),a=ia(),null===e||oH)?(rh&&a&&rl(t),t.flags|=1,oK(e,t,r,i),t.child):(il(e,t,i),sn(e,t,i))}function oG(e,t,n,r,i){if(null===e){var o=n.type;return"function"!=typeof o||ac(o)||void 0!==o.defaultProps||null!==n.compare?((e=ah(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,oq(e,t,o,r,i))}if(o=e.child,!sr(e,i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:nk)(s,r)&&e.ref===t.ref)return sn(e,t,i)}return t.flags|=1,(e=ad(o,r)).ref=t.ref,e.return=t,t.child=e}function oq(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(nk(o,r)&&e.ref===t.ref){if(oH=!1,t.pendingProps=r=o,!sr(e,i))return t.lanes=e.lanes,sn(e,t,i);0!=(131072&e.flags)&&(oH=!0)}}return oQ(e,t,n,r,i)}function oY(e,t,n){var r=t.pendingProps,i=r.children,o=0!=(2&t.stateNode._pendingVisibility),s=null!==e?e.memoizedState:null;if(oZ(e,t),"hidden"===r.mode||o){if(0!=(128&t.flags)){if(r=null!==s?s.baseLanes|n:n,null!==e){for(o=0,i=t.child=e.child;null!==i;)o=o|i.lanes|i.childLanes,i=i.sibling;t.childLanes=o&~r}else t.childLanes=0,t.child=null;return oX(e,t,r,n)}if(0==(0x20000000&n))return t.lanes=t.childLanes=0x20000000,oX(e,t,null!==s?s.baseLanes|n:n,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&rZ(t,null!==s?s.cachePool:null),null!==s?rK(t,s):rW(),oC(t)}else null!==s?(rZ(t,s.cachePool),rK(t,s),oP(t),t.memoizedState=null):(null!==e&&rZ(t,null),rW(),oP(t));return oK(e,t,i,n),t.child}function oX(e,t,n,r){var i=rX();return i=null===i?null:{parent:rD._currentValue,pool:i},t.memoizedState={baseLanes:n,cachePool:i},null!==e&&rZ(t,null),rW(),oC(t),null!==e&&sh(e,t,r,!0),null}function oZ(e,t){var n=t.ref;if(null===n)null!==e&&null!==e.ref&&(t.flags|=2097664);else{if("function"!=typeof n&&"object"!=typeof n)throw Error(l(284));(null===e||e.ref!==n)&&(t.flags|=2097664)}}function oQ(e,t,n,r,i){return(sf(t),n=ir(e,t,n,r,void 0,i),r=ia(),null===e||oH)?(rh&&r&&rl(t),t.flags|=1,oK(e,t,n,i),t.child):(il(e,t,i),sn(e,t,i))}function oJ(e,t,n,r,i,o){return(sf(t),t.updateQueue=null,n=io(t,r,n,i),ii(e),r=ia(),null===e||oH)?(rh&&r&&rl(t),t.flags|=1,oK(e,t,n,o),t.child):(il(e,t,o),sn(e,t,o))}function o0(e,t,n,r,i){if(sf(t),null===t.stateNode){var o=n5,s=n.contextType;"object"==typeof s&&null!==s&&(o=sg(s)),o=new n(r,o),t.memoizedState=null!==o.state&&void 0!==o.state?o.state:null,o.updater=oT,t.stateNode=o,o._reactInternals=t,(o=t.stateNode).props=r,o.state=t.memoizedState,o.refs={},sx(t),s=n.contextType,o.context="object"==typeof s&&null!==s?sg(s):n5,o.state=t.memoizedState,"function"==typeof(s=n.getDerivedStateFromProps)&&(oj(t,n,s,r),o.state=t.memoizedState),"function"==typeof n.getDerivedStateFromProps||"function"==typeof o.getSnapshotBeforeUpdate||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||(s=o.state,"function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount(),s!==o.state&&oT.enqueueReplaceState(o,o.state,null),sI(t,r,o,i),s_(),o.state=t.memoizedState),"function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!0}else if(null===e){o=t.stateNode;var a=t.memoizedProps,l=oO(n,a);o.props=l;var c=o.context,d=n.contextType;s=n5,"object"==typeof d&&null!==d&&(s=sg(d));var u=n.getDerivedStateFromProps;d="function"==typeof u||"function"==typeof o.getSnapshotBeforeUpdate,a=t.pendingProps!==a,d||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a||c!==s)&&oA(t,o,r,s),sb=!1;var h=t.memoizedState;o.state=h,sI(t,r,o,i),s_(),c=t.memoizedState,a||h!==c||sb?("function"==typeof u&&(oj(t,n,u,r),c=t.memoizedState),(l=sb||oM(t,n,l,r,h,c,s))?(d||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4194308)):("function"==typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=c),o.props=r,o.state=c,o.context=s,r=l):("function"==typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,sv(e,t),d=oO(n,s=t.memoizedProps),o.props=d,u=t.pendingProps,h=o.context,c=n.contextType,l=n5,"object"==typeof c&&null!==c&&(l=sg(c)),(c="function"==typeof(a=n.getDerivedStateFromProps)||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(s!==u||h!==l)&&oA(t,o,r,l),sb=!1,h=t.memoizedState,o.state=h,sI(t,r,o,i),s_();var p=t.memoizedState;s!==u||h!==p||sb||null!==e&&null!==e.dependencies&&sp(e.dependencies)?("function"==typeof a&&(oj(t,n,a,r),p=t.memoizedState),(d=sb||oM(t,n,d,r,h,p,l)||null!==e&&null!==e.dependencies&&sp(e.dependencies))?(c||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=l,r=d):("function"!=typeof o.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),r=!1)}return o=r,oZ(e,t),r=0!=(128&t.flags),o||r?(o=t.stateNode,n=r&&"function"!=typeof n.getDerivedStateFromError?null:o.render(),t.flags|=1,null!==e&&r?(t.child=ox(t,e.child,null,i),t.child=ox(t,null,n,i)):oK(e,t,n,i),t.memoizedState=o.state,e=t.child):e=sn(e,t,i),e}function o1(e,t,n,r){return rv(),t.flags|=256,oK(e,t,n,r),t.child}var o2={dehydrated:null,treeContext:null,retryLane:0};function o3(e){return{baseLanes:e,cachePool:rQ()}}function o5(e,t,n){return e=null!==e?e.childLanes&~n:0,t&&(e|=aF),e}function o4(e,t,n){var r,i=t.pendingProps,o=!1,s=0!=(128&t.flags);if((r=s)||(r=(null===e||null!==e.memoizedState)&&0!=(2&oI.current)),r&&(o=!0,t.flags&=-129),r=0!=(32&t.flags),t.flags&=-33,null===e){if(rh){if(o?ok(t):oP(t),rh){var a,c=ru;if(a=c){r:{for(a=c,c=rf;8!==a.nodeType;)if(!c||null===(a=cd(a.nextSibling))){c=null;break r}c=a}null!==c?(t.memoizedState={dehydrated:c,treeContext:null!==rr?{id:ri,overflow:ro}:null,retryLane:0x20000000},(a=al(18,null,null,0)).stateNode=c,a.return=t,t.child=a,rd=t,ru=null,a=!0):a=!1}a||rm(t)}if(null!==(c=t.memoizedState)&&null!==(c=c.dehydrated))return cc(c)?t.lanes=16:t.lanes=0x20000000,null;o_(t)}return(c=i.children,i=i.fallback,o)?(oP(t),c=o8({mode:"hidden",children:c},o=t.mode),i=ap(i,o,n,null),c.return=t,i.return=t,c.sibling=i,t.child=c,(o=t.child).memoizedState=o3(n),o.childLanes=o5(e,r,n),t.memoizedState=o2,i):(ok(t),o6(t,c))}if(null!==(a=e.memoizedState)&&null!==(c=a.dehydrated)){if(s)256&t.flags?(ok(t),t.flags&=-257,t=o9(e,t,n)):null!==t.memoizedState?(oP(t),t.child=e.child,t.flags|=128,t=null):(oP(t),o=i.fallback,c=t.mode,i=o8({mode:"visible",children:i.children},c),o=ap(o,c,n,null),o.flags|=2,i.return=t,o.return=t,i.sibling=o,t.child=i,ox(t,e.child,null,n),(i=t.child).memoizedState=o3(n),i.childLanes=o5(e,r,n),t.memoizedState=o2,t=o);else if(ok(t),cc(c)){if(r=c.nextSibling&&c.nextSibling.dataset)var d=r.dgst;r=d,(i=Error(l(419))).stack="",i.digest=r,rw({value:i,source:null,stack:null}),t=o9(e,t,n)}else if(oH||sh(e,t,n,!1),r=0!=(n&e.childLanes),oH||r){if(null!==(r=a_)){if(0!=(42&(i=n&-n)))i=1;else switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 0x1000000:case 0x2000000:i=64;break;case 0x10000000:i=0x8000000;break;default:i=0}if(0!==(i=0!=(i&(r.suspendedLanes|n))?0:i)&&i!==a.retryLane)throw a.retryLane=i,n1(e,i),a3(r,e,i),oV}"$?"===c.data||li(),t=o9(e,t,n)}else"$?"===c.data?(t.flags|=192,t.child=e.child,t=null):(e=a.treeContext,ru=cd(c.nextSibling),rd=t,rh=!0,rp=null,rf=!1,null!==e&&(rt[rn++]=ri,rt[rn++]=ro,rt[rn++]=rr,ri=e.id,ro=e.overflow,rr=t),t=o6(t,i.children),t.flags|=4096);return t}return o?(oP(t),o=i.fallback,c=t.mode,d=(a=e.child).sibling,(i=ad(a,{mode:"hidden",children:i.children})).subtreeFlags=0x1e00000&a.subtreeFlags,null!==d?o=ad(d,o):(o=ap(o,c,n,null),o.flags|=2),o.return=t,i.return=t,i.sibling=o,t.child=i,i=o,o=t.child,null===(c=e.child.memoizedState)?c=o3(n):(null!==(a=c.cachePool)?(d=rD._currentValue,a=a.parent!==d?{parent:d,pool:d}:a):a=rQ(),c={baseLanes:c.baseLanes|n,cachePool:a}),o.memoizedState=c,o.childLanes=o5(e,r,n),t.memoizedState=o2,i):(ok(t),e=(n=e.child).sibling,(n=ad(n,{mode:"visible",children:i.children})).return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n)}function o6(e,t){return(t=o8({mode:"visible",children:t},e.mode)).return=e,e.child=t}function o8(e,t){return af(e,t,0,null)}function o9(e,t,n){return ox(t,e.child,null,n),e=o6(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function o7(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),sd(e.return,t,n)}function se(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function st(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(oK(e,t,r.children,n),0!=(2&(r=oI.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!=(128&e.flags))t:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&o7(e,n,t);else if(19===e.tag)o7(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break;for(;null===e.sibling;){if(null===e.return||e.return===t)break t;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}switch(W(oI,r),i){case"forwards":for(i=null,n=t.child;null!==n;)null!==(e=n.alternate)&&null===oE(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),se(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===oE(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}se(t,!0,n,null,o);break;case"together":se(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function sn(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),az|=t.lanes,0==(n&t.childLanes)&&(null===e||(sh(e,t,n,!1),0==(n&t.childLanes))))return null;if(null!==e&&t.child!==e.child)throw Error(l(153));if(null!==t.child){for(n=ad(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=ad(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function sr(e,t){return 0!=(e.lanes&t)||!!(null!==(e=e.dependencies)&&sp(e))}function si(e,t,n){if(null!==e){if(e.memoizedProps!==t.pendingProps)oH=!0;else{if(!sr(e,n)&&0==(128&t.flags))return oH=!1,function(e,t,n){switch(t.tag){case 3:Z(t,t.stateNode.containerInfo),sl(t,rD,e.memoizedState.cache),rv();break;case 27:case 5:J(t);break;case 4:Z(t,t.stateNode.containerInfo);break;case 10:sl(t,t.type,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r){if(null!==r.dehydrated)return ok(t),t.flags|=128,null;if(0!=(n&t.child.childLanes))return o4(e,t,n);return ok(t),null!==(e=sn(e,t,n))?e.sibling:null}ok(t);break;case 19:var i=0!=(128&e.flags);if((r=0!=(n&t.childLanes))||(sh(e,t,n,!1),r=0!=(n&t.childLanes)),i){if(r)return st(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),W(oI,oI.current),!r)return null;break;case 22:case 23:return t.lanes=0,oY(e,t,n);case 24:sl(t,rD,e.memoizedState.cache)}return sn(e,t,n)}(e,t,n);oH=0!=(131072&e.flags)}}else oH=!1,rh&&0!=(1048576&t.flags)&&ra(t,re,t.index);switch(t.lanes=0,t.tag){case 16:t:{e=t.pendingProps;var r=t.elementType,i=r._init;if(r=i(r._payload),t.type=r,"function"==typeof r)ac(r)?(e=oO(r,e),t.tag=1,t=o0(null,t,r,e,n)):(t.tag=0,t=oQ(null,t,r,e,n));else{if(null!=r){if((i=r.$$typeof)===b){t.tag=11,t=oW(null,t,r,e,n);break t}if(i===w){t.tag=14,t=oG(null,t,r,e,n);break t}}throw Error(l(306,t=function e(t){if(null==t)return null;if("function"==typeof t)return t.$$typeof===j?null:t.displayName||t.name||null;if("string"==typeof t)return t;switch(t){case h:return"Fragment";case u:return"Portal";case f:return"Profiler";case p:return"StrictMode";case x:return"Suspense";case v:return"SuspenseList"}if("object"==typeof t)switch(t.$$typeof){case y:return(t.displayName||"Context")+".Provider";case m:return(t._context.displayName||"Context")+".Consumer";case b:var n=t.render;return(t=t.displayName)||(t=""!==(t=n.displayName||n.name||"")?"ForwardRef("+t+")":"ForwardRef"),t;case w:return null!==(n=t.displayName||null)?n:e(t.type)||"Memo";case S:n=t._payload,t=t._init;try{return e(t(n))}catch(e){}}return null}(r)||r,""))}}return t;case 0:return oQ(e,t,t.type,t.pendingProps,n);case 1:return i=oO(r=t.type,t.pendingProps),o0(e,t,r,i,n);case 3:t:{if(Z(t,t.stateNode.containerInfo),null===e)throw Error(l(387));var o=t.pendingProps;r=(i=t.memoizedState).element,sv(e,t),sI(t,o,null,n);var s=t.memoizedState;if(sl(t,rD,o=s.cache),o!==i.cache&&su(t,[rD],n,!0),s_(),o=s.element,i.isDehydrated){if(i={element:o,isDehydrated:!1,cache:s.cache},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=o1(e,t,o,n);break t}if(o!==r){rw(r=n6(Error(l(424)),t)),t=o1(e,t,o,n);break t}for(ru=cd(t.stateNode.containerInfo.firstChild),rd=t,rh=!0,rp=null,rf=!0,n=ov(t,null,o,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(rv(),o===r){t=sn(e,t,n);break t}oK(e,t,o,n)}t=t.child}return t;case 26:return oZ(e,t),null===e?(n=cx(t.type,null,t.pendingProps,null))?t.memoizedState=n:rh||(n=t.type,e=t.pendingProps,(r=l8(Y.current).createElement(n))[eD]=t,r[ez]=e,l5(r,n,e),eq(r),t.stateNode=r):t.memoizedState=cx(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return J(t),null===e&&rh&&(r=t.stateNode=ch(t.type,t.pendingProps,Y.current),rd=t,rf=!0,ru=cd(r.firstChild)),r=t.pendingProps.children,null!==e||rh?oK(e,t,r,n):t.child=ox(t,null,r,n),oZ(e,t),t.child;case 5:return null===e&&rh&&((i=r=ru)&&(null!==(r=function(e,t,n,r){for(;1===e.nodeType;){if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!r&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(r){if(!e[eU])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(i=e.getAttribute("rel"))&&e.hasAttribute("data-precedence")||i!==n.rel||e.getAttribute("href")!==(null==n.href?null:n.href)||e.getAttribute("crossorigin")!==(null==n.crossOrigin?null:n.crossOrigin)||e.getAttribute("title")!==(null==n.title?null:n.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((i=e.getAttribute("src"))!==(null==n.src?null:n.src)||e.getAttribute("type")!==(null==n.type?null:n.type)||e.getAttribute("crossorigin")!==(null==n.crossOrigin?null:n.crossOrigin))&&i&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var i=null==n.name?null:""+n.name;if("hidden"===n.type&&e.getAttribute("name")===i)return e}if(null===(e=cd(e.nextSibling)))break}return null}(r,t.type,t.pendingProps,rf))?(t.stateNode=r,rd=t,ru=cd(r.firstChild),rf=!1,i=!0):i=!1),i||rm(t)),J(t),i=t.type,o=t.pendingProps,s=null!==e?e.memoizedProps:null,r=o.children,ce(i,o)?r=null:null!==s&&ce(i,s)&&(t.flags|=32),null!==t.memoizedState&&(i=ir(e,t,is,null,null,n),cF._currentValue=i),oZ(e,t),oK(e,t,r,n),t.child;case 6:return null===e&&rh&&((e=n=ru)&&(null!==(n=function(e,t,n){if(""===t)return null;for(;3!==e.nodeType;)if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!n||null===(e=cd(e.nextSibling)))return null;return e}(n,t.pendingProps,rf))?(t.stateNode=n,rd=t,ru=null,e=!0):e=!1),e||rm(t)),null;case 13:return o4(e,t,n);case 4:return Z(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ox(t,null,r,n):oK(e,t,r,n),t.child;case 11:return oW(e,t,t.type,t.pendingProps,n);case 7:return oK(e,t,t.pendingProps,n),t.child;case 8:case 12:return oK(e,t,t.pendingProps.children,n),t.child;case 10:return r=t.pendingProps,sl(t,t.type,r.value),oK(e,t,r.children,n),t.child;case 9:return i=t.type._context,r=t.pendingProps.children,sf(t),r=r(i=sg(i)),t.flags|=1,oK(e,t,r,n),t.child;case 14:return oG(e,t,t.type,t.pendingProps,n);case 15:return oq(e,t,t.type,t.pendingProps,n);case 19:return st(e,t,n);case 22:return oY(e,t,n);case 24:return sf(t),r=sg(rD),null===e?(null===(i=rX())&&(i=a_,o=rz(),i.pooledCache=o,o.refCount++,null!==o&&(i.pooledCacheLanes|=n),i=o),t.memoizedState={parent:r,cache:i},sx(t),sl(t,rD,i)):(0!=(e.lanes&n)&&(sv(e,t),sI(t,null,null,n),s_()),i=e.memoizedState,o=t.memoizedState,i.parent!==r?(i={parent:r,cache:r},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),sl(t,rD,r)):(sl(t,rD,r=o.cache),r!==i.cache&&su(t,[rD],n,!0))),oK(e,t,t.pendingProps.children,n),t.child;case 29:throw t.pendingProps}throw Error(l(156,t.tag))}var so=H(null),ss=null,sa=null;function sl(e,t,n){W(so,t._currentValue),t._currentValue=n}function sc(e){e._currentValue=so.current,K(so)}function sd(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function su(e,t,n,r){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var o=i.dependencies;if(null!==o){var s=i.child;o=o.firstContext;t:for(;null!==o;){var a=o;o=i;for(var c=0;c<t.length;c++)if(a.context===t[c]){o.lanes|=n,null!==(a=o.alternate)&&(a.lanes|=n),sd(o.return,n,e),r||(s=null);break t}o=a.next}}else if(18===i.tag){if(null===(s=i.return))throw Error(l(341));s.lanes|=n,null!==(o=s.alternate)&&(o.lanes|=n),sd(s,n,e),s=null}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===e){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}}function sh(e,t,n,r){e=null;for(var i=t,o=!1;null!==i;){if(!o){if(0!=(524288&i.flags))o=!0;else if(0!=(262144&i.flags))break}if(10===i.tag){var s=i.alternate;if(null===s)throw Error(l(387));if(null!==(s=s.memoizedProps)){var a=i.type;nS(i.pendingProps.value,s.value)||(null!==e?e.push(a):e=[a])}}else if(i===X.current){if(null===(s=i.alternate))throw Error(l(387));s.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(cF):e=[cF])}i=i.return}null!==e&&su(t,e,n,r),t.flags|=262144}function sp(e){for(e=e.firstContext;null!==e;){if(!nS(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function sf(e){ss=e,sa=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function sg(e){return sy(ss,e)}function sm(e,t){return null===ss&&sf(e),sy(e,t)}function sy(e,t){var n=t._currentValue;if(t={context:t,memoizedValue:n,next:null},null===sa){if(null===e)throw Error(l(308));sa=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else sa=sa.next=t;return n}var sb=!1;function sx(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function sv(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function sw(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function sS(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!=(2&aP)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,t=n3(e),n2(e,null,n),t}return nJ(e,r,t,n),n3(e)}function sk(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!=(4194176&n))){var r=t.lanes;r&=e.pendingLanes,n|=r,t.lanes=n,eM(e,n)}}function sC(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={lane:n.lane,tag:n.tag,payload:n.payload,callback:null,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,callbacks:r.callbacks},e.updateQueue=n;return}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}var sP=!1;function s_(){if(sP){var e=rB;if(null!==e)throw e}}function sI(e,t,n,r){sP=!1;var i=e.updateQueue;sb=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var d=e.alternate;null!==d&&(a=(d=d.updateQueue).lastBaseUpdate)!==s&&(null===a?d.firstBaseUpdate=c:a.next=c,d.lastBaseUpdate=l)}if(null!==o){var u=i.baseState;for(s=0,d=c=l=null,a=o;;){var h=-0x20000001&a.lane,p=h!==a.lane;if(p?(aE&h)===h:(r&h)===h){0!==h&&h===r$&&(sP=!0),null!==d&&(d=d.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});t:{var f=e,g=a;switch(h=t,g.tag){case 1:if("function"==typeof(f=g.payload)){u=f.call(n,u,h);break t}u=f;break t;case 3:f.flags=-65537&f.flags|128;case 0:if(null==(h="function"==typeof(f=g.payload)?f.call(n,u,h):f))break t;u=M({},u,h);break t;case 2:sb=!0}}null!==(h=a.callback)&&(e.flags|=64,p&&(e.flags|=8192),null===(p=i.callbacks)?i.callbacks=[h]:p.push(h))}else p={lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===d?(c=d=p,l=u):d=d.next=p,s|=h;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(p=a).next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}null===d&&(l=u),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=d,null===o&&(i.shared.lanes=0),az|=s,e.lanes=s,e.memoizedState=u}}function sE(e,t){if("function"!=typeof e)throw Error(l(191,e));e.call(t)}function sj(e,t){var n=e.callbacks;if(null!==n)for(e.callbacks=null,e=0;e<n.length;e++)sE(n[e],t)}function sT(e,t){try{var n=t.updateQueue,r=null!==n?n.lastEffect:null;if(null!==r){var i=r.next;n=i;do{if((n.tag&e)===e){r=void 0;var o=n.create,s=n.inst;r=o(),s.destroy=r}n=n.next}while(n!==i)}}catch(e){lg(t,t.return,e)}}function sM(e,t,n){try{var r=t.updateQueue,i=null!==r?r.lastEffect:null;if(null!==i){var o=i.next;r=o;do{if((r.tag&e)===e){var s=r.inst,a=s.destroy;if(void 0!==a){s.destroy=void 0,i=t;try{a()}catch(e){lg(i,n,e)}}}r=r.next}while(r!==o)}}catch(e){lg(t,t.return,e)}}function sA(e){var t=e.updateQueue;if(null!==t){var n=e.stateNode;try{sj(t,n)}catch(t){lg(e,e.return,t)}}}function sO(e,t,n){n.props=oO(e.type,e.memoizedProps),n.state=e.memoizedState;try{n.componentWillUnmount()}catch(n){lg(e,t,n)}}function sL(e,t){try{var n=e.ref;if(null!==n){var r=e.stateNode;switch(e.tag){case 26:case 27:case 5:var i=r;break;default:i=r}"function"==typeof n?e.refCleanup=n(i):n.current=i}}catch(n){lg(e,t,n)}}function sD(e,t){var n=e.ref,r=e.refCleanup;if(null!==n){if("function"==typeof r)try{r()}catch(n){lg(e,t,n)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"==typeof n)try{n(null)}catch(n){lg(e,t,n)}else n.current=null}}function sz(e){var t=e.type,n=e.memoizedProps,r=e.stateNode;try{switch(t){case"button":case"input":case"select":case"textarea":n.autoFocus&&r.focus();break;case"img":n.src?r.src=n.src:n.srcSet&&(r.srcset=n.srcSet)}}catch(t){lg(e,e.return,t)}}function sR(e,t,n){try{var r=e.stateNode;(function(e,t,n,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,o=null,s=null,a=null,c=null,d=null,u=null;for(f in n){var h=n[f];if(n.hasOwnProperty(f)&&null!=h)switch(f){case"checked":case"value":break;case"defaultValue":c=h;default:r.hasOwnProperty(f)||l2(e,t,f,null,r,h)}}for(var p in r){var f=r[p];if(h=n[p],r.hasOwnProperty(p)&&(null!=f||null!=h))switch(p){case"type":o=f;break;case"name":i=f;break;case"checked":d=f;break;case"defaultChecked":u=f;break;case"value":s=f;break;case"defaultValue":a=f;break;case"children":case"dangerouslySetInnerHTML":if(null!=f)throw Error(l(137,t));break;default:f!==h&&l2(e,t,p,f,r,h)}}tr(e,s,a,c,d,u,o,i);return;case"select":for(o in f=s=a=p=null,n)if(c=n[o],n.hasOwnProperty(o)&&null!=c)switch(o){case"value":break;case"multiple":f=c;default:r.hasOwnProperty(o)||l2(e,t,o,null,r,c)}for(i in r)if(o=r[i],c=n[i],r.hasOwnProperty(i)&&(null!=o||null!=c))switch(i){case"value":p=o;break;case"defaultValue":a=o;break;case"multiple":s=o;default:o!==c&&l2(e,t,i,o,r,c)}t=a,n=s,r=f,null!=p?ts(e,!!n,p,!1):!!r!=!!n&&(null!=t?ts(e,!!n,t,!0):ts(e,!!n,n?[]:"",!1));return;case"textarea":for(a in f=p=null,n)if(i=n[a],n.hasOwnProperty(a)&&null!=i&&!r.hasOwnProperty(a))switch(a){case"value":case"children":break;default:l2(e,t,a,null,r,i)}for(s in r)if(i=r[s],o=n[s],r.hasOwnProperty(s)&&(null!=i||null!=o))switch(s){case"value":p=i;break;case"defaultValue":f=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(l(91));break;default:i!==o&&l2(e,t,s,i,r,o)}ta(e,p,f);return;case"option":for(var g in n)p=n[g],n.hasOwnProperty(g)&&null!=p&&!r.hasOwnProperty(g)&&("selected"===g?e.selected=!1:l2(e,t,g,null,r,p));for(c in r)p=r[c],f=n[c],r.hasOwnProperty(c)&&p!==f&&(null!=p||null!=f)&&("selected"===c?e.selected=p&&"function"!=typeof p&&"symbol"!=typeof p:l2(e,t,c,p,r,f));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in n)p=n[m],n.hasOwnProperty(m)&&null!=p&&!r.hasOwnProperty(m)&&l2(e,t,m,null,r,p);for(d in r)if(p=r[d],f=n[d],r.hasOwnProperty(d)&&p!==f&&(null!=p||null!=f))switch(d){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(l(137,t));break;default:l2(e,t,d,p,r,f)}return;default:if(tp(t)){for(var y in n)p=n[y],n.hasOwnProperty(y)&&void 0!==p&&!r.hasOwnProperty(y)&&l3(e,t,y,void 0,r,p);for(u in r)p=r[u],f=n[u],r.hasOwnProperty(u)&&p!==f&&(void 0!==p||void 0!==f)&&l3(e,t,u,p,r,f);return}}for(var b in n)p=n[b],n.hasOwnProperty(b)&&null!=p&&!r.hasOwnProperty(b)&&l2(e,t,b,null,r,p);for(h in r)p=r[h],f=n[h],r.hasOwnProperty(h)&&p!==f&&(null!=p||null!=f)&&l2(e,t,h,p,r,f)})(r,e.type,n,t),r[ez]=t}catch(t){lg(e,e.return,t)}}function sN(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag||4===e.tag}function sF(e){t:for(;;){for(;null===e.sibling;){if(null===e.return||sN(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&27!==e.tag&&18!==e.tag;){if(2&e.flags||null===e.child||4===e.tag)continue t;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function s$(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&27!==r&&null!==(e=e.child))for(s$(e,t,n),e=e.sibling;null!==e;)s$(e,t,n),e=e.sibling}var sB=!1,sU=!1,sV=!1,sH="function"==typeof WeakSet?WeakSet:Set,sK=null,sW=!1;function sG(e,t,n){var r=n.flags;switch(n.tag){case 0:case 11:case 15:s5(e,n),4&r&&sT(5,n);break;case 1:if(s5(e,n),4&r){if(e=n.stateNode,null===t)try{e.componentDidMount()}catch(e){lg(n,n.return,e)}else{var i=oO(n.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(e){lg(n,n.return,e)}}}64&r&&sA(n),512&r&&sL(n,n.return);break;case 3:if(s5(e,n),64&r&&null!==(r=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 27:case 5:case 1:e=n.child.stateNode}try{sj(r,e)}catch(e){lg(n,n.return,e)}}break;case 26:s5(e,n),512&r&&sL(n,n.return);break;case 27:case 5:s5(e,n),null===t&&4&r&&sz(n),512&r&&sL(n,n.return);break;case 12:default:s5(e,n);break;case 13:s5(e,n),4&r&&sQ(e,n),64&r&&null!==(r=n.memoizedState)&&null!==(r=r.dehydrated)&&function(e,t){var n=e.ownerDocument;if("$?"!==e.data||"complete"===n.readyState)t();else{var r=function(){t(),n.removeEventListener("DOMContentLoaded",r)};n.addEventListener("DOMContentLoaded",r),e._reactRetry=r}}(r,n=lx.bind(null,n));break;case 22:if(!(i=null!==n.memoizedState||sB)){t=null!==t&&null!==t.memoizedState||sU;var o=sB,s=sU;sB=i,(sU=t)&&!s?function e(t,n,r){for(r=r&&0!=(8772&n.subtreeFlags),n=n.child;null!==n;){var i=n.alternate,o=t,s=n,a=s.flags;switch(s.tag){case 0:case 11:case 15:e(o,s,r),sT(4,s);break;case 1:if(e(o,s,r),"function"==typeof(o=(i=s).stateNode).componentDidMount)try{o.componentDidMount()}catch(e){lg(i,i.return,e)}if(null!==(o=(i=s).updateQueue)){var l=i.stateNode;try{var c=o.shared.hiddenCallbacks;if(null!==c)for(o.shared.hiddenCallbacks=null,o=0;o<c.length;o++)sE(c[o],l)}catch(e){lg(i,i.return,e)}}r&&64&a&&sA(s),sL(s,s.return);break;case 26:case 27:case 5:e(o,s,r),r&&null===i&&4&a&&sz(s),sL(s,s.return);break;case 12:default:e(o,s,r);break;case 13:e(o,s,r),r&&4&a&&sQ(o,s);break;case 22:null===s.memoizedState&&e(o,s,r),sL(s,s.return)}n=n.sibling}}(e,n,0!=(8772&n.subtreeFlags)):s5(e,n),sB=o,sU=s}512&r&&("manual"===n.memoizedProps.mode?sL(n,n.return):sD(n,n.return))}}var sq=null,sY=!1;function sX(e,t,n){for(n=n.child;null!==n;)sZ(e,t,n),n=n.sibling}function sZ(e,t,n){if(em&&"function"==typeof em.onCommitFiberUnmount)try{em.onCommitFiberUnmount(eg,n)}catch(e){}switch(n.tag){case 26:sU||sD(n,t),sX(e,t,n),n.memoizedState?n.memoizedState.count--:n.stateNode&&(n=n.stateNode).parentNode.removeChild(n);break;case 27:sU||sD(n,t);var r=sq,i=sY;for(sq=n.stateNode,sX(e,t,n),t=(n=n.stateNode).attributes;t.length;)n.removeAttributeNode(t[0]);eV(n),sq=r,sY=i;break;case 5:sU||sD(n,t);case 6:i=sq;var o=sY;if(sq=null,sX(e,t,n),sq=i,sY=o,null!==sq){if(sY)try{e=sq,r=n.stateNode,8===e.nodeType?e.parentNode.removeChild(r):e.removeChild(r)}catch(e){lg(n,t,e)}else try{sq.removeChild(n.stateNode)}catch(e){lg(n,t,e)}}break;case 18:null!==sq&&(sY?(t=sq,n=n.stateNode,8===t.nodeType?ca(t.parentNode,n):1===t.nodeType&&ca(t,n),da(t)):ca(sq,n.stateNode));break;case 4:r=sq,i=sY,sq=n.stateNode.containerInfo,sY=!0,sX(e,t,n),sq=r,sY=i;break;case 0:case 11:case 14:case 15:sU||sM(2,n,t),sU||sM(4,n,t),sX(e,t,n);break;case 1:sU||(sD(n,t),"function"==typeof(r=n.stateNode).componentWillUnmount&&sO(n,t,r)),sX(e,t,n);break;case 21:default:sX(e,t,n);break;case 22:sU||sD(n,t),sU=(r=sU)||null!==n.memoizedState,sX(e,t,n),sU=r}}function sQ(e,t){if(null===t.memoizedState&&null!==(e=t.alternate)&&null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))try{da(e)}catch(e){lg(t,t.return,e)}}function sJ(e,t){var n=function(e){switch(e.tag){case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new sH),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new sH),t;default:throw Error(l(435,e.tag))}}(e);t.forEach(function(t){var r=lv.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))})}function s0(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r],o=e,s=t,a=s;t:for(;null!==a;){switch(a.tag){case 27:case 5:sq=a.stateNode,sY=!1;break t;case 3:case 4:sq=a.stateNode.containerInfo,sY=!0;break t}a=a.return}if(null===sq)throw Error(l(160));sZ(o,s,i),sq=null,sY=!1,null!==(o=i.alternate)&&(o.return=null),i.return=null}if(13878&t.subtreeFlags)for(t=t.child;null!==t;)s2(t,e),t=t.sibling}var s1=null;function s2(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:s0(t,e),s3(e),4&r&&(sM(3,e,e.return),sT(3,e),sM(5,e,e.return));break;case 1:s0(t,e),s3(e),512&r&&(sU||null===n||sD(n,n.return)),64&r&&sB&&null!==(e=e.updateQueue)&&null!==(r=e.callbacks)&&(n=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===n?r:n.concat(r));break;case 26:var i=s1;if(s0(t,e),s3(e),512&r&&(sU||null===n||sD(n,n.return)),4&r){var o=null!==n?n.memoizedState:null;if(r=e.memoizedState,null===n){if(null===r){if(null===e.stateNode){t:{r=e.type,n=e.memoizedProps,i=i.ownerDocument||i;n:switch(r){case"title":(!(o=i.getElementsByTagName("title")[0])||o[eU]||o[eD]||"http://www.w3.org/2000/svg"===o.namespaceURI||o.hasAttribute("itemprop"))&&(o=i.createElement(r),i.head.insertBefore(o,i.querySelector("head > title"))),l5(o,r,n),o[eD]=e,eq(o),r=o;break t;case"link":var s=cT("link","href",i).get(r+(n.href||""));if(s){for(var a=0;a<s.length;a++)if((o=s[a]).getAttribute("href")===(null==n.href?null:n.href)&&o.getAttribute("rel")===(null==n.rel?null:n.rel)&&o.getAttribute("title")===(null==n.title?null:n.title)&&o.getAttribute("crossorigin")===(null==n.crossOrigin?null:n.crossOrigin)){s.splice(a,1);break n}}l5(o=i.createElement(r),r,n),i.head.appendChild(o);break;case"meta":if(s=cT("meta","content",i).get(r+(n.content||""))){for(a=0;a<s.length;a++)if((o=s[a]).getAttribute("content")===(null==n.content?null:""+n.content)&&o.getAttribute("name")===(null==n.name?null:n.name)&&o.getAttribute("property")===(null==n.property?null:n.property)&&o.getAttribute("http-equiv")===(null==n.httpEquiv?null:n.httpEquiv)&&o.getAttribute("charset")===(null==n.charSet?null:n.charSet)){s.splice(a,1);break n}}l5(o=i.createElement(r),r,n),i.head.appendChild(o);break;default:throw Error(l(468,r))}o[eD]=e,eq(o),r=o}e.stateNode=r}else cM(i,e.type,e.stateNode)}else e.stateNode=cP(i,r,e.memoizedProps)}else o!==r?(null===o?null!==n.stateNode&&(n=n.stateNode).parentNode.removeChild(n):o.count--,null===r?cM(i,e.type,e.stateNode):cP(i,r,e.memoizedProps)):null===r&&null!==e.stateNode&&sR(e,e.memoizedProps,n.memoizedProps)}break;case 27:if(4&r&&null===e.alternate){i=e.stateNode,o=e.memoizedProps;try{for(var c=i.firstChild;c;){var d=c.nextSibling,u=c.nodeName;c[eU]||"HEAD"===u||"BODY"===u||"SCRIPT"===u||"STYLE"===u||"LINK"===u&&"stylesheet"===c.rel.toLowerCase()||i.removeChild(c),c=d}for(var h=e.type,p=i.attributes;p.length;)i.removeAttributeNode(p[0]);l5(i,h,o),i[eD]=e,i[ez]=o}catch(t){lg(e,e.return,t)}}case 5:if(s0(t,e),s3(e),512&r&&(sU||null===n||sD(n,n.return)),32&e.flags){i=e.stateNode;try{tc(i,"")}catch(t){lg(e,e.return,t)}}4&r&&null!=e.stateNode&&(i=e.memoizedProps,sR(e,i,null!==n?n.memoizedProps:i)),1024&r&&(sV=!0);break;case 6:if(s0(t,e),s3(e),4&r){if(null===e.stateNode)throw Error(l(162));r=e.memoizedProps,n=e.stateNode;try{n.nodeValue=r}catch(t){lg(e,e.return,t)}}break;case 3:if(cj=null,i=s1,s1=cg(t.containerInfo),s0(t,e),s1=i,s3(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{da(t.containerInfo)}catch(t){lg(e,e.return,t)}sV&&(sV=!1,function e(t){if(1024&t.subtreeFlags)for(t=t.child;null!==t;){var n=t;e(n),5===n.tag&&1024&n.flags&&n.stateNode.reset(),t=t.sibling}}(e));break;case 4:r=s1,s1=cg(e.stateNode.containerInfo),s0(t,e),s3(e),s1=r;break;case 12:default:s0(t,e),s3(e);break;case 13:s0(t,e),s3(e),8192&e.child.flags&&null!==e.memoizedState!=(null!==n&&null!==n.memoizedState)&&(aH=es()),4&r&&null!==(r=e.updateQueue)&&(e.updateQueue=null,sJ(e,r));break;case 22:if(512&r&&(sU||null===n||sD(n,n.return)),c=null!==e.memoizedState,d=null!==n&&null!==n.memoizedState,u=sB,h=sU,sB=u||c,sU=h||d,s0(t,e),sU=h,sB=u,s3(e),(t=e.stateNode)._current=e,t._visibility&=-3,t._visibility|=2&t._pendingVisibility,8192&r&&(t._visibility=c?-2&t._visibility:1|t._visibility,c&&(t=sB||sU,null===n||d||t||function e(t){for(t=t.child;null!==t;){var n=t;switch(n.tag){case 0:case 11:case 14:case 15:sM(4,n,n.return),e(n);break;case 1:sD(n,n.return);var r=n.stateNode;"function"==typeof r.componentWillUnmount&&sO(n,n.return,r),e(n);break;case 26:case 27:case 5:sD(n,n.return),e(n);break;case 22:sD(n,n.return),null===n.memoizedState&&e(n);break;default:e(n)}t=t.sibling}}(e)),null===e.memoizedProps||"manual"!==e.memoizedProps.mode))t:for(n=null,t=e;;){if(5===t.tag||26===t.tag||27===t.tag){if(null===n){d=n=t;try{if(i=d.stateNode,c)o=i.style,"function"==typeof o.setProperty?o.setProperty("display","none","important"):o.display="none";else{s=d.stateNode;var f=null!=(a=d.memoizedProps.style)&&a.hasOwnProperty("display")?a.display:null;s.style.display=null==f||"boolean"==typeof f?"":(""+f).trim()}}catch(e){lg(d,d.return,e)}}}else if(6===t.tag){if(null===n){d=t;try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(e){lg(d,d.return,e)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)break t;n===t&&(n=null),t=t.return}n===t&&(n=null),t.sibling.return=t.return,t=t.sibling}4&r&&null!==(r=e.updateQueue)&&null!==(n=r.retryQueue)&&(r.retryQueue=null,sJ(e,n));break;case 19:s0(t,e),s3(e),4&r&&null!==(r=e.updateQueue)&&(e.updateQueue=null,sJ(e,r));case 21:}}function s3(e){var t=e.flags;if(2&t){try{if(27!==e.tag){t:{for(var n=e.return;null!==n;){if(sN(n)){var r=n;break t}n=n.return}throw Error(l(160))}switch(r.tag){case 27:var i=r.stateNode,o=sF(e);s$(e,o,i);break;case 5:var s=r.stateNode;32&r.flags&&(tc(s,""),r.flags&=-33);var a=sF(e);s$(e,a,s);break;case 3:case 4:var c=r.stateNode.containerInfo,d=sF(e);!function e(t,n,r){var i=t.tag;if(5===i||6===i)t=t.stateNode,n?8===r.nodeType?r.parentNode.insertBefore(t,n):r.insertBefore(t,n):(8===r.nodeType?(n=r.parentNode).insertBefore(t,r):(n=r).appendChild(t),null!=(r=r._reactRootContainer)||null!==n.onclick||(n.onclick=l1));else if(4!==i&&27!==i&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,d,c);break;default:throw Error(l(161))}}}catch(t){lg(e,e.return,t)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function s5(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)sG(e,t.alternate,t),t=t.sibling}function s4(e,t){var n=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==n&&(null!=e&&e.refCount++,null!=n&&rR(n))}function s6(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&rR(e))}function s8(e,t,n,r){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)s9(e,t,n,r),t=t.sibling}function s9(e,t,n,r){var i=t.flags;switch(t.tag){case 0:case 11:case 15:s8(e,t,n,r),2048&i&&sT(9,t);break;case 3:s8(e,t,n,r),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&rR(e)));break;case 12:if(2048&i){s8(e,t,n,r),e=t.stateNode;try{var o=t.memoizedProps,s=o.id,a=o.onPostCommit;"function"==typeof a&&a(s,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(e){lg(t,t.return,e)}}else s8(e,t,n,r);break;case 23:break;case 22:o=t.stateNode,null!==t.memoizedState?4&o._visibility?s8(e,t,n,r):s7(e,t):4&o._visibility?s8(e,t,n,r):(o._visibility|=4,function e(t,n,r,i,o){for(o=o&&0!=(10256&n.subtreeFlags),n=n.child;null!==n;){var s=n,a=s.flags;switch(s.tag){case 0:case 11:case 15:e(t,s,r,i,o),sT(8,s);break;case 23:break;case 22:var l=s.stateNode;null!==s.memoizedState?4&l._visibility?e(t,s,r,i,o):s7(t,s):(l._visibility|=4,e(t,s,r,i,o)),o&&2048&a&&s4(s.alternate,s);break;case 24:e(t,s,r,i,o),o&&2048&a&&s6(s.alternate,s);break;default:e(t,s,r,i,o)}n=n.sibling}}(e,t,n,r,0!=(10256&t.subtreeFlags))),2048&i&&s4(t.alternate,t);break;case 24:s8(e,t,n,r),2048&i&&s6(t.alternate,t);break;default:s8(e,t,n,r)}}function s7(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var n=t,r=n.flags;switch(n.tag){case 22:s7(e,n),2048&r&&s4(n.alternate,n);break;case 24:s7(e,n),2048&r&&s6(n.alternate,n);break;default:s7(e,n)}t=t.sibling}}var ae=8192;function at(e){if(e.subtreeFlags&ae)for(e=e.child;null!==e;)an(e),e=e.sibling}function an(e){switch(e.tag){case 26:at(e),e.flags&ae&&null!==e.memoizedState&&function(e,t,n){if(null===cO)throw Error(l(475));var r=cO;if("stylesheet"===t.type&&("string"!=typeof n.media||!1!==matchMedia(n.media).matches)&&0==(4&t.state.loading)){if(null===t.instance){var i=cv(n.href),o=e.querySelector(cw(i));if(o){null!==(e=o._p)&&"object"==typeof e&&"function"==typeof e.then&&(r.count++,r=cD.bind(r),e.then(r,r)),t.state.loading|=4,t.instance=o,eq(o);return}o=e.ownerDocument||e,n=cS(n),(i=cp.get(i))&&cI(n,i),eq(o=o.createElement("link"));var s=o;s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),l5(o,"link",n),t.instance=o}null===r.stylesheets&&(r.stylesheets=new Map),r.stylesheets.set(t,e),(e=t.state.preload)&&0==(3&t.state.loading)&&(r.count++,t=cD.bind(r),e.addEventListener("load",t),e.addEventListener("error",t))}}(s1,e.memoizedState,e.memoizedProps);break;case 5:default:at(e);break;case 3:case 4:var t=s1;s1=cg(e.stateNode.containerInfo),at(e),s1=t;break;case 22:null===e.memoizedState&&(null!==(t=e.alternate)&&null!==t.memoizedState?(t=ae,ae=0x1000000,at(e),ae=t):at(e))}}function ar(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do t=e.sibling,e.sibling=null,e=t;while(null!==e)}}function ai(e){var t=e.deletions;if(0!=(16&e.flags)){if(null!==t)for(var n=0;n<t.length;n++){var r=t[n];sK=r,as(r,e)}ar(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)ao(e),e=e.sibling}function ao(e){switch(e.tag){case 0:case 11:case 15:ai(e),2048&e.flags&&sM(9,e,e.return);break;case 3:case 12:default:ai(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&4&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-5,function e(t){var n=t.deletions;if(0!=(16&t.flags)){if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];sK=i,as(i,t)}ar(t)}for(t=t.child;null!==t;){switch((n=t).tag){case 0:case 11:case 15:sM(8,n,n.return),e(n);break;case 22:4&(r=n.stateNode)._visibility&&(r._visibility&=-5,e(n));break;default:e(n)}t=t.sibling}}(e)):ai(e)}}function as(e,t){for(;null!==sK;){var n=sK;switch(n.tag){case 0:case 11:case 15:sM(8,n,t);break;case 23:case 22:if(null!==n.memoizedState&&null!==n.memoizedState.cachePool){var r=n.memoizedState.cachePool.pool;null!=r&&r.refCount++}break;case 24:rR(n.memoizedState.cache)}if(null!==(r=n.child))r.return=n,sK=r;else for(n=e;null!==sK;){var i=(r=sK).sibling,o=r.return;if(function e(t){var n=t.alternate;null!==n&&(t.alternate=null,e(n)),t.child=null,t.deletions=null,t.sibling=null,5===t.tag&&null!==(n=t.stateNode)&&eV(n),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}(r),r===n){sK=null;break}if(null!==i){i.return=o,sK=i;break}sK=o}}}function aa(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function al(e,t,n,r){return new aa(e,t,n,r)}function ac(e){return!(!(e=e.prototype)||!e.isReactComponent)}function ad(e,t){var n=e.alternate;return null===n?((n=al(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=0x1e00000&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n.refCleanup=e.refCleanup,n}function au(e,t){e.flags&=0x1e00002;var n=e.alternate;return null===n?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=n.childLanes,e.lanes=n.lanes,e.child=n.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=n.memoizedProps,e.memoizedState=n.memoizedState,e.updateQueue=n.updateQueue,e.type=n.type,t=n.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function ah(e,t,n,r,i,o){var s=0;if(r=e,"function"==typeof e)ac(e)&&(s=1);else if("string"==typeof e)s=!function(e,t,n){if(1===n||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!=typeof t.precedence||"string"!=typeof t.href||""===t.href)break;return!0;case"link":if("string"!=typeof t.rel||"string"!=typeof t.href||""===t.href||t.onLoad||t.onError)break;if("stylesheet"===t.rel)return e=t.disabled,"string"==typeof t.precedence&&null==e;return!0;case"script":if(t.async&&"function"!=typeof t.async&&"symbol"!=typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"==typeof t.src)return!0}return!1}(e,n,G.current)?"html"===e||"head"===e||"body"===e?27:5:26;else t:switch(e){case h:return ap(n.children,i,o,t);case p:s=8,i|=24;break;case f:return(e=al(12,n,t,2|i)).elementType=f,e.lanes=o,e;case x:return(e=al(13,n,t,i)).elementType=x,e.lanes=o,e;case v:return(e=al(19,n,t,i)).elementType=v,e.lanes=o,e;case k:return af(n,i,o,t);default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case g:case y:s=10;break t;case m:s=9;break t;case b:s=11;break t;case w:s=14;break t;case S:s=16,r=null;break t}s=29,n=Error(l(130,null===e?"null":typeof e,"")),r=null}return(t=al(s,n,t,i)).elementType=e,t.type=r,t.lanes=o,t}function ap(e,t,n,r){return(e=al(7,e,r,t)).lanes=n,e}function af(e,t,n,r){(e=al(22,e,r,t)).elementType=k,e.lanes=n;var i={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var e=i._current;if(null===e)throw Error(l(456));if(0==(2&i._pendingVisibility)){var t=n1(e,2);null!==t&&(i._pendingVisibility|=2,a3(t,e,2))}},attach:function(){var e=i._current;if(null===e)throw Error(l(456));if(0!=(2&i._pendingVisibility)){var t=n1(e,2);null!==t&&(i._pendingVisibility&=-3,a3(t,e,2))}}};return e.stateNode=i,e}function ag(e,t,n){return(e=al(6,e,null,t)).lanes=n,e}function am(e,t,n){return(t=al(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function ay(e){e.flags|=4}function ab(e,t){if("stylesheet"!==t.type||0!=(4&t.state.loading))e.flags&=-0x1000001;else if(e.flags|=0x1000000,!cA(t)){if(null!==(t=ow.current)&&((4194176&aE)===aE?null!==oS:(0x3c00000&aE)!==aE&&0==(0x20000000&aE)||t!==oS))throw rj=rP,rk;e.flags|=8192}}function ax(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?eI():0x20000000,e.lanes|=t,a$|=t)}function av(e,t){if(!rh)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function aw(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=0x1e00000&i.subtreeFlags,r|=0x1e00000&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function aS(e,t){switch(rc(t),t.tag){case 3:sc(rD),Q();break;case 26:case 27:case 5:ee(t);break;case 4:Q();break;case 13:o_(t);break;case 19:K(oI);break;case 10:sc(t.type);break;case 22:case 23:o_(t),rG(),null!==e&&K(rY);break;case 24:sc(rD)}}var ak={getCacheForType:function(e){var t=sg(rD),n=t.data.get(e);return void 0===n&&(n=e(),t.data.set(e,n)),n}},aC="function"==typeof WeakMap?WeakMap:Map,aP=0,a_=null,aI=null,aE=0,aj=0,aT=null,aM=!1,aA=!1,aO=!1,aL=0,aD=0,az=0,aR=0,aN=0,aF=0,a$=0,aB=null,aU=null,aV=!1,aH=0,aK=1/0,aW=null,aG=null,aq=!1,aY=null,aX=0,aZ=0,aQ=null,aJ=0,a0=null;function a1(){if(0!=(2&aP)&&0!==aE)return aE&-aE;if(null!==T.T){var e=r$;return 0!==e?e:lO()}return eO()}function a2(){0===aF&&(aF=0==(0x20000000&aE)||rh?e_():0x20000000);var e=ow.current;return null!==e&&(e.flags|=32),aF}function a3(e,t,n){(e===a_&&(2===aj||9===aj)||null!==e.cancelPendingCommit)&&(le(e,0),a8(e,aE,aF,!1)),ej(e,n),(0==(2&aP)||e!==a_)&&(e===a_&&(0==(2&aP)&&(aR|=n),4===aD&&a8(e,aE,aF,!1)),lI(e))}function a5(e,t,n){if(0!=(6&aP))throw Error(l(327));for(var r=!n&&0==(60&t)&&0==(t&e.expiredLanes)||eP(e,t),i=r?function(e,t){var n=aP;aP|=2;var r=ln(),i=lr();a_!==e||aE!==t?(aW=null,aK=es()+500,le(e,t)):aA=eP(e,t);t:for(;;)try{if(0!==aj&&null!==aI){t=aI;var o=aT;n:switch(aj){case 1:aj=0,aT=null,ll(e,t,o,1);break;case 2:case 9:if(r_(o)){aj=0,aT=null,la(t);break}t=function(){2!==aj&&9!==aj||a_!==e||(aj=7),lI(e)},o.then(t,t);break t;case 3:aj=7;break t;case 4:aj=5;break t;case 7:r_(o)?(aj=0,aT=null,la(t)):(aj=0,aT=null,ll(e,t,o,7));break;case 5:var s=null;switch(aI.tag){case 26:s=aI.memoizedState;case 5:case 27:var a=aI;if(s?cA(s):1){aj=0,aT=null;var c=a.sibling;if(null!==c)aI=c;else{var d=a.return;null!==d?(aI=d,lc(d)):aI=null}break n}}aj=0,aT=null,ll(e,t,o,5);break;case 6:aj=0,aT=null,ll(e,t,o,6);break;case 8:a7(),aD=6;break t;default:throw Error(l(462))}}(function(){for(;null!==aI&&!ei();)ls(aI)})();break}catch(t){lt(e,t)}return(sa=ss=null,T.H=r,T.A=i,aP=n,null!==aI)?0:(a_=null,aE=0,nQ(),aD)}(e,t):lo(e,t,!0),o=r;;){if(0===i)aA&&!r&&a8(e,t,0,!1);else{if(n=e.current.alternate,o&&!function(e){for(var t=e;;){var n=t.tag;if((0===n||11===n||15===n)&&16384&t.flags&&null!==(n=t.updateQueue)&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!nS(o(),i))return!1}catch(e){return!1}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(n)){i=lo(e,t,!1),o=!1;continue}if(2===i){if(o=t,e.errorRecoveryDisabledLanes&o)var s=0;else s=0!=(s=-0x20000001&e.pendingLanes)?s:0x20000000&s?0x20000000:0;if(0!==s){t=s;t:{i=aB;var a=e.current.memoizedState.isDehydrated;if(a&&(le(e,s).flags|=256),2!==(s=lo(e,s,!1))){if(aO&&!a){e.errorRecoveryDisabledLanes|=o,aR|=o,i=4;break t}o=aU,aU=i,null!==o&&a4(o)}i=s}if(o=!1,2!==i)continue}}if(1===i){le(e,0),a8(e,t,0,!0);break}t:{switch(r=e,o=i){case 0:case 1:throw Error(l(345));case 4:if((4194176&t)!==t)break;case 6:a8(r,t,aF,!aM);break t;case 2:aU=null;break;case 3:case 5:break;default:throw Error(l(329))}if(r.finishedWork=n,r.finishedLanes=t,(0x3c00000&t)===t&&10<(i=aH+300-es())){if(a8(r,t,aF,!aM),0!==eC(r,0))break t;r.timeoutHandle=cn(a6.bind(null,r,n,aU,aW,aV,t,aF,aR,a$,aM,o,2,-0,0),i);break t}a6(r,n,aU,aW,aV,t,aF,aR,a$,aM,o,0,-0,0)}}break}lI(e)}function a4(e){null===aU?aU=e:aU.push.apply(aU,e)}function a6(e,t,n,r,i,o,s,a,c,d,u,h,p,f){var g=t.subtreeFlags;if((8192&g||0x1002000==(0x1002000&g))&&(cO={stylesheets:null,count:0,unsuspend:cL},an(t),null!==(t=function(){if(null===cO)throw Error(l(475));var e=cO;return e.stylesheets&&0===e.count&&cR(e,e.stylesheets),0<e.count?function(t){var n=setTimeout(function(){if(e.stylesheets&&cR(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4);return e.unsuspend=t,function(){e.unsuspend=null,clearTimeout(n)}}:null}()))){e.cancelPendingCommit=t(lu.bind(null,e,n,r,i,s,a,c,u,1,p,f)),a8(e,o,s,!d);return}lu(e,n,r,i,s,a,c,u,h,p,f)}function a8(e,t,n,r){t&=~aN,t&=~aR,e.suspendedLanes|=t,e.pingedLanes&=~t,r&&(e.warmLanes|=t),r=e.expirationTimes;for(var i=t;0<i;){var o=31-eb(i),s=1<<o;r[o]=-1,i&=~s}0!==n&&eT(e,n,t)}function a9(){return 0!=(6&aP)||(lE(0,!1),!1)}function a7(){if(null!==aI){if(0===aj)var e=aI.return;else e=aI,sa=ss=null,ic(e),oh=null,op=0,e=aI;for(;null!==e;)aS(e.alternate,e),e=e.return;aI=null}}function le(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;-1!==n&&(e.timeoutHandle=-1,cr(n)),null!==(n=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,n()),a7(),a_=e,aI=n=ad(e.current,null),aE=t,aj=0,aT=null,aM=!1,aA=eP(e,t),aO=!1,a$=aF=aN=aR=az=aD=0,aU=aB=null,aV=!1,0!=(8&t)&&(t|=32&t);var r=e.entangledLanes;if(0!==r)for(e=e.entanglements,r&=t;0<r;){var i=31-eb(r),o=1<<i;t|=e[i],r&=~o}return aL=t,nQ(),n}function lt(e,t){r0=null,T.H=ol,t===rS||t===rC?(t=rT(),aj=3):t===rk?(t=rT(),aj=4):aj=t===oV?8:null!==t&&"object"==typeof t&&"function"==typeof t.then?6:1,aT=t,null===aI&&(aD=1,oN(e,n6(t,e.current)))}function ln(){var e=T.H;return T.H=ol,null===e?ol:e}function lr(){var e=T.A;return T.A=ak,e}function li(){aD=4,aM||(4194176&aE)!==aE&&null!==ow.current||(aA=!0),0==(0x7ffffff&az)&&0==(0x7ffffff&aR)||null===a_||a8(a_,aE,aF,!1)}function lo(e,t,n){var r=aP;aP|=2;var i=ln(),o=lr();(a_!==e||aE!==t)&&(aW=null,le(e,t)),t=!1;var s=aD;t:for(;;)try{if(0!==aj&&null!==aI){var a=aI,l=aT;switch(aj){case 8:a7(),s=6;break t;case 3:case 2:case 9:case 6:null===ow.current&&(t=!0);var c=aj;if(aj=0,aT=null,ll(e,a,l,c),n&&aA){s=0;break t}break;default:c=aj,aj=0,aT=null,ll(e,a,l,c)}}(function(){for(;null!==aI;)ls(aI)})(),s=aD;break}catch(t){lt(e,t)}return t&&e.shellSuspendCounter++,sa=ss=null,aP=r,T.H=i,T.A=o,null===aI&&(a_=null,aE=0,nQ()),s}function ls(e){var t=si(e.alternate,e,aL);e.memoizedProps=e.pendingProps,null===t?lc(e):aI=t}function la(e){var t=e,n=t.alternate;switch(t.tag){case 15:case 0:t=oJ(n,t,t.pendingProps,t.type,void 0,aE);break;case 11:t=oJ(n,t,t.pendingProps,t.type.render,t.ref,aE);break;case 5:ic(t);default:aS(n,t),t=si(n,t=aI=au(t,aL),aL)}e.memoizedProps=e.pendingProps,null===t?lc(e):aI=t}function ll(e,t,n,r){sa=ss=null,ic(t),oh=null,op=0;var i=t.return;try{if(function(e,t,n,r,i){if(n.flags|=32768,null!==r&&"object"==typeof r&&"function"==typeof r.then){if(null!==(t=n.alternate)&&sh(t,n,i,!0),null!==(n=ow.current)){switch(n.tag){case 13:return null===oS?li():null===n.alternate&&0===aD&&(aD=3),n.flags&=-257,n.flags|=65536,n.lanes=i,r===rP?n.flags|=16384:(null===(t=n.updateQueue)?n.updateQueue=new Set([r]):t.add(r),lm(e,r,i)),!1;case 22:return n.flags|=65536,r===rP?n.flags|=16384:(null===(t=n.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([r])},n.updateQueue=t):null===(n=t.retryQueue)?t.retryQueue=new Set([r]):n.add(r),lm(e,r,i)),!1}throw Error(l(435,n.tag))}return lm(e,r,i),li(),!1}if(rh)return null!==(t=ow.current)?(0==(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,r!==rg&&rw(n6(e=Error(l(422),{cause:r}),n))):(r!==rg&&rw(n6(t=Error(l(423),{cause:r}),n)),e=e.current.alternate,e.flags|=65536,i&=-i,e.lanes|=i,r=n6(r,n),i=o$(e.stateNode,r,i),sC(e,i),4!==aD&&(aD=2)),!1;var o=Error(l(520),{cause:r});if(o=n6(o,n),null===aB?aB=[o]:aB.push(o),4!==aD&&(aD=2),null===t)return!0;r=n6(r,n),n=t;do{switch(n.tag){case 3:return n.flags|=65536,e=i&-i,n.lanes|=e,e=o$(n.stateNode,r,e),sC(n,e),!1;case 1:if(t=n.type,o=n.stateNode,0==(128&n.flags)&&("function"==typeof t.getDerivedStateFromError||null!==o&&"function"==typeof o.componentDidCatch&&(null===aG||!aG.has(o))))return n.flags|=65536,i&=-i,n.lanes|=i,oU(i=oB(i),e,n,r),sC(n,i),!1}n=n.return}while(null!==n);return!1}(e,i,t,n,aE)){aD=1,oN(e,n6(n,e.current)),aI=null;return}}catch(t){if(null!==i)throw aI=i,t;aD=1,oN(e,n6(n,e.current)),aI=null;return}32768&t.flags?(rh||1===r?e=!0:aA||0!=(0x20000000&aE)?e=!1:(aM=e=!0,(2===r||9===r||3===r||6===r)&&null!==(r=ow.current)&&13===r.tag&&(r.flags|=16384)),ld(t,e)):lc(t)}function lc(e){var t=e;do{if(0!=(32768&t.flags)){ld(t,aM);return}e=t.return;var n=function(e,t,n){var r=t.pendingProps;switch(rc(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return aw(t),null;case 3:return n=t.stateNode,r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),sc(rD),Q(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(null===e||null===e.child)&&(rx(t)?ay(t):null===e||e.memoizedState.isDehydrated&&0==(256&t.flags)||(t.flags|=1024,null!==rp&&(a4(rp),rp=null))),aw(t),null;case 26:return n=t.memoizedState,null===e?(ay(t),null!==n?(aw(t),ab(t,n)):(aw(t),t.flags&=-0x1000001)):n?n!==e.memoizedState?(ay(t),aw(t),ab(t,n)):(aw(t),t.flags&=-0x1000001):(e.memoizedProps!==r&&ay(t),aw(t),t.flags&=-0x1000001),null;case 27:ee(t),n=Y.current;var i=t.type;if(null!==e&&null!=t.stateNode)e.memoizedProps!==r&&ay(t);else{if(!r){if(null===t.stateNode)throw Error(l(166));return aw(t),null}e=G.current,rx(t)?ry(t,e):(e=ch(i,r,n),t.stateNode=e,ay(t))}return aw(t),null;case 5:if(ee(t),n=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==r&&ay(t);else{if(!r){if(null===t.stateNode)throw Error(l(166));return aw(t),null}if(e=G.current,rx(t))ry(t,e);else{switch(i=l8(Y.current),e){case 1:e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case 2:e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;default:switch(n){case"svg":e=i.createElementNS("http://www.w3.org/2000/svg",n);break;case"math":e=i.createElementNS("http://www.w3.org/1998/Math/MathML",n);break;case"script":(e=i.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild);break;case"select":e="string"==typeof r.is?i.createElement("select",{is:r.is}):i.createElement("select"),r.multiple?e.multiple=!0:r.size&&(e.size=r.size);break;default:e="string"==typeof r.is?i.createElement(n,{is:r.is}):i.createElement(n)}}e[eD]=t,e[ez]=r;t:for(i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&27!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)break t;i=i.return}i.sibling.return=i.return,i=i.sibling}switch(t.stateNode=e,l5(e,n,r),n){case"button":case"input":case"select":case"textarea":e=!!r.autoFocus;break;case"img":e=!0;break;default:e=!1}e&&ay(t)}}return aw(t),t.flags&=-0x1000001,null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==r&&ay(t);else{if("string"!=typeof r&&null===t.stateNode)throw Error(l(166));if(e=Y.current,rx(t)){if(e=t.stateNode,n=t.memoizedProps,r=null,null!==(i=rd))switch(i.tag){case 27:case 5:r=i.memoizedProps}e[eD]=t,(e=!!(e.nodeValue===n||null!==r&&!0===r.suppressHydrationWarning||l0(e.nodeValue,n)))||rm(t)}else(e=l8(e).createTextNode(r))[eD]=t,t.stateNode=e}return aw(t),null;case 13:if(r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=rx(t),null!==r&&null!==r.dehydrated){if(null===e){if(!i)throw Error(l(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(l(317));i[eD]=t}else rv(),0==(128&t.flags)&&(t.memoizedState=null),t.flags|=4;aw(t),i=!1}else null!==rp&&(a4(rp),rp=null),i=!0;if(!i){if(256&t.flags)return o_(t),t;return o_(t),null}}if(o_(t),0!=(128&t.flags))return t.lanes=n,t;if(n=null!==r,e=null!==e&&null!==e.memoizedState,n){r=t.child,i=null,null!==r.alternate&&null!==r.alternate.memoizedState&&null!==r.alternate.memoizedState.cachePool&&(i=r.alternate.memoizedState.cachePool.pool);var o=null;null!==r.memoizedState&&null!==r.memoizedState.cachePool&&(o=r.memoizedState.cachePool.pool),o!==i&&(r.flags|=2048)}return n!==e&&n&&(t.child.flags|=8192),ax(t,t.updateQueue),aw(t),null;case 4:return Q(),null===e&&lH(t.stateNode.containerInfo),aw(t),null;case 10:return sc(t.type),aw(t),null;case 19:if(K(oI),null===(i=t.memoizedState))return aw(t),null;if(r=0!=(128&t.flags),null===(o=i.rendering)){if(r)av(i,!1);else{if(0!==aD||null!==e&&0!=(128&e.flags))for(e=t.child;null!==e;){if(null!==(o=oE(e))){for(t.flags|=128,av(i,!1),e=o.updateQueue,t.updateQueue=e,ax(t,e),t.subtreeFlags=0,e=n,n=t.child;null!==n;)au(n,e),n=n.sibling;return W(oI,1&oI.current|2),t.child}e=e.sibling}null!==i.tail&&es()>aK&&(t.flags|=128,r=!0,av(i,!1),t.lanes=4194304)}}else{if(!r){if(null!==(e=oE(o))){if(t.flags|=128,r=!0,e=e.updateQueue,t.updateQueue=e,ax(t,e),av(i,!0),null===i.tail&&"hidden"===i.tailMode&&!o.alternate&&!rh)return aw(t),null}else 2*es()-i.renderingStartTime>aK&&0x20000000!==n&&(t.flags|=128,r=!0,av(i,!1),t.lanes=4194304)}i.isBackwards?(o.sibling=t.child,t.child=o):(null!==(e=i.last)?e.sibling=o:t.child=o,i.last=o)}if(null!==i.tail)return t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=es(),t.sibling=null,e=oI.current,W(oI,r?1&e|2:1&e),t;return aw(t),null;case 22:case 23:return o_(t),rG(),r=null!==t.memoizedState,null!==e?null!==e.memoizedState!==r&&(t.flags|=8192):r&&(t.flags|=8192),r?0!=(0x20000000&n)&&0==(128&t.flags)&&(aw(t),6&t.subtreeFlags&&(t.flags|=8192)):aw(t),null!==(n=t.updateQueue)&&ax(t,n.retryQueue),n=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(n=e.memoizedState.cachePool.pool),r=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(r=t.memoizedState.cachePool.pool),r!==n&&(t.flags|=2048),null!==e&&K(rY),null;case 24:return n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),sc(rD),aw(t),null;case 25:return null}throw Error(l(156,t.tag))}(t.alternate,t,aL);if(null!==n){aI=n;return}if(null!==(t=t.sibling)){aI=t;return}aI=t=e}while(null!==t);0===aD&&(aD=5)}function ld(e,t){do{var n=function(e,t){switch(rc(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return sc(rD),Q(),0!=(65536&(e=t.flags))&&0==(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return ee(t),null;case 13:if(o_(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(l(340));rv()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return K(oI),null;case 4:return Q(),null;case 10:return sc(t.type),null;case 22:case 23:return o_(t),rG(),null!==e&&K(rY),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return sc(rD),null;default:return null}}(e.alternate,e);if(null!==n){n.flags&=32767,aI=n;return}if(null!==(n=e.return)&&(n.flags|=32768,n.subtreeFlags=0,n.deletions=null),!t&&null!==(e=e.sibling)){aI=e;return}aI=e=n}while(null!==e);aD=6,aI=null}function lu(e,t,n,r,i,o,s,a,c,d,u){var h=T.T,p=$.p;try{$.p=2,T.T=null,function(e,t,n,r,i,o,s,a){do lp();while(null!==aY);if(0!=(6&aP))throw Error(l(327));var c,d=e.finishedWork;if(r=e.finishedLanes,null!==d){if(e.finishedWork=null,e.finishedLanes=0,d===e.current)throw Error(l(177));e.callbackNode=null,e.callbackPriority=0,e.cancelPendingCommit=null;var u=d.lanes|d.childLanes;if(function(e,t,n,r,i,o){var s=e.pendingLanes;e.pendingLanes=n,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=n,e.entangledLanes&=n,e.errorRecoveryDisabledLanes&=n,e.shellSuspendCounter=0;var a=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(n=s&~n;0<n;){var d=31-eb(n),u=1<<d;a[d]=0,l[d]=-1;var h=c[d];if(null!==h)for(c[d]=null,d=0;d<h.length;d++){var p=h[d];null!==p&&(p.lane&=-0x20000001)}n&=~u}0!==r&&eT(e,r,0),0!==o&&0===i&&0!==e.tag&&(e.suspendedLanes|=o&~(s&~t))}(e,r,u|=nZ,o,s,a),e===a_&&(aI=a_=null,aE=0),0==(10256&d.subtreeFlags)&&0==(10256&d.flags)||aq||(aq=!0,aZ=u,aQ=n,c=function(){return lp(!0),null},en(ed,c)),n=0!=(15990&d.flags),0!=(15990&d.subtreeFlags)||n?(n=T.T,T.T=null,o=$.p,$.p=2,s=aP,aP|=4,function(e,t){if(e=e.containerInfo,l4=cK,nI(e=n_(e))){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else t:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i,o=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(e){n=null;break t}var a=0,c=-1,d=-1,u=0,h=0,p=e,f=null;n:for(;;){for(;p!==n||0!==o&&3!==p.nodeType||(c=a+o),p!==s||0!==r&&3!==p.nodeType||(d=a+r),3===p.nodeType&&(a+=p.nodeValue.length),null!==(i=p.firstChild);)f=p,p=i;for(;;){if(p===e)break n;if(f===n&&++u===o&&(c=a),f===s&&++h===r&&(d=a),null!==(i=p.nextSibling))break;f=(p=f).parentNode}p=i}n=-1===c||-1===d?null:{start:c,end:d}}else n=null}n=n||{start:0,end:0}}else n=null;for(l6={focusedElem:e,selectionRange:n},cK=!1,sK=t;null!==sK;)if(e=(t=sK).child,0!=(1028&t.subtreeFlags)&&null!==e)e.return=t,sK=e;else for(;null!==sK;){switch(s=(t=sK).alternate,e=t.flags,t.tag){case 0:case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!=(1024&e)&&null!==s){e=void 0,n=t,o=s.memoizedProps,s=s.memoizedState,r=n.stateNode;try{var g=oO(n.type,o,n.elementType===n.type);e=r.getSnapshotBeforeUpdate(g,s),r.__reactInternalSnapshotBeforeUpdate=e}catch(e){lg(n,n.return,e)}}break;case 3:if(0!=(1024&e)){if(9===(n=(e=t.stateNode.containerInfo).nodeType))cl(e);else if(1===n)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":cl(e);break;default:e.textContent=""}}break;default:if(0!=(1024&e))throw Error(l(163))}if(null!==(e=t.sibling)){e.return=t.return,sK=e;break}sK=t.return}g=sW,sW=!1}(e,d),s2(d,e),function(e,t){var n=n_(t);t=e.focusedElem;var r=e.selectionRange;if(n!==t&&t&&t.ownerDocument&&function e(t,n){return!!t&&!!n&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(t.ownerDocument.documentElement,t)){if(null!==r&&nI(t)){if(e=r.start,void 0===(n=r.end)&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if((n=(e=t.ownerDocument||document)&&e.defaultView||window).getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=nP(t,o);var s=nP(t,r);i&&s&&(1!==n.rangeCount||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&((e=e.createRange()).setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)1===n.nodeType&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for("function"==typeof t.focus&&t.focus(),t=0;t<e.length;t++)(n=e[t]).element.scrollLeft=n.left,n.element.scrollTop=n.top}}(l6,e.containerInfo),cK=!!l4,l6=l4=null,e.current=d,sG(e,d.alternate,d),eo(),aP=s,$.p=o,T.T=n):e.current=d,aq?(aq=!1,aY=e,aX=r):lh(e,u),0===(u=e.pendingLanes)&&(aG=null),function(e){if(em&&"function"==typeof em.onCommitFiberRoot)try{em.onCommitFiberRoot(eg,e,void 0,128==(128&e.current.flags))}catch(e){}}(d.stateNode,i),lI(e),null!==t)for(i=e.onRecoverableError,d=0;d<t.length;d++)i((u=t[d]).value,{componentStack:u.stack});0!=(3&aX)&&lp(),u=e.pendingLanes,0!=(4194218&r)&&0!=(42&u)?e===a0?aJ++:(aJ=0,a0=e):aJ=0,lE(0,!1)}}(e,t,n,r,p,i,o,s,a,c,d,u)}finally{T.T=h,$.p=p}}function lh(e,t){0==(e.pooledCacheLanes&=t)&&null!=(t=e.pooledCache)&&(e.pooledCache=null,rR(t))}function lp(){if(null!==aY){var e=aY,t=aZ;aZ=0;var n=eA(aX),r=T.T,i=$.p;try{if($.p=32>n?32:n,T.T=null,null===aY)var o=!1;else{n=aQ,aQ=null;var s=aY,a=aX;if(aY=null,aX=0,0!=(6&aP))throw Error(l(331));var c=aP;if(aP|=4,ao(s.current),s9(s,s.current,a,n),aP=c,lE(0,!1),em&&"function"==typeof em.onPostCommitFiberRoot)try{em.onPostCommitFiberRoot(eg,s)}catch(e){}o=!0}return o}finally{$.p=i,T.T=r,lh(e,t)}}return!1}function lf(e,t,n){t=n6(n,t),t=o$(e.stateNode,t,2),null!==(e=sS(e,t,2))&&(ej(e,2),lI(e))}function lg(e,t,n){if(3===e.tag)lf(e,e,n);else for(;null!==t;){if(3===t.tag){lf(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"==typeof t.type.getDerivedStateFromError||"function"==typeof r.componentDidCatch&&(null===aG||!aG.has(r))){e=n6(n,e),null!==(r=sS(t,n=oB(2),2))&&(oU(n,r,t,e),ej(r,2),lI(r));break}}t=t.return}}function lm(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new aC;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(aO=!0,i.add(n),e=ly.bind(null,e,t,n),t.then(e,e))}function ly(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),e.pingedLanes|=e.suspendedLanes&n,e.warmLanes&=~n,a_===e&&(aE&n)===n&&(4===aD||3===aD&&(0x3c00000&aE)===aE&&300>es()-aH?0==(2&aP)&&le(e,0):aN|=n,a$===aE&&(a$=0)),lI(e)}function lb(e,t){0===t&&(t=eI()),null!==(e=n1(e,t))&&(ej(e,t),lI(e))}function lx(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),lb(e,n)}function lv(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;case 22:r=e.stateNode._retryCache;break;default:throw Error(l(314))}null!==r&&r.delete(t),lb(e,n)}var lw=null,lS=null,lk=!1,lC=!1,lP=!1,l_=0;function lI(e){var t;e!==lS&&null===e.next&&(null===lS?lw=lS=e:lS=lS.next=e),lC=!0,lk||(lk=!0,t=lj,co(function(){0!=(6&aP)?en(el,t):t()}))}function lE(e,t){if(!lP&&lC){lP=!0;do for(var n=!1,r=lw;null!==r;){if(!t){if(0!==e){var i=r.pendingLanes;if(0===i)var o=0;else{var s=r.suspendedLanes,a=r.pingedLanes;o=0xc000055&(o=(1<<31-eb(42|e)+1)-1&(i&~(s&~a)))?0xc000055&o|1:o?2|o:0}0!==o&&(n=!0,lA(r,o))}else o=aE,0==(3&(o=eC(r,r===a_?o:0)))||eP(r,o)||(n=!0,lA(r,o))}r=r.next}while(n);lP=!1}}function lj(){lC=lk=!1;var e,t=0;0!==l_&&(((e=window.event)&&"popstate"===e.type?e===ct||(ct=e,0):(ct=null,1))||(t=l_),l_=0);for(var n=es(),r=null,i=lw;null!==i;){var o=i.next,s=lT(i,n);0===s?(i.next=null,null===r?lw=o:r.next=o,null===o&&(lS=r)):(r=i,(0!==t||0!=(3&s))&&(lC=!0)),i=o}lE(t,!1)}function lT(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=-0x3c00001&e.pendingLanes;0<o;){var s=31-eb(o),a=1<<s,l=i[s];-1===l?(0==(a&n)||0!=(a&r))&&(i[s]=function(e,t){switch(e){case 1:case 2:case 4:case 8:return t+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return -1}}(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}if(t=a_,n=aE,n=eC(e,e===t?n:0),r=e.callbackNode,0===n||e===t&&(2===aj||9===aj)||null!==e.cancelPendingCommit)return null!==r&&null!==r&&er(r),e.callbackNode=null,e.callbackPriority=0;if(0==(3&n)||eP(e,n)){if((t=n&-n)===e.callbackPriority)return t;switch(null!==r&&er(r),eA(n)){case 2:case 8:n=ec;break;case 32:default:n=ed;break;case 0x10000000:n=eh}return n=en(n,r=lM.bind(null,e)),e.callbackPriority=t,e.callbackNode=n,t}return null!==r&&null!==r&&er(r),e.callbackPriority=2,e.callbackNode=null,2}function lM(e,t){var n=e.callbackNode;if(lp()&&e.callbackNode!==n)return null;var r=aE;return 0===(r=eC(e,e===a_?r:0))?null:(a5(e,r,t),lT(e,es()),null!=e.callbackNode&&e.callbackNode===n?lM.bind(null,e):null)}function lA(e,t){if(lp())return null;a5(e,t,!0)}function lO(){return 0===l_&&(l_=e_()),l_}function lL(e){return null==e||"symbol"==typeof e||"boolean"==typeof e?null:"function"==typeof e?e:tm(""+e)}function lD(e,t){var n=t.ownerDocument.createElement("input");return n.name=t.name,n.value=t.value,e.id&&n.setAttribute("form",e.id),t.parentNode.insertBefore(n,t),e=new FormData(e),n.parentNode.removeChild(n),e}for(var lz=0;lz<nG.length;lz++){var lR=nG[lz];nq(lR.toLowerCase(),"on"+(lR[0].toUpperCase()+lR.slice(1)))}nq(nF,"onAnimationEnd"),nq(n$,"onAnimationIteration"),nq(nB,"onAnimationStart"),nq("dblclick","onDoubleClick"),nq("focusin","onFocus"),nq("focusout","onBlur"),nq(nU,"onTransitionRun"),nq(nV,"onTransitionStart"),nq(nH,"onTransitionCancel"),nq(nK,"onTransitionEnd"),eQ("onMouseEnter",["mouseout","mouseover"]),eQ("onMouseLeave",["mouseout","mouseover"]),eQ("onPointerEnter",["pointerout","pointerover"]),eQ("onPointerLeave",["pointerout","pointerover"]),eZ("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),eZ("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),eZ("onBeforeInput",["compositionend","keypress","textInput","paste"]),eZ("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),eZ("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),eZ("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lN="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lF=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(lN));function l$(e,t){t=0!=(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;t:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break t;o=a,i.currentTarget=c;try{o(i)}catch(e){oL(e)}i.currentTarget=null,o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break t;o=a,i.currentTarget=c;try{o(i)}catch(e){oL(e)}i.currentTarget=null,o=l}}}}function lB(e,t){var n=t[eN];void 0===n&&(n=t[eN]=new Set);var r=e+"__bubble";n.has(r)||(lK(t,e,2,!1),n.add(r))}function lU(e,t,n){var r=0;t&&(r|=4),lK(n,e,r,t)}var lV="_reactListening"+Math.random().toString(36).slice(2);function lH(e){if(!e[lV]){e[lV]=!0,eY.forEach(function(t){"selectionchange"!==t&&(lF.has(t)||lU(t,!1,e),lU(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[lV]||(t[lV]=!0,lU("selectionchange",!1,t))}}function lK(e,t,n,r){switch(cQ(t)){case 2:var i=cW;break;case 8:i=cG;break;default:i=cq}n=i.bind(null,t,n,e),i=void 0,tP&&("touchstart"===t||"touchmove"===t||"wheel"===t)&&(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function lW(e,t,n,r,i){var o=r;if(0==(1&t)&&0==(2&t)&&null!==r)t:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=eH(a)))return;if(5===(l=s.tag)||6===l||26===l||27===l){r=o=s;continue t}a=a.parentNode}}r=r.return}tk(function(){var r=o,i=tb(n),s=[];t:{var a=nW.get(e);if(void 0!==a){var l=tF,c=e;switch(e){case"keypress":if(0===tM(n))break t;case"keydown":case"keyup":l=t0;break;case"focusin":c="focus",l=tK;break;case"focusout":c="blur",l=tK;break;case"beforeblur":case"afterblur":l=tK;break;case"click":if(2===n.button)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=tV;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=tH;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=t2;break;case nF:case n$:case nB:l=tW;break;case nK:l=t3;break;case"scroll":case"scrollend":l=tB;break;case"wheel":l=t5;break;case"copy":case"cut":case"paste":l=tG;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=t1;break;case"toggle":case"beforetoggle":l=t4}var d=0!=(4&t),u=!d&&("scroll"===e||"scrollend"===e),h=d?null!==a?a+"Capture":null:a;d=[];for(var p,f=r;null!==f;){var g=f;if(p=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===p||null===h||null!=(g=tC(f,h))&&d.push(lG(f,g,p)),u)break;f=f.return}0<d.length&&(a=new l(a,c,null,n,i),s.push({event:a,listeners:d}))}}if(0==(7&t)){if(a="mouseover"===e||"pointerover"===e,l="mouseout"===e||"pointerout"===e,!(a&&n!==ty&&(c=n.relatedTarget||n.fromElement)&&(eH(c)||c[eR]))&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(c=n.relatedTarget||n.toElement,l=r,null!==(c=c?eH(c):null)&&(u=z(c),d=c.tag,c!==u||5!==d&&27!==d&&6!==d)&&(c=null)):(l=null,c=r),l!==c)){if(d=tV,g="onMouseLeave",h="onMouseEnter",f="mouse",("pointerout"===e||"pointerover"===e)&&(d=t1,g="onPointerLeave",h="onPointerEnter",f="pointer"),u=null==l?a:eW(l),p=null==c?a:eW(c),(a=new d(g,f+"leave",l,n,i)).target=u,a.relatedTarget=p,g=null,eH(i)===r&&((d=new d(h,f+"enter",c,n,i)).target=p,d.relatedTarget=u,g=d),u=g,l&&c)n:{for(d=l,h=c,f=0,p=d;p;p=lY(p))f++;for(p=0,g=h;g;g=lY(g))p++;for(;0<f-p;)d=lY(d),f--;for(;0<p-f;)h=lY(h),p--;for(;f--;){if(d===h||null!==h&&d===h.alternate)break n;d=lY(d),h=lY(h)}d=null}else d=null;null!==l&&lX(s,a,l,d,!1),null!==c&&null!==u&&lX(s,u,c,d,!0)}t:{if("select"===(l=(a=r?eW(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var m,y=nh;else if(ns(a)){if(np)y=nw;else{y=nx;var b=nb}}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)?y=nv:r&&tp(r.elementType)&&(y=nh);if(y&&(y=y(e,r))){na(s,y,n,i);break t}b&&b(e,a,r),"focusout"===e&&r&&"number"===a.type&&null!=r.memoizedProps.value&&to(a,"number",a.value)}switch(b=r?eW(r):window,e){case"focusin":(ns(b)||"true"===b.contentEditable)&&(nj=b,nT=r,nM=null);break;case"focusout":nM=nT=nj=null;break;case"mousedown":nA=!0;break;case"contextmenu":case"mouseup":case"dragend":nA=!1,nO(s,n,i);break;case"selectionchange":if(nE)break;case"keydown":case"keyup":nO(s,n,i)}if(t8)n:{switch(e){case"compositionstart":var x="onCompositionStart";break n;case"compositionend":x="onCompositionEnd";break n;case"compositionupdate":x="onCompositionUpdate";break n}x=void 0}else ni?nn(e,n)&&(x="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(x="onCompositionStart");x&&(ne&&"ko"!==n.locale&&(ni||"onCompositionStart"!==x?"onCompositionEnd"===x&&ni&&(m=tT()):(tE="value"in(tI=i)?tI.value:tI.textContent,ni=!0)),0<(b=lq(r,x)).length&&(x=new tq(x,e,null,n,i),s.push({event:x,listeners:b}),m?x.data=m:null!==(m=nr(n))&&(x.data=m))),(m=t7?function(e,t){switch(e){case"compositionend":return nr(t);case"keypress":if(32!==t.which)return null;return nt=!0," ";case"textInput":return" "===(e=t.data)&&nt?null:e;default:return null}}(e,n):function(e,t){if(ni)return"compositionend"===e||!t8&&nn(e,t)?(e=tT(),tj=tE=tI=null,ni=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ne&&"ko"!==t.locale?null:t.data}}(e,n))&&0<(x=lq(r,"onBeforeInput")).length&&(b=new tq("onBeforeInput","beforeinput",null,n,i),s.push({event:b,listeners:x}),b.data=m),function(e,t,n,r,i){if("submit"===t&&n&&n.stateNode===i){var o=lL((i[ez]||null).action),s=r.submitter;s&&null!==(t=(t=s[ez]||null)?lL(t.formAction):s.getAttribute("formAction"))&&(o=t,s=null);var a=new tF("action","action",null,r,i);e.push({event:a,listeners:[{instance:null,listener:function(){if(r.defaultPrevented){if(0!==l_){var e=s?lD(i,s):new FormData(i);i5(n,{pending:!0,data:e,method:i.method,action:o},null,e)}}else"function"==typeof o&&(a.preventDefault(),i5(n,{pending:!0,data:e=s?lD(i,s):new FormData(i),method:i.method,action:o},o,e))},currentTarget:i}]})}}(s,e,r,n,i)}l$(s,t)})}function lG(e,t,n){return{instance:e,listener:t,currentTarget:n}}function lq(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5!==(i=i.tag)&&26!==i&&27!==i||null===o||(null!=(i=tC(e,n))&&r.unshift(lG(e,i,o)),null!=(i=tC(e,t))&&r.push(lG(e,i,o))),e=e.return}return r}function lY(e){if(null===e)return null;do e=e.return;while(e&&5!==e.tag&&27!==e.tag);return e||null}function lX(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===r)break;5!==a&&26!==a&&27!==a||null===c||(l=c,i?null!=(c=tC(n,o))&&s.unshift(lG(n,c,l)):i||null!=(c=tC(n,o))&&s.push(lG(n,c,l))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var lZ=/\r\n?/g,lQ=/\u0000|\uFFFD/g;function lJ(e){return("string"==typeof e?e:""+e).replace(lZ,"\n").replace(lQ,"")}function l0(e,t){return t=lJ(t),lJ(e)===t}function l1(){}function l2(e,t,n,r,i,o){switch(n){case"children":"string"==typeof r?"body"===t||"textarea"===t&&""===r||tc(e,r):("number"==typeof r||"bigint"==typeof r)&&"body"!==t&&tc(e,""+r);break;case"className":e5(e,"class",r);break;case"tabIndex":e5(e,"tabindex",r);break;case"dir":case"role":case"viewBox":case"width":case"height":e5(e,n,r);break;case"style":th(e,r,o);break;case"data":if("object"!==t){e5(e,"data",r);break}case"src":case"href":if(""===r&&("a"!==t||"href"!==n)||null==r||"function"==typeof r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=tm(""+r),e.setAttribute(n,r);break;case"action":case"formAction":if("function"==typeof r){e.setAttribute(n,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"==typeof o&&("formAction"===n?("input"!==t&&l2(e,t,"name",i.name,i,null),l2(e,t,"formEncType",i.formEncType,i,null),l2(e,t,"formMethod",i.formMethod,i,null),l2(e,t,"formTarget",i.formTarget,i,null)):(l2(e,t,"encType",i.encType,i,null),l2(e,t,"method",i.method,i,null),l2(e,t,"target",i.target,i,null))),null==r||"symbol"==typeof r||"boolean"==typeof r){e.removeAttribute(n);break}r=tm(""+r),e.setAttribute(n,r);break;case"onClick":null!=r&&(e.onclick=l1);break;case"onScroll":null!=r&&lB("scroll",e);break;case"onScrollEnd":null!=r&&lB("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(l(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(l(60));e.innerHTML=n}}break;case"multiple":e.multiple=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"muted":e.muted=r&&"function"!=typeof r&&"symbol"!=typeof r;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":case"innerText":case"textContent":break;case"xlinkHref":if(null==r||"function"==typeof r||"boolean"==typeof r||"symbol"==typeof r){e.removeAttribute("xlink:href");break}n=tm(""+r),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""+r):e.removeAttribute(n);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,""):e.removeAttribute(n);break;case"capture":case"download":!0===r?e.setAttribute(n,""):!1!==r&&null!=r&&"function"!=typeof r&&"symbol"!=typeof r?e.setAttribute(n,r):e.removeAttribute(n);break;case"cols":case"rows":case"size":case"span":null!=r&&"function"!=typeof r&&"symbol"!=typeof r&&!isNaN(r)&&1<=r?e.setAttribute(n,r):e.removeAttribute(n);break;case"rowSpan":case"start":null==r||"function"==typeof r||"symbol"==typeof r||isNaN(r)?e.removeAttribute(n):e.setAttribute(n,r);break;case"popover":lB("beforetoggle",e),lB("toggle",e),e3(e,"popover",r);break;case"xlinkActuate":e4(e,"http://www.w3.org/1999/xlink","xlink:actuate",r);break;case"xlinkArcrole":e4(e,"http://www.w3.org/1999/xlink","xlink:arcrole",r);break;case"xlinkRole":e4(e,"http://www.w3.org/1999/xlink","xlink:role",r);break;case"xlinkShow":e4(e,"http://www.w3.org/1999/xlink","xlink:show",r);break;case"xlinkTitle":e4(e,"http://www.w3.org/1999/xlink","xlink:title",r);break;case"xlinkType":e4(e,"http://www.w3.org/1999/xlink","xlink:type",r);break;case"xmlBase":e4(e,"http://www.w3.org/XML/1998/namespace","xml:base",r);break;case"xmlLang":e4(e,"http://www.w3.org/XML/1998/namespace","xml:lang",r);break;case"xmlSpace":e4(e,"http://www.w3.org/XML/1998/namespace","xml:space",r);break;case"is":e3(e,"is",r);break;default:2<n.length&&("o"===n[0]||"O"===n[0])&&("n"===n[1]||"N"===n[1])||e3(e,n=tf.get(n)||n,r)}}function l3(e,t,n,r,i,o){switch(n){case"style":th(e,r,o);break;case"dangerouslySetInnerHTML":if(null!=r){if("object"!=typeof r||!("__html"in r))throw Error(l(61));if(null!=(n=r.__html)){if(null!=i.children)throw Error(l(60));e.innerHTML=n}}break;case"children":"string"==typeof r?tc(e,r):("number"==typeof r||"bigint"==typeof r)&&tc(e,""+r);break;case"onScroll":null!=r&&lB("scroll",e);break;case"onScrollEnd":null!=r&&lB("scrollend",e);break;case"onClick":null!=r&&(e.onclick=l1);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:if(!eX.hasOwnProperty(n))t:{if("o"===n[0]&&"n"===n[1]&&(i=n.endsWith("Capture"),t=n.slice(2,i?n.length-7:void 0),"function"==typeof(o=null!=(o=e[ez]||null)?o[n]:null)&&e.removeEventListener(t,o,i),"function"==typeof r)){"function"!=typeof o&&null!==o&&(n in e?e[n]=null:e.hasAttribute(n)&&e.removeAttribute(n)),e.addEventListener(t,r,i);break t}n in e?e[n]=r:!0===r?e.setAttribute(n,""):e3(e,n,r)}}}function l5(e,t,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":lB("error",e),lB("load",e);var r,i=!1,o=!1;for(r in n)if(n.hasOwnProperty(r)){var s=n[r];if(null!=s)switch(r){case"src":i=!0;break;case"srcSet":o=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,t));default:l2(e,t,r,s,n,null)}}o&&l2(e,t,"srcSet",n.srcSet,n,null),i&&l2(e,t,"src",n.src,n,null);return;case"input":lB("invalid",e);var a=r=s=o=null,c=null,d=null;for(i in n)if(n.hasOwnProperty(i)){var u=n[i];if(null!=u)switch(i){case"name":o=u;break;case"type":s=u;break;case"checked":c=u;break;case"defaultChecked":d=u;break;case"value":r=u;break;case"defaultValue":a=u;break;case"children":case"dangerouslySetInnerHTML":if(null!=u)throw Error(l(137,t));break;default:l2(e,t,i,u,n,null)}}ti(e,r,a,c,d,s,o,!1),e9(e);return;case"select":for(o in lB("invalid",e),i=s=r=null,n)if(n.hasOwnProperty(o)&&null!=(a=n[o]))switch(o){case"value":r=a;break;case"defaultValue":s=a;break;case"multiple":i=a;default:l2(e,t,o,a,n,null)}t=r,n=s,e.multiple=!!i,null!=t?ts(e,!!i,t,!1):null!=n&&ts(e,!!i,n,!0);return;case"textarea":for(s in lB("invalid",e),r=o=i=null,n)if(n.hasOwnProperty(s)&&null!=(a=n[s]))switch(s){case"value":i=a;break;case"defaultValue":o=a;break;case"children":r=a;break;case"dangerouslySetInnerHTML":if(null!=a)throw Error(l(91));break;default:l2(e,t,s,a,n,null)}tl(e,i,o,r),e9(e);return;case"option":for(c in n)n.hasOwnProperty(c)&&null!=(i=n[c])&&("selected"===c?e.selected=i&&"function"!=typeof i&&"symbol"!=typeof i:l2(e,t,c,i,n,null));return;case"dialog":lB("cancel",e),lB("close",e);break;case"iframe":case"object":lB("load",e);break;case"video":case"audio":for(i=0;i<lN.length;i++)lB(lN[i],e);break;case"image":lB("error",e),lB("load",e);break;case"details":lB("toggle",e);break;case"embed":case"source":case"link":lB("error",e),lB("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(d in n)if(n.hasOwnProperty(d)&&null!=(i=n[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,t));default:l2(e,t,d,i,n,null)}return;default:if(tp(t)){for(u in n)n.hasOwnProperty(u)&&void 0!==(i=n[u])&&l3(e,t,u,i,n,void 0);return}}for(a in n)n.hasOwnProperty(a)&&null!=(i=n[a])&&l2(e,t,a,i,n,null)}var l4=null,l6=null;function l8(e){return 9===e.nodeType?e:e.ownerDocument}function l9(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function l7(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function ce(e,t){return"textarea"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"bigint"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ct=null,cn="function"==typeof setTimeout?setTimeout:void 0,cr="function"==typeof clearTimeout?clearTimeout:void 0,ci="function"==typeof Promise?Promise:void 0,co="function"==typeof queueMicrotask?queueMicrotask:void 0!==ci?function(e){return ci.resolve(null).then(e).catch(cs)}:cn;function cs(e){setTimeout(function(){throw e})}function ca(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType){if("/$"===(n=i.data)){if(0===r){e.removeChild(i),da(t);return}r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++}n=i}while(n);da(t)}function cl(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var n=t;switch(t=t.nextSibling,n.nodeName){case"HTML":case"HEAD":case"BODY":cl(n),eV(n);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===n.rel.toLowerCase())continue}e.removeChild(n)}}function cc(e){return"$!"===e.data||"$?"===e.data&&"complete"===e.ownerDocument.readyState}function cd(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"F!"===t||"F"===t)break;if("/$"===t)return null}}return e}function cu(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}function ch(e,t,n){switch(t=l8(n),e){case"html":if(!(e=t.documentElement))throw Error(l(452));return e;case"head":if(!(e=t.head))throw Error(l(453));return e;case"body":if(!(e=t.body))throw Error(l(454));return e;default:throw Error(l(451))}}var cp=new Map,cf=new Set;function cg(e){return"function"==typeof e.getRootNode?e.getRootNode():e.ownerDocument}var cm=$.d;$.d={f:function(){var e=cm.f(),t=a9();return e||t},r:function(e){var t=eK(e);null!==t&&5===t.tag&&"form"===t.type?i6(t):cm.r(e)},D:function(e){cm.D(e),cb("dns-prefetch",e,null)},C:function(e,t){cm.C(e,t),cb("preconnect",e,t)},L:function(e,t,n){if(cm.L(e,t,n),cy&&e&&t){var r='link[rel="preload"][as="'+tn(t)+'"]';"image"===t&&n&&n.imageSrcSet?(r+='[imagesrcset="'+tn(n.imageSrcSet)+'"]',"string"==typeof n.imageSizes&&(r+='[imagesizes="'+tn(n.imageSizes)+'"]')):r+='[href="'+tn(e)+'"]';var i=r;switch(t){case"style":i=cv(e);break;case"script":i=ck(e)}cp.has(i)||(e=M({rel:"preload",href:"image"===t&&n&&n.imageSrcSet?void 0:e,as:t},n),cp.set(i,e),null!==cy.querySelector(r)||"style"===t&&cy.querySelector(cw(i))||"script"===t&&cy.querySelector(cC(i))||(l5(t=cy.createElement("link"),"link",e),eq(t),cy.head.appendChild(t)))}},m:function(e,t){if(cm.m(e,t),cy&&e){var n=t&&"string"==typeof t.as?t.as:"script",r='link[rel="modulepreload"][as="'+tn(n)+'"][href="'+tn(e)+'"]',i=r;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":i=ck(e)}if(!cp.has(i)&&(e=M({rel:"modulepreload",href:e},t),cp.set(i,e),null===cy.querySelector(r))){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(cy.querySelector(cC(i)))return}l5(n=cy.createElement("link"),"link",e),eq(n),cy.head.appendChild(n)}}},X:function(e,t){if(cm.X(e,t),cy&&e){var n=eG(cy).hoistableScripts,r=ck(e),i=n.get(r);i||((i=cy.querySelector(cC(r)))||(e=M({src:e,async:!0},t),(t=cp.get(r))&&cE(e,t),eq(i=cy.createElement("script")),l5(i,"link",e),cy.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},n.set(r,i))}},S:function(e,t,n){if(cm.S(e,t,n),cy&&e){var r=eG(cy).hoistableStyles,i=cv(e);t=t||"default";var o=r.get(i);if(!o){var s={loading:0,preload:null};if(o=cy.querySelector(cw(i)))s.loading=5;else{e=M({rel:"stylesheet",href:e,"data-precedence":t},n),(n=cp.get(i))&&cI(e,n);var a=o=cy.createElement("link");eq(a),l5(a,"link",e),a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),a.addEventListener("load",function(){s.loading|=1}),a.addEventListener("error",function(){s.loading|=2}),s.loading|=4,c_(o,t,cy)}o={type:"stylesheet",instance:o,count:1,state:s},r.set(i,o)}}},M:function(e,t){if(cm.M(e,t),cy&&e){var n=eG(cy).hoistableScripts,r=ck(e),i=n.get(r);i||((i=cy.querySelector(cC(r)))||(e=M({src:e,async:!0,type:"module"},t),(t=cp.get(r))&&cE(e,t),eq(i=cy.createElement("script")),l5(i,"link",e),cy.head.appendChild(i)),i={type:"script",instance:i,count:1,state:null},n.set(r,i))}}};var cy="undefined"==typeof document?null:document;function cb(e,t,n){if(cy&&"string"==typeof t&&t){var r=tn(t);r='link[rel="'+e+'"][href="'+r+'"]',"string"==typeof n&&(r+='[crossorigin="'+n+'"]'),cf.has(r)||(cf.add(r),e={rel:e,crossOrigin:n,href:t},null===cy.querySelector(r)&&(l5(t=cy.createElement("link"),"link",e),eq(t),cy.head.appendChild(t)))}}function cx(e,t,n,r){var i=(i=Y.current)?cg(i):null;if(!i)throw Error(l(446));switch(e){case"meta":case"title":return null;case"style":return"string"==typeof n.precedence&&"string"==typeof n.href?(t=cv(n.href),(r=(n=eG(i).hoistableStyles).get(t))||(r={type:"style",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===n.rel&&"string"==typeof n.href&&"string"==typeof n.precedence){e=cv(n.href);var o,s,a,c,d=eG(i).hoistableStyles,u=d.get(e);if(u||(i=i.ownerDocument||i,u={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},d.set(e,u),(d=i.querySelector(cw(e)))&&!d._p&&(u.instance=d,u.state.loading=5),cp.has(e)||(n={rel:"preload",as:"style",href:n.href,crossOrigin:n.crossOrigin,integrity:n.integrity,media:n.media,hrefLang:n.hrefLang,referrerPolicy:n.referrerPolicy},cp.set(e,n),d||(o=i,s=e,a=n,c=u.state,o.querySelector('link[rel="preload"][as="style"]['+s+"]")?c.loading=1:(s=o.createElement("link"),c.preload=s,s.addEventListener("load",function(){return c.loading|=1}),s.addEventListener("error",function(){return c.loading|=2}),l5(s,"link",a),eq(s),o.head.appendChild(s))))),t&&null===r)throw Error(l(528,""));return u}if(t&&null!==r)throw Error(l(529,""));return null;case"script":return t=n.async,"string"==typeof(n=n.src)&&t&&"function"!=typeof t&&"symbol"!=typeof t?(t=ck(n),(r=(n=eG(i).hoistableScripts).get(t))||(r={type:"script",instance:null,count:0,state:null},n.set(t,r)),r):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,e))}}function cv(e){return'href="'+tn(e)+'"'}function cw(e){return'link[rel="stylesheet"]['+e+"]"}function cS(e){return M({},e,{"data-precedence":e.precedence,precedence:null})}function ck(e){return'[src="'+tn(e)+'"]'}function cC(e){return"script[async]"+e}function cP(e,t,n){if(t.count++,null===t.instance)switch(t.type){case"style":var r=e.querySelector('style[data-href~="'+tn(n.href)+'"]');if(r)return t.instance=r,eq(r),r;var i=M({},n,{"data-href":n.href,"data-precedence":n.precedence,href:null,precedence:null});return eq(r=(e.ownerDocument||e).createElement("style")),l5(r,"style",i),c_(r,n.precedence,e),t.instance=r;case"stylesheet":i=cv(n.href);var o=e.querySelector(cw(i));if(o)return t.state.loading|=4,t.instance=o,eq(o),o;r=cS(n),(i=cp.get(i))&&cI(r,i),eq(o=(e.ownerDocument||e).createElement("link"));var s=o;return s._p=new Promise(function(e,t){s.onload=e,s.onerror=t}),l5(o,"link",r),t.state.loading|=4,c_(o,n.precedence,e),t.instance=o;case"script":if(o=ck(n.src),i=e.querySelector(cC(o)))return t.instance=i,eq(i),i;return r=n,(i=cp.get(o))&&cE(r=M({},n),i),eq(i=(e=e.ownerDocument||e).createElement("script")),l5(i,"link",r),e.head.appendChild(i),t.instance=i;case"void":return null;default:throw Error(l(443,t.type))}else"stylesheet"===t.type&&0==(4&t.state.loading)&&(r=t.instance,t.state.loading|=4,c_(r,n.precedence,e));return t.instance}function c_(e,t,n){for(var r=n.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=r.length?r[r.length-1]:null,o=i,s=0;s<r.length;s++){var a=r[s];if(a.dataset.precedence===t)o=a;else if(o!==i)break}o?o.parentNode.insertBefore(e,o.nextSibling):(t=9===n.nodeType?n.head:n).insertBefore(e,t.firstChild)}function cI(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function cE(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var cj=null;function cT(e,t,n){if(null===cj){var r=new Map,i=cj=new Map;i.set(n,r)}else(r=(i=cj).get(n))||(r=new Map,i.set(n,r));if(r.has(e))return r;for(r.set(e,null),n=n.getElementsByTagName(e),i=0;i<n.length;i++){var o=n[i];if(!(o[eU]||o[eD]||"link"===e&&"stylesheet"===o.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==o.namespaceURI){var s=o.getAttribute(t)||"";s=e+s;var a=r.get(s);a?a.push(o):r.set(s,[o])}}return r}function cM(e,t,n){(e=e.ownerDocument||e).head.insertBefore(n,"title"===t?e.querySelector("head > title"):null)}function cA(e){return"stylesheet"!==e.type||0!=(3&e.state.loading)}var cO=null;function cL(){}function cD(){if(this.count--,0===this.count){if(this.stylesheets)cR(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}}var cz=null;function cR(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,cz=new Map,t.forEach(cN,e),cz=null,cD.call(e))}function cN(e,t){if(!(4&t.state.loading)){var n=cz.get(e);if(n)var r=n.get(null);else{n=new Map,cz.set(e,n);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),o=0;o<i.length;o++){var s=i[o];("LINK"===s.nodeName||"not all"!==s.getAttribute("media"))&&(n.set(s.dataset.precedence,s),r=s)}r&&n.set(null,r)}s=(i=t.instance).getAttribute("data-precedence"),(o=n.get(s)||r)===r&&n.set(null,i),n.set(s,i),this.count++,r=cD.bind(this),i.addEventListener("load",r),i.addEventListener("error",r),o?o.parentNode.insertBefore(i,o.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var cF={$$typeof:y,Provider:null,Consumer:null,_currentValue:B,_currentValue2:B,_threadCount:0};function c$(e,t,n,r,i,o,s,a){this.tag=1,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=eE(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eE(0),this.hiddenUpdates=eE(null),this.identifierPrefix=r,this.onUncaughtError=i,this.onCaughtError=o,this.onRecoverableError=s,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=a,this.incompleteTransitions=new Map}function cB(e,t,n,r,i,o){var s;i=n5,null===r.context?r.context=i:r.pendingContext=i,(r=sw(t)).payload={element:n},null!==(o=void 0===o?null:o)&&(r.callback=o),null!==(n=sS(e,r,t))&&(a3(n,e,t),sk(n,e,t))}function cU(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function cV(e,t){cU(e,t),(e=e.alternate)&&cU(e,t)}function cH(e){if(13===e.tag){var t=n1(e,0x4000000);null!==t&&a3(t,e,0x4000000),cV(e,0x4000000)}}var cK=!0;function cW(e,t,n,r){var i=T.T;T.T=null;var o=$.p;try{$.p=2,cq(e,t,n,r)}finally{$.p=o,T.T=i}}function cG(e,t,n,r){var i=T.T;T.T=null;var o=$.p;try{$.p=8,cq(e,t,n,r)}finally{$.p=o,T.T=i}}function cq(e,t,n,r){if(cK){var i=cY(r);if(null===i)lW(e,t,r,cX,n),c8(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return c0=c9(c0,e,t,n,r,i),!0;case"dragenter":return c1=c9(c1,e,t,n,r,i),!0;case"mouseover":return c2=c9(c2,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return c3.set(o,c9(c3.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,c5.set(o,c9(c5.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(c8(e,r),4&t&&-1<c6.indexOf(e)){for(;null!==i;){var o=eK(i);if(null!==o)switch(o.tag){case 3:if((o=o.stateNode).current.memoizedState.isDehydrated){var s=ek(o.pendingLanes);if(0!==s){var a=o;for(a.pendingLanes|=2,a.entangledLanes|=2;s;){var l=1<<31-eb(s);a.entanglements[1]|=l,s&=~l}lI(o),0==(6&aP)&&(aK=es()+500,lE(0,!1))}}break;case 13:null!==(a=n1(o,2))&&a3(a,o,2),a9(),cV(o,2)}if(null===(o=cY(r))&&lW(e,t,r,cX,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else lW(e,t,r,null,n)}}function cY(e){return cZ(e=tb(e))}var cX=null;function cZ(e){if(cX=null,null!==(e=eH(e))){var t=z(e);if(null===t)e=null;else{var n=t.tag;if(13===n){if(null!==(e=R(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return cX=e,null}function cQ(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ea()){case el:return 2;case ec:return 8;case ed:case eu:return 32;case eh:return 0x10000000;default:return 32}default:return 32}}var cJ=!1,c0=null,c1=null,c2=null,c3=new Map,c5=new Map,c4=[],c6="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function c8(e,t){switch(e){case"focusin":case"focusout":c0=null;break;case"dragenter":case"dragleave":c1=null;break;case"mouseover":case"mouseout":c2=null;break;case"pointerover":case"pointerout":c3.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":c5.delete(t.pointerId)}}function c9(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&null!==(t=eK(t))&&cH(t)):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i)),e}function c7(e){var t=eH(e.target);if(null!==t){var n=z(t);if(null!==n){if(13===(t=n.tag)){if(null!==(t=R(n))){e.blockedOn=t,function(e,t){var n=$.p;try{return $.p=e,t()}finally{$.p=n}}(e.priority,function(){if(13===n.tag){var e=a1(),t=n1(n,e);null!==t&&a3(t,n,e),cV(n,e)}});return}}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=3===n.tag?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function de(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=cY(e.nativeEvent);if(null!==n)return null!==(t=eK(n))&&cH(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ty=r,n.target.dispatchEvent(r),ty=null,t.shift()}return!0}function dt(e,t,n){de(e)&&n.delete(t)}function dn(){cJ=!1,null!==c0&&de(c0)&&(c0=null),null!==c1&&de(c1)&&(c1=null),null!==c2&&de(c2)&&(c2=null),c3.forEach(dt),c5.forEach(dt)}function dr(e,t){e.blockedOn===t&&(e.blockedOn=null,cJ||(cJ=!0,o.unstable_scheduleCallback(o.unstable_NormalPriority,dn)))}var di=null;function ds(e){di!==e&&(di=e,o.unstable_scheduleCallback(o.unstable_NormalPriority,function(){di===e&&(di=null);for(var t=0;t<e.length;t+=3){var n=e[t],r=e[t+1],i=e[t+2];if("function"!=typeof r){if(null===cZ(r||n))continue;break}var o=eK(n);null!==o&&(e.splice(t,3),t-=3,i5(o,{pending:!0,data:i,method:n.method,action:r},r,i))}}))}function da(e){function t(t){return dr(t,e)}null!==c0&&dr(c0,e),null!==c1&&dr(c1,e),null!==c2&&dr(c2,e),c3.forEach(t),c5.forEach(t);for(var n=0;n<c4.length;n++){var r=c4[n];r.blockedOn===e&&(r.blockedOn=null)}for(;0<c4.length&&null===(n=c4[0]).blockedOn;)c7(n),null===n.blockedOn&&c4.shift();if(null!=(n=(e.ownerDocument||e).$$reactFormReplay))for(r=0;r<n.length;r+=3){var i=n[r],o=n[r+1],s=i[ez]||null;if("function"==typeof o)s||ds(n);else if(s){var a=null;if(o&&o.hasAttribute("formAction")){if(i=o,s=o[ez]||null)a=s.formAction;else if(null!==cZ(i))continue}else a=s.action;"function"==typeof a?n[r+1]=a:(n.splice(r,3),r-=3),ds(n)}}}function dl(e){this._internalRoot=e}function dc(e){this._internalRoot=e}dc.prototype.render=dl.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(l(409));cB(t.current,a1(),e,t,null,null)},dc.prototype.unmount=dl.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;0===e.tag&&lp(),cB(e.current,2,null,e,null,null),a9(),t[eR]=null}},dc.prototype.unstable_scheduleHydration=function(e){if(e){var t=eO();e={blockedOn:null,target:e,priority:t};for(var n=0;n<c4.length&&0!==t&&t<c4[n].priority;n++);c4.splice(n,0,e),0===n&&c7(e)}};var dd=s.version;if("19.0.0-rc-7283a213-20241206"!==dd)throw Error(l(527,dd,"19.0.0-rc-7283a213-20241206"));if($.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"==typeof e.render)throw Error(l(188));throw Error(l(268,e=Object.keys(e).join(",")))}return e=null===(e=null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=z(e)))throw Error(l(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var o=i.alternate;if(null===o){if(null!==(r=i.return)){n=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===n)return N(i),e;if(o===r)return N(i),t;o=o.sibling}throw Error(l(188))}if(n.return!==r.return)n=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===n){s=!0,n=i,r=o;break}if(a===r){s=!0,r=i,n=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===n){s=!0,n=o,r=i;break}if(a===r){s=!0,r=o,n=i;break}a=a.sibling}if(!s)throw Error(l(189))}}if(n.alternate!==r)throw Error(l(190))}if(3!==n.tag)throw Error(l(188));return n.stateNode.current===n?e:t}(t))?function e(t){var n=t.tag;if(5===n||26===n||27===n||6===n)return t;for(t=t.child;null!==t;){if(null!==(n=e(t)))return n;t=t.sibling}return null}(e):null)?null:e.stateNode},"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var du=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!du.isDisabled&&du.supportsFiber)try{eg=du.inject({bundleType:0,version:"19.0.0-rc-7283a213-20241206",rendererPackageName:"react-dom",currentDispatcherRef:T,findFiberByHostInstance:eH,reconcilerVersion:"19.0.0-rc-7283a213-20241206"}),em=du}catch(e){}}t.createRoot=function(e,t){if(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)throw Error(l(299));var n,r,i,o=!1,s="",a=oD,c=oz,d=oR,u=null;return null!=t&&(!0===t.unstable_strictMode&&(o=!0),void 0!==t.identifierPrefix&&(s=t.identifierPrefix),void 0!==t.onUncaughtError&&(a=t.onUncaughtError),void 0!==t.onCaughtError&&(c=t.onCaughtError),void 0!==t.onRecoverableError&&(d=t.onRecoverableError),void 0!==t.unstable_transitionCallbacks&&t.unstable_transitionCallbacks),n=e,r=1,i=o,n=new c$(n,r,!1,s,a,c,d,null),r=1,!0===i&&(r|=24),i=al(3,null,null,r),n.current=i,i.stateNode=n,r=rz(),r.refCount++,n.pooledCache=r,r.refCount++,i.memoizedState={element:null,isDehydrated:!1,cache:r},sx(i),t=n,e[eR]=t.current,lH(8===e.nodeType?e.parentNode:e),new dl(t)}},35750:(e,t,n)=>{"use strict";var r=n(14205);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var n=2;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var s={d:{f:o,r:function(){throw Error(i(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},a=Symbol.for("react.portal"),l=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.flushSync=function(e){var t=l.T,n=s.p;try{if(l.T=null,s.p=2,e)return e()}finally{l.T=t,s.p=n,s.d.f()}},t.preconnect=function(e,t){"string"==typeof e&&(t=t?"string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:null,s.d.C(e,t))},t.prefetchDNS=function(e){"string"==typeof e&&s.d.D(e)},t.preinit=function(e,t){if("string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,r=c(n,t.crossOrigin),i="string"==typeof t.integrity?t.integrity:void 0,o="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?s.d.S(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:r,integrity:i,fetchPriority:o}):"script"===n&&s.d.X(e,{crossOrigin:r,integrity:i,fetchPriority:o,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"==typeof e){if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=c(t.as,t.crossOrigin);s.d.M(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&s.d.M(e)}},t.preload=function(e,t){if("string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,r=c(n,t.crossOrigin);s.d.L(e,n,{crossOrigin:r,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0,media:"string"==typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"==typeof e){if(t){var n=c(t.as,t.crossOrigin);s.d.m(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else s.d.m(e)}},t.requestFormReset=function(e){s.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,n){return l.H.useFormState(e,t,n)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.0.0-rc-7283a213-20241206"},53413:(e,t,n)=>{"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),e.exports=n(75614)},20100:(e,t,n)=>{"use strict";(function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}})(),e.exports=n(35750)},76014:(e,t)=>{"use strict";var n=Symbol.for("react.transitional.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator,f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,m={};function y(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}function b(){}function x(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=y.prototype;var v=x.prototype=new b;v.constructor=x,g(v,y.prototype),v.isPureReactComponent=!0;var w=Array.isArray,S={H:null,A:null,T:null,S:null},k=Object.prototype.hasOwnProperty;function C(e,t,r,i,o,s){return{$$typeof:n,type:e,key:t,ref:void 0!==(r=s.ref)?r:null,props:s}}function P(e){return"object"==typeof e&&null!==e&&e.$$typeof===n}var _=/\/+/g;function I(e,t){var n,r;return"object"==typeof e&&null!==e&&null!=e.key?(n=""+e.key,r={"=":"=0",":":"=2"},"$"+n.replace(/[=:]/g,function(e){return r[e]})):t.toString(36)}function E(){}function j(e,t,i){if(null==e)return e;var o=[],s=0;return function e(t,i,o,s,a){var l,c,d,u=typeof t;("undefined"===u||"boolean"===u)&&(t=null);var f=!1;if(null===t)f=!0;else switch(u){case"bigint":case"string":case"number":f=!0;break;case"object":switch(t.$$typeof){case n:case r:f=!0;break;case h:return e((f=t._init)(t._payload),i,o,s,a)}}if(f)return a=a(t),f=""===s?"."+I(t,0):s,w(a)?(o="",null!=f&&(o=f.replace(_,"$&/")+"/"),e(a,i,o,"",function(e){return e})):null!=a&&(P(a)&&(l=a,c=o+(null==a.key||t&&t.key===a.key?"":(""+a.key).replace(_,"$&/")+"/")+f,a=C(l.type,c,void 0,void 0,void 0,l.props)),i.push(a)),1;f=0;var g=""===s?".":s+":";if(w(t))for(var m=0;m<t.length;m++)u=g+I(s=t[m],m),f+=e(s,i,o,u,a);else if("function"==typeof(m=null===(d=t)||"object"!=typeof d?null:"function"==typeof(d=p&&d[p]||d["@@iterator"])?d:null))for(t=m.call(t),m=0;!(s=t.next()).done;)u=g+I(s=s.value,m++),f+=e(s,i,o,u,a);else if("object"===u){if("function"==typeof t.then)return e(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"==typeof e.status?e.then(E,E):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(t),i,o,s,a);throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(i=String(t))?"object with keys {"+Object.keys(t).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.")}return f}(e,o,"","",function(e){return t.call(i,e,s++)}),o}function T(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var M="function"==typeof reportError?reportError:function(e){if("object"==typeof window&&"function"==typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"==typeof e&&null!==e&&"string"==typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"==typeof process&&"function"==typeof process.emit){process.emit("uncaughtException",e);return}console.error(e)};function A(){}t.Children={map:j,forEach:function(e,t,n){j(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return j(e,function(){t++}),t},toArray:function(e){return j(e,function(e){return e})||[]},only:function(e){if(!P(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=i,t.Profiler=s,t.PureComponent=x,t.StrictMode=o,t.Suspense=d,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.__COMPILER_RUNTIME={c:function(e){return S.H.useMemoCache(e)}},t.act=function(){throw Error("act(...) is not supported in production builds of React.")},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cloneElement=function(e,t,n){if(null==e)throw Error("The argument must be a React element, but you passed "+e+".");var r=g({},e.props),i=e.key,o=void 0;if(null!=t)for(s in void 0!==t.ref&&(o=void 0),void 0!==t.key&&(i=""+t.key),t)k.call(t,s)&&"key"!==s&&"__self"!==s&&"__source"!==s&&("ref"!==s||void 0!==t.ref)&&(r[s]=t[s]);var s=arguments.length-2;if(1===s)r.children=n;else if(1<s){for(var a=Array(s),l=0;l<s;l++)a[l]=arguments[l+2];r.children=a}return C(e.type,i,void 0,void 0,o,r)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},t.createElement=function(e,t,n){var r,i={},o=null;if(null!=t)for(r in void 0!==t.key&&(o=""+t.key),t)k.call(t,r)&&"key"!==r&&"__self"!==r&&"__source"!==r&&(i[r]=t[r]);var s=arguments.length-2;if(1===s)i.children=n;else if(1<s){for(var a=Array(s),l=0;l<s;l++)a[l]=arguments[l+2];i.children=a}if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===i[r]&&(i[r]=s[r]);return C(e,o,void 0,void 0,null,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=P,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:T}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,n={};S.T=n;try{var r=e(),i=S.S;null!==i&&i(n,r),"object"==typeof r&&null!==r&&"function"==typeof r.then&&r.then(A,M)}catch(e){M(e)}finally{S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,n){return S.H.useActionState(e,t,n)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return S.H.useEffect(e,t)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,n){return S.H.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,n){return S.H.useReducer(e,t,n)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,n){return S.H.useSyncExternalStore(e,t,n)},t.useTransition=function(){return S.H.useTransition()},t.version="19.0.0-rc-7283a213-20241206"},14205:(e,t,n)=>{"use strict";e.exports=n(76014)},16998:(e,t)=>{"use strict";function n(e,t){var n=e.length;for(e.push(t);0<n;){var r=n-1>>>1,i=e[r];if(0<o(i,t))e[r]=t,e[n]=i,n=r;else break}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,l=e[a],c=a+1,d=e[c];if(0>o(l,n))c<i&&0>o(d,l)?(e[r]=d,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else if(c<i&&0>o(d,n))e[r]=d,e[c]=n,r=c;else break}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if(t.unstable_now=void 0,"object"==typeof performance&&"function"==typeof performance.now){var s,a=performance;t.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();t.unstable_now=function(){return l.now()-c}}var d=[],u=[],h=1,p=null,f=3,g=!1,m=!1,y=!1,b="function"==typeof setTimeout?setTimeout:null,x="function"==typeof clearTimeout?clearTimeout:null,v="undefined"!=typeof setImmediate?setImmediate:null;function w(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else if(t.startTime<=e)i(u),t.sortIndex=t.expirationTime,n(d,t);else break;t=r(u)}}function S(e){if(y=!1,w(e),!m){if(null!==r(d))m=!0,M();else{var t=r(u);null!==t&&A(S,t.startTime-e)}}}var k=!1,C=-1,P=5,_=-1;function I(){return!(t.unstable_now()-_<P)}function E(){if(k){var e=t.unstable_now();_=e;var n=!0;try{t:{m=!1,y&&(y=!1,x(C),C=-1),g=!0;var o=f;try{n:{for(w(e),p=r(d);null!==p&&!(p.expirationTime>e&&I());){var a=p.callback;if("function"==typeof a){p.callback=null,f=p.priorityLevel;var l=a(p.expirationTime<=e);if(e=t.unstable_now(),"function"==typeof l){p.callback=l,w(e),n=!0;break n}p===r(d)&&i(d),w(e)}else i(d);p=r(d)}if(null!==p)n=!0;else{var c=r(u);null!==c&&A(S,c.startTime-e),n=!1}}break t}finally{p=null,f=o,g=!1}n=void 0}}finally{n?s():k=!1}}}if("function"==typeof v)s=function(){v(E)};else if("undefined"!=typeof MessageChannel){var j=new MessageChannel,T=j.port2;j.port1.onmessage=E,s=function(){T.postMessage(null)}}else s=function(){b(E,0)};function M(){k||(k=!0,s())}function A(e,n){C=b(function(){e(t.unstable_now())},n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||g||(m=!0,M())},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(d)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch(o="object"==typeof o&&null!==o&&"number"==typeof(o=o.delay)&&0<o?s+o:s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=0x3fffffff;break;case 4:a=1e4;break;default:a=5e3}return a=o+a,e={id:h++,callback:i,priorityLevel:e,startTime:o,expirationTime:a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===r(d)&&e===r(u)&&(y?(x(C),C=-1):y=!0,A(S,o-s))):(e.sortIndex=a,n(d,e),m||g||(m=!0,M())),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},51583:(e,t,n)=>{"use strict";e.exports=n(16998)},11304:(e,t,n)=>{"use strict";let r,i,o,s,a,l,c,d,u,h;n.r(t),n.d(t,{default:()=>IM});var p,f,g,m=n(45512),y=n(58009),b=n.t(y,2),x=n.n(y);function v({onCreated:e}){let[t,n]=(0,y.useState)(""),[r,i]=(0,y.useState)([]),[o,s]=(0,y.useState)(!1),[a,l]=(0,y.useState)(null),c=async o=>{if(o.preventDefault(),!t.trim()||0===r.length){l("Name and at least one image are required");return}s(!0),l(null);try{let o=new FormData;o.set("name",t.trim()),r.forEach(e=>o.append("files",e));let s=await fetch("/api/styles",{method:"POST",headers:{"X-User-Id":"dev-user"},body:o}),a=await s.json();if(!s.ok)throw Error(a.error??"Failed to create style");e?.(a.id),n(""),i([])}catch(e){l(e instanceof Error?e.message:"Failed")}finally{s(!1)}};return(0,m.jsxs)("form",{onSubmit:c,className:"space-y-4 rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,m.jsx)("h3",{className:"font-medium",children:"Create style profile"}),a&&(0,m.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:a}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium",children:"Name"}),(0,m.jsx)("input",{type:"text",value:t,onChange:e=>n(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-3 py-2 dark:border-gray-600 dark:bg-gray-800",placeholder:"My illustration style"})]}),(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium",children:"Reference images"}),(0,m.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>i(Array.from(e.target.files??[])),className:"mt-1 w-full text-sm"})]}),(0,m.jsx)("button",{type:"submit",disabled:o,className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:o?"Creating":"Create style"})]})}function w({selectedStyleId:e,onSelect:t}){let[n,r]=(0,y.useState)([]),[i,o]=(0,y.useState)(!0);return i?(0,m.jsx)("p",{className:"text-sm text-gray-500",children:"Loading styles"}):0===n.length?null:(0,m.jsxs)("div",{className:"space-y-2 rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,m.jsx)("h3",{className:"font-medium",children:"Select style profile"}),(0,m.jsxs)("select",{value:e??"",onChange:e=>t(e.target.value||null),className:"w-full rounded border border-gray-300 px-3 py-2 dark:border-gray-600 dark:bg-gray-800",children:[(0,m.jsx)("option",{value:"",children:" Pick a style "}),n.map(e=>(0,m.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}function S({styleProfileId:e,onJobStarted:t}){let[n,r]=(0,y.useState)(""),[i,o]=(0,y.useState)(!1),[s,a]=(0,y.useState)(null),[l,c]=(0,y.useState)(null),d=async r=>{if(r.preventDefault(),!e||!n.trim()){a("Select a style and enter a prompt");return}o(!0),a(null);try{let r=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({styleProfileId:e,userPrompt:n.trim()})}),i=await r.json();if(!r.ok)throw Error(i.error??"Failed to start generation");c(i.jobId),t?.(i.jobId)}catch(e){a(e instanceof Error?e.message:"Failed")}finally{o(!1)}};return(0,m.jsxs)("div",{className:"space-y-4 rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,m.jsx)("h3",{className:"font-medium",children:"Generate illustrations"}),s&&(0,m.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:s}),!e&&(0,m.jsx)("p",{className:"text-sm text-gray-500",children:"Create or select a style profile first."}),(0,m.jsxs)("form",{onSubmit:d,className:"space-y-2",children:[(0,m.jsxs)("div",{children:[(0,m.jsx)("label",{className:"block text-sm font-medium",children:"Prompt"}),(0,m.jsx)("textarea",{value:n,onChange:e=>r(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-3 py-2 dark:border-gray-600 dark:bg-gray-800",rows:2,placeholder:"A cat sitting on a windowsill, morning light",disabled:!e})]}),(0,m.jsx)("button",{type:"submit",disabled:i||!e,className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:i?"Queuing":"Generate 3 options"})]}),l&&(0,m.jsxs)("p",{className:"text-sm text-gray-500",children:["Job ",l," queued. Poll GET /api/generate/job/",l," for result."]})]})}function k(e){return e&&"object"==typeof e&&"parents"in e}function C(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(!0),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}n(8217),n(37632),n(15247),n(94779),n(8126);let P=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&k(e))for(let t=0,n=e.parents.length;t<n;t++)P(e.parents[t],e)},_=(e,t)=>{if(e.children.add(t)&&k(e))for(let t=0,n=e.parents.length;t<n;t++)_(e.parents[t],e)};function I(e,t){return e===t||Object.is(e,t)||!!(e&&t&&"function"==typeof e.equals&&e.equals(t))}function E(e,t){let n=Symbol.for(`com.tldraw.state/${e}`),r=globalThis;return r[n]??=t(),r[n]}let j=E("empty_array",()=>Object.freeze([]));class T{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw Error("no set or array")}add(e){if(this.array)return -1===this.array.indexOf(e)&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++):(this.set=new Set(this.array),this.array=null,this.set.add(e)),!0);if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw Error("no set or array")}remove(e){if(this.array){let t=this.array.indexOf(e);return -1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){let n=this.array[t];void 0!==n&&e(n)}return}if(this.set){this.set.forEach(e);return}throw Error("no set or array")}has(e){return this.array?-1!==this.array.indexOf(e):this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}let M=Symbol.for("com.tldraw.state/RESET_VALUE");class A{constructor(e){this.capacity=e,this.buffer=Array(e)}index=0;buffer;pushEntry(e,t,n){if(void 0!==n){if(n===M){this.clear();return}this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){let{index:t,capacity:n,buffer:r}=this;for(let i=0;i<n;i++){let o=(t-1+n-i)%n,s=r[o];if(!s)break;let[a,l]=s;if(0===i&&e>=l)return[];if(a<=e&&e<l){let e=i+1,t=Array(e);for(let i=0;i<e;i++)t[i]=r[(o+i)%n][2];return t}}return M}}class O{constructor(e,t){this.below=e,this.child=t}offset=0;maybeRemoved}let L=E("capture",()=>({stack:null}));function D(e){let t=L.stack;L.stack=null;try{return e()}finally{L.stack=t}}function z(e){L.stack=new O(L.stack,e),e.parentSet.clear()}function R(){let e=L.stack;if(L.stack=e.below,e.offset<e.child.parents.length){for(let t=e.offset;t<e.child.parents.length;t++){let n=e.child.parents[t];e.child.parentSet.has(n)||P(n,e.child)}e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset}if(e.maybeRemoved)for(let t=0;t<e.maybeRemoved.length;t++){let n=e.maybeRemoved[t];e.child.parentSet.has(n)||P(n,e.child)}}function N(e){if(L.stack&&!L.stack.child.parentSet.has(e)){if(L.stack.child.parentSet.add(e),L.stack.child.isActivelyListening&&_(e,L.stack.child),L.stack.offset<L.stack.child.parents.length){let t=L.stack.child.parents[L.stack.offset];t!==e&&(L.stack.maybeRemoved?L.stack.maybeRemoved.push(t):L.stack.maybeRemoved=[t])}L.stack.child.parents[L.stack.offset]=e,L.stack.child.parentEpochs[L.stack.offset]=e.lastChangedEpoch,L.stack.offset++}}class F{constructor(e,t,n){this.name=e,this.runEffect=t,this._scheduleEffect=n?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;get scheduleCount(){return this._scheduleCount}parentSet=new T;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==H()){if(this.parents.length&&!C(this)){this.lastReactedEpoch=H();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)_(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)P(this.parents[e],this)}execute(){try{z(this);let e=H(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{R()}}}let $=E("EffectScheduler",()=>F);function B(e,t,n){let r=new $(e,t,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}class U{constructor(e){this.parent=e}initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){this.isRoot?W(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){V.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{t.set(e),t.historyBuffer?.clear()}),this.commit()}}let V=E("transactions",()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:0}));function H(){return V.globalEpoch}function K(e,t){t.lastTraversedEpoch!==V.globalEpoch&&(t.lastTraversedEpoch=V.globalEpoch,t instanceof $?e.add(t):t.children.visit(t=>K(e,t)))}function W(e){if(V.globalIsReacting)throw Error("cannot change atoms during reaction cycle");try{V.globalIsReacting=!0,V.reactionEpoch=V.globalEpoch;let t=new Set;for(let n of e)n.children.visit(e=>K(t,e));for(let e of t)e.maybeScheduleEffect();let n=0;for(;V.cleanupReactors?.size;){if(n++>1e3)throw Error("Reaction update depth limit exceeded");let e=V.cleanupReactors;for(let t of(V.cleanupReactors=null,e))t.maybeScheduleEffect()}}finally{V.cleanupReactors=null,V.globalIsReacting=!1}}function G(e){return V.currentTransaction?e():function(e){let t=new U(V.currentTransaction);V.currentTransaction=t;try{let n;let r=!1;try{n=e(()=>r=!0)}catch(e){throw t.abort(),e}return r?t.abort():t.commit(),n}finally{V.currentTransaction=V.currentTransaction.parent}}(e)}class q{constructor(e,t,n){if(this.name=e,this.current=t,this.isEqual=n?.isEqual??null,!n)return;n.historyLength&&(this.historyBuffer=new A(n.historyLength)),this.computeDiff=n.computeDiff}isEqual;computeDiff;lastChangedEpoch=H();children=new T;historyBuffer;__unsafe__getWithoutCapture(e){return this.current}get(){return N(this),this.current}set(e,t){if(this.isEqual?.(this.current,e)??I(this.current,e))return this.current;V.globalEpoch++,this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,H(),t??this.computeDiff?.(this.current,e,this.lastChangedEpoch,H())??M),this.lastChangedEpoch=H();let n=this.current;return this.current=e,function(e,t){if(V.globalIsReacting){let t=V.cleanupReactors??=new Set;e.children.visit(e=>K(t,e))}else V.currentTransaction?V.currentTransaction.initialAtomValues.has(e)||V.currentTransaction.initialAtomValues.set(e,t):W([e])}(this,n),e}update(e){return this.set(e(this.current))}getDiffSince(e){return(N(this),e>=this.lastChangedEpoch)?j:this.historyBuffer?.getChangesSince(e)??M}}let Y=E("Atom",()=>q);function X(e,t,n){return new Y(e,t,n)}let Z=!1,Q=Symbol.for("com.tldraw.state/UNINITIALIZED"),J=e=>e===Q,ee=E("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function et(e,t){return new ee(e,t)}class en{constructor(e,t,n){this.name=e,this.derive=t,n?.historyLength&&(this.historyBuffer=new A(n.historyLength)),this.computeDiff=n?.computeDiff,this.isEqual=n?.isEqual??I}lastChangedEpoch=-1;lastTraversedEpoch=-1;lastCheckedEpoch=-1;parentSet=new T;parents=[];parentEpochs=[];children=new T;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=Q;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(e){let t=-1===this.lastChangedEpoch,n=H();if(!t&&(this.lastCheckedEpoch===n||this.isActivelyListening&&V.globalIsReacting&&this.lastTraversedEpoch<V.reactionEpoch||!C(this))){if(this.lastCheckedEpoch=n,!this.error||e)return this.state;throw this.error.thrownValue}try{z(this);let e=this.derive(this.state,this.lastCheckedEpoch),t=e instanceof ee?e.value:e,n=this.state===Q;if(n||!this.isEqual(t,this.state)){if(this.historyBuffer&&!n){let n=e instanceof ee?e.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,H(),n??this.computeDiff?.(this.state,t,this.lastCheckedEpoch,H())??M)}this.lastChangedEpoch=H(),this.state=t}return this.error=null,this.lastCheckedEpoch=H(),this.state}catch(t){if(this.state!==Q&&(this.state=Q,this.lastChangedEpoch=H()),this.lastCheckedEpoch=H(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:t},!e)throw t;return this.state}finally{R()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{N(this)}}getDiffSince(e){return(this.__unsafe__getWithoutCapture(!0),N(this),e>=this.lastChangedEpoch)?j:this.historyBuffer?.getChangesSince(e)??M}}let er=E("Computed",()=>en);function ei(e={},t,n,r){return r.get?(Z||(Z=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`)),function(e={},t,n,r){let i=r.get,o=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new er(n,i.bind(this),e)}),t.get()},r}(e,0,n,r)):function(e={},t,n,r){let i=r.value,o=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new er(n,i.bind(this),e)}),t.get()},r.value[eo]=!0,r}(e,0,n,r)}let eo="@@__isComputedMethod__@@";function es(){if(1==arguments.length){let e=arguments[0];return(t,n,r)=>ei(e,t,n,r)}return"string"==typeof arguments[0]?new er(arguments[0],arguments[1],arguments[2]):ei(void 0,arguments[0],arguments[1],arguments[2])}if(1!==E("apiVersion",()=>1))throw Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var ea=n(87634),el=n(62063);let ec={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},ed=ec.Good;class eu{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(e){this.name=e,this.frames=0,this.started=!0,null!==this.frame&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,null!==this.frame&&cancelAnimationFrame(this.frame);let e=(performance.now()-this.startTime)/1e3,t=0===e?0:Math.floor(this.frames/e),n=t>55?ec.Good:t>30?ec.Mid:ec.Poor,r=n===ec.Mid?"black":"white",i=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${i} %c${t}%c fps`,`color: white; background: ${ed};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${n};color: ${r};`,"font-weight: normal")}isStarted(){return this.started}}function eh(e,t){let n=[];i:for(let r of e){for(let e of n)if(t?t(r,e):r===e)continue i;n.push(r)}return n}function ep(e){return e.filter(e=>null!=e)}function ef(e){return e[e.length-1]}function eg(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}class em{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function ey(e){let t=(...n)=>{try{return e(...n)}catch(e){throw e instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(e,t),e}};return t}let eb=()=>{},ex={ok:e=>({ok:!0,value:e}),err:e=>({ok:!1,error:e})};function ev(e,t){let n=t&&e&&"object"==typeof e&&t in e?e[t]:e;throw Error(`Unknown switch case ${n}`)}let ew=ey((e,t)=>{if(!e)throw Error(t||"Assertion Error")}),eS=ey((e,t)=>{if(null==e)throw Error(t??"value must be defined");return e});function ek(e,t){let n;let r=(...r)=>(n||((n={}).promise=new Promise((e,t)=>{n.resolve=e,n.reject=t})),clearTimeout(n.timeout),n.latestArgs=r,n.timeout=setTimeout(()=>{let t=n;n=void 0;try{t.resolve(e(...t.latestArgs))}catch(e){t.reject(e)}},t),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}let eC=new WeakMap;function eP(e,t){if("object"!=typeof e||null===e)return;let n=eC.get(e);n||(n={tags:{},extras:{}},eC.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}async function e_(e,t){return window.fetch(e,{referrerPolicy:"strict-origin-when-cross-origin",...t})}let eI=(e,t)=>{let n=new window.Image(e,t);return n.referrerPolicy="strict-origin-when-cross-origin",n};class eE{static async dataUrlToArrayBuffer(e){return e_(e).then(function(e){return e.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((t,n)=>{if(e){let r=new FileReader;r.onload=()=>t(r.result),r.onerror=e=>n(e),r.onabort=e=>n(e),r.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,n)=>{if(e){let r=new FileReader;r.onload=()=>t(r.result),r.onerror=e=>n(e),r.onabort=e=>n(e),r.readAsText(e)}})}}function ej(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t+""}let eT=e=>44===new Uint8Array(e)[3];function eM(e,t){let n=0;for(;e[t+n];)n+=e[t+n]+1;return n+1}let eA=[0,0x77073096,0xee0e612c,0x990951ba,0x76dc419,0x706af48f,0xe963a535,0x9e6495a3,0xedb8832,0x79dcb8a4,0xe0d5e91e,0x97d2d988,0x9b64c2b,0x7eb17cbd,0xe7b82d07,0x90bf1d91,0x1db71064,0x6ab020f2,0xf3b97148,0x84be41de,0x1adad47d,0x6ddde4eb,0xf4d4b551,0x83d385c7,0x136c9856,0x646ba8c0,0xfd62f97a,0x8a65c9ec,0x14015c4f,0x63066cd9,0xfa0f3d63,0x8d080df5,0x3b6e20c8,0x4c69105e,0xd56041e4,0xa2677172,0x3c03e4d1,0x4b04d447,0xd20d85fd,0xa50ab56b,0x35b5a8fa,0x42b2986c,0xdbbbc9d6,0xacbcf940,0x32d86ce3,0x45df5c75,0xdcd60dcf,0xabd13d59,0x26d930ac,0x51de003a,0xc8d75180,0xbfd06116,0x21b4f4b5,0x56b3c423,0xcfba9599,0xb8bda50f,0x2802b89e,0x5f058808,0xc60cd9b2,0xb10be924,0x2f6f7c87,0x58684c11,0xc1611dab,0xb6662d3d,0x76dc4190,0x1db7106,0x98d220bc,0xefd5102a,0x71b18589,0x6b6b51f,0x9fbfe4a5,0xe8b8d433,0x7807c9a2,0xf00f934,0x9609a88e,0xe10e9818,0x7f6a0dbb,0x86d3d2d,0x91646c97,0xe6635c01,0x6b6b51f4,0x1c6c6162,0x856530d8,0xf262004e,0x6c0695ed,0x1b01a57b,0x8208f4c1,0xf50fc457,0x65b0d9c6,0x12b7e950,0x8bbeb8ea,0xfcb9887c,0x62dd1ddf,0x15da2d49,0x8cd37cf3,0xfbd44c65,0x4db26158,0x3ab551ce,0xa3bc0074,0xd4bb30e2,0x4adfa541,0x3dd895d7,0xa4d1c46d,0xd3d6f4fb,0x4369e96a,0x346ed9fc,0xad678846,0xda60b8d0,0x44042d73,0x33031de5,0xaa0a4c5f,0xdd0d7cc9,0x5005713c,0x270241aa,0xbe0b1010,0xc90c2086,0x5768b525,0x206f85b3,0xb966d409,0xce61e49f,0x5edef90e,0x29d9c998,0xb0d09822,0xc7d7a8b4,0x59b33d17,0x2eb40d81,0xb7bd5c3b,0xc0ba6cad,0xedb88320,0x9abfb3b6,0x3b6e20c,0x74b1d29a,0xead54739,0x9dd277af,0x4db2615,0x73dc1683,0xe3630b12,0x94643b84,0xd6d6a3e,0x7a6a5aa8,0xe40ecf0b,0x9309ff9d,0xa00ae27,0x7d079eb1,0xf00f9344,0x8708a3d2,0x1e01f268,0x6906c2fe,0xf762575d,0x806567cb,0x196c3671,0x6e6b06e7,0xfed41b76,0x89d32be0,0x10da7a5a,0x67dd4acc,0xf9b9df6f,0x8ebeeff9,0x17b7be43,0x60b08ed5,0xd6d6a3e8,0xa1d1937e,0x38d8c2c4,0x4fdff252,0xd1bb67f1,0xa6bc5767,0x3fb506dd,0x48b2364b,0xd80d2bda,0xaf0a1b4c,0x36034af6,0x41047a60,0xdf60efc3,0xa867df55,0x316e8eef,0x4669be79,0xcb61b38c,0xbc66831a,0x256fd2a0,0x5268e236,0xcc0c7795,0xbb0b4703,0x220216b9,0x5505262f,0xc5ba3bbe,0xb2bd0b28,0x2bb45a92,0x5cb36a04,0xc2d7ffa7,0xb5d0cf31,0x2cd99e8b,0x5bdeae1d,0x9b64c2b0,0xec63f226,0x756aa39c,0x26d930a,0x9c0906a9,0xeb0e363f,0x72076785,0x5005713,0x95bf4a82,0xe2b87a14,0x7bb12bae,0xcb61b38,0x92d28e9b,0xe5d5be0d,0x7cdcefb7,0xbdbdf21,0x86d3d2d4,0xf1d4e242,0x68ddb3f8,0x1fda836e,0x81be16cd,0xf6b9265b,0x6fb077e1,0x18b74777,0x88085ae6,0xff0f6a70,0x66063bca,0x11010b5c,0x8f659eff,0xf862ae69,0x616bffd3,0x166ccf45,0xa00ae278,0xd70dd2ee,0x4e048354,0x3903b3c2,0xa7672661,0xd06016f7,0x4969474d,0x3e6e77db,0xaed16a4a,0xd9d65adc,0x40df0b66,936918e3,0xa9bcae53,0xdebb9ec5,0x47b2cf7f,0x30b5ffe9,0xbdbdf21c,0xcabac28a,0x53b39330,0x24b4a3a6,0xbad03605,0xcdd70693,0x54de5729,0x23d967bf,0xb3667a2e,0xc4614ab8,0x5d681b02,0x2a6f2b94,0xb40bbe37,0xc30c8ea1,0x5a05df1b,0x2d02ef8d];"undefined"!=typeof Int32Array&&(eA=new Int32Array(eA));let eO=(e,t)=>{let n=0===t?0:-1^~~t;for(let t=0;t<e.length;t++)n=eA[(n^e[t])&255]^n>>>8;return -1^n};class eL{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){let n={};if(!eL.isPng(e,t))throw Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){let r=t,i=e.getInt32(t);t+=4;let o=eL.getChunkType(e,t);if("IDAT"===o&&n[o]){t+=i+4+4;continue}if("IEND"===o)break;n[o]={start:r,dataOffset:t+4,size:i},t+=i+4+4}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return eL.readChunks(e)[t]}static setPhysChunk(e,t=1,n){let r=46,i=0,o=eL.findChunk(e,"pHYs");o&&(r=o.start,i=o.size);let s=eL.findChunk(e,"IDAT");s&&(r=s.start,i=0);let a=new ArrayBuffer(21),l=new DataView(a);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115),l.setInt32(8,2835.5*t),l.setInt32(12,2835.5*t),l.setInt8(16,1);let c=new Uint8Array(a.slice(4,17));return l.setInt32(17,eO(c)),new Blob([e.buffer.slice(0,r),a,e.buffer.slice(r+i)],n)}}let eD=Object.freeze(["image/svg+xml"]),ez=Object.freeze(["image/jpeg","image/png","image/webp"]),eR=Object.freeze(["image/gif","image/apng","image/avif"]),eN=Object.freeze([...ez,...eD,...eR]),eF=Object.freeze(["video/mp4","video/webm","video/quicktime"]),e$=[...eN,...eF].join(",");class eB{static loadVideo(e){return new Promise((t,n)=>{let r=document.createElement("video");r.onloadeddata=()=>t(r),r.onerror=e=>{console.error(e),n(Error("Could not load video"))},r.crossOrigin="anonymous",r.src=e})}static loadImage(e){return new Promise((t,n)=>{let r=eI();r.onload=()=>t(r),r.onerror=e=>{console.error(e),n(Error("Could not load image"))},r.crossOrigin="anonymous",r.referrerPolicy="strict-origin-when-cross-origin",r.src=e})}static async getVideoSize(e){return eB.usingObjectURL(e,async e=>{let t=await eB.loadVideo(e);return{w:t.videoWidth,h:t.videoHeight}})}static async getImageSize(e){let t=await eB.usingObjectURL(e,eB.loadImage);try{if("image/png"===e.type){let n=new DataView(await e.arrayBuffer());if(eL.isPng(n,0)){let e=eL.findChunk(n,"pHYs");if(e){let r=eL.parsePhys(n,e.dataOffset);if(0===r.unit&&r.ppux===r.ppuy){let e=Math.max(r.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/e),h:Math.round(t.naturalHeight/e)}}}}}}catch(e){console.error(e)}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return"image/gif"===e.type?function(e){let t,n;let r=new Uint8Array(e),i=0,o=0;if("GIF"!==new TextDecoder("ascii").decode(e.slice(0,3)))return!1;for(t=128&r[10],n=7&r[10],i+=6,i+=7,i+=t?3*Math.pow(2,n+1):0;o<2&&i<r.length;)switch(r[i]){case 44:o+=1,t=128&r[i+9],n=7&r[i+9],i+=10,i+=t?3*Math.pow(2,n+1):0,i+=eM(r,i+1)+1;break;case 33:i+=2,i+=eM(r,i);break;default:i=r.length}return o>1}(await e.arrayBuffer()):"image/avif"===e.type?eT(await e.arrayBuffer()):"image/webp"===e.type?function(e){let t=new Uint8Array(e);return!!t&&!(t.length<12)&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]&&!!t&&!(t.length<21)&&(t[20]>>1&1)==1}(await e.arrayBuffer()):"image/apng"===e.type&&function(e){let t=new Uint8Array(e);if(!t||!("undefined"!=typeof Buffer&&Buffer.isBuffer(t)||t instanceof Uint8Array)||t.length<16||!(137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]))return!1;function n(e,t,r,i,o=1024){if(!t)return -1;let s=(t=RegExp(t,"g")).source.length,a=new TextDecoder,l=e.length;if(void 0===i&&(i=l),r>=l||i<=0||r>=i)return -1;e=e.subarray(r,i);let c=-1,d=0,u=0,h="";e:for(;d<e.length;){let n;let r=d+o,i=e.subarray(d,r),l=a.decode(i,{stream:!0}),p=h+l,f=-1;for(;null!==(n=t.exec(p));){c=u+(f=n.index-h.length);break e}d=r,u+=l.length;let g=f>-1?f+s:l.length-s;h=l.slice(g)}return c>=0&&(c+=r>=0?r:l+r),c}let r=n(t,"IDAT",12);return r>=12&&n(t,"acTL",8,r)>=8}(await e.arrayBuffer())}static isAnimatedImageType(e){return eR.includes(e||"")}static isStaticImageType(e){return ez.includes(e||"")}static isVectorImageType(e){return eD.includes(e||"")}static isImageType(e){return eN.includes(e)}static async usingObjectURL(e,t){let n=URL.createObjectURL(e);try{return await t(n)}finally{URL.revokeObjectURL(n)}}}function eU(e=""){let t=0,n=0,r=0,i=0;function o(){let e=t^t<<11;return t=n,n=r,r=i,(i^=(i>>>19^e^e>>>8)>>>0)/0x100000000*2}for(let n=0;n<e.length+64;n++)t^=0|e.charCodeAt(n),o();return o}function eV(e,t,n,r=!1){let[i,o]=t,[s,a]=n,l=s+(e-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function eH(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eK(e,t){if(eH(e,t))return e[t]}function eW(e){return Object.keys(e)}function eG(e){return Object.values(e)}function eq(e){return Object.entries(e)}function eY(e){return Object.fromEntries(e)}function eX(e,t){let n={},r=!1;for(let[i,o]of eq(e))t(i,o)?n[i]=o:r=!0;return r?n:e}function eZ(e,t){let n={};for(let[r,i]of eq(e)){let e=t(r,i);n[r]=e}return n}function eQ(e,t){if(e===t)return!0;let n=new Set(Object.keys(e)),r=new Set(Object.keys(t));if(n.size!==r.size)return!1;for(let i of n)if(!r.has(i)||!Object.is(e[i],t[i]))return!1;return!0}let eJ="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",e0="A00000000000000000000000000";function e1(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-97+2;if(e>="A"&&e<="Z")return 90-e.charCodeAt(0)+2;throw Error("Invalid index key head: "+e)}function e2(e){if(e.length!==e1(e.charAt(0)))throw Error("invalid integer part of index key: "+e)}function e3(e){if(void 0===e)throw Error("n is undefined")}function e5(e){e2(e);let[t,...n]=e.split(""),r=!0;for(let e=n.length-1;r&&e>=0;e--){let t=eJ.indexOf(n[e])+1;t===eJ.length?n[e]="0":(n[e]=eJ.charAt(t),r=!1)}if(!r)return t+n.join("");{if("Z"===t)return"a0";if("z"===t)return;let e=String.fromCharCode(t.charCodeAt(0)+1);return e>"a"?n.push("0"):n.pop(),e+n.join("")}}function e4(e,t){if(void 0!==t&&e>=t)throw Error(e+" >= "+t);if("0"===e.slice(-1)||t&&"0"===t.slice(-1))throw Error("trailing zero");if(t){let n=0;for(;(e.charAt(n)||"0")===t.charAt(n);)n++;if(n>0)return t.slice(0,n)+e4(e.slice(n),t.slice(n))}let n=e?eJ.indexOf(e.charAt(0)):0,r=void 0!==t?eJ.indexOf(t.charAt(0)):eJ.length;if(r-n>1){let e=Math.round(.5*(n+r));return eJ.charAt(e)}return t&&t.length>1?t.slice(0,1):eJ.charAt(n)+e4(e.slice(1),void 0)}function e6(e){let t=e1(e.charAt(0));if(t>e.length)throw Error("invalid index: "+e);return e.slice(0,t)}function e8(e){if(e===e0)throw Error("invalid index: "+e);let t=e6(e);if("0"===e.slice(t.length).slice(-1))throw Error("invalid index: "+e)}function e9(e,t){if(void 0!==e&&e8(e),void 0!==t&&e8(t),void 0!==e&&void 0!==t&&e>=t)throw Error(e+" >= "+t);if(void 0===e&&void 0===t)return"a0";if(void 0===e){if(void 0===t)throw Error("b is undefined");let e=e6(t),n=t.slice(e.length);if(e===e0)return e+e4("",n);if(e<t)return e;let r=function(e){e2(e);let[t,...n]=e.split(""),r=!0;for(let e=n.length-1;r&&e>=0;e--){let t=eJ.indexOf(n[e])-1;-1===t?n[e]=eJ.slice(-1):(n[e]=eJ.charAt(t),r=!1)}if(!r)return t+n.join("");{if("a"===t)return"Z"+eJ.slice(-1);if("A"===t)return;let e=String.fromCharCode(t.charCodeAt(0)-1);return e<"Z"?n.push(eJ.slice(-1)):n.pop(),e+n.join("")}}(e);return e3(r),r}if(void 0===t){let t=e6(e),n=e.slice(t.length),r=e5(t);return void 0===r?t+e4(n,void 0):r}let n=e6(e),r=e.slice(n.length),i=e6(t),o=t.slice(i.length);if(n===i)return n+e4(r,o);let s=e5(n);return e3(s),s<t?s:n+e4(r,void 0)}function e7(e,t,n){if(0===n)return[];if(1===n)return[e9(e,t)];if(void 0===t){let r=e9(e,t),i=[r];for(let e=0;e<n-1;e++)i.push(r=e9(r,t));return i}if(void 0===e){let r=e9(e,t),i=[r];for(let t=0;t<n-1;t++)i.push(r=e9(e,r));return i.reverse(),i}let r=Math.floor(n/2),i=e9(e,t);return[...e7(e,i,r),i,...e7(i,t,n-r-1)]}function te(e,t){return e7(e,void 0,t)}function tt(e,t){return e7(e,t,1)[0]}function tn(e){return e7(e,void 0,1)[0]}function tr(e,t="a1"){return[t,...e7(t,void 0,e)]}function ti(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function to(e,t){return e.id>t.id?1:-1}function ts(e){try{return localStorage.getItem(e)}catch{return null}}function ta(e,t){try{localStorage.setItem(e,t)}catch{}}function tl(e){try{return sessionStorage.getItem(e)}catch{return null}}function tc(e,t){try{sessionStorage.setItem(e,t)}catch{}}function td(e){try{sessionStorage.removeItem(e)}catch{}}let tu=()=>"undefined"!=typeof process&&!1,th=[],tp=Math.ceil(16.666666666666668),tf=0,tg=0,tm=()=>{for(let e of th.splice(0,th.length))e()},ty=!1;function tb(e){return tu()?(e(),()=>{}):(th.includes(e)||(th.push(e),ty||(ty=!0,tg=Date.now()-tp-1),function e(){if(r)return;let t=Date.now(),n=t-tg;if(tf+n<tp){r=requestAnimationFrame(()=>{r=void 0,e()});return}r=requestAnimationFrame(()=>{r=void 0,tg=t,tf=Math.min(tf+n-tp,10*tp),tm()})}()),()=>{let t=th.indexOf(e);t>-1&&th.splice(t,1)})}class tx{timeouts=[];intervals=[];rafs=[];setTimeout(e,t,...n){let r=window.setTimeout(e,t,n);return this.timeouts.push(r),r}setInterval(e,t,...n){let r=window.setInterval(e,t,n);return this.intervals.push(r),r}requestAnimationFrame(e){let t=window.requestAnimationFrame(e);return this.rafs.push(t),t}dispose(){this.timeouts.forEach(e=>clearTimeout(e)),this.intervals.forEach(e=>clearInterval(e)),this.rafs.forEach(e=>cancelAnimationFrame(e)),this.timeouts.length=0,this.intervals.length=0,this.rafs.length=0}}function tv(e){return null!==e}let tw="undefined"!=typeof globalThis&&globalThis.structuredClone?[globalThis.structuredClone,!0]:"undefined"!=typeof global&&global.structuredClone?[global.structuredClone,!0]:"undefined"!=typeof window&&window.structuredClone?[window.structuredClone,!0]:[e=>e?JSON.parse(JSON.stringify(e)):e,!1],tS=tw[0];tw[1];let tk=Object.getPrototypeOf(tS({})),tC={enableLicensing:function(e,{defaults:t,shouldStoreForSession:n=!0}){return tE({name:e,defaults:t,shouldStoreForSession:n})}("enableLicensing",{defaults:{all:!0,production:!1}})},tP=tI("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),t_={logPreventDefaults:tI("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:tI("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:tI("logElementRemoves",{defaults:{all:!1}}),debugSvg:tI("debugSvg",{defaults:{all:!1}}),showFps:tI("showFps",{defaults:{all:!1}}),measurePerformance:tI("measurePerformance",{defaults:{all:!1}}),throwToBlob:tI("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:tI("reconnectOnPing",{defaults:{all:!1}}),debugCursors:tI("debugCursors",{defaults:{all:!1}}),forceSrgb:tI("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:tI("debugGeometry",{defaults:{all:!1}}),hideShapes:tI("hideShapes",{defaults:{all:!1}}),editOnType:tI("editOnType",{defaults:{all:!1}})};if("undefined"!=typeof Element){let e=Element.prototype.removeChild;B("element removal logging",()=>{t_.logElementRemoves.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e})}function tI(e,{defaults:t,shouldStoreForSession:n=!0}){return tE({name:e,defaults:t,shouldStoreForSession:n})}function tE(e){let t=function(e){switch(tj(()=>process.env.TLDRAW_ENV)??tj(()=>process.env.VERCEL_PUBLIC_TLDRAW_ENV)??tj(()=>process.env.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}(e),n=e.shouldStoreForSession?function(e){try{return JSON.parse(tl(`tldraw_debug:${e}`)??"null")}catch(e){return null}}(e.name):null,r=X(`debug:${e.name}`,n??t);return"undefined"!=typeof window&&(e.shouldStoreForSession&&B(`debug:${e.name}`,()=>{let n=r.get();n===t?td(`tldraw_debug:${e.name}`):tc(`tldraw_debug:${e.name}`,JSON.stringify(n))}),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,e=>e.toUpperCase())}`,{get:()=>r.get(),set(e){r.set(e)},configurable:!0})),Object.assign(r,e)}function tj(e){try{return e()}catch{return null}}class tT{constructor(e){this.previousValue=e}nextValue;diff;get(){let e=this.diff?.removed?.size??0,t=this.diff?.added?.size??0;if(0!==e||0!==t)return{value:this.nextValue,diff:this.diff}}_add(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},t?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){let t=this.previousValue.has(e);if(t){if(!this.diff?.removed?.has(e))return;return this._add(e,t)}this.nextValue?.has(e)||this._add(e,t)}_remove(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},t?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){let t=this.previousValue.has(e);if(!t){if(!this.diff?.added?.has(e))return;return this._remove(e,t)}this.diff?.removed?.has(e)||this._remove(e,t)}}var tM=n(55511);let tA=e=>{!i||i.length<e?(i=Buffer.allocUnsafe(128*e),(0,tM.randomFillSync)(i),o=0):o+e>i.length&&((0,tM.randomFillSync)(i),o=0),o+=e},tO=(e=21)=>{tA(e-=0);let t="";for(let n=o-e;n<o;n++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&i[n]];return t};class tL{constructor(e,t){this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:e=>e},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;let n=new Set;if(t.ephemeralKeys)for(let[e,r]of eq(t.ephemeralKeys))r&&n.add(e);this.ephemeralKeySet=n}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(e){let t={...this.createDefaultProperties(),id:this.createId()};for(let[n,r]of Object.entries(e))void 0!==r&&(t[n]=r);return t.typeName=this.typeName,t}clone(e){return{...tS(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??tO())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance=e=>e?.typeName===this.typeName;isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new tL(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function tD(e,t){return new tL(e,{createDefaultProperties:()=>({}),validator:t.validator,scope:t.scope,ephemeralKeys:t.ephemeralKeys})}function tz(){return{added:{},updated:{},removed:{}}}function tR(e){let t={added:e.removed,removed:e.added,updated:{}};for(let[n,r]of Object.values(e.updated))t.updated[n.id]=[r,n];return t}function tN(e){return 0===Object.keys(e.added).length&&0===Object.keys(e.updated).length&&0===Object.keys(e.removed).length}function tF(e){let t={added:{},removed:{},updated:{}};return t$(t,e),t}function t$(e,t){for(let n of t){for(let[t,r]of eq(n.added))if(e.removed[t]){let n=e.removed[t];delete e.removed[t],n!==r&&(e.updated[t]=[n,r])}else e.added[t]=r;for(let[t,[r,i]]of eq(n.updated)){if(e.added[t]){e.added[t]=i,delete e.updated[t],delete e.removed[t];continue}if(e.updated[t]){e.updated[t]=[e.updated[t][0],i],delete e.removed[t];continue}e.updated[t]=n.updated[t],delete e.removed[t]}for(let[t,r]of eq(n.removed))e.added[t]?delete e.added[t]:e.updated[t]?(e.removed[t]=e.updated[t][0],delete e.updated[t]):e.removed[t]=r}}var tB=n(97702);function tU(e,t){for(let[n,r]of Object.entries(e)){let e=t[n];if("eq"in r&&e!==r.eq||"neq"in r&&e===r.neq||"gt"in r&&("number"!=typeof e||e<=r.gt))return!1}return!0}function tV(e,t,n){let r=Object.fromEntries(Object.keys(n).map(e=>[e,new Set]));for(let[i,o]of Object.entries(n))if("eq"in o){let n=e.index(t,i).get().get(o.eq);if(n)for(let e of n)r[i].add(e)}else if("neq"in o){for(let[n,s]of e.index(t,i).get())if(n!==o.neq)for(let e of s)r[i].add(e)}else if("gt"in o){for(let[n,s]of e.index(t,i).get())if(n>o.gt)for(let e of s)r[i].add(e)}return function(e){if(0===e.length)return new Set;let t=e[0],n=e.slice(1),r=new Set;for(let e of t)n.every(t=>t.has(e))&&r.add(e);return r}(Object.values(r))}class tH{constructor(e,t){this.atoms=e,this.history=t}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);let t=es("filterHistory:"+e,(t,n)=>{if(J(t))return this.history.get();let r=this.history.getDiffSince(n);if(r===M)return this.history.get();let i={added:{},removed:{},updated:{}},o=0,s=0,a=0;for(let t of r){for(let n of eG(t.added))if(n.typeName===e){if(i.removed[n.id]){let e=i.removed[n.id];delete i.removed[n.id],s--,e!==n&&(i.updated[n.id]=[e,n],a++)}else i.added[n.id]=n,o++}for(let[n,r]of eG(t.updated))r.typeName===e&&(i.added[r.id]?i.added[r.id]=r:i.updated[r.id]?i.updated[r.id]=[i.updated[r.id][0],r]:(i.updated[r.id]=[n,r],a++));for(let n of eG(t.removed))n.typeName===e&&(i.added[n.id]?(delete i.added[n.id],o--):(i.updated[n.id]?(i.removed[n.id]=i.updated[n.id][0],delete i.updated[n.id],a--):i.removed[n.id]=n,s++))}return o||s||a?et(this.history.get(),i):t},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){let n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);let r=this.__uncached_createIndex(e,t);return this.indexCache.set(n,r),r}__uncached_createIndex(e,t){let n=this.filterHistory(e),r=()=>{n.get();let r=new Map;for(let n of eG(this.atoms.get())){let i=n.get();if(i.typeName===e){let e=i[t];r.has(e)||r.set(e,new Set),r.get(e).add(i.id)}}return r};return es("index:"+e+":"+t,(i,o)=>{let s,a;if(J(i))return r();let l=n.getDiffSince(o);if(l===M)return r();let c=new Map,d=(e,t)=>{let n=c.get(e);n||(n=new tT(i.get(e)??new Set)),n.add(t),c.set(e,n)},u=(e,t)=>{let n=c.get(e);n||(n=new tT(i.get(e)??new Set)),n.remove(t),c.set(e,n)};for(let n of l){for(let r of eG(n.added))r.typeName===e&&d(r[t],r.id);for(let[r,i]of eG(n.updated))if(i.typeName===e){let e=r[t],n=i[t];e!==n&&(u(e,i.id),d(n,i.id))}for(let r of eG(n.removed))r.typeName===e&&u(r[t],r.id)}for(let[e,t]of c){let n=t.get();n&&(s||(s=new Map(i)),a||(a=new Map),0===n.value.size?s.delete(e):s.set(e,n.value),a.set(e,n.diff))}return s&&a?et(s,a):i},{historyLength:100})}record(e,t=()=>({}),n="record:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,n);return es(n,()=>{for(let e of r.get())return this.atoms.get()[e]?.get()})}records(e,t=()=>({}),n="records:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,"ids:"+n);return es(n,()=>[...r.get()].map(e=>{let t=this.atoms.get()[e];if(!t)throw Error("no atom found for record id: "+e);return t.get()}))}ids(e,t=()=>({}),n="ids:"+e+(t?":"+t.toString():"")){let r=this.filterHistory(e),i=()=>{r.get();let n=t();return 0===Object.keys(n).length?new Set(eG(this.atoms.get()).flatMap(t=>{let n=t.get();return n.typeName===e?n.id:[]})):tV(this,e,n)},o=e=>{let t=i(),n=function(e,t){let n={};for(let r of t)e.has(r)||(n.added??=new Set,n.added.add(r));for(let r of e)t.has(r)||(n.removed??=new Set,n.removed.add(r));return n.added||n.removed?n:void 0}(e,t);return n?et(t,n):e},s=es("ids_query:"+n,t,{isEqual:tB});return es("query:"+n,(t,n)=>{let a=s.get();if(J(t))return i();if(n<s.lastChangedEpoch)return o(t);let l=r.getDiffSince(n);if(l===M)return o(t);let c=new tT(t);for(let t of l){for(let n of eG(t.added))n.typeName===e&&tU(a,n)&&c.add(n.id);for(let[n,r]of eG(t.updated))r.typeName===e&&(tU(a,r)?c.add(r.id):c.remove(r.id));for(let n of eG(t.removed))n.typeName===e&&c.remove(n.id)}let d=c.get();return d?et(d.value,d.diff):t},{historyLength:50})}exec(e,t){let n=tV(this,e,t);if(0===n.size)return j;let r=this.atoms.get();return[...n].map(e=>r[e].get())}}class tK{constructor(e){this.store=e}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;let n=this._beforeCreateHandlers[e.typeName];if(n){let r=e;for(let e of n)r=e(r,t);return r}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;let n=this._afterCreateHandlers[e.typeName];if(n)for(let r of n)r(e,t)}handleBeforeChange(e,t,n){if(!this._isEnabled)return t;let r=this._beforeChangeHandlers[t.typeName];if(r){let i=t;for(let t of r)i=t(e,i,n);return i}return t}handleAfterChange(e,t,n){if(!this._isEnabled)return;let r=this._afterChangeHandlers[t.typeName];if(r)for(let i of r)i(e,t,n)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;let n=this._beforeDeleteHandlers[e.typeName];if(n){for(let r of n)if(!1===r(e,t))return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;let n=this._afterDeleteHandlers[e.typeName];if(n)for(let r of n)r(e,t)}handleOperationComplete(e){if(this._isEnabled)for(let t of this._operationCompleteHandlers)t(e)}register(e){let t=[];for(let[n,r]of Object.entries(e))r?.beforeCreate&&t.push(this.registerBeforeCreateHandler(n,r.beforeCreate)),r?.afterCreate&&t.push(this.registerAfterCreateHandler(n,r.afterCreate)),r?.beforeChange&&t.push(this.registerBeforeChangeHandler(n,r.beforeChange)),r?.afterChange&&t.push(this.registerAfterChangeHandler(n,r.afterChange)),r?.beforeDelete&&t.push(this.registerBeforeDeleteHandler(n,r.beforeDelete)),r?.afterDelete&&t.push(this.registerAfterDeleteHandler(n,r.afterDelete));return()=>{for(let e of t)e()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>tW(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>tW(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>tW(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>tW(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>tW(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>tW(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>tW(this._operationCompleteHandlers,e)}}function tW(e,t){let n=e.indexOf(t);n>=0&&e.splice(n,1)}class tG{id;atoms=X("store_atoms",{});history=X("history",0,{historyLength:1e3});query=new tH(this.atoms,this.history);listeners=new Set;historyAccumulator=new tq;historyReactor;cancelHistoryReactor=()=>{};schema;props;scopedTypes;sideEffects=new tK(this);constructor(e){let{initialData:t,schema:n,id:r}=e;this.id=r??tO(),this.schema=n,this.props=e.props,t&&this.atoms.set(eY(eq(t).map(([e,t])=>[e,X("atom:"+e,this.schema.validateRecord(this,t,"initialize",null))]))),this.historyReactor=function(e,t,n){let r=new $(e,t,n);return{scheduler:r,start:e=>{let t=e?.force??!1;r.attach(),t?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:e=>this.cancelHistoryReactor=tb(e)}),this.scopedTypes={document:new Set(eG(this.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName)),session:new Set(eG(this.schema.types).filter(e=>"session"===e.scope).map(e=>e.typeName)),presence:new Set(eG(this.schema.types).filter(e=>"presence"===e.scope).map(e=>e.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges())for(let{changes:e,source:t}of this.historyAccumulator.flush()){let n=null,r=null,i=null;for(let{onHistory:o,filters:s}of this.listeners)if("all"===s.source||s.source===t){if("all"!==s.scope){if("document"===s.scope){if(!(r??=this.filterChangesByScope(e,"document")))continue;o({changes:r,source:t})}else if("session"===s.scope){if(!(n??=this.filterChangesByScope(e,"session")))continue;o({changes:n,source:t})}else{if(!(i??=this.filterChangesByScope(e,"presence")))continue;o({changes:i,source:t})}}else o({changes:e,source:t})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){let n={added:eX(e.added,(e,n)=>this.scopedTypes[t].has(n.typeName)),updated:eX(e.updated,(e,n)=>this.scopedTypes[t].has(n[1].typeName)),removed:eX(e.removed,(e,n)=>this.scopedTypes[t].has(n.typeName))};return 0===Object.keys(n.added).length&&0===Object.keys(n.updated).length&&0===Object.keys(n.removed).length?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}put=(e,t)=>{this.atomic(()=>{let n;let r={},i={},o=this.atoms.__unsafe__getWithoutCapture(),s=null,a=!1,l=this.isMergingRemoteChanges?"remote":"user";for(let c=0,d=e.length;c<d;c++){let d=(s??o)[(n=e[c]).id];if(d){let e=d.__unsafe__getWithoutCapture();if(n=this.sideEffects.handleBeforeChange(e,n,l),this.schema.validateRecord(this,n,t??"updateRecord",e)===e)continue;d.set(n),a=!0;let i=d.__unsafe__getWithoutCapture();r[n.id]=[e,i],this.addDiffForAfterEvent(e,i)}else n=this.sideEffects.handleBeforeCreate(n,l),a=!0,i[(n=this.schema.validateRecord(this,n,t??"createRecord",null)).id]=n,this.addDiffForAfterEvent(null,n),s||(s={...o}),s[n.id]=X("atom:"+n.id,n)}s&&this.atoms.set(s),a&&this.updateHistory({added:i,updated:r,removed:{}})})};remove=e=>{this.atomic(()=>{let t;let n=new Set,r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(let t of e){let e=this.atoms.__unsafe__getWithoutCapture()[t];e&&!1===this.sideEffects.handleBeforeDelete(e.get(),r)&&n.add(t)}this.atoms.update(r=>{let i;for(let o of e){if(n.has(o)||!(o in r))continue;i||(i={...r}),t||(t={}),delete i[o];let e=r[o].get();t[o]=e,this.addDiffForAfterEvent(e,null)}return i??r}),t&&this.updateHistory({added:{},updated:{},removed:t})})};get=e=>this.atoms.get()[e]?.get();unsafeGetWithoutCapture=e=>this.atoms.__unsafe__getWithoutCapture()[e]?.__unsafe__getWithoutCapture();serialize=(e="document")=>{let t={};for(let[n,r]of eq(this.atoms.get())){let i=r.get();("all"===e||this.scopedTypes[e].has(i.typeName))&&(t[n]=i)}return t};getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);let n=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(n)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords=()=>eG(this.atoms.get()).map(e=>e.get());clear=()=>{this.remove(eW(this.atoms.get()))};update=(e,t)=>{let n=this.atoms.get()[e];if(!n){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(n.__unsafe__getWithoutCapture())])};has=e=>!!this.atoms.get()[e];listen=(e,t)=>{this._flushHistory();let n={onHistory:e,filters:{source:t?.source??"all",scope:t?.scope??"all"}};return this.listeners.add(n),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(n),0===this.listeners.size&&this.historyReactor.stop()}};isMergingRemoteChanges=!1;mergeRemoteChanges=e=>{if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,G(e)}finally{this.isMergingRemoteChanges=!1}};extractingChanges(e){let t=[],n=this.historyAccumulator.addInterceptor(e=>t.push(e.changes));try{return G(e),tF(t)}finally{n()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:n=!1}={}){this.atomic(()=>{let t=eG(e.added);for(let[r,i]of eG(e.updated)){let e=this.schema.getType(i.typeName);if(n&&e.ephemeralKeySet.size){let n=this.get(i.id);if(!n){t.push(i);continue}let r=null;for(let[t,o]of Object.entries(i))e.ephemeralKeySet.has(t)||Object.is(o,eK(n,t))||(r||(r={...n}),r[t]=o);r&&t.push(r)}else t.push(i)}let r=eW(e.removed);t.length&&this.put(t),r.length&&this.remove(r)},t)}createComputedCache=(e,t,n)=>{let r=new em;return{get:i=>{let o=this.atoms.get()[i];if(o)return r.get(o,()=>{let r=n?es(o.name+":equals",()=>o.get(),{isEqual:n}):o;return es(e+":"+i,()=>t(r.get()))}).get()}}};createSelectedComputedCache=(e,t,n)=>{let r=new em;return{get:i=>{let o=this.atoms.get()[i];if(o)return r.get(o,()=>{let r=es(e+":"+i+":selector",()=>t(o.get()));return es(e+":"+i,()=>n(r.get()))}).get()}}};_integrityChecker;ensureStoreIsUsable(){this.atomic(()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()})}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(e,t){if(ew(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&ew(e.id===t.id),!e&&!t))return;let n=(e||t).id,r=this.pendingAfterEvents.get(n);r?r.after=t:this.pendingAfterEvents.set(n,{before:e,after:t})}flushAtomicCallbacks(){let e=0,t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){let n=this.pendingAfterEvents;if(this.pendingAfterEvents=null,this.sideEffects.isEnabled()){if(++e>100)throw Error("Maximum store update depth exceeded, bailing out");for(let{before:e,after:r}of n.values())e&&r?this.sideEffects.handleAfterChange(e,r,t):e&&!r?this.sideEffects.handleAfterDelete(e,t):!e&&r&&this.sideEffects.handleAfterCreate(r,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}_isInAtomicOp=!1;atomic(e,t=!0){return G(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;let n=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??n),this._isInAtomicOp=!0;try{let t=e();return this.flushAtomicCallbacks(),t}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(n),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}class tq{_history=[];_interceptors=new Set;addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){for(let t of(this._history.push(e),this._interceptors))t(e)}flush(){let e=function(e){let t;if(0===e.length)return[];let n=[],r=[e[0]];for(let i=1,o=e.length;i<o;i++)t=e[i],r[0].source!==t.source&&(n.push(r),r=[]),r.push(t);return n.push(r),n.map(e=>({source:e[0].source,changes:tF(e.map(e=>e.changes))}))}(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function tY({sequence:e,sequenceId:t,retroactive:n=!0}){let r={sequenceId:t,retroactive:n,sequence:function(e){let t=[];for(let n=e.length-1;n>=0;n--){let r=e[n];if("id"in r)t.unshift(r);else{let e=r.dependsOn,n=t[0];n&&(t[0]={...n,dependsOn:e.concat(n.dependsOn??[])})}}return t}(e)};return t0(r),r}function tX(e,t){return Object.fromEntries(eq(t).map(([t,n])=>[t,`${e}/${n}`]))}function tZ(e){return tY({sequenceId:e.sequenceId,retroactive:e.retroactive??!0,sequence:e.sequence.map(t=>"id"in t?{...t,scope:"record",filter:n=>n.typeName===e.recordType&&(t.filter?.(n)??!0)&&(e.filter?.(n)??!0)}:t)})}function tQ(e){let[t,n]=e.split("/");return{sequenceId:t,version:parseInt(n)}}function tJ(e,t){t&&ew(e.startsWith(t+"/"),`Every migration in sequence '${t}' must have an id starting with '${t}/'. Got invalid id: '${e}'`),ew(e.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${e}'`)}function t0(e){if(ew(!e.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${e.sequenceId}`),ew(e.sequenceId.length,"sequenceId must be a non-empty string"),0===e.sequence.length)return;tJ(e.sequence[0].id,e.sequenceId);let t=tQ(e.sequence[0].id).version;ew(1===t,`Expected the first migrationId to be '${e.sequenceId}/1' but got '${e.sequence[0].id}'`);for(let n=1;n<e.sequence.length;n++){let r=e.sequence[n].id;tJ(r,e.sequenceId);let i=tQ(r).version;ew(i===t+1,`Migration id numbers must increase in increments of 1, expected ${e.sequenceId}/${t+1} but got '${e.sequence[n].id}'`),t=i}}var t1=(e=>(e.IncompatibleSubtype="incompatible-subtype",e.UnknownType="unknown-type",e.TargetVersionTooNew="target-version-too-new",e.TargetVersionTooOld="target-version-too-old",e.MigrationError="migration-error",e.UnrecognizedSubtype="unrecognized-subtype",e))(t1||{});class t2{constructor(e,t){for(let n of(this.types=e,this.options=t,t.migrations??[]))ew(!this.migrations[n.sequenceId],`Duplicate migration sequenceId ${n.sequenceId}`),t0(n),this.migrations[n.sequenceId]=n;let n=Object.values(this.migrations).flatMap(e=>e.sequence);for(let e of(this.sortedMigrations=function(e){let t=new Map(e.map(e=>[e.id,e])),n=new Set,r=[];for(let e of t.values())!function e(i){ew(!n.has(i.id),`Circular dependency in migrations: ${i.id}`),n.add(i.id);let{version:o,sequenceId:s}=tQ(i.id),a=t.get(`${s}/${o-1}`);if(a&&e(a),i.dependsOn)for(let n of i.dependsOn){let r=t.get(n);r&&e(r)}t.delete(i.id),r.push(i)}(e);return r}(n),this.sortedMigrations))if(e.dependsOn?.length)for(let t of e.dependsOn)ew(n.find(e=>e.id===t),`Migration '${e.id}' depends on missing migration '${t}'`)}static create(e,t){return new t2(e,t??{})}migrations={};sortedMigrations;validateRecord(e,t,n,r){try{let e=eK(this.types,t.typeName);if(!e)throw Error(`Missing definition for record type ${t.typeName}`);return e.validate(t,r??void 0)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:r,error:i});throw i}}getMigrationsSince(e){let t=function(e){if(e.schemaVersion>2||e.schemaVersion<1)return ex.err("Bad schema version");if(2===e.schemaVersion)return ex.ok(e);let t={schemaVersion:2,sequences:{}};for(let[n,r]of Object.entries(e.recordVersions))if(t.sequences[`com.tldraw.${n}`]=r.version,"subTypeKey"in r)for(let[e,i]of Object.entries(r.subTypeVersions))t.sequences[`com.tldraw.${n}.${e}`]=i;return ex.ok(t)}(e);if(!t.ok)return t;let n=t.value,r=new Set(Object.keys(n.sequences).filter(e=>this.migrations[e]));for(let e in this.migrations)void 0===n.sequences[e]&&this.migrations[e].retroactive&&r.add(e);if(0===r.size)return ex.ok([]);let i=new Set;for(let e of r){let t=n.sequences[e];if("number"!=typeof t&&this.migrations[e].retroactive||0===t){for(let t of this.migrations[e].sequence)i.add(t.id);continue}let r=`${e}/${t}`,o=this.migrations[e].sequence.findIndex(e=>e.id===r);if(-1===o)return ex.err("Incompatible schema?");for(let t of this.migrations[e].sequence.slice(o+1))i.add(t.id)}return ex.ok(this.sortedMigrations.filter(({id:e})=>i.has(e)))}migratePersistedRecord(e,t,n="up"){let r=this.getMigrationsSince(t);if(!r.ok)return console.error("Error migrating record",r.error),{type:"error",reason:t1.MigrationError};let i=r.value;if(0===i.length)return{type:"success",value:e};if(i.some(e=>"store"===e.scope))return{type:"error",reason:"down"===n?t1.TargetVersionTooOld:t1.TargetVersionTooNew};if("down"===n){if(!i.every(e=>e.down))return{type:"error",reason:t1.TargetVersionTooOld};i=i.slice().reverse()}e=tS(e);try{for(let t of i){if("store"===t.scope)throw Error();if(!(!t.filter||t.filter(e)))continue;let r=t[n](e);r&&(e=tS(r))}}catch(e){return console.error("Error migrating record",e),{type:"error",reason:t1.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e,n=this.getMigrationsSince(e.schema);if(!n.ok)return console.error("Error migrating store",n.error),{type:"error",reason:t1.MigrationError};let r=n.value;if(0===r.length)return{type:"success",value:t};t=tS(t);try{for(let e of r)if("record"===e.scope)for(let[n,r]of Object.entries(t)){if(!(!e.filter||e.filter(r)))continue;let i=e.up(r);i&&(t[n]=tS(i))}else if("store"===e.scope){let n=e.up(t);n&&(t=tS(n))}else ev(e)}catch(e){return console.error("Error migrating store",e),{type:"error",reason:t1.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?tQ(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){let t=eK(this.types,e);return ew(t,"record type does not exists"),t}}class t3 extends Error{constructor(e,t=[]){let n=function(e){if(!e.length)return null;let t="";for(let n of e)"number"==typeof n?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return(t=t.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,"")).startsWith(".")?t.slice(1):t}(t),r=e.split("\n").map((e,t)=>0===t?e:`  ${e}`).join("\n");super(t?`At ${n}: ${r}`:r),this.rawMessage=e,this.path=t}name="ValidationError"}function t5(e,t){try{return t()}catch(t){if(t instanceof t3)throw new t3(t.rawMessage,[e,...t.path]);throw new t3(t.toString(),[e])}}function t4(e){if(null===e)return"null";if(Array.isArray(e))return"an array";let t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:ev(t)}}class t6{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){var e;return e=this,new t6(t=>null===t?null:e.validate(t),(t,n)=>null===n?null:e.validateUsingKnownGoodVersion&&null!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n))}optional(){return nw(this)}refine(e){return new t6(t=>e(this.validate(t)),(t,n)=>{let r=this.validateUsingKnownGoodVersion(t,n);return Object.is(t,r)?t:e(r)})}check(e,t){return"string"==typeof e?this.refine(n=>(t5(`(check ${e})`,()=>t(n)),n)):this.refine(t=>(e(t),t))}}class t8 extends t6{constructor(e){super(t=>{let n=nh.validate(t);for(let t=0;t<n.length;t++)t5(t,()=>e.validate(n[t]));return n},(t,n)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(n);let r=nh.validate(n),i=t.length!==r.length;for(let n=0;n<r.length;n++){let o=r[n];if(n>=t.length){i=!0,t5(n,()=>e.validate(o));continue}!Object.is(t[n],o)&&(Object.is(t5(n,()=>e.validateUsingKnownGoodVersion(t[n],o)),t[n])||(i=!0))}return i?n:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(0===e.length)throw new t3("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new t3("Expected an array with length greater than 1")})}}class t9 extends t6{constructor(e,t=!1){super(n=>{if("object"!=typeof n||null===n)throw new t3(`Expected object, got ${t4(n)}`);for(let[t,r]of Object.entries(e))t5(t,()=>{r.validate(eK(n,t))});if(!t){for(let t of Object.keys(n))if(!eH(e,t))throw new t3("Unexpected property",[t])}return n},(n,r)=>{if("object"!=typeof r||null===r)throw new t3(`Expected object, got ${t4(r)}`);let i=!1;for(let[t,o]of Object.entries(e)){let e=eK(n,t),s=eK(r,t);!Object.is(e,s)&&(Object.is(t5(t,()=>o.validateUsingKnownGoodVersion?o.validateUsingKnownGoodVersion(e,s):o.validate(s)),e)||(i=!0))}if(!t){for(let t of Object.keys(r))if(!eH(e,t))throw new t3("Unexpected property",[t])}for(let e of Object.keys(n))if(!eH(r,e)){i=!0;break}return i?r:n}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new t9(this.config,!0)}extend(e){return new t9({...this.config,...e})}}class t7 extends t6{constructor(e,t,n,r){super(t=>{this.expectObject(t);let{matchingSchema:n,variant:r}=this.getMatchingSchemaAndVariant(t);return void 0===n?this.unknownValueValidation(t,r):t5(`(${e} = ${r})`,()=>n.validate(t))},(t,n)=>{this.expectObject(n),this.expectObject(t);let{matchingSchema:r,variant:i}=this.getMatchingSchemaAndVariant(n);return void 0===r?this.unknownValueValidation(n,i):eK(t,e)!==eK(n,e)?t5(`(${e} = ${i})`,()=>r.validate(n)):t5(`(${e} = ${i})`,()=>r.validateUsingKnownGoodVersion?r.validateUsingKnownGoodVersion(t,n):r.validate(n))}),this.key=e,this.config=t,this.unknownValueValidation=n,this.useNumberKeys=r}expectObject(e){if("object"!=typeof e||null===e)throw new t3(`Expected an object, got ${t4(e)}`,[])}getMatchingSchemaAndVariant(e){let t=eK(e,this.key);if(this.useNumberKeys||"string"==typeof t){if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new t3(`Expected a number for key "${this.key}", got "${t}"`)}else throw new t3(`Expected a string for key "${this.key}", got ${t4(t)}`);return{matchingSchema:eH(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new t7(this.key,this.config,e,this.useNumberKeys)}}class ne extends t6{constructor(e,t){super(n=>{if("object"!=typeof n||null===n)throw new t3(`Expected object, got ${t4(n)}`);for(let[r,i]of Object.entries(n))t5(r,()=>{e.validate(r),t.validate(i)});return n},(n,r)=>{if("object"!=typeof r||null===r)throw new t3(`Expected object, got ${t4(r)}`);let i=!1;for(let[o,s]of Object.entries(r)){if(!eH(n,o)){i=!0,t5(o,()=>{e.validate(o),t.validate(s)});continue}let r=eK(n,o),a=s;!Object.is(r,a)&&(Object.is(t5(o,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(r,a):t.validate(a)),r)||(i=!0))}for(let e of Object.keys(n))if(!eH(r,e)){i=!0;break}return i?r:n}),this.keyValidator=e,this.valueValidator=t}}function nt(e){return new t6(t=>{if(typeof t!==e)throw new t3(`Expected ${e}, got ${t4(t)}`);return t})}new t6(e=>e);let nn=new t6(e=>e),nr=nt("string"),ni=nt("number").check(e=>{if(Number.isNaN(e))throw new t3("Expected a number, got NaN");if(!Number.isFinite(e))throw new t3(`Expected a finite number, got ${e}`)}),no=ni.check(e=>{if(e<0)throw new t3(`Expected a positive number, got ${e}`)}),ns=ni.check(e=>{if(e<=0)throw new t3(`Expected a non-zero positive number, got ${e}`)}),na=ni.check(e=>{if(!Number.isInteger(e))throw new t3(`Expected an integer, got ${e}`)}),nl=na.check(e=>{if(e<0)throw new t3(`Expected a positive integer, got ${e}`)}),nc=na.check(e=>{if(e<=0)throw new t3(`Expected a non-zero positive integer, got ${e}`)}),nd=nt("boolean");function nu(e){return new t6(t=>{if(t!==e)throw new t3(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}nt("bigint");let nh=new t6(e=>{if(!Array.isArray(e))throw new t3(`Expected an array, got ${t4(e)}`);return e});function np(e){return new t8(e)}function nf(e){return new t9(e)}function ng(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===tk)}new t6(e=>{if("object"!=typeof e||null===e)throw new t3(`Expected object, got ${t4(e)}`);return e});let nm=new t6(e=>{if(function e(t){return null===t||"number"==typeof t||"string"==typeof t||"boolean"==typeof t||(Array.isArray(t)?t.every(e):!!ng(t)&&Object.values(t).every(e))}(e))return e;throw new t3(`Expected json serializable value, got ${typeof e}`)},(e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){let n=e.length!==t.length;for(let r=0;r<t.length;r++){if(r>=e.length){n=!0,nm.validate(t[r]);continue}let i=e[r],o=t[r];!Object.is(i,o)&&(Object.is(nm.validateUsingKnownGoodVersion(i,o),i)||(n=!0))}return n?t:e}if(!(ng(e)&&ng(t)))return nm.validate(t);{let n=!1;for(let r of Object.keys(t)){if(!eH(e,r)){n=!0,nm.validate(t[r]);continue}let i=e[r],o=t[r];!Object.is(i,o)&&(Object.is(nm.validateUsingKnownGoodVersion(i,o),i)||(n=!0))}for(let r of Object.keys(e))if(!eH(t,r)){n=!0;break}return n?t:e}});function ny(e,t){return new ne(e,t)}function nb(e,t){return new t7(e,t,(n,r)=>{throw new t3(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])},!1)}function nx(e,t){return new t6(n=>t5(e,()=>t.validate(n)),(n,r)=>t5(e,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(n,r):t.validate(r)))}function nv(e){return new t6(t=>{if(!e.has(t)){let n=Array.from(e,e=>JSON.stringify(e)).join(" or ");throw new t3(`Expected ${n}, got ${t}`)}return t})}function nw(e){return new t6(t=>{if(void 0!==t)return e.validate(t)},(t,n)=>{if((void 0!==t||void 0!==n)&&void 0!==n)return e.validateUsingKnownGoodVersion&&void 0!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n)})}function nS(...e){return nv(new Set(e))}function nk(e){try{return new URL(e)}catch(t){if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch(e){}throw new t3(`Expected a valid url, got ${JSON.stringify(e)}`)}}let nC=new Set(["http:","https:","mailto:"]),nP=nr.check(e=>{if(""===e)return;let t=nk(e);if(!nC.has(t.protocol.toLowerCase()))throw new t3(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),n_=new Set(["http:","https:","data:","asset:"]),nI=nr.check(e=>{if(""===e)return;let t=nk(e);if(!n_.has(t.protocol.toLowerCase()))throw new t3(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)});nr.check(e=>{if(""!==e&&!nk(e).protocol.toLowerCase().match(/^https?:$/))throw new t3(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)});let nE=nr.refine(e=>{try{return e8(e),e}catch{throw new t3(`Expected an index key, got ${JSON.stringify(e)}`)}});function nj(e){return nr.refine(t=>{if(!t.startsWith(`${e}:`))throw Error(`${e} ID must start with "${e}:"`);return t})}let nT=nj("asset");function nM(e,t){return nf({id:nT,typeName:nu("asset"),type:nu(e),props:t,meta:nm})}let nA=nf({x:ni,y:ni,z:ni.optional()}),nO=nf({x:ni,y:ni,w:ni,h:ni}),nL=e=>{!s||s.length<e?(s=Buffer.allocUnsafe(128*e),(0,tM.randomFillSync)(s),a=0):a+e>s.length&&((0,tM.randomFillSync)(s),a=0),a+=e},nD=(e=21)=>{nL(e-=0);let t="";for(let n=a-e;n<a;n++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&s[n]];return t},nz=ni.check(e=>{if(e<0||e>1)throw new t3("Opacity must be between 0 and 1")}),nR=nr.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw Error('Parent ID must start with "page:" or "shape:"');return e}),nN=nj("shape"),nF=nj("binding");function n$(e){return`binding:${e??nD()}`}tX("com.tldraw.binding",{}),tZ({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});class nB{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){let{defaultValue:n,type:r=nn}=t;return new nB(e,n,r)}static defineEnum(e,t){let{defaultValue:n,values:r}=t;return new nU(e,n,r)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class nU extends nB{constructor(e,t,n){super(e,t,nS(...n)),this.values=n}}let nV=tX("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),nH=tZ({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:nV.AddIsLocked,up:e=>{e.isLocked=!1},down:e=>{delete e.isLocked}},{id:nV.HoistOpacity,up:e=>{e.opacity=Number(e.props.opacity??"1"),delete e.props.opacity},down:e=>{let t=e.opacity;delete e.opacity,e.props.opacity=t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}},{id:nV.AddMeta,up:e=>{e.meta={}}},{id:nV.AddWhite,up:e=>{},down:e=>{"white"===e.props.color&&(e.props.color="black")}}]});function nK(e){return!!e&&"shape"===e.typeName}function nW(e){return!!e&&e.startsWith("shape:")}function nG(e){return`shape:${e??nD()}`}function nq(e){let t=new Map;for(let[n,r]of Object.entries(e))if(r instanceof nB){if(t.has(r))throw Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);t.set(r,n)}return t}function nY(e,t){return eZ(t,(t,n)=>`com.tldraw.shape.${e}/${n}`)}function nX(e,t){let n=[];for(let[r,{migrations:i}]of Object.entries(t)){let t=`com.tldraw.${e}.${r}`;i?"sequenceId"in i?(ew(t===i.sequenceId,`sequenceId mismatch for ${r} ${tL} migrations. Expected '${t}', got '${i.sequenceId}'`),n.push(i)):"sequence"in i?n.push(tY({sequenceId:t,retroactive:!1,sequence:i.sequence.map(t=>"id"in t?nZ(e,r,t):t)})):n.push(tY({sequenceId:t,retroactive:!1,sequence:Object.keys(i.migrators).map(e=>Number(e)).sort((e,t)=>e-t).map(n=>({id:`${t}/${n}`,scope:"record",filter:t=>t.typeName===e&&t.type===r,up:e=>{let t=i.migrators[n].up(e);if(t)return t},down:e=>{let t=i.migrators[n].down(e);if(t)return t}}))})):n.push(tY({sequenceId:t,retroactive:!1,sequence:[]}))}return n}function nZ(e,t,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:n=>n.typeName===e&&n.type===t,up:e=>{let t=n.up(e.props);t&&(e.props=t)},down:"function"==typeof n.down?e=>{let t=n.down(e.props);t&&(e.props=t)}:void 0}}let nQ=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],nJ={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function n0(e){return e.isDarkMode?nJ.darkMode:nJ.lightMode}let n1=nB.defineEnum("tldraw:color",{defaultValue:"black",values:nQ}),n2=nB.defineEnum("tldraw:labelColor",{defaultValue:"black",values:nQ}),n3=nB.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),n5=nB.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),n4=nB.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),n6={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},n8=nB.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),n9=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],n7=nB.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:n9}),re=nB.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:n9}),rt={labelColor:n2,color:n1,fill:n5,dash:n3,size:n8,arrowheadStart:n7,arrowheadEnd:re,font:n4,start:nA,end:nA,bend:ni,text:nr,labelPosition:ni,scale:ns},rn=nY("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function rr(e){return nZ("shape","arrow",e)}let ri=tY({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[rr({id:rn.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"}),rr({id:rn.AddIsPrecise,up:({start:e,end:t})=>{"binding"===e.type&&(e.isPrecise=!(.5===e.normalizedAnchor.x&&.5===e.normalizedAnchor.y)),"binding"===t.type&&(t.isPrecise=!(.5===t.normalizedAnchor.x&&.5===t.normalizedAnchor.y))},down:({start:e,end:t})=>{"binding"===e.type&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise),"binding"===t.type&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise)}}),rr({id:rn.AddLabelPosition,up:e=>{e.labelPosition=.5},down:e=>{delete e.labelPosition}}),{id:rn.ExtractBindings,scope:"store",up:e=>{for(let t of Object.values(e).filter(e=>"shape"===e.typeName&&"arrow"===e.type)){let{start:n,end:r}=t.props;if("binding"===n.type){let r=n$(),i={typeName:"binding",id:r,type:"arrow",fromId:t.id,toId:n.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:n.normalizedAnchor,isExact:n.isExact,isPrecise:n.isPrecise}};e[r]=i,t.props.start={x:0,y:0}}else delete t.props.start.type;if("binding"===r.type){let n=n$(),i={typeName:"binding",id:n,type:"arrow",fromId:t.id,toId:r.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};e[n]=i,t.props.end={x:0,y:0}}else delete t.props.end.type}}},rr({id:rn.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}})]}),ro={terminal:nS("start","end"),normalizedAnchor:nA,isExact:nd,isPrecise:nd},rs={sequence:[{dependsOn:[rn.ExtractBindings]}]},ra=nx("camera",nf({typeName:nu("camera"),id:nj("camera"),x:ni,y:ni,z:ni,meta:nm})),rl=tZ({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:tX("com.tldraw.camera",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),rc=tD("camera",{validator:ra,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),rd=nv(new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"])),ru=nf({type:rd,rotation:ni}),rh=nv(new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"])),rp=new Set(["starting","paused","active","stopping"]),rf=nf({id:nr,points:np(nA),size:no,color:rh,opacity:ni,state:nv(rp),delay:ni,shrink:ni,taper:nd}),rg=nj("page"),rm=nx("page",nf({typeName:nu("page"),id:rg,name:nr,index:nE,meta:nm})),ry=tZ({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:tX("com.tldraw.page",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),rb=tD("page",{validator:rm,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function rx(e){return rb.isId(e)}let rv={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1},rw=e=>e?eX(e,e=>rv[e]):null;nj("instance");let rS=tX("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),rk=tZ({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:rS.AddTransparentExportBgs,up:e=>({...e,exportBackground:!0})},{id:rS.RemoveDialog,up:({dialog:e,...t})=>t},{id:rS.AddToolLockMode,up:e=>({...e,isToolLocked:!1})},{id:rS.RemoveExtraPropsForNextShape,up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([e])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(e)))})},{id:rS.AddLabelColor,up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}})},{id:rS.AddFollowingUserId,up:e=>({...e,followingUserId:null})},{id:rS.RemoveAlignJustify,up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}}},{id:rS.AddZoom,up:e=>({...e,zoomBrush:null})},{id:rS.AddVerticalAlign,up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}})},{id:rS.AddScribbleDelay,up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e}},{id:rS.RemoveUserId,up:({userId:e,...t})=>t},{id:rS.AddIsPenModeAndIsGridMode,up:e=>({...e,isPenMode:!1,isGridMode:!1})},{id:rS.HoistOpacity,up:({propsForNextShape:{opacity:e,...t},...n})=>({...n,opacityForNextShape:Number(e??"1"),propsForNextShape:t})},{id:rS.AddChat,up:e=>({...e,chatMessage:"",isChatting:!1})},{id:rS.AddHighlightedUserIds,up:e=>({...e,highlightedUserIds:[]})},{id:rS.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}})},{id:rS.AddMeta,up:e=>({...e,meta:{}})},{id:rS.RemoveCursorColor,up:e=>{let{color:t,...n}=e.cursor;return{...e,cursor:n}}},{id:rS.AddLonelyProperties,up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:rS.ReadOnlyReadonly,up:({isReadOnly:e,...t})=>({...t,isReadonly:e})},{id:rS.AddHoveringCanvas,up:e=>({...e,isHoveringCanvas:null})},{id:rS.AddScribbles,up:({scribble:e,...t})=>({...t,scribbles:[]})},{id:rS.AddInset,up:e=>({...e,insets:[!1,!1,!1,!1]}),down:({insets:e,...t})=>({...t})},{id:rS.AddDuplicateProps,up:e=>({...e,duplicateProps:null}),down:({duplicateProps:e,...t})=>({...t})},{id:rS.RemoveCanMoveCamera,up:({canMoveCamera:e,...t})=>({...t}),down:e=>({...e,canMoveCamera:!0})}]}),rC="instance:instance",rP=nx("instance_page_state",nf({typeName:nu("instance_page_state"),id:nj("instance_page_state"),pageId:rg,selectedShapeIds:np(nN),hintingShapeIds:np(nN),erasingShapeIds:np(nN),hoveredShapeId:nN.nullable(),editingShapeId:nN.nullable(),croppingShapeId:nN.nullable(),focusedGroupId:nN.nullable(),meta:nm})),r_=tX("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),rI=tZ({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:r_.AddCroppingId,up(e){e.croppingShapeId=null}},{id:r_.RemoveInstanceIdAndCameraId,up(e){delete e.instanceId,delete e.cameraId}},{id:r_.AddMeta,up:e=>{e.meta={}}},{id:r_.RenameProperties,up:e=>{},down:e=>{}},{id:r_.RenamePropertiesAgain,up:e=>{e.selectedShapeIds=e.selectedIds,delete e.selectedIds,e.hintingShapeIds=e.hintingIds,delete e.hintingIds,e.erasingShapeIds=e.erasingIds,delete e.erasingIds,e.hoveredShapeId=e.hoveredId,delete e.hoveredId,e.editingShapeId=e.editingId,delete e.editingId,e.croppingShapeId=e.croppingShapeId??e.croppingId??null,delete e.croppingId,e.focusedGroupId=e.focusLayerId,delete e.focusLayerId},down:e=>{e.selectedIds=e.selectedShapeIds,delete e.selectedShapeIds,e.hintingIds=e.hintingShapeIds,delete e.hintingShapeIds,e.erasingIds=e.erasingShapeIds,delete e.erasingShapeIds,e.hoveredId=e.hoveredShapeId,delete e.hoveredShapeId,e.editingId=e.editingShapeId,delete e.editingShapeId,e.croppingId=e.croppingShapeId,delete e.croppingShapeId,e.focusLayerId=e.focusedGroupId,delete e.focusedGroupId}}]}),rE=tD("instance_page_state",{validator:rP,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),rj=nx("pointer",nf({typeName:nu("pointer"),id:nj("pointer"),x:ni,y:ni,lastActivityTimestamp:ni,meta:nm})),rT=tZ({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:tX("com.tldraw.pointer",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),rM=tD("pointer",{validator:rj,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),rA=rM.createId("pointer"),rO=nx("instance_presence",nf({typeName:nu("instance_presence"),id:nj("instance_presence"),userId:nr,userName:nr,lastActivityTimestamp:ni,followingUserId:nr.nullable(),cursor:nf({x:ni,y:ni,type:rd,rotation:ni}),color:nr,camera:nf({x:ni,y:ni,z:ni}),screenBounds:nO,selectedShapeIds:np(nj("shape")),currentPageId:nj("page"),brush:nO.nullable(),scribbles:np(rf),chatMessage:nr,meta:nm})),rL=tX("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),rD=tZ({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:rL.AddScribbleDelay,up:e=>{null!==e.scribble&&(e.scribble.delay=0)}},{id:rL.RemoveInstanceId,up:e=>{delete e.instanceId}},{id:rL.AddChatMessage,up:e=>{e.chatMessage=""}},{id:rL.AddMeta,up:e=>{e.meta={}}},{id:rL.RenameSelectedShapeIds,up:e=>{}}]}),rz=tD("instance_presence",{validator:rO,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),rR=nx("document",nf({typeName:nu("document"),id:nu("document:document"),gridSize:ni,name:nr,meta:nm})),rN=tX("com.tldraw.document",{AddName:1,AddMeta:2}),rF=tZ({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:rN.AddName,up:e=>{e.name=""},down:e=>{delete e.name}},{id:rN.AddMeta,up:e=>{e.meta={}}}]}),r$=tD("document",{validator:rR,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),rB=r$.createId("document");function rU(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function rV(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}let rH=({error:e,phase:t,record:n,recordBefore:r})=>{throw eP(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:"initialize"===t},extras:{recordBefore:r?rV(tS(r)):void 0,recordAfter:rV(tS(n))}}),e};function rK(e){let t=e.query.ids("page"),n=()=>{if(!e.has(rB))return e.put([r$.create({id:rB,name:e.props.defaultName})]),n();if(!e.has(rA))return e.put([rM.create({id:rA})]),n();let r=t.get();if(0===r.size)return e.put([rb.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]),n();let i=e.get(rC);if(!i)return e.put([e.schema.types.instance.create({id:rC,currentPageId:[...r].map(t=>e.get(t)).sort(rU)[0].id,exportBackground:!0})]),n();if(!r.has(i.currentPageId))return e.put([{...i,currentPageId:[...r].map(t=>e.get(t)).sort(rU)[0].id}]),n();let o=new Set,s=new Set;for(let t of r){let n=rE.createId(t);e.has(n)||o.add(n);let r=rc.createId(t);e.has(r)||s.add(r)}o.size>0&&e.put([...o].map(e=>rE.create({id:e,pageId:rE.parseId(e)}))),s.size>0&&e.put([...s].map(e=>rc.create({id:e})))};return n}let rW=nM("bookmark",nf({title:nr,description:nr,image:nr,favicon:nr,src:nI.nullable()})),rG=tX("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),rq=tZ({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:e=>"bookmark"===e.type,sequence:[{id:rG.MakeUrlsValid,up:e=>{nI.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:rG.AddFavicon,up:e=>{nI.isValid(e.props.favicon)||(e.props.favicon="")},down:e=>{delete e.props.favicon}}]}),rY=nM("image",nf({w:ni,h:ni,name:nr,isAnimated:nd,mimeType:nr.nullable(),src:nI.nullable(),fileSize:ns.optional()})),rX=tX("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),rZ=tZ({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:e=>"image"===e.type,sequence:[{id:rX.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:rX.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:rX.MakeUrlsValid,up:e=>{nI.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:rX.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}},{id:rX.MakeFileSizeOptional,up:e=>{-1===e.props.fileSize&&(e.props.fileSize=void 0)},down:e=>{void 0===e.props.fileSize&&(e.props.fileSize=-1)}}]}),rQ=nM("video",nf({w:ni,h:ni,name:nr,isAnimated:nd,mimeType:nr.nullable(),src:nI.nullable(),fileSize:ni.optional()})),rJ=tX("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),r0=tZ({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:e=>"video"===e.type,sequence:[{id:rJ.AddIsAnimated,up:e=>{e.props.isAnimated=!1},down:e=>{delete e.props.isAnimated}},{id:rJ.RenameWidthHeight,up:e=>{e.props.w=e.props.width,e.props.h=e.props.height,delete e.props.width,delete e.props.height},down:e=>{e.props.width=e.props.w,e.props.height=e.props.h,delete e.props.w,delete e.props.h}},{id:rJ.MakeUrlsValid,up:e=>{nI.isValid(e.props.src)||(e.props.src="")},down:e=>{}},{id:rJ.AddFileSize,up:e=>{e.props.fileSize=-1},down:e=>{delete e.props.fileSize}},{id:rJ.MakeFileSizeOptional,up:e=>{-1===e.props.fileSize&&(e.props.fileSize=void 0)},down:e=>{void 0===e.props.fileSize&&(e.props.fileSize=-1)}}]}),r1=nx("asset",nb("type",{image:rY,video:rQ,bookmark:rW})),r2=tZ({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:tX("com.tldraw.asset",{AddMeta:1}).AddMeta,up:e=>{e.meta={}}}]}),r3=tD("asset",{validator:r1,scope:"document"}).withDefaultProperties(()=>({meta:{}})),r5={w:ns,h:ns,assetId:nT.nullable(),url:nP},r4=nY("bookmark",{NullAssetId:1,MakeUrlsValid:2}),r6={sequence:[{id:r4.NullAssetId,up:e=>{void 0===e.assetId&&(e.assetId=null)},down:"retired"},{id:r4.MakeUrlsValid,up:e=>{nP.isValid(e.url)||(e.url="")},down:e=>{}}]},r8=nf({type:nS("free","straight"),points:np(nA)}),r9={color:n1,fill:n5,dash:n3,size:n8,segments:np(r8),isComplete:nd,isClosed:nd,isPen:nd,scale:ns},r7=nY("draw",{AddInPen:1,AddScale:2}),ie={sequence:[{id:r7.AddInPen,up:e=>{let{points:t}=e.segments[0];if(0===t.length){e.isPen=!1;return}let n=!(0===t[0].z||.5===t[0].z);t[1]&&(n=n&&!(0===t[1].z||.5===t[1].z)),e.isPen=n},down:"retired"},{id:r7.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},it=/(^\/r\/[^/]+\/?$)/,ir=e=>{try{return new URL(e)}catch(e){return}},ii=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(it))return e},fromEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(it))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/^\/embed\/?$/)){let e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:e=>{if(e.includes("/maps/")){let t;let n=e.match(/@(.*),(.*),(.*)z/);if(n){let[,r,i,o]=n,s=new URL(e).host.replace("www.","");t=`https://${s}/maps/embed/v1/view?key=${process.env.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${o}`}else t="";return t}},fromEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&t.searchParams.has("center")&&t.searchParams.get("zoom")){let e=t.searchParams.get("zoom"),[n,r]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${n},${r},${e}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=ir(e),n=t&&t.pathname.match(/\/v\/(.+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:e=>{let t=ir(e),n=t&&t.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=ir(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:e=>{let t=ir(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/embed/${r}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/pen/${r}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:e=>{let t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/embed/${n}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/${n}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=ir(e);if(!t)return;let n=t.hostname.replace(/^www./,"");if("youtu.be"===n){let e=t.pathname.split("/").filter(Boolean)[0];return`https://www.youtube.com/embed/${e}`}if(("youtube.com"===n||"m.youtube.com"===n)&&t.pathname.match(/^\/watch/)){let e=t.searchParams.get("v");return`https://www.youtube.com/embed/${e}`}},fromEmbedUrl:e=>{let t=ir(e);if(t&&"youtube.com"===t.hostname.replace(/^www./,"")){let e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return`https://www.youtube.com/watch?v=${e[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:e=>{let t=ir(e),n=t?.searchParams.get("cid");if(t?.pathname.match(/\/calendar\/u\/0/)&&n){for(let e of(t.pathname="/calendar/embed",Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{let t=ir(e),n=t?.searchParams.get("src");if(t?.pathname.match(/\/calendar\/embed/)&&n){for(let e of(t.pathname="/calendar/u/0",Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:e=>{let t=ir(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/pub\/?$/)){for(let e of(t.pathname=t.pathname.replace(/\/pub$/,"/embed"),Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.href}},fromEmbedUrl:e=>{let t=ir(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/embed\/?$/)){for(let e of(t.pathname=t.pathname.replace(/\/embed$/,"/pub"),Array.from(t.searchParams.keys())))t.searchParams.delete(e);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=ir(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{let t=ir(e);if(t&&"player.vimeo.com"===t.hostname){let e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=ir(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{let t=ir(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{let t=ir(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){let e=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${e}?cell=*`}},fromEmbedUrl:e=>{let t=ir(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","")}#cell-*`:t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`:void 0}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:e=>{let t=ir(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&""===t.search&&""===t.hash)return`${e}?embed`},fromEmbedUrl:e=>{let t=ir(e);if(t&&"www.desmos.com"===t.hostname&&t.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&"?embed"===t.search&&""===t.hash)return e.replace("?embed","")}}],io={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},is={w:ns,h:ns,url:nr},ia=nY("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),il={sequence:[{id:ia.GenOriginalUrlInEmbed,up:e=>{try{let t;let n=e.url,r=new URL(n).host.replace("www.","");for(let e of ii)if(e.hostnames.includes(r))try{t=e.fromEmbedUrl(n)}catch(e){console.warn(e)}e.tmpOldUrl=e.url,e.url=t??""}catch(t){e.url="",e.tmpOldUrl=e.url}},down:"retired"},{id:ia.RemoveDoesResize,up:e=>{delete e.doesResize},down:"retired"},{id:ia.RemoveTmpOldUrl,up:e=>{delete e.tmpOldUrl},down:"retired"},{id:ia.RemovePermissionOverrides,up:e=>{delete e.overridePermissions},down:"retired"}]},ic={w:ns,h:ns,name:nr},id={sequence:[]},iu=nB.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),ih=nB.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),ip=nB.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),ig={geo:ip,labelColor:n2,color:n1,fill:n5,dash:n3,size:n8,font:n4,align:iu,verticalAlign:ih,url:nP,w:ns,h:ns,growY:no,text:nr,scale:ns},im=nY("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),iy={sequence:[{id:im.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:im.AddLabelColor,up:e=>{e.labelColor="black"},down:"retired"},{id:im.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:im.AddCheckBox,up:e=>{},down:"retired"},{id:im.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:im.MigrateLegacyAlign,up:e=>{let t;switch(e.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}e.align=t},down:"retired"},{id:im.AddCloud,up:e=>{},down:"retired"},{id:im.MakeUrlsValid,up:e=>{nP.isValid(e.url)||(e.url="")},down:e=>{}},{id:im.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},ib={},ix={sequence:[]},iv={color:n1,size:n8,segments:np(r8),isComplete:nd,isPen:nd,scale:ns},iw={sequence:[{id:nY("highlight",{AddScale:1}).AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},iS=nf({topLeft:nA,bottomRight:nA}),ik={w:ns,h:ns,playing:nd,url:nP,assetId:nT.nullable(),crop:iS.nullable(),flipX:nd,flipY:nd},iC=nY("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),iP={sequence:[{id:iC.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:iC.AddCropProp,up:e=>{e.crop=null},down:e=>{delete e.crop}},{id:iC.MakeUrlsValid,up:e=>{nP.isValid(e.url)||(e.url="")},down:e=>{}},{id:iC.AddFlipProps,up:e=>{e.flipX=!1,e.flipY=!1},down:e=>{delete e.flipX,delete e.flipY}}]},i_=nB.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),iI=nf({id:nr,index:nE,x:ni,y:ni}),iE={color:n1,dash:n3,size:n8,spline:i_,points:ny(nr,iI),scale:ns},ij=nY("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),iT={sequence:[{id:ij.AddSnapHandles,up:e=>{for(let t of Object.values(e.handles))t.canSnap=!0},down:"retired"},{id:ij.RemoveExtraHandleProps,up:e=>{e.handles=eY(Object.values(e.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:e=>{let t=Object.entries(e.handles).map(([e,t])=>({index:e,...t})).sort(ti);e.handles=Object.fromEntries(t.map((e,n)=>{let r=0===n?"start":n===t.length-1?"end":`handle:${e.index}`;return[r,{id:r,type:"vertex",canBind:!1,canSnap:!0,index:e.index,x:e.x,y:e.y}]}))}},{id:ij.HandlesToPoints,up:e=>{let t=Object.entries(e.handles).map(([e,{x:t,y:n}])=>({x:t,y:n,index:e})).sort(ti);e.points=t.map(({x:e,y:t})=>({x:e,y:t})),delete e.handles},down:e=>{let t=tr(e.points.length);e.handles=Object.fromEntries(e.points.map((e,n)=>[t[n],{x:e.x,y:e.y}])),delete e.points}},{id:ij.PointIndexIds,up:e=>{let t=tr(e.points.length);e.points=Object.fromEntries(e.points.map((e,n)=>{let r=t[n];return[r,{id:r,index:r,x:e.x,y:e.y}]}))},down:e=>{let t=Object.values(e.points).sort(ti);e.points=t.map(({x:e,y:t})=>({x:e,y:t}))}},{id:ij.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},iM={color:n1,size:n8,font:n4,fontSizeAdjustment:no,align:iu,verticalAlign:ih,growY:no,url:nP,text:nr,scale:ns},iA=nY("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),iO={sequence:[{id:iA.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:iA.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:iA.MigrateLegacyAlign,up:e=>{switch(e.align){case"start":e.align="start-legacy";return;case"end":e.align="end-legacy";return;default:e.align="middle-legacy";return}},down:"retired"},{id:iA.AddVerticalAlign,up:e=>{e.verticalAlign="middle"},down:"retired"},{id:iA.MakeUrlsValid,up:e=>{nP.isValid(e.url)||(e.url="")},down:e=>{}},{id:iA.AddFontSizeAdjustment,up:e=>{e.fontSizeAdjustment=0},down:e=>{delete e.fontSizeAdjustment}},{id:iA.AddScale,up:e=>{e.scale=1},down:e=>{delete e.scale}}]},iL=nB.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),iD={color:n1,size:n8,font:n4,textAlign:iL,w:ns,text:nr,scale:ns,autoSize:nd},iz=nY("text",{RemoveJustify:1,AddTextAlign:2}),iR={sequence:[{id:iz.RemoveJustify,up:e=>{"justify"===e.align&&(e.align="start")},down:"retired"},{id:iz.AddTextAlign,up:e=>{e.textAlign=e.align,delete e.align},down:e=>{e.align=e.textAlign,delete e.textAlign}}]},iN={w:ns,h:ns,time:ni,playing:nd,url:nP,assetId:nT.nullable()},iF=nY("video",{AddUrlProp:1,MakeUrlsValid:2}),i$={sequence:[{id:iF.AddUrlProp,up:e=>{e.url=""},down:"retired"},{id:iF.MakeUrlsValid,up:e=>{nP.isValid(e.url)||(e.url="")},down:e=>{}}]},iB=tX("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),iU=tY({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:iB.RemoveCodeAndIconShapeTypes,scope:"store",up:e=>{for(let[t,n]of eq(e))"shape"===n.typeName&&("icon"===n.type||"code"===n.type)&&delete e[t]}},{id:iB.AddInstancePresenceType,scope:"store",up(e){}},{id:iB.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:e=>{for(let[t,n]of eq(e))n.typeName.match(/^(user|user_presence)$/)&&delete e[t]}},{id:iB.RemoveUserDocument,scope:"store",up:e=>{for(let[t,n]of eq(e))n.typeName.match("user_document")&&delete e[t]}}]}),iV={arrow:{migrations:ri,props:rt},bookmark:{migrations:r6,props:r5},draw:{migrations:ie,props:r9},embed:{migrations:il,props:is},frame:{migrations:id,props:ic},geo:{migrations:iy,props:ig},group:{migrations:ix,props:ib},highlight:{migrations:iw,props:iv},image:{migrations:iP,props:ik},line:{migrations:iT,props:iE},note:{migrations:iO,props:iM},text:{migrations:iR,props:iD},video:{migrations:i$,props:iN}},iH={arrow:{migrations:rs,props:ro}},iK=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Catal\xe0"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xf1ol"},{locale:"fr",label:"Fran\xe7ais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xeas - Brasil"},{locale:"pt-pt",label:"Portugu\xeas - Europeu"},{locale:"ro",label:"Rom\xe2n"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"T\xfcrk\xe7e"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}],iW={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function iG(e,t){let n=y.useRef(t);n.current=t;let[r,i,o]=y.useMemo(()=>{let t=null,r=new $(`useStateTracking(${e})`,()=>n.current?.(),{scheduleEffect(){t?.()}});return[r,e=>(t=e,()=>{t=null}),()=>r.scheduleCount]},[e]);return y.useSyncExternalStore(i,o,o),y.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}let iq={apply:(e,t,n)=>iG(e.displayName??e.name??"tracked(???)",()=>e.apply(t,n))},iY=Symbol.for("react.memo"),iX=Symbol.for("react.forward_ref");function iZ(e){let t=null,n=e.$$typeof;return(n===iY&&(t=(e=e.type).compare),n===iX)?(0,y.memo)((0,y.forwardRef)(new Proxy(e.render,iq))):(0,y.memo)(new Proxy(e,iq),t)}function iQ(e,t,n=j){(0,y.useEffect)(()=>{let n=new $(e,t);return n.attach(),n.execute(),()=>{n.detach()}},n)}function iJ(){let e=arguments,t=3===e.length?e[2]:[e[0]],n=3===e.length?e[0]:`useValue(${e[0].name})`,r=(0,y.useRef)(!0);r.current=!0;let i=(0,y.useMemo)(()=>1===e.length?e[0]:es(n,()=>{if(r.current)return e[1]();try{return e[1]()}catch{return{}}}),t);try{let{subscribe:e,getSnapshot:t}=(0,y.useMemo)(()=>({subscribe:e=>B(`useValue(${n})`,()=>{i.get(),e()}),getSnapshot:()=>i.get()}),[i]);return(0,y.useSyncExternalStore)(e,t,t)}finally{r.current=!1}}var i0=n(56073);let i1="2.4.6",i2={major:"2024-06-28T10:56:07.893Z",minor:"2024-07-22T16:42:50.301Z"},i3={error:null};class i5 extends y.Component{static getDerivedStateFromError(e){return{error:e}}state=i3;componentDidCatch(e){this.props.onError?.(e)}render(){let{error:e}=this.state;if(null!==e){let{fallback:t}=this.props;return(0,m.jsx)(t,{error:e})}return this.props.children}}function i4({children:e,fallback:t,...n}){return null===t?e:(0,m.jsx)(i5,{fallback:t,...n,children:e})}let i6=(0,y.createContext)(null);function i8(){let e=y.useContext(i6);if(!e)throw Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return e}function i9(){return(0,m.jsx)("div",{className:"tl-background"})}function i7(e,t,n,r,i,o){(0,y.useLayoutEffect)(()=>{let s=e.current;if(!s||void 0===t)return;let a=`translate(${t}px, ${n}px)`;void 0!==r&&(a+=` scale(${r})`),void 0!==i&&(a+=` rotate(${i}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),s.style.transform=a})}let oe={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeOutQuint:e=>1+--e*e*e*e*e,easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10)};class ot{constructor(e=0,t=0,n=1){this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(e=this.x,t=this.y,n=this.z){return this.x=e,this.y=t,this.z=n,this}setTo({x:e=0,y:t=0,z:n=1}){return this.x=e,this.y=t,this.z=n,this}rot(e){if(0===e)return this;let{x:t,y:n}=this,r=Math.sin(e),i=Math.cos(e);return this.x=t*i-n*r,this.y=t*r+n*i,this}rotWith(e,t){if(0===t)return this;let n=this.x-e.x,r=this.y-e.y,i=Math.sin(t),o=Math.cos(t);return this.x=e.x+(n*o-r*i),this.y=e.y+(n*i+r*o),this}clone(){let{x:e,y:t,z:n}=this;return new ot(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){let n=ot.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return ot.Dpr(this,e)}cpr(e){return ot.Cpr(this,e)}len2(){return ot.Len2(this)}len(){return ot.Len(this)}pry(e){return ot.Pry(this,e)}per(){let{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return ot.Uni(this)}tan(e){return ot.Tan(this,e)}dist(e){return ot.Dist(this,e)}distanceToLineSegment(e,t){return ot.DistanceToLineSegment(e,t,this)}slope(e){return ot.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return ot.Angle(this,e)}toAngle(){return ot.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return ot.Equals(this,e)}equalsXY(e,t){return ot.EqualsXY(this,e,t)}norm(){let e=this.len();return this.x=0===e?0:this.x/e,this.y=0===e?0:this.y/e,this}toFixed(){return ot.ToFixed(this)}toString(){return ot.ToString(ot.ToFixed(this))}toJson(){return ot.ToJson(this)}toArray(){return ot.ToArray(this)}static Add(e,t){return new ot(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new ot(e.x+t,e.y+n)}static Sub(e,t){return new ot(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new ot(e.x-t,e.y-n)}static AddScalar(e,t){return new ot(e.x+t,e.y+t)}static SubScalar(e,t){return new ot(e.x-t,e.y-t)}static Div(e,t){return new ot(e.x/t,e.y/t)}static Mul(e,t){return new ot(e.x*t,e.y*t)}static DivV(e,t){return new ot(e.x/t.x,e.y/t.y)}static MulV(e,t){return new ot(e.x*t.x,e.y*t.y)}static Neg(e){return new ot(-e.x,-e.y)}static Per(e){return new ot(e.y,-e.x)}static Abs(e){return new ot(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,n){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<n**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new ot(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return ot.Dpr(e,t)/ot.Len(t)}static Uni(e){return ot.Div(e,ot.Len(e))}static Tan(e,t){return ot.Uni(ot.Sub(e,t))}static Min(e,t){return new ot(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new ot(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:n=1}){return new ot(e,t,n)}static FromArray(e){return new ot(e[0],e[1])}static Rot(e,t=0){let n=Math.sin(t),r=Math.cos(t);return new ot(e.x*r-e.y*n,e.x*n+e.y*r)}static RotWith(e,t,n){let r=e.x-t.x,i=e.y-t.y,o=Math.sin(n),s=Math.cos(n);return new ot(t.x+(r*s-i*o),t.y+(r*o+i*s))}static NearestPointOnLineThroughPoint(e,t,n){return ot.Mul(t,ot.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n,r=!0){if(ot.Equals(e,n)||ot.Equals(t,n))return ot.From(n);let i=ot.Tan(t,e),o=ot.Add(e,ot.Mul(i,ot.Sub(n,e).pry(i)));if(r){if(o.x<Math.min(e.x,t.x))return ot.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return ot.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return ot.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return ot.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,n){return ot.Dist(n,ot.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n,r=!0){return ot.Dist(n,ot.NearestPointOnLineSegment(e,t,n,r))}static Snap(e,t=1){return new ot(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof ot?e:ot.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,n){return ot.Sub(t,e).mul(n).add(e)}static Med(e,t){return new ot((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return 1e-4>Math.abs(e.x-t.x)&&1e-4>Math.abs(e.y-t.y)}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){let n=ot.Len(e);return new ot(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return ot.Sub(e,n).mul(t).add(n)}static ToFixed(e){return new ot(oP(e.x),oP(e.y))}static ToInt(e){return new ot(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,n){return ot.Add(e,ot.Tan(t,e).mul(n))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e,t=1){return new ot(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){let{x:t,y:n,z:r}=e;return{x:t,y:n,z:r}}static Average(e){let t=e.length,n=new ot(0,0);if(0===t)return n;for(let r=0;r<t;r++)n.add(e[r]);return n.div(t)}static Clamp(e,t,n){return void 0===n?new ot(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new ot(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t,n=6){let r=[];for(let i=0;i<n;i++){let o=oe.easeInQuad(i/(n-1)),s=ot.Lrp(e,t,o);s.z=Math.min(1,.5+.65*Math.abs(.5-on(o))),r.push(s)}return r}static SnapToGrid(e,t=8){return new ot(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}let on=e=>e<.5?2*e*e:-1+(4-2*e)*e;function or(e){return`${oC(e.x)},${oC(e.y)} `}function oi(e,t){return`${oC((e.x+t.x)/2)},${oC((e.y+t.y)/2)} `}let oo=Math.PI,os=oo/2,oa=2*oo,ol=Math.sin;function oc(e,t,n){return Math.max(t,void 0!==n?Math.min(e,n):e)}function od(e,t=1e10){return e?Math.round(e*t)/t:0}function ou(e,t,n=1e-6){return Math.abs(e-t)<=n}function oh(e,t){let n=Math.pow(e-t,2)/Math.pow(e+t,2);return oo*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function op(e){return(e%=oa)<0?e+=oa:0===e&&(e=0),e}function of(e,t){return(e=op(e))>(t=op(t))&&(t+=oa),t-e}function og(e,t){return oa-of(e,t)}function om(e,t){let n=(t-e)%oa;return 2*n%oa-n}function oy(e,t){let n=oa/t,r=Math.floor(((oa+e)%oa+n/2)/n)*n%oa;return r<oo&&(r+=oa),r>oo&&(r-=oa),r}function ob(e,t){return e===t||ou(e%(Math.PI/2)-t%(Math.PI/2),0)}function ox(e,t,n){return new ot(e.x,e.y).add(ot.FromAngle(n,t))}function ov(e,t,n){let r=e/2,i=t/2,o=[],s=1/0,a=-1/0,l=1/0,c=-1/0;for(let e=0;e<n;e++){let t=-os+oa/n*e,d=r+r*Math.cos(t),u=i+i*Math.sin(t);d<s&&(s=d),u<l&&(l=u),d>a&&(a=d),u>c&&(c=u),o.push(new ot(d,u))}let d=a-s,u=c-l;if(0!=e-d||0!=t-u)for(let n=0;n<o.length;n++){let r=o[n];r.x=(r.x-s)/d*e,r.y=(r.y-l)/u*t}return o}function ow(e,t,n,r){let i=Math.max(e,n),o=Math.min(t,r);return i<=o?[i,o]:null}function oS(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function ok(e,t){let n,r,i=0;for(let o=0;o<t.length;o++){if((n=t[o]).x===e.x&&n.y===e.y||(r=t[(o+1)%t.length],ot.Dist(e,n)+ot.Dist(e,r)===ot.Dist(n,r)))return!0;n.y<=e.y?r.y>e.y&&oS(n,r,e)>0&&(i+=1):r.y<=e.y&&0>oS(n,r,e)&&(i-=1)}return 0!==i}function oC(e){return Math.round(1e4*e)/1e4}function oP(e){return Math.round(100*e)/100}let o_=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER;function oI(e,t,n){return n<0?of(e,t):og(e,t)}function oE(e,t,n,r){let i;if(Math.abs(e)>oo){i=om(t,r);let o=om(r,n);return Math.abs(i)<Math.abs(o)?i/e:(e-o)/e}{let n=(i=om(t,r))/e;return Math.sign(i)!==Math.sign(e)?Math.abs(n)>.5?1:0:n}}function oj(e,t,n){let r=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y);return new ot(((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/r,((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/r)}let oT=({brush:e,color:t,opacity:n,className:r})=>{let i=(0,y.useRef)(null);i7(i,e.x,e.y);let o=oC(Math.max(1,e.w)),s=oC(Math.max(1,e.h));return(0,m.jsx)("svg",{className:"tl-overlays__item",ref:i,children:t?(0,m.jsxs)("g",{className:"tl-brush",opacity:n,children:[(0,m.jsx)("rect",{width:o,height:s,fill:t,opacity:.75}),(0,m.jsx)("rect",{width:o,height:s,fill:"none",stroke:t,opacity:.1})]}):(0,m.jsx)("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:s})})},oM={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},oA={duration:0,easing:oe.easeInOutCubic},oO={CAMERA_MOVE:-10},oL=["top","right","bottom","left"];function oD(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return oD(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function oz(e){e.preventDefault(),t_.logPreventDefaults.get()&&console.warn("preventDefault called on event:",e)}function oR(e,t){if(e.setPointerCapture(t.pointerId),t_.logPointerCaptures.get()){let n=tP.get();n.set(e,(n.get(e)??0)+1),console.warn("setPointerCapture called on element:",e,t)}}function oN(e,t){if(e.hasPointerCapture(t.pointerId)&&(e.releasePointerCapture(t.pointerId),t_.logPointerCaptures.get())){let n=tP.get();1===n.get(e)?n.delete(e):n.has(e)?n.set(e,n.get(e)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",e,t)}}let oF=e=>e.stopPropagation(),o$=(e,t,n)=>{e&&e.style.setProperty(t,n)};function oB(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}function oU(){let e=i8();return(0,y.useMemo)(function(){let t,n;return{onPointerDown:function(t){if(!t.isKilled){if(2===t.button){e.dispatch({type:"pointer",target:"canvas",name:"right_click",...oB(t)});return}(0===t.button||1===t.button||5===t.button)&&(oR(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...oB(t)}))}},onPointerMove:function(r){r.isKilled||r.clientX===t&&r.clientY===n||(t=r.clientX,n=r.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...oB(r)}))},onPointerUp:function(r){r.isKilled||0!==r.button&&1!==r.button&&2!==r.button&&5!==r.button||(t=r.clientX,n=r.clientY,oN(r.currentTarget,r),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...oB(r)}))},onPointerEnter:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!!n||null})},onPointerLeave:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!n&&null})},onDragOver:function(e){oz(e)},onDrop:async function(t){if(oz(t),!t.dataTransfer?.files?.length)return;let n=Array.from(t.dataTransfer.files);await e.putExternalContent({type:"files",files:n,point:e.screenToPage({x:t.clientX,y:t.clientY}),ignoreParent:!1})},onTouchStart:function(e){e.isKilled=!0,oz(e)},onTouchEnd:function(t){t.isKilled=!0,t.target instanceof HTMLElement&&"A"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&!(e.getEditingShape()&&t.target.className.includes("tl-text-content"))&&oz(t)},onClick:function(e){oF(e)}}},[e])}let oV=(0,y.createContext)(null);function oH({container:e,children:t}){return(0,m.jsx)(oV.Provider,{value:e,children:t})}function oK(){return eS((0,y.useContext)(oV),"useContainer used outside of <Tldraw />")}let oW=["input","select","button","textarea"];function oG(){let{activeElement:e}=document;return!!(e&&(e.getAttribute("contenteditable")||oW.indexOf(e.tagName.toLowerCase())>-1))}let oq=["textarea","input"],oY={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function oX(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function oZ(e,t,n,r=.15){return 0===r?Math.max(t,Math.min(e,n)):e<t?-oX(t-e,n-t,r)+t:e>n?+oX(e-n,n-t,r)+n:e}function oQ(e,t,n){var r;return(t="symbol"==typeof(r=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oJ(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o0(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oJ(Object(n),!0).forEach(function(t){oQ(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oJ(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let o1={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function o2(e){return e?e[0].toUpperCase()+e.slice(1):""}let o3=["enter","leave"],o5=["gotpointercapture","lostpointercapture"];function o4(e){return"touches"in e}function o6(e,t){try{let n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2,s=Math.hypot(n,r);return{angle:-(180*Math.atan2(n,r))/Math.PI,distance:s,origin:[i,o]}}catch(e){}return null}function o8(e,t){let[n,r]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return o6(n,r)}function o9(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function o7(e,...t){return"function"==typeof e?e(...t):e}function se(){}function st(e,t){return Object.assign({},t,e||{})}class sn{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?o7(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);oY.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[o,s]=t._movement,[a,l]=n.threshold,{_step:c,values:d}=t;if(n.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(o)>=a&&d[0]),!1===c[1]&&(c[1]=Math.abs(s)>=l&&d[1])):(!1===c[0]&&(c[0]=Math.abs(o)>=a&&Math.sign(o)*a),!1===c[1]&&(c[1]=Math.abs(s)>=l&&Math.sign(s)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;let u=[0,0];if(n.hasCustomTransform){let[e,t]=d;u[0]=!1!==c[0]?e-c[0]:0,u[1]=!1!==c[1]?t-c[1]:0}else u[0]=!1!==c[0]?o-c[0]:0,u[1]=!1!==c[1]?s-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(u);let h=t.offset,p=t._active&&!t._blocked||t.active;p&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=o7(n.bounds,t)),this.setup&&this.setup()),t.movement=u,this.computeOffset()));let[f,g]=t.offset,[[m,y],[b,x]]=t._bounds;t.overflow=[f<m?-1:f>y?1:0,g<b?-1:g>x?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let v=t._active&&n.rubberband||[0,0];if(t.offset=function(e,[t,n],[r,i]){let[[o,s],[a,l]]=e;return[oZ(t,o,s,r),oZ(n,a,l,i)]}(t._bounds,t.offset,v),t.delta=oY.sub(t.offset,h),this.computeMovement(),p&&(!t.last||i>32)){t.delta=oY.sub(t.offset,h);let e=t.delta.map(Math.abs);oY.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){let e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;let r=this.handler(o0(o0(o0({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class sr extends sn{constructor(...e){super(...e),oQ(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=oY.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=oY.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,n=this.config;if(!t.axis&&e){let r="object"==typeof n.axisThreshold?n.axisThreshold[o4(e)?"touch":"pointerType"in e?e.pointerType:"mouse"]:n.axisThreshold;t.axis=function([e,t],n){let r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}let si=e=>e,so={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>o0(o0({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return oY.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?oY.toVector(e):void 0,transform(e,t,n){let r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||si},threshold:e=>oY.toVector(e,0)},ss=0,sa=o0(o0({},so),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=ss)=>e,bounds(e={}){if("function"==typeof e)return t=>sa.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),sl="undefined"!=typeof window&&window.document&&window.document.createElement;function sc(){return sl&&"ontouchstart"in window}let sd={isBrowser:sl,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:sc(),touchscreen:sc()||sl&&window.navigator.maxTouchPoints>1,pointer:sl&&"onpointerdown"in window,pointerLock:sl&&"exitPointerLock"in window.document},su=10,sh={mouse:0,touch:0,pen:8};function sp(e){let[t,n]=e.overflow,[r,i]=e._delta,[o,s]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&s<0||n>0&&i<0&&s>0)&&(e._movement[1]=e._movementBound[1])}o0(o0({},sa),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return(this.pointerLock=r&&sd.pointerLock,sd.touch&&n)?"touch":this.pointerLock?"mouse":sd.pointer&&!i?"pointer":sd.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,sd.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){let o=oY.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(oY.toVector(e)),distance:this.transform(oY.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?o0(o0({},sh),e):sh,keyboardDisplacement:(e=su)=>e});class sf extends sn{constructor(...e){super(...e),oQ(this,"ingKey","pinching"),oQ(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:n}=this.state;"wheel"===e?this.state.offset=oY.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,n]=e._movement;if(!e.axis){let r=30*Math.abs(t)-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>n.has(e))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);let r=o8(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(e=>r.has(e))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let i=o6(...Array.from(n.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=o8(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let n=o6(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){let n=this.state,r=n._values[1],i=t.angle-r,o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=oY.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||!e.cancelable||e.preventDefault();let t=this.state;t._delta=[-o9(e)[1]/100*t.offset[0],0],oY.addTo(t._movement,t._delta),sp(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}let sg=o0(o0({},so),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!sd.touch&&sd.gesture)return"gesture";if(sd.touch&&r)return"touch";if(sd.touchscreen){if(sd.pointer)return"pointer";if(sd.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){let i=e=>{let t=st(o7(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},o=e=>{let t=st(o7(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof r?[i(),o()]:e=>[i(e),o(e)]},threshold(e,t,n){return this.lockDirection="lock"===n.axis,oY.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});o0(o0({},sa),{},{mouseOnly:(e=!0)=>e});class sm extends sr{constructor(...e){super(...e),oQ(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=o9(e),oY.addTo(t._movement,t._delta),sp(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}o0(o0({},sa),{},{mouseOnly:(e=!0)=>e});let sy=new Map,sb=new Map,sx={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=sd.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},sv=["target","eventOptions","window","enabled","transform"];function sw(e={},t){let n={};for(let[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=sw(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}class sS{constructor(e,t){oQ(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){let o=this._listeners,s=function(e,t=""){let n=o1[e];return e+(n&&n[t]||t)}(t,n),a=o0(o0({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),i);e.addEventListener(s,r,a);let l=()=>{e.removeEventListener(s,r,a),o.delete(l)};return o.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class sk{constructor(){oQ(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class sC{constructor(e){oQ(this,"gestures",new Set),oQ(this,"_targetEventStore",new sS(this)),oQ(this,"gestureEventStores",{}),oQ(this,"gestureTimeoutStores",{}),oQ(this,"handlers",{}),oQ(this,"config",{}),oQ(this,"pointerIds",new Set),oQ(this,"touchIds",new Set),oQ(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&sP(e,"drag"),t.wheel&&sP(e,"wheel"),t.scroll&&sP(e,"scroll"),t.move&&sP(e,"move"),t.pinch&&sP(e,"pinch"),t.hover&&sP(e,"hover")}(this,e)}setEventIds(e){return o4(e)?(this.touchIds=new Set(Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))}).map(e=>e.identifier)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,n={}){let{target:r,eventOptions:i,window:o,enabled:s,transform:a}=e,l=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,sv);if(n.shared=sw({target:r,eventOptions:i,window:o,enabled:s,transform:a},sx),t){let e=sb.get(t);n[t]=sw(o0({shared:n.shared},l),e)}else for(let e in l){let t=sb.get(e);t&&(n[e]=sw(o0({shared:n.shared},l[e]),t))}return n}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let n=this.config.shared,r={};if(!n.target||(t=n.target())){if(n.enabled){for(let n of this.gestures){let i=this.config[n],o=s_(r,i.eventOptions,!!t);i.enabled&&new(sy.get(n))(this,e,n).bind(o)}let i=s_(r,n.eventOptions,!!t);for(let t in this.nativeHandlers)i(t,"",n=>this.nativeHandlers[t](o0(o0({},this.state.shared),{},{event:n,args:e})),void 0,!0)}for(let e in r)r[e]=function(...e){return 0===e.length?se:1===e.length?e[0]:function(){let t;for(let n of e)t=n.apply(this,arguments)||t;return t}}(...r[e]);if(!t)return r;for(let e in r){let{device:n,capture:i,passive:o}=function(e){let t=e.substring(2).toLowerCase(),n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));let r=o5.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}(e);this._targetEventStore.add(t,n,"",r[e],{capture:i,passive:o})}}}}function sP(e,t){e.gestures.add(t),e.gestureEventStores[t]=new sS(e,t),e.gestureTimeoutStores[t]=new sk}let s_=(e,t,n)=>(r,i,o,s={},a=!1)=>{var l,c;let d=null!==(l=s.capture)&&void 0!==l?l:t.capture,u=null!==(c=s.passive)&&void 0!==c?c:t.passive,h=a?r:function(e,t="",n=!1){let r=o1[e],i=r&&r[t]||t;return"on"+o2(e)+o2(i)+(!function(e=!1,t){return e&&!o3.includes(t)}(n,i)?"":"Capture")}(r,i,d);n&&u&&(h+="Passive"),e[h]=e[h]||[],e[h].push(o)},sI=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function sE(e,t,n,r,i,o){if(!e.has(n)||!sy.has(r))return;let s=n+"Start",a=n+"End";i[r]=e=>{let r;return e.first&&s in t&&t[s](e),n in t&&(r=t[n](e)),e.last&&a in t&&t[a](e),r},o[r]=o[r]||{}}let sj=/Mac|iPod|iPhone|iPad/.test("undefined"==typeof window?"node":window.navigator.platform);function sT(e){let{deltaY:t,deltaX:n}=e,r=0;return e.ctrlKey||e.altKey||e.metaKey?r=(Math.abs(t)>10?10*Math.sign(t):t)/100:e.shiftKey&&!sj&&(n=t,t=0),{x:-n,y:-t,z:-r}}let sM=([{key:"wheel",engine:sm,resolver:sa},{key:"pinch",engine:sf,resolver:sg}].forEach(function(e){sy.set(e.key,e.engine),sb.set(e.key,e.resolver)}),function(e,t){let{handlers:n,nativeHandlers:r,config:i}=function(e,t){let[n,r,i]=function(e){let t={},n={},r=new Set;for(let i in e)sI.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}(e),o={};return sE(i,n,"onDrag","drag",o,t),sE(i,n,"onWheel","wheel",o,t),sE(i,n,"onScroll","scroll",o,t),sE(i,n,"onPinch","pinch",o,t),sE(i,n,"onMove","move",o,t),sE(i,n,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}(e,t||{});return function(e,t={},n,r){let i=x().useMemo(()=>new sC(e),[]);if(i.applyHandlers(e,r),i.applyConfig(t,n),x().useEffect(i.effect.bind(i)),x().useEffect(()=>i.clean.bind(i),[]),void 0===t.target)return i.bind.bind(i)}(n,i,void 0,r)}),sA=e=>void 0===h?(h=e,!1):e-h>120&&e-h<160?(h=e,!0):(h=e,!1);function sO(e,t,n){let r=e.getShape(t),i=e.getShapeHandles(r);return{shape:r,handle:i.find(e=>e.id===n)}}class sL{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.w=n,this.h=r}x=0;y=0;w=0;h=0;get point(){return new ot(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new ot(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new ot(this.minX,this.minY),new ot(this.maxX,this.minY),new ot(this.maxX,this.maxY),new ot(this.minX,this.maxY)]}get cornersAndCenter(){return[new ot(this.minX,this.minY),new ot(this.maxX,this.minY),new ot(this.maxX,this.maxY),new ot(this.minX,this.maxY),this.center]}get sides(){let{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new ot(this.w,this.h)}toFixed(){return this.x=od(this.x),this.y=od(this.y),this.w=od(this.w),this.h=od(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,n=0,r=0){return this.x=e,this.y=t,this.w=n,this.h=r,this}expand(e){let t=Math.min(this.minX,e.minX),n=Math.min(this.minY,e.minY),r=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=t,this.y=n,this.w=r-t,this.h=i-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){let{x:e,y:t,w:n,h:r}=this;return new sL(e,t,n,r)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){let t=Math.round(this.minX/e)*e,n=Math.round(this.minY/e)*e,r=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,r-t),this.height=Math.max(1,i-n)}collides(e){return sL.Collides(this,e)}contains(e){return sL.Contains(this,e)}includes(e){return sL.Includes(this,e)}containsPoint(e,t=0){return sL.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new ot(this.minX,this.minY);case"top_right":return new ot(this.maxX,this.minY);case"bottom_left":return new ot(this.minX,this.maxY);case"bottom_right":return new ot(this.maxX,this.maxY);case"top":return new ot(this.midX,this.minY);case"right":return new ot(this.maxX,this.midY);case"bottom":return new ot(this.midX,this.maxY);case"left":return new ot(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,n){let{minX:r,minY:i,maxX:o,maxY:s}=this,{minX:a,minY:l,maxX:c,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":a+=t;break;case"right":case"top_right":case"bottom_right":c+=t}switch(e){case"top":case"top_left":case"top_right":l+=n;break;case"bottom":case"bottom_left":case"bottom_right":d+=n}let u=(d-l)/(s-i);if((c-a)/(o-r)<0){let e=c;c=a,a=e}if(u<0){let e=d;d=l,l=e}this.minX=a,this.minY=l,this.width=Math.abs(c-a),this.height=Math.abs(d-l)}union(e){let t=Math.min(this.minX,e.x),n=Math.min(this.minY,e.y),r=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=n,this.width=r-t,this.height=i-n,this}static From(e){return new sL(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new sL(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){let t;if(0===e.length)return new sL;let n=1/0,r=1/0,i=-1/0,o=-1/0;for(let s=0,a=e.length;s<a;s++)n=Math.min((t=e[s]).x,n),r=Math.min(t.y,r),i=Math.max(t.x,i),o=Math.max(t.y,o);return new sL(n,r,i-n,o-r)}static Expand(e,t){let n=Math.min(t.minX,e.minX),r=Math.min(t.minY,e.minY);return new sL(n,r,Math.max(t.maxX,e.maxX)-n,Math.max(t.maxY,e.maxY)-r)}static ExpandBy(e,t){return new sL(e.minX-t,e.minY-t,e.width+2*t,e.height+2*t)}static Collides=(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY);static Contains=(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX;static Includes=(e,t)=>sL.Collides(e,t)||sL.Contains(e,t);static ContainsPoint=(e,t,n=0)=>!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n);static Common=e=>{let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let o=0;o<e.length;o++){let s=e[o];t=Math.min(t,s.minX),n=Math.min(n,s.minY),r=Math.max(r,s.maxX),i=Math.max(i,s.maxY)}return new sL(t,n,r-t,i-n)};static Sides=(e,t=0)=>{let{corners:n}=e;return[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]]};static Resize(e,t,n,r,i=!1){let{minX:o,minY:s,maxX:a,maxY:l}=e,{minX:c,minY:d,maxX:u,maxY:h}=e;switch(t){case"left":case"top_left":case"bottom_left":c+=n;break;case"right":case"top_right":case"bottom_right":u+=n}switch(t){case"top":case"top_left":case"top_right":d+=r;break;case"bottom":case"bottom_left":case"bottom_right":h+=r}let p=(u-c)/(a-o),f=(h-d)/(l-s);if(i){let e=(a-o)/(l-s),n=Math.abs(u-c),r=Math.abs(h-d),i=n*(f<0?1:-1)*(1/e),g=r*(p<0?1:-1)*e,m=e<n/r;switch(t){case"top_left":m?d=h+i:c=u+g;break;case"top_right":m?d=h+i:u=c-g;break;case"bottom_right":m?h=d-i:u=c-g;break;case"bottom_left":m?h=d-i:c=u+g;break;case"bottom":case"top":{let t=(c+u)/2,n=r*e;c=t-n/2,u=t+n/2;break}case"left":case"right":{let t=(d+h)/2,r=n/e;d=t-r/2,h=t+r/2}}}if(p<0){let e=u;u=c,c=e}if(f<0){let e=h;h=d,d=e}let g=new sL(c,d,Math.abs(u-c),Math.abs(h-d));return{box:g,scaleX:+(g.width/e.width*(p>0?1:-1)).toFixed(5),scaleY:+(g.height/e.height*(f>0?1:-1)).toFixed(5)}}equals(e){return sL.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new sL(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}let sD=e=>{let t=e.parentElement;for(;t&&t!==document.body;){let{overflowY:e}=window.getComputedStyle(t);if(t.scrollHeight>t.clientHeight&&("auto"===e||"scroll"===e||"overlay"===e))return t;t=t.parentElement}return document};class sz{constructor(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=o}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){let{a:t,b:n,c:r,d:i,e:o,f:s}=this;return this.a=t*e.a+r*e.b,this.c=t*e.c+r*e.d,this.e=t*e.e+r*e.f+o,this.b=n*e.a+i*e.b,this.d=n*e.c+i*e.d,this.f=n*e.e+i*e.f+s,this}rotate(e,t,n){return 0===e?this:void 0===t?this.multiply(sz.Rotate(e)):this.translate(t,n).multiply(sz.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(sz.Translate(e,t))}scale(e,t){return this.multiply(sz.Scale(e,t))}invert(){let{a:e,b:t,c:n,d:r,e:i,f:o}=this,s=e*r-t*n;return this.a=r/s,this.b=-(t/s),this.c=-(n/s),this.d=e/s,this.e=-((r*i-n*o)/s),this.f=(t*i-e*o)/s,this}applyToPoint(e){return sz.applyToPoint(this,e)}applyToPoints(e){return sz.applyToPoints(this,e)}rotation(){return sz.Rotation(this)}point(){return sz.Point(this)}decomposed(){return sz.Decompose(this)}toCssString(){return sz.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return sz.Decompose(this)}clone(){return new sz(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new sz(1,0,0,1,0,0)}static Translate(e,t){return new sz(1,0,0,1,e,t)}static Rotate(e,t,n){if(0===e)return sz.Identity();let r=Math.cos(e),i=Math.sin(e),o=new sz(r,i,-i,r,0,0);return void 0===t?o:sz.Compose(sz.Translate(t,n),o,sz.Translate(-t,-n))}static Scale=(e,t,n,r)=>{let i=new sz(e,0,0,t,0,0);return void 0===n?i:sz.Compose(sz.Translate(n,r),i,sz.Translate(-n,-r))};static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:-((e.d*e.e-e.c*e.f)/t),f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:-((e.b*e.e-e.a*e.f)/t)}}static Compose(...e){let t=sz.Identity();for(let n=0,r=e.length;n<r;n++)t.multiply(e[n]);return t}static Point(e){return new ot(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){let n=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let n=(e.b*e.b+e.d*e.d)**.5;t=os+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return(oa+t)%oa}static Decompose(e){let t,n,r;if(0!==e.a||0!==e.c){let i=(e.a*e.a+e.c*e.c)**.5;t=i,n=(e.a*e.d-e.b*e.c)/i,r=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let i=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/i,n=i,r=os+Math.acos(e.b/i)*(e.d>0?-1:1)}else t=0,n=0,r=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:(oa+r)%oa}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${oC(e.a)}, ${oC(e.b)}, ${oC(e.c)}, ${oC(e.d)}, ${oC(e.e)}, ${oC(e.f)})`}static applyToPoint(e,t){return new ot(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map(t=>new ot(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z))}static applyToBounds(e,t){return new sL(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new sz(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof sz?e:sz.From(e)}}function sR(e){let t=e.toString().split(".")[1];if(!t)return 1;let n=Math.pow(10,t.length);return n/function e(t,n){return 0===n?t:e(n,t%n)}(parseInt(t,10),n)}class sN{isFilled=!1;isClosed=!0;isLabel=!1;debugColor;ignore;constructor(e){this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,n=!1){return!!(this.isClosed&&(this.isFilled||n)&&ok(e,this.vertices))||ot.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&ok(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){let n,r,i,o;if(e.equals(t))return this.distanceToPoint(e);let{vertices:s}=this,a=1/0;for(let l=0;l<s.length;l++)i=s[l],o=ot.NearestPointOnLineSegment(e,t,i,!0),(r=ot.Dist2(i,o))<a&&(a=r,n=o);if(!n)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&ok(n,this.vertices)?-a:a}hitTestLineSegment(e,t,n=0){return this.distanceToLineSegment(e,t)<=n}nearestPointOnLineSegment(e,t){let n,r,i,o;let{vertices:s}=this,a=1/0;for(let l=0;l<s.length;l++)i=s[l],o=ot.NearestPointOnLineSegment(e,t,i,!0),(r=ot.Dist2(i,o))<a&&(a=r,n=o);if(!n)throw Error("nearest point not found");return n}isPointInBounds(e,t=0){let{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return sL.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;let{vertices:e}=this,t=0;for(let n=0,r=e.length;n<r;n++){let i=e[n],o=e[(n+1)%r];t+=i.x*o.y-o.x*i.y}return t/2}toSimpleSvgPath(){let e="",{vertices:t}=this,n=t.length;if(0===n)return e;e+=`M${t[0].x},${t[0].y}`;for(let r=1;r<n;r++)e+=`L${t[r].x},${t[r].y}`;return this.isClosed&&(e+="Z"),e}_length;get length(){return this._length||(this._length=this.getLength()),this._length}getLength(){let{vertices:e}=this,t,n=e[0],r=0;for(let i=1;i<e.length;i++)t=e[i],r+=ot.Dist2(n,t),n=t;return Math.sqrt(r)}}class sF extends sN{children=[];ignoredChildren=[];constructor(e){for(let t of(super({...e,isClosed:!0,isFilled:!1}),e.children))t.ignore?this.ignoredChildren.push(t):this.children.push(t);if(0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(e=>!e.isLabel).flatMap(e=>e.vertices)}nearestPoint(e){let t,n,r,i=1/0,{children:o}=this;if(0===o.length)throw Error("no children");for(let s of o)n=s.nearestPoint(e),(r=ot.Dist2(n,e))<i&&(i=r,t=n);if(!t)throw Error("nearest point not found");return t}distanceToPoint(e,t=!1){return Math.min(...this.children.map((n,r)=>n.distanceToPoint(e,t||r>0)))}hitTestPoint(e,t,n){return!!this.children.filter(e=>!e.isLabel).find(r=>r.hitTestPoint(e,t,n))}hitTestLineSegment(e,t,n){return!!this.children.filter(e=>!e.isLabel).find(r=>r.hitTestLineSegment(e,t,n))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(let t of this.children)e+=t.toSimpleSvgPath();let t=sL.FromPoints(this.vertices).corners;for(let n=0,r=t.length;n<r;n++){let i=t[n],o=t[(n-1+r)%r],s=i.dist(o),a=t[(n+1)%r],l=i.dist(a),c=i.clone().lrp(o,4/s),d=i.clone().lrp(a,4/l);e+=`M${c.x},${c.y} L${i.x},${i.y} L${d.x},${d.y} `}return e}getLength(){return this.children.reduce((e,t)=>t.isLabel?e:e+t.length,0)}getSvgPathData(){return this.children.map((e,t)=>e.isLabel?"":e.getSvgPathData(0===t)).join(" ")}}let s$=iZ(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){let r=i8();!function(e=!0){let[t,n]=(0,y.useState)(0),r=i8();(0,y.useEffect)(()=>{if(!e)return;let t=()=>n(e=>e+1);return r.on("tick",t),()=>{r.off("tick",t)}},[r,e])}(n);let i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:s}}=r;return(0,m.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:0x3b9ac9ff,top:0,left:0,overflow:"visible"},children:o.map(o=>{let a=r.getShape(o.id);if("group"===a.type)return null;let l=r.getShapeGeometry(a),c=r.getShapePageTransform(a),d=r.getPointInShapeSpace(a,s),u=l.nearestPoint(d),h=l.distanceToPoint(d,!0),p=Math.abs(h)*i,{vertices:f}=l;return(0,m.jsxs)("g",{transform:c.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&(0,m.jsx)("g",{stroke:l.debugColor??"red",opacity:"1",strokeWidth:2/i,fill:"none",children:(0,m.jsx)(sB,{geometry:l})}),t&&f.map((e,t)=>(0,m.jsx)("circle",{cx:e.x,cy:e.y,r:2/i,fill:`hsl(${eV(t,[0,f.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/i},`v${t}`)),n&&p<150&&(0,m.jsx)("line",{x1:u.x,y1:u.y,x2:d.x,y2:d.y,opacity:1-p/150,stroke:h<0?"goldenrod":"dodgerblue",strokeWidth:2/i})]},o.id+"_outline")})})});function sB({geometry:e}){return e instanceof sF?(0,m.jsx)(m.Fragment,{children:[...e.children,...e.ignoredChildren].map((e,t)=>(0,m.jsx)(sB,{geometry:e},t))}):(0,m.jsx)("path",{d:e.toSimpleSvgPath()})}function sU(){let e=i8();return iJ(function(){let e=arguments[0],t=arguments[1],n=3==arguments.length?void 0:arguments[2],r=3==arguments.length?arguments[2]:arguments[3];return(0,y.useMemo)(()=>es(`useComputed(${e})`,t,n),r)}("userIds",()=>el(e.getCollaborators().map(e=>e.userId)).sort(),{isEqual:(e,t)=>e.join(",")===t.join?.(",")},[e]))}function sV(e){let t=i8();return iJ(`latestPresence:${e}`,()=>t.getCollaborators().find(t=>t.userId===e),[t,e])??null}let sH=iZ(function(){return sU().map(e=>(0,m.jsx)(sK,{collaboratorId:e},e))}),sK=iZ(function({collaboratorId:e}){let t=i8(),n=sV(e),r=function(e,t){let n=(0,y.useRef)(t?.lastActivityTimestamp??-1),[r,i]=(0,y.useState)(()=>sG(e,Date.now()-n.current));return(0,y.useEffect)(()=>{let t=e.timers.setInterval(()=>{i(sG(e,Date.now()-n.current))},e.options.collaboratorCheckIntervalMs);return()=>clearInterval(t)},[e]),t&&(n.current=t.lastActivityTimestamp),r}(t,n);if(!(n&&n.currentPageId===t.getCurrentPageId()))return null;switch(r){case"inactive":{let{followingUserId:e,highlightedUserIds:r}=t.getInstanceState();if(!(e===n.userId||r.includes(n.userId)))return null;break}case"idle":{let{highlightedUserIds:e}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!(n.chatMessage||e.includes(n.userId)))return null}}return(0,m.jsx)(sW,{latestPresence:n})}),sW=iZ(function({latestPresence:e}){let t=i8(),{CollaboratorBrush:n,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:s}=aL(),a=t.getZoomLevel(),l=t.getViewportPageBounds(),{userId:c,chatMessage:d,brush:u,scribbles:h,selectedShapeIds:p,userName:f,cursor:g,color:y}=e,b=!(g.x<l.minX-12/a||g.y<l.minY-16/a||g.x>l.maxX-12/a||g.y>l.maxY-16/a);return(0,m.jsxs)(m.Fragment,{children:[u&&n?(0,m.jsx)(n,{className:"tl-collaborator__brush",brush:u,color:y,opacity:.1},c+"_brush"):null,b&&i?(0,m.jsx)(i,{className:"tl-collaborator__cursor",point:g,color:y,zoom:a,name:"New User"!==f?f:null,chatMessage:d},c+"_cursor"):o?(0,m.jsx)(o,{className:"tl-collaborator__cursor-hint",point:g,color:y,zoom:a,viewport:l},c+"_cursor_hint"):null,r&&h.length?(0,m.jsx)(m.Fragment,{children:h.map(e=>(0,m.jsx)(r,{className:"tl-collaborator__scribble",scribble:e,color:y,zoom:a,opacity:"laser"===e.color?.5:.1},c+"_scribble_"+e.id))}):null,s&&p.map(e=>(0,m.jsx)(s,{className:"tl-collaborator__shape-indicator",shapeId:e,color:y,opacity:.5},c+"_"+e))]})});function sG(e,t){return t>e.options.collaboratorInactiveTimeoutMs?"inactive":t>e.options.collaboratorIdleTimeoutMs?"idle":"active"}let sq=(0,y.memo)(function({id:e,shape:t,util:n,index:r,backgroundIndex:i,opacity:o,dprMultiple:s}){let a=i8(),{ShapeErrorFallback:l}=aL(),c=(0,y.useRef)(null),d=(0,y.useRef)(null),u=(0,y.useRef)({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});iQ("set shape stuff",()=>{let t=a.getShape(e);if(!t)return;let n=u.current,r=a.getShapeClipPath(e)??"none";r!==n.clipPath&&(o$(c.current,"clip-path",r),o$(d.current,"clip-path",r),n.clipPath=r);let i=a.getShapePageTransform(e),o=sz.toCssString(i),l=a.getShapeGeometry(t).bounds;o!==n.transform&&(o$(c.current,"transform",o),o$(d.current,"transform",o),n.transform=o);let h=l.w%s,p=l.h%s,f=0===h?l.w:l.w+(s-h),g=0===p?l.h:l.h+(s-p);(f!==n.width||g!==n.height)&&(o$(c.current,"width",Math.max(f,s)+"px"),o$(c.current,"height",Math.max(g,s)+"px"),o$(d.current,"width",Math.max(f,s)+"px"),o$(d.current,"height",Math.max(g,s)+"px"),n.width=f,n.height=g)},[a]),iQ("set opacity and z-index",()=>{let e=c.current,t=d.current;o$(e,"opacity",o),o$(t,"opacity",o),o$(e,"z-index",r),o$(t,"z-index",i)},[o,r,i]),iQ("set display",()=>{if(!a.getShape(e))return;let t=a.getCulledShapes().has(e);t!==u.current.isCulled&&(o$(c.current,"display",t?"none":"block"),o$(d.current,"display",t?"none":"block"),u.current.isCulled=t)},[a]);let h=(0,y.useCallback)(e=>a.annotateError(e,{origin:"shape",willCrashApp:!1}),[a]);if(!t)return null;let p="fill"in t.props&&"none"!==t.props.fill;return(0,m.jsxs)(m.Fragment,{children:[n.backgroundComponent&&(0,m.jsx)("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:(0,m.jsx)(i4,{fallback:l,onError:h,children:(0,m.jsx)(sX,{shape:t,util:n})})}),(0,m.jsx)("div",{ref:c,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":p,draggable:!1,children:(0,m.jsx)(i4,{fallback:l,onError:h,children:(0,m.jsx)(sY,{shape:t,util:n})})})]})}),sY=(0,y.memo)(function({shape:e,util:t}){return iG("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),sX=(0,y.memo)(function({shape:e,util:t}){return iG("InnerShape:"+e.type,()=>t.backgroundComponent?.(t.editor.store.unsafeGetWithoutCapture(e.id)))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta);function sZ({className:e}){let t=i8(),{Background:n,SvgDefs:r,ShapeIndicators:i}=aL(),o=(0,y.useRef)(null),s=(0,y.useRef)(null),a=(0,y.useRef)(null),l=oK();(function(e){let t=i8();(0,y.useLayoutEffect)(()=>{let n=new sL;function r(){let r=e.current;if(!r)return null;let i=r.getBoundingClientRect(),o=new sL(i.left||i.x,i.top||i.y,Math.max(i.width,1),Math.max(i.height,1));n.equals(o)||(t.updateViewportScreenBounds(o),n=o)}r();let i=ea(r,200,{trailing:!0}),o=t.timers.setInterval(i,1e3);window.addEventListener("resize",i);let s=new ResizeObserver(e=>{e[0].contentRect&&i()}),a=e.current,l=null;return a&&(s.observe(a),(l=sD(a)).addEventListener("scroll",i)),()=>{clearInterval(o),window.removeEventListener("resize",i),s.disconnect(),l?.removeEventListener("scroll",i),i.cancel()}},[t,e])})(o),function(){let e=i8(),t=oK(),n=iJ("isFocused",()=>e.getIsFocused(),[e]);(0,y.useEffect)(()=>{if("undefined"==typeof window||!("matchMedia"in window))return;let t=null,n=()=>{null!=t&&t();let r=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`),i=e=>{"change"===e.type&&n()};r.addEventListener?r.addEventListener("change",n):r.addListener&&r.addListener(i),t=()=>{r.removeEventListener?r.removeEventListener("change",n):r.removeListener&&r.removeListener(i)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return n(),()=>{t?.()}},[e]),(0,y.useEffect)(()=>{if(!n)return;let r=t=>{if(t.altKey&&(e.isIn("zoom")||!e.getPath().endsWith(".idle"))&&!oG()&&oz(t),t.isKilled)return;switch(t.isKilled=!0,t.key){case"=":case"-":case"0":if(t.metaKey||t.ctrlKey){oz(t);return}break;case"Tab":default:if(oG()||e.getIsMenuOpen())return;break;case",":return;case"Escape":if((e.getEditingShape()||e.getSelectedShapeIds().length>0)&&t.preventDefault(),e.getOpenMenus().length>0)return;e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),e.focus());return}let n={type:"keyboard",name:t.repeat?"key_repeat":"key_down",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(n)},i=t=>{if(t.isKilled||(t.isKilled=!0,oG()||e.getIsMenuOpen()||","===t.key))return;let n={type:"keyboard",name:"key_up",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(n)};function o(n){if(t.contains(n.target)){let t=n.touches[0].pageX,r=n.touches[0].radiusX||0;(t-r<10||t+r>e.getViewportScreenBounds().width-10)&&(n.target?.tagName==="BUTTON"&&n.target?.click(),oz(n))}}let s=e=>{t.contains(e.target)&&(e.ctrlKey||e.metaKey)&&oz(e)};return t.addEventListener("touchstart",o,{passive:!1}),t.addEventListener("wheel",s,{passive:!1}),document.addEventListener("gesturestart",oz),document.addEventListener("gesturechange",oz),document.addEventListener("gestureend",oz),t.addEventListener("keydown",r),t.addEventListener("keyup",i),()=>{t.removeEventListener("touchstart",o),t.removeEventListener("wheel",s),document.removeEventListener("gesturestart",oz),document.removeEventListener("gesturechange",oz),document.removeEventListener("gestureend",oz),t.removeEventListener("keydown",r),t.removeEventListener("keyup",i)}},[e,t,n])}(),function(){let e=i8();(0,y.useEffect)(()=>{let t=e.getInstanceState().isCoarsePointer,n=n=>{let r="mouse"!==n.pointerType;t!==r&&(t=r,e.updateInstanceState({isCoarsePointer:r}))};window.addEventListener("pointerdown",n,{capture:!0});let r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=e.environment.isFirefox&&!e.environment.isAndroid&&!e.environment.isIos,o=()=>{let n=!i&&r.matches;t===n&&(t=n,e.updateInstanceState({isCoarsePointer:n}))};return r&&(r.addEventListener("change",o),o()),()=>{window.removeEventListener("pointerdown",n,{capture:!0}),r&&r.removeEventListener("change",o)}},[e])}(),function(e){let t=i8();sM(y.useMemo(()=>{let n="not sure",r=1,i=1,o=1,s=0,a=new ot,l=new ot,c=e=>{if(e&&(n="zooming"),"zooming"===n)return;let t=Math.abs(s-r),i=ot.Dist(a,l);switch(n){case"not sure":t>24?n="zooming":i>16&&(n="panning");break;case"panning":t>64&&(n="zooming")}};return{onWheel:({event:e})=>{if(!t.getInstanceState().isFocused||(n="not sure",sA(Date.now())))return;let r=t.getEditingShapeId();if(r){let e=t.getShape(r);if(e&&t.getShapeUtil(e).canScroll(e)){let e=t.getShapePageBounds(r);if(e?.containsPoint(t.inputs.currentPagePoint))return}}oz(e),oF(e);let i=sT(e);if(0===i.x&&0===i.y)return;let o={type:"wheel",name:"wheel",delta:i,point:new ot(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey};t.dispatch(o)},onPinchStart:o=>{let s=e.current;n="not sure";let{event:c,origin:d,da:u}=o;!(c instanceof WheelEvent)&&(c.target===s||s?.contains(c.target))&&(l.x=d[0],l.y=d[1],a.x=d[0],a.y=d[1],r=u[0],i=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:d[0],y:d[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey}))},onPinchEnd:r=>{let i=e.current,{event:o,origin:s,offset:a}=r;if(o instanceof WheelEvent||!(o.target===i||i?.contains(o.target)))return;let l=a[0];n="not sure",t.timers.requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:s[0],y:s[1],z:l},delta:{x:s[0],y:s[1]},shiftKey:o.shiftKey,altKey:o.altKey,ctrlKey:o.metaKey||o.ctrlKey})})},onPinch:r=>{let a=e.current,{event:d,origin:u,offset:h,da:p}=r;if(d instanceof WheelEvent||!(d.target===a||a?.contains(d.target)))return;let f="gesturechange"===r.type||"gestureend"===r.type;s=p[0];let g=u[0]-l.x,m=u[1]-l.y;switch(l.x=u[0],l.y=u[1],c(f),n){case"zooming":o=h[0],t.dispatch({type:"pinch",name:"pinch",point:{x:u[0],y:u[1],z:o},delta:{x:g,y:m},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey});break;case"panning":t.dispatch({type:"pinch",name:"pinch",point:{x:u[0],y:u[1],z:i},delta:{x:g,y:m},shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey})}}}},[t,e]),{target:e,eventOptions:{passive:!1},pinch:{from:()=>[t.getZoomLevel(),0],scaleBounds:()=>({from:t.getZoomLevel(),max:8,min:.05})}})}(o),function(e){let t=i8();(0,y.useEffect)(()=>{let n=e.current;if(!n)return;let r=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){e.isKilled=!0;let{target:n}=e;oq.includes(n.tagName?.toLocaleLowerCase())||t.isIn("select.editing_shape")||oz(e)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[t,e])}(o);let c=(0,y.useRef)({lodDisableTextOutline:!1,allowTextOutline:!0});iQ("position layers",function(){let{x:e,y:n,z:r}=t.getCamera();if(c.current.allowTextOutline&&t.environment.isSafari&&(l.style.setProperty("--tl-text-outline","none"),c.current.allowTextOutline=!1),c.current.allowTextOutline&&r<t.options.textShadowLod!==c.current.lodDisableTextOutline){let e=r<t.options.textShadowLod;l.style.setProperty("--tl-text-outline",e?"none":"var(--tl-text-outline-reference)"),c.current.lodDisableTextOutline=e}let i=r>=1?eV(r,[1,8],[.125,.5],!0):eV(r,[.1,1],[-2,.125],!0),o=`scale(${oC(r)}) translate(${oC(e+i)}px,${oC(n+i)}px)`;o$(s.current,"transform",o),o$(a.current,"transform",o)},[t,l]);let d=oU(),u=iJ("shapeSvgDefs",()=>{let e=new Map;for(let n of eG(t.shapeUtils)){if(!n)return;for(let{key:t,component:r}of n.getCanvasSvgDefs())e.has(t)||e.set(t,(0,m.jsx)(r,{},t))}return[...e.values()]},[t]),h=iJ("debug_shapes",()=>t_.hideShapes.get(),[t_]),p=iJ("debug_svg",()=>t_.debugSvg.get(),[t_]),f=iJ("debug_geometry",()=>t_.debugGeometry.get(),[t_]),g=iJ("isEditingAnything",()=>null!==t.getEditingShapeId(),[t]),b=iJ("isSelectingAnything",()=>!!t.getSelectedShapeIds().length,[t]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{ref:o,draggable:!1,"data-iseditinganything":g,"data-isselectinganything":b,className:i0("tl-canvas",e),"data-testid":"canvas",...d,children:[(0,m.jsx)("svg",{className:"tl-svg-context",children:(0,m.jsxs)("defs",{children:[u,(0,m.jsx)(at,{}),(0,m.jsx)(an,{}),r&&(0,m.jsx)(r,{})]})}),n&&(0,m.jsx)("div",{className:"tl-background__wrapper",children:(0,m.jsx)(n,{})}),(0,m.jsx)(sJ,{}),(0,m.jsxs)("div",{ref:s,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,m.jsx)(as,{}),(0,m.jsx)(ao,{}),h?null:p?(0,m.jsx)(s8,{}):(0,m.jsx)(s7,{})]}),(0,m.jsx)("div",{className:"tl-overlays",children:(0,m.jsxs)("div",{ref:a,className:"tl-html-layer",children:[f?(0,m.jsx)(s$,{}):null,(0,m.jsx)(s5,{}),(0,m.jsx)(s1,{}),(0,m.jsx)(s0,{}),(0,m.jsx)(s2,{}),i&&(0,m.jsx)(i,{}),(0,m.jsx)(ae,{}),(0,m.jsx)(s3,{}),(0,m.jsx)(ai,{}),(0,m.jsx)(sH,{})]})}),(0,m.jsx)(aa,{})]}),(0,m.jsx)(sQ,{})]})}function sQ(){let{InFrontOfTheCanvas:e}=aL();return e?(0,m.jsx)(e,{}):null}function sJ(){let e=i8(),t=iJ("gridSize",()=>e.getDocumentSettings().gridSize,[e]),{x:n,y:r,z:i}=iJ("camera",()=>e.getCamera(),[e]),o=iJ("isGridMode",()=>e.getInstanceState().isGridMode,[e]),{Grid:s}=aL();return s&&o?(0,m.jsx)(s,{x:n,y:r,z:i,size:t}):null}function s0(){let e=i8(),t=iJ("scribbles",()=>e.getInstanceState().scribbles,[e]),n=iJ("zoomLevel",()=>e.getZoomLevel(),[e]),{Scribble:r}=aL();return r&&t.length?t.map(e=>(0,m.jsx)(r,{className:"tl-user-scribble",scribble:e,zoom:n},e.id)):null}function s1(){let e=i8(),t=iJ("brush",()=>e.getInstanceState().brush,[e]),{Brush:n}=aL();return n&&t?(0,m.jsx)(n,{className:"tl-user-brush",brush:t}):null}function s2(){let e=i8(),t=iJ("zoomBrush",()=>e.getInstanceState().zoomBrush,[e]),{ZoomBrush:n}=aL();return n&&t?(0,m.jsx)(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function s3(){let e=i8(),t=iJ("snapLines",()=>e.snaps.getIndicators(),[e]),n=iJ("zoomLevel",()=>e.getZoomLevel(),[e]),{SnapIndicator:r}=aL();return r&&t.length>0?t.map(e=>(0,m.jsx)(r,{className:"tl-user-snapline",line:e,zoom:n},e.id)):null}function s5(){let e=i8(),t=iJ("handles shapeIdWithHandles",()=>{let{isReadonly:t,isChangingStyle:n}=e.getInstanceState();if(t||n)return!1;let r=e.getOnlySelectedShape();return!!(r&&e.getShapeHandles(r))&&r.id},[e]);return t?(0,m.jsx)(s4,{shapeId:t}):null}function s4({shapeId:e}){let t=i8(),{Handles:n}=aL(),r=iJ("zoomLevel",()=>t.getZoomLevel(),[t]),i=iJ("coarse pointer",()=>t.getInstanceState().isCoarsePointer,[t]),o=iJ("handles transform",()=>t.getShapePageTransform(e),[t,e]),s=iJ("handles",()=>{let n=t.getShapeHandles(e);if(!n)return null;let o=(i?t.options.coarseHandleRadius:t.options.handleRadius)/r*2;return n.filter(e=>"virtual"!==e.type||!n.some(t=>t!==e&&"vertex"===t.type&&ot.Dist(e,t)<o)).sort(e=>"vertex"===e.type?1:-1)},[t,r,i,e]);return n&&s&&o?(0,m.jsx)(n,{children:(0,m.jsx)("g",{transform:sz.toCssString(o),children:s.map(t=>(0,m.jsx)(s6,{shapeId:e,handle:t,zoom:r,isCoarse:i},t.id))})}):null}function s6({shapeId:e,handle:t,zoom:n,isCoarse:r}){let i=function(e,t){let n=i8();return y.useMemo(()=>{let r,i;return{onPointerDown:r=>{if(r.isKilled)return;oR(oD(r.currentTarget),r);let{shape:i,handle:o}=sO(n,e,t);o&&n.dispatch({type:"pointer",target:"handle",handle:o,shape:i,name:"pointer_down",...oB(r)})},onPointerMove:o=>{if(o.isKilled||o.clientX===r&&o.clientY===i)return;r=o.clientX,i=o.clientY;let{shape:s,handle:a}=sO(n,e,t);a&&n.dispatch({type:"pointer",target:"handle",handle:a,shape:s,name:"pointer_move",...oB(o)})},onPointerUp:r=>{if(r.isKilled)return;oN(oD(r.currentTarget),r);let{shape:i,handle:o}=sO(n,e,t);o&&n.dispatch({type:"pointer",target:"handle",handle:o,shape:i,name:"pointer_up",...oB(r)})}}},[n,e,t])}(e,t.id),{Handle:o}=aL();return o?(0,m.jsx)("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...i,children:(0,m.jsx)(o,{shapeId:e,handle:t,zoom:n,isCoarse:r})}):null}function s8(){let e=i8(),t=iJ("rendering shapes",()=>e.getRenderingShapes(),[e]),n=iJ("dpr multiple",()=>sR(Math.floor(100*e.getInstanceState().devicePixelRatio)/100),[e]);return t.map(e=>(0,m.jsxs)(y.Fragment,{children:[(0,m.jsx)(sq,{...e,dprMultiple:n}),(0,m.jsx)(ar,{id:e.id})]},e.id+"_fragment"))}function s9(){let e=i8(),t=(0,y.useRef)(new Set);return iQ("reflow for culled shapes",()=>{let n=e.getCulledShapes();if(t.current.size===n.size&&[...n].every(e=>t.current.has(e)))return;t.current=n;let r=document.getElementsByClassName("tl-canvas");0!==r.length&&r[0].offsetHeight},[e]),null}function s7(){let e=i8(),t=iJ("rendering shapes",()=>e.getRenderingShapes(),[e]),n=iJ("dpr multiple",()=>sR(Math.floor(100*e.getInstanceState().devicePixelRatio)/100),[e]);return(0,m.jsxs)(m.Fragment,{children:[t.map(e=>(0,m.jsx)(sq,{...e,dprMultiple:n},e.id+"_shape")),e.environment.isSafari&&(0,m.jsx)(s9,{})]})}function ae(){let e=i8(),{ShapeIndicator:t}=aL(),n=iJ("hinting shape ids",()=>eh(e.getHintingShapeIds()),[e]);return n.length&&t?n.map(e=>(0,m.jsx)(t,{className:"tl-user-indicator__hint",shapeId:e},e+"_hinting")):null}function at(){return(0,m.jsxs)("g",{id:"cursor",children:[(0,m.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,m.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,m.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,m.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,m.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,m.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,m.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,m.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,m.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function an(){return(0,m.jsx)("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function ar({id:e}){let t=i8(),[n,r]=(0,y.useState)(null),i=iJ("is in root",()=>{let n=t.getShape(e);return n?.parentId===t.getCurrentPageId()},[t,e]);return((0,y.useEffect)(()=>{if(!i)return;let n=null,o=B("shape to svg",async()=>{let i=Math.random();n=i;let o=t.isShapeOfType(e,"frame")?0:10,s=t.getShapePageBounds(e);if(!s)return;s=s.clone().expandBy(o);let a=await t.getSvgString([e],{padding:o,background:t.getInstanceState().exportBackground});n===i&&a&&r({src:`data:image/svg+xml;utf8,${encodeURIComponent(a.svg)}`,bounds:s})});return()=>{n=null,o()}},[t,e,i]),i&&n)?(0,m.jsx)("img",{src:n.src,width:n.bounds.width,height:n.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${n.bounds.x}px, ${n.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):null}function ai(){let e=i8(),t=iJ("selection rotation",()=>e.getSelectionRotation(),[e]),n=iJ("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionForeground:r}=aL();return n&&r?(0,m.jsx)(r,{bounds:n,rotation:t}):null}function ao(){let e=i8(),t=iJ("selection rotation",()=>e.getSelectionRotation(),[e]),n=iJ("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionBackground:r}=aL();return n&&r?(0,m.jsx)(r,{bounds:n,rotation:t}):null}function as(){let{OnTheCanvas:e}=aL();return e?(0,m.jsx)(e,{}):null}function aa(){let e=i8(),t=iJ("camera state",()=>e.getCameraState(),[e]);return(0,m.jsx)("div",{className:i0("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":"idle"===t})})}function al({className:e,zoom:t,point:n,color:r,viewport:i,opacity:o=1}){let s=(0,y.useRef)(null);return i7(s,oc(n.x,i.minX+5/t,i.maxX-5/t),oc(n.y,i.minY+5/t,i.maxY-5/t),1/t,ot.Angle(i.center,n)),(0,m.jsxs)("svg",{ref:s,className:i0("tl-overlays__item",e),children:[(0,m.jsx)("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),(0,m.jsx)("use",{href:"#cursor_hint",color:r,opacity:o})]})}let ac=(0,y.memo)(function({className:e,zoom:t,point:n,color:r,name:i,chatMessage:o}){let s=(0,y.useRef)(null);return(i7(s,n?.x,n?.y,1/t),n)?(0,m.jsxs)("div",{ref:s,className:i0("tl-overlays__item",e),children:[(0,m.jsx)("svg",{className:"tl-cursor",children:(0,m.jsx)("use",{href:"#cursor",color:r})}),o?(0,m.jsxs)(m.Fragment,{children:[i&&(0,m.jsx)("div",{className:"tl-nametag-title",style:{color:r},children:i}),(0,m.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&(0,m.jsx)("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null});function ad(){return(0,y.useId)().replace(/:/g,"_")}function au({x:e,y:t,z:n,size:r}){let i=`grid_${ad()}`,{gridSteps:o}=i8().options;return(0,m.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,m.jsx)("defs",{children:o.map(({min:o,mid:s,step:a},l)=>{let c=a*r*n,d=.5+e*n,u=.5+t*n,h=d>0?d%c:c+d%c,p=u>0?u%c:c+u%c,f=n<s?eV(n,[o,s],[0,1]):1;return(0,m.jsx)("pattern",{id:`${i}_${a}`,width:c,height:c,patternUnits:"userSpaceOnUse",children:(0,m.jsx)("circle",{className:"tl-grid-dot",cx:h,cy:p,r:1,opacity:f})},l)})}),o.map(({step:e},t)=>(0,m.jsx)("rect",{width:"100%",height:"100%",fill:`url(#${i}_${e})`},t))]})}function ah({handle:e,isCoarse:t,className:n,zoom:r}){let i=i8(),o=(t?i.options.coarseHandleRadius:i.options.handleRadius)/r;if("clone"===e.type){let t=3/r,i=`M0,${-t} A${t},${t} 0 0,1 0,${t}`,s=oL.indexOf(e.id);return(0,m.jsxs)("g",{className:i0(`tl-handle tl-handle__${e.type}`,n),children:[(0,m.jsx)("circle",{className:"tl-handle__bg",r:o}),(0,m.jsx)("path",{className:"tl-handle__fg",d:i,transform:`rotate(${-90+90*s})`})]})}let s=("create"===e.type&&t?3:4)/Math.max(r,.25);return(0,m.jsxs)("g",{className:i0(`tl-handle tl-handle__${e.type}`,n),children:[(0,m.jsx)("circle",{className:"tl-handle__bg",r:o}),(0,m.jsx)("circle",{className:"tl-handle__fg",r:s})]})}let ap=({children:e})=>(0,m.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e}),af=()=>{let{Spinner:e}=aL();return(0,m.jsx)(dR,{children:e?(0,m.jsx)(e,{}):null})};function ag(e,t=!0){let n=e.length;if(n<2)return"";let r=e[0],i=e[1];if(2===n)return`M${or(r)}L${or(i)}`;let o="";for(let t=2,s=n-1;t<s;t++)o+=oi(r=e[t],i=e[t+1]);return t?`M${oi(e[0],e[1])}Q${or(e[1])}${oi(e[1],e[2])}T${o}${oi(e[n-1],e[0])}${oi(e[0],e[1])}Z`:`M${or(e[0])}Q${or(e[1])}${oi(e[1],e[2])}${e.length>3?"T":""}${o}L${or(e[n-1])}`}function am({scribble:e,zoom:t,color:n,opacity:r,className:i}){return e.points.length?(0,m.jsx)("svg",{className:i?i0("tl-overlays__item",i):i,children:(0,m.jsx)("path",{className:"tl-scribble",d:ag(e.points,!1),stroke:n??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:r??e.opacity})}):null}function ay({bounds:e,rotation:t}){let n=y.useRef(null);return i7(n,e.x,e.y,1,t),y.useLayoutEffect(()=>{let t=n.current;t&&(t.style.width=oC(Math.max(1,e.width))+"px",t.style.height=oC(Math.max(1,e.height))+"px")},[e.width,e.height]),(0,m.jsx)("div",{ref:n,className:"tl-selection__bg",draggable:!1})}function ab({bounds:e,rotation:t}){let n=i8(),r=(0,y.useRef)(null),i=iJ("only selected shape",()=>n.getOnlySelectedShape(),[n]),o=i?n.getShapeUtil(i).expandSelectionOutlinePx(i):0;return i7(r,e?.x,e?.y,1,t,{x:-o,y:-o}),e=e.clone().expandBy(o).zeroFix(),(0,m.jsx)("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,m.jsx)("rect",{className:i0("tl-selection__fg__outline"),width:oC(e.width),height:oC(e.height)})})}let ax=()=>(0,m.jsx)("div",{className:"tl-shape-error-boundary"}),av=({shape:e,util:t})=>iG("Indicator: "+e.type,()=>t.indicator(t.editor.store.unsafeGetWithoutCapture(e.id))),aw=({editor:e,id:t})=>{let n=iJ("shape for indicator",()=>e.store.get(t),[e,t]),{ShapeIndicatorErrorFallback:r}=aL();return!n||n.isLocked?null:(0,m.jsx)(i4,{fallback:r,onError:t=>e.annotateError(t,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,m.jsx)(av,{shape:n,util:e.getShapeUtil(n)},n.id)})},aS=(0,y.memo)(function({shapeId:e,className:t,color:n,hidden:r,opacity:i}){let o=i8(),s=(0,y.useRef)(null);return iQ("indicator transform",()=>{let t=s.current;if(!t)return;let n=o.getShapePageTransform(e);n&&t.style.setProperty("transform",n.toCssString())},[o,e]),(0,y.useLayoutEffect)(()=>{let e=s.current;e&&e.style.setProperty("display",r?"none":"block")},[r]),(0,m.jsx)("svg",{ref:s,className:i0("tl-overlays__item",t),children:(0,m.jsx)("g",{className:"tl-shape-indicator",stroke:n??"var(--color-selected)",opacity:i,children:(0,m.jsx)(aw,{editor:o,id:e})})})}),ak=()=>(0,m.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),aC=(0,y.memo)(function(){let e=i8(),t=(0,y.useRef)(new Set),n=iJ("should display selected ids",()=>{let n=t.current,r=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){for(let t of e.getSelectedShapeIds())r.add(t);if(e.isInAny("select.idle","select.editing_shape")){let t=e.getInstanceState();if(t.isHoveringCanvas&&!t.isCoarsePointer){let t=e.getHoveredShapeId();t&&r.add(t)}}}if(n.size!==r.size)return t.current=r,r;for(let e of r)if(!n.has(e))return t.current=r,r;return n},[e]),r=iJ("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:i}=aL();return i?r.map(({id:e})=>(0,m.jsx)(i,{shapeId:e,hidden:!n.has(e)},e+"_indicator")):null});function aP({points:e,zoom:t}){let n,r,i,o;let s=2.5/t,a=e.reduce((e,t)=>Math.min(e,t.x),1/0),l=e.reduce((e,t)=>Math.max(e,t.x),-1/0),c=e.reduce((e,t)=>Math.min(e,t.y),1/0),d=e.reduce((e,t)=>Math.max(e,t.y),-1/0);return e.some(e=>e.x===a&&e.y===c)?(n=a,r=c,i=l,o=d):(n=a,r=d,i=l,o=c),(0,m.jsxs)("g",{className:"tl-snap-indicator",stroke:"lime",children:[(0,m.jsx)("line",{x1:n,y1:r,x2:i,y2:o}),e.map((e,t)=>(0,m.jsx)("g",{transform:`translate(${e.x},${e.y})`,children:(0,m.jsx)("path",{className:"tl-snap-point",d:`M ${-s},${-s} L ${s},${s} M ${-s},${s} L ${s},${-s}`})},t))]})}function a_({gaps:e,direction:t,zoom:n}){let r=3.5/n,i=[-1/0,1/0],o=null,s="horizontal"===t;for(let t of e)(o=ow(i[0],i[1],s?t.startEdge[0].y:t.startEdge[0].x,s?t.startEdge[1].y:t.startEdge[1].x))&&(o=ow((i=o)[0],i[1],s?t.endEdge[0].y:t.endEdge[0].x,s?t.endEdge[1].y:t.endEdge[1].x))&&(i=o);if(null===i)return null;let a=(i[0]+i[1])/2;return(0,m.jsx)("g",{className:"tl-snap-indicator",stroke:"cyan",children:e.map(({startEdge:e,endEdge:t},n)=>(0,m.jsx)(y.Fragment,{children:s?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("line",{x1:e[0].x,y1:a-2*r,x2:e[1].x,y2:a+2*r}),(0,m.jsx)("line",{x1:t[0].x,y1:a-2*r,x2:t[1].x,y2:a+2*r}),(0,m.jsx)("line",{x1:e[0].x,y1:a,x2:t[0].x,y2:a}),(0,m.jsx)("line",{x1:(e[0].x+t[0].x)/2,y1:a-r,x2:(e[0].x+t[0].x)/2,y2:a+r})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("line",{x1:a-2*r,y1:e[0].y,x2:a+2*r,y2:e[1].y}),(0,m.jsx)("line",{x1:a-2*r,y1:t[0].y,x2:a+2*r,y2:t[1].y}),(0,m.jsx)("line",{x1:a,y1:e[0].y,x2:a,y2:t[0].y}),(0,m.jsx)("line",{x1:a-r,y1:(e[0].y+t[0].y)/2,x2:a+r,y2:(e[0].y+t[0].y)/2})]})},n))})}function aI({className:e,line:t,zoom:n}){return(0,m.jsx)("svg",{className:i0("tl-overlays__item",e),children:"points"===t.type?(0,m.jsx)(aP,{...t,zoom:n}):"gaps"===t.type?(0,m.jsx)(a_,{...t,zoom:n}):null})}function aE(){return(0,m.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",children:(0,m.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,m.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,m.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,m.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}let aj=()=>null;function aT(e,t){let n=(0,y.useRef)(e);return t(e,n.current)?n.current:(n.current=e,e)}let aM=(e,t)=>(e??=null)===(t??=null)||!!e&&!!t&&eQ(e,t),aA=(0,y.createContext)(null);function aO({overrides:e={},children:t}){let n=aT(e,aM),r=(0,y.useMemo)(()=>({Background:i9,SvgDefs:aj,Brush:oT,ZoomBrush:oT,CollaboratorBrush:oT,Cursor:ac,CollaboratorCursor:ac,CollaboratorHint:al,CollaboratorShapeIndicator:aS,Grid:au,Scribble:am,SnapIndicator:aI,Handles:ap,Handle:ah,CollaboratorScribble:am,ErrorFallback:aR,ShapeErrorFallback:ax,ShapeIndicatorErrorFallback:ak,Spinner:aE,SelectionBackground:ay,SelectionForeground:ab,ShapeIndicators:aC,ShapeIndicator:aS,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:sZ,LoadingScreen:af,...n}),[n]);return(0,m.jsx)(aA.Provider,{value:r,children:t})}function aL(){let e=(0,y.useContext)(aA);if(!e)throw Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return e}let aD={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>await window.__tldraw__hardReset?.()};function az(){aD.hardReset()}let aR=({error:e,editor:t})=>{let n=(0,y.useRef)(null),[r,i]=(0,y.useState)(!1),[o,s]=(0,y.useState)(!1),[a,l]=(0,y.useState)(!1),c=null;try{c=aL().Canvas??null}catch(e){}let d=e instanceof Error?e.message:String(e),u=e instanceof Error?e.stack:null,h=iJ("isDarkMode",()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null},[t]),[p,f]=(0,y.useState)(null);(0,y.useLayoutEffect)(()=>{null!==h&&f(h);let e=n.current?.parentElement,t=!1;for(;e;){if(e.classList.contains("tl-theme__dark")||e.classList.contains("tl-theme__light")){t=!0;break}e=e.parentElement}if(t){f(null);return}"undefined"!=typeof window&&"matchMedia"in window&&f(window.matchMedia("(prefers-color-scheme: dark)").matches)},[h]),(0,y.useEffect)(()=>{if(o){let e=t?.timers.setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(e)}},[o,t]);let g=async()=>{az()},b=new URL("https://github.com/tldraw/tldraw/issues/new");return b.searchParams.set("title",d),b.searchParams.set("labels","bug"),b.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??d}
\`\`\`

My browser: ${navigator.userAgent}`),(0,m.jsxs)("div",{ref:n,className:i0("tl-container tl-error-boundary",null===p?"":p?"tl-theme__dark":"tl-theme__light"),children:[(0,m.jsx)("div",{className:"tl-error-boundary__overlay"}),t&&(0,m.jsx)(i5,{onError:eb,fallback:()=>null,children:(0,m.jsx)(i6.Provider,{value:t,children:(0,m.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:c?(0,m.jsx)(c,{}):null})})}),(0,m.jsx)("div",{className:i0("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h2",{children:"Are you sure?"}),(0,m.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,m.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,m.jsx)("button",{onClick:()=>l(!1),children:"Cancel"}),(0,m.jsx)("button",{className:"tl-error-boundary__reset",onClick:g,children:"Reset data"})]})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("h2",{children:"Something's gone wrong."}),(0,m.jsxs)("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",(0,m.jsx)("a",{href:b.toString(),children:"create a GitHub issue"})," or"," ",(0,m.jsx)("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&(0,m.jsxs)(m.Fragment,{children:["Message:",(0,m.jsx)("h4",{children:(0,m.jsx)("code",{children:d})}),"Stack trace:",(0,m.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,m.jsx)("pre",{children:(0,m.jsx)("code",{children:u??d})}),(0,m.jsx)("button",{onClick:()=>{let e=document.createElement("textarea");e.value=u??d,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),s(!0)},children:o?"Copied!":"Copy"})]})]}),(0,m.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,m.jsx)("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),(0,m.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,m.jsx)("button",{className:"tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),(0,m.jsx)("button",{className:"tl-error-boundary__refresh",onClick:()=>{aD.refreshPage()},children:"Refresh Page"})]})]})]})})]})},aN=e=>{!l||l.length<e?(l=Buffer.allocUnsafe(128*e),(0,tM.randomFillSync)(l),c=0):c+e>l.length&&((0,tM.randomFillSync)(l),c=0),c+=e},aF=(e=21)=>{aN(e-=0);let t="";for(let n=c-e;n<c;n++)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&l[n]];return t};function a$(){return aF()}let aB="TLDRAW_USER_DATA_v3",aU=nf({id:nr,name:nr.nullable().optional(),locale:nr.nullable().optional(),color:nr.nullable().optional(),colorScheme:nS("light","dark","system").optional(),animationSpeed:ni.nullable().optional(),edgeScrollSpeed:ni.nullable().optional(),isSnapMode:nd.nullable().optional(),isWrapMode:nd.nullable().optional(),isDynamicSizeMode:nd.nullable().optional(),isPasteAtCursorMode:nd.nullable().optional()}),aV={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},aH=Math.max(...Object.values(aV)),aK=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function aW(){return aK[Math.floor(Math.random()*aK.length)]}let aG=Object.freeze({name:"New User",locale:function(e){for(let t of e){let e=function(e){let t=iK.find(t=>t.locale===e.toLowerCase());if(t)return t.locale;let[n,r]=e.split(/[-_]/).map(e=>e.toLowerCase());if(r){let e=iK.find(e=>e.locale===n);if(e)return e.locale}return n in iW?iW[n]:null}(t);if(e)return e}return"en"}("undefined"!=typeof window?window.navigator.languages??["en"]:["en"]),color:aW(),edgeScrollSpeed:1,animationSpeed:"undefined"!=typeof window&&"matchMedia"in window&&window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"system"});function aq(){return{id:a$(),color:aW()}}function aY(e){if(null===e||"object"!=typeof e||!("version"in e)||!("user"in e)||"number"!=typeof e.version)return aq();let t=tS(e);t.version<aV.AddAnimationSpeed&&(t.user.animationSpeed=1),t.version<aV.AddIsSnapMode&&(t.user.isSnapMode=!1),t.version,aV.MakeFieldsNullable,t.version<aV.AddEdgeScrollSpeed&&(t.user.edgeScrollSpeed=1),t.version<aV.AddExcalidrawSelectMode&&(t.user.isWrapMode=!1),t.version<aV.AllowSystemColorScheme&&(!0===t.user.isDarkMode?t.user.colorScheme="dark":!1===t.user.isDarkMode&&(t.user.colorScheme="light"),delete t.user.isDarkMode),t.version<aV.AddDynamicSizeMode&&(t.user.isDynamicSizeMode=!1),t.version<aV.AddPasteAtCursor&&(t.user.isPasteAtCursorMode=!1),t.version=aH;try{return aU.validate(t.user)}catch(e){return aq()}}let aX=X("globalUserData",null);function aZ(e){aU.validate(e),aX.set(e),ta(aB,JSON.stringify({version:aH,user:aX.get()})),aJ?.postMessage({type:a2,origin:a1(),data:{user:a3(),version:aH}})}let aQ="undefined"!=typeof process&&!1,aJ="undefined"==typeof BroadcastChannel||aQ?null:new BroadcastChannel("tldraw-user-sync");aJ?.addEventListener("message",e=>{let t=e.data;t?.type===a2&&t?.origin!==a1()&&aX.set(aY(t.data))});let a0=null;function a1(){return null===a0&&(a0=a$()),a0}let a2="tldraw-user-preferences-change";function a3(){let e=aX.get();return e||aZ(e=aY(JSON.parse(ts(aB)||"null")??null)),e}let a5=es("defaultLocalStorageUserPrefs",()=>a3());function a4(e={}){return{userPreferences:e.userPreferences??a5,setUserPreferences:e.setUserPreferences??aZ}}var a6=n(38224),a8=n(55740),a9=n(53413);let a7="TLDRAW_TAB_ID_v2",le=globalThis.window,lt=le?le[a7]??tl(a7)??"TLDRAW_INSTANCE_STATE_V1_"+a$():"<error>";le&&(le[a7]=lt,le&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(le.navigator.platform)||le.navigator.userAgent.includes("Mac")&&"ontouchend"in document)?tc(a7,lt):td(a7)),le?.addEventListener("beforeunload",()=>{tc(a7,lt)});let ln={Initial:0},lr=Math.max(...Object.values(ln)),li=nf({version:ni,currentPageId:rg,isFocusMode:nd,exportBackground:nd,isDebugMode:nd,isToolLocked:nd,isGridMode:nd,pageStates:np(nf({pageId:rg,camera:nf({x:ni,y:ni,z:ni}),selectedShapeIds:np(nN),focusedGroupId:nN.nullable()}))});function lo(e){let t=e.query.ids("page");return es("sessionStateSnapshot",()=>{let n=e.get(rC);if(!n)return null;let r=[...t.get()];return{version:lr,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(t=>{let n=e.get(rE.createId(t)),r=e.get(rc.createId(t));return{pageId:t,camera:{x:r?.x??0,y:r?.y??0,z:r?.z??1},selectedShapeIds:n?.selectedShapeIds??[],focusedGroupId:n?.focusedGroupId??null}})}})}function ls(e,t){let n=function(e){if(!e||"object"!=typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!=typeof e.version)return console.warn("No version in instance state"),null;if(e.version!==lr){var t;(t=e=tS(e)).version,ln.Initial,t.version=lr}try{return li.validate(e)}catch(e){return console.warn(e),null}}(t);if(!n)return;let r=e.schema.types.instance.create({id:rC,...rw(e.get(rC)),currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground}),i=e.allRecords().filter(e=>"instance_page_state"===e.typeName||"camera"===e.typeName);e.atomic(()=>{for(let t of(e.remove(i.map(e=>e.id)),n.pageStates))e.put([rc.create({id:rc.createId(t.pageId),x:t.camera.x,y:t.camera.y,z:t.camera.z}),rE.create({id:rE.createId(t.pageId),pageId:t.pageId,selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId})]);e.put([r]),e.ensureStoreIsUsable()})}function la(e,t){let n={};if("store"in t){let r=e.schema.migrateStoreSnapshot(t);if("success"!==r.type)throw Error("Failed to migrate store snapshot: "+r.reason);n.document={schema:e.schema.serialize(),store:eX(r.value,(t,{typeName:n})=>e.scopedTypes.document.has(n))}}else n=t;let r=rw(e.get(rC));e.atomic(()=>{n.document&&e.loadStoreSnapshot(n.document),r&&e.update(rC,e=>({...e,...r})),n.session&&ls(e,n.session)})}let ll=new em;function lc(e){let t=[],n=new Set;for(let r of e){if(n.has(r.type))throw Error(`Binding type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}function ld({children:e,className:t="",...n}){return(0,m.jsx)("svg",{...n,className:i0("tl-svg-container",t),children:e})}function lu(e,t,n,r){let i=e.x-n.x,o=e.y-n.y,s=r.x-n.x,a=r.y-n.y,l=t.x-e.x,c=t.y-e.y,d=s*o-a*i,u=l*o-c*i,h=a*l-s*c;if(0===d||0===u||0===h)return null;if(0!==h){let t=d/h,n=u/h;if(0<=t&&t<=1&&0<=n&&n<=1)return ot.AddXY(e,t*l,t*c)}return null}function lh(e,t,n,r){let i=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),o=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),s=o*o-4*i*(n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-r*r);if(s<0||0===s)return null;let a=Math.sqrt(s),l=(-o+a)/(2*i),c=(-o-a)/(2*i);if((l<0||l>1)&&(c<0||c>1))return null;let d=[];return(0<=l&&l<=1&&d.push(ot.Lrp(e,t,l)),0<=c&&c<=1&&d.push(ot.Lrp(e,t,c)),0===d.length)?null:d}function lp(e,t,n){let r;let i=[];for(let o=1,s=n.length;o<s+1;o++)(r=lu(e,t,n[o-1],n[o%n.length]))&&i.push(r);return 0===i.length?null:i}function lf(e,t,n){let r;let i=[];for(let o=0,s=n.length;o<s;o++)(r=lh(n[o],n[(o+1)%n.length],e,t))&&i.push(...r);return 0===i.length?null:i}function lg(e,t,n){let r;let i=[];for(let o=1,s=n.length;o<s;o++)(r=lh(n[o-1],n[o],e,t))&&i.push(...r);return 0===i.length?null:i}function lm(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function ly(e,t,n,r){return lm(e,n,r)!==lm(t,n,r)&&lm(e,t,n)!==lm(e,t,r)}function lb(e,t){let n,r;let i=new Map;for(let r=0,o=e.length;r<o;r++)if(ok(n=e[r],t)){let e=lx(n);i.has(e)||i.set(e,n)}for(let r=0,o=t.length;r<o;r++)if(ok(n=t[r],e)){let e=lx(n);i.has(e)||i.set(e,n)}for(let o=0,s=e.length;o<s;o++){n=e[o],r=e[(o+1)%e.length];for(let e=0,o=t.length;e<o;e++){let o=lu(n,r,t[e],t[(e+1)%t.length]);if(null!==o){let e=lx(o);i.has(e)||i.set(e,o)}}}return 0===i.size?null:function(e){let t=ot.Average(e);return e.sort((e,n)=>ot.Angle(t,e)-ot.Angle(t,n))}([...i.values()])}function lx(e){return`${e.x},${e.y}`}function lv(e,t){let n,r;for(let i=0,o=e.length;i<o;i++){n=e[i],r=e[(i+1)%o];for(let e=0,i=t.length;e<i;e++)if(ly(n,r,t[e],t[(e+1)%i]))return!0}return!1}class lw extends sN{start;end;d;u;ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{start:t,end:n}=e;this.start=t,this.end=n,this.d=t.clone().sub(n),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){let{start:t,end:n,u:r,ul:i}=this;if(0===i)return t;let o=ot.Sub(e,t).dpr(r)/i,s=t.x+r.x*o;if(s<Math.min(t.x,n.x))return t.x<n.x?t:n;if(s>Math.max(t.x,n.x))return t.x>n.x?t:n;let a=t.y+r.y*o;return a<Math.min(t.y,n.y)?t.y<n.y?t:n:a>Math.max(t.y,n.y)?t.y>n.y?t:n:new ot(s,a)}hitTestLineSegment(e,t,n=0){return ly(e,t,this.start,this.end)||this.distanceToLineSegment(e,t)<=n}getSvgPathData(e=!0){let{start:t,end:n}=this;return`${e?`M${t.toFixed()}`:""} L${n.toFixed()}`}}class lS extends sN{points;constructor(e){super({isClosed:!1,isFilled:!1,...e});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){let n=e[t],r=e[t+1];this._segments.push(new lw({start:n,end:r}))}this.isClosed&&this._segments.push(new lw({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce((e,t)=>e+t.length,0)}getVertices(){return this.points}nearestPoint(e){let t,n;let{segments:r}=this,i=this.points[0],o=1/0;for(let s=0;s<r.length;s++)t=r[s].nearestPoint(e),(n=ot.Dist2(t,e))<o&&(i=t,o=n);if(!i)throw Error("nearest point not found");return i}hitTestLineSegment(e,t,n=0){let{segments:r}=this;for(let i=0,o=r.length;i<o;i++)if(r[i].hitTestLineSegment(e,t,n))return!0;return!1}getSvgPathData(){let{vertices:e}=this;return e.length<2?"":e.reduce((e,t,n)=>0===n?`M ${t.x} ${t.y}`:`${e} L ${t.x} ${t.y}`,"")}}class lk extends lS{constructor(e){super({...e}),this.isClosed=!0}}class lC extends lk{x;y;w;h;constructor(e){let{x:t=0,y:n=0,width:r,height:i}=e;super({...e,points:[new ot(t,n),new ot(t+r,n),new ot(t+r,n+i),new ot(t,n+i)]}),this.x=t,this.y=n,this.w=r,this.h=i}getBounds(){return new sL(this.x,this.y,this.w,this.h)}getSvgPathData(){let{x:e,y:t,w:n,h:r}=this;return`M${e},${t} h${n} v${r} h-${n}z`}}class lP{constructor(e){this.editor=e}static props;static migrations;static type;canSnap=()=>!0;canScroll=()=>!1;canBind(e){return!0}canEdit=()=>!1;canResize=()=>!0;canEditInReadOnly=()=>!1;canCrop=()=>!1;canBeLaidOut=()=>!0;providesBackgroundForChildren(e){return!1}hideResizeHandles=()=>!1;hideRotateHandle=()=>!1;hideSelectionBoundsBg=()=>!1;hideSelectionBoundsFg=()=>!1;isAspectRatioLocked=()=>!1;canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}onBeforeCreate;onBeforeUpdate;onDragShapesOver;onDragShapesOut;onDropShapesOver;onResizeStart;onResize;onResizeEnd;onTranslateStart;onTranslate;onTranslateEnd;onHandleDrag;onRotateStart;onRotate;onRotateEnd;onBindingChange;onChildrenChange;onDoubleClickHandle;onDoubleClickEdge;onDoubleClick;onClick;onEditEnd}function l_({bounds:e,className:t}){let n=i8(),r=iJ("zoom level",()=>n.getZoomLevel(),[n]);return(0,m.jsx)("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map((e,t)=>{let{strokeDasharray:n,strokeDashoffset:i}=function(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n,c=0,d=0,u=1,h=0,p=0;switch(l){case"dashed":u=1,c=Math.min(t*a,e/4);break;case"dotted":c=t/(u=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=c/2,p+=c/2):"skip"===o&&(e-=c,p-=c),"outset"===s?e+=c/2:"skip"!==s||(e-=c)),d=Math.floor(e/c/(2*u)),(d-=d%i)<3&&"dashed"===l?e/t<5?(c=e,d=1,h=0):(c=.333*e,h=.333*e):(c=e/(d=Math.max(d,3))/(2*u),r?(p=c/2,h=(e-d*c)/d):h=(e-d*c)/Math.max(1,d-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}(e[0].dist(e[1]),1/r,{style:"dashed",lengthRatio:4});return(0,m.jsx)("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:n,strokeDashoffset:i},t)})})}class lI extends lP{static type="group";static props=ib;static migrations=ix;hideSelectionBoundsFg=()=>!0;canBind=()=>!1;getDefaultProps(){return{}}getGeometry(e){let t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new lC({width:1,height:1,isFilled:!1}):new sF({children:t.map(e=>{let t=this.editor.getShape(e),n=this.editor.getShapeGeometry(e),r=this.editor.getShapeLocalTransform(t).applyToPoints(n.vertices);return n.isClosed?new lk({points:r,isFilled:!0}):new lS({points:r})})})}component(e){let t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),r=n.length>0&&n.some(t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group")),i=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(i||r))return null;let o=this.editor.getShapeGeometry(e).bounds;return(0,m.jsx)(ld,{id:e.id,children:(0,m.jsx)(l_,{className:"tl-group",bounds:o})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,m.jsx)(l_,{className:"",bounds:t})}onChildrenChange=e=>{let t=this.editor.getSortedChildIdsForParent(e.id);if(0===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}if(1===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}let lE=[lI],lj=new Set(lE.map(e=>e.type));function lT(e){let t=[...lE],n=new Set;for(let r of e){if(lj.has(r.type))throw Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw Error(`Shape type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}let lM={maxShapesPerPage:4e3,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16};function lA(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw ev(e)}}class lO{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){let t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;let t=new Set;for(let[n,r]of this){if(!lA(r,e.get(n)))return!1;t.add(n)}for(let[n,r]of e)if(!t.has(n)&&!lA(r,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class lL extends lO{set(e,t){this.map.set(e,t)}applyValue(e,t){let n=this.get(e);if(!n){this.set(e,{type:"shared",value:t});return}switch(n.type){case"mixed":return;case"shared":n.value!==t&&this.set(e,{type:"mixed"});return;default:ev(n,"type")}}}function lD(){return`https://cdn.tldraw.com/${i1}`}function lz(e,t,n){if(0===n.length)return[];let r=new Map;for(let t of ep(n.map(t=>e.getShape(t)))){let{parentId:n}=t;r.has(n)||r.set(n,{children:ep(e.getSortedChildIdsForParent(n).map(t=>e.getShape(t))),moving:new Set}),r.get(n).moving.add(t)}let i=[];switch(t){case"toBack":r.forEach(({moving:e,children:t})=>(function(e,t,n){let r,i;let o=t.length;if(e.size!==o){for(let n=0;n<o;n++){let o=t[n];if(e.has(o))r=o.index,e.delete(o);else{i=o.index;break}}if(0===e.size)return;{let t=e7(r,i,e.size);n.push(...Array.from(e.values()).sort(ti).map((e,n)=>({...e,index:t[n]})))}}})(e,t,i));break;case"toFront":r.forEach(({moving:e,children:t})=>(function(e,t,n){let r,i;let o=t.length;if(e.size!==o){for(let n=o-1;n>-1;n--){let o=t[n];if(e.has(o))i=o.index,e.delete(o);else{r=o.index;break}}if(0===e.size)return;{let t=e7(r,i,e.size);n.push(...Array.from(e.values()).sort(ti).map((e,n)=>({...e,index:t[n]})))}}})(e,t,i));break;case"forward":r.forEach(({moving:e,children:t})=>(function(e,t,n){let r=t.length;if(e.size===r)return;let i={name:"skipping"};for(let o=0;o<r;o++){let r=e.has(t[o]);switch(i.name){case"skipping":if(!r)continue;i={name:"selecting",selectIndex:o};break;case"selecting":{if(r)continue;let{selectIndex:e}=i;e7(t[o].index,t[o+1]?.index,o-e).forEach((r,i)=>n.push({...t[e+i],index:r})),i={name:"skipping"}}}}})(e,t,i));break;case"backward":r.forEach(({moving:e,children:t})=>(function(e,t,n){let r=t.length;if(e.size===r)return;let i={name:"skipping"};for(let o=r-1;o>-1;o--){let r=e.has(t[o]);switch(i.name){case"skipping":if(!r)continue;i={name:"selecting",selectIndex:o};break;case"selecting":if(r)continue;e7(t[o-1]?.index,t[o].index,i.selectIndex-o).forEach((e,r)=>{n.push({...t[o+r+1],index:e})}),i={name:"skipping"}}}})(e,t,i))}return i}function lR({editor:e}){let t=e.getSelectedShapes(),n=e.getSelectionRotation(),r=e.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=e;if(!r)return null;let o=r.center.clone().rotWith(r.point,n);return{selectionPageCenter:o,initialCursorAngle:o.angle(i),initialSelectionRotation:n,shapeSnapshots:t.map(t=>({shape:tS(t),initialPagePoint:e.getShapePageTransform(t.id).point()}))}}function lN({delta:e,editor:t,snapshot:n,stage:r}){let{selectionPageCenter:i,shapeSnapshots:o}=n;t.updateShapes(o.map(({shape:n,initialPagePoint:r})=>{let o=nW(n.parentId)?t.getShapePageTransform(n.parentId):sz.Identity(),s=ot.RotWith(r,i,e),a=sz.applyToPoint(sz.Inverse(o),s),l=op(n.rotation+e);return{id:n.id,type:n.type,x:a.x,y:a.y,rotation:l}}));let s=[];o.forEach(({shape:e})=>{let n=t.getShape(e.id);if(!n)return;let i=t.getShapeUtil(e);if("start"===r||"one-off"===r){let t=i.onRotateStart?.(e);t&&s.push(t)}let o=i.onRotate?.(e,n);if(o&&s.push(o),"end"===r||"one-off"===r){let t=i.onRotateEnd?.(e,n);t&&s.push(t)}}),s.length>0&&t.updateShapes(s)}let lF=e=>{let{store:t}=e,n=t.query.filterHistory("binding"),r=t.query.records("binding");function i(){let e=r.get(),t=new Map;for(let n of e){let{fromId:e,toId:r}=n,i=t.get(e);i?i.push(n):t.set(e,[n]);let o=t.get(r);o?o.push(n):t.set(r,[n])}return t}return es("arrowBindingsIndex",(e,t)=>{let r;if(J(e))return i();let o=n.getDiffSince(t);if(o===M)return i();function s(t){let n=(r??=new Map(e)).get(t.fromId),i=n?.filter(e=>e.id!==t.id);i?.length?r.set(t.fromId,i):r.delete(t.fromId);let o=r.get(t.toId),s=o?.filter(e=>e.id!==t.id);s?.length?r.set(t.toId,s):r.delete(t.toId)}function a(t){let n=(r??=new Map(e)).get(t);return n?n===e.get(t)&&(n=n.slice(0),r.set(t,n)):(n=[],r.set(t,n)),n}function l(e){a(e.fromId).push(e),a(e.toId).push(e)}for(let e of o){for(let t of eG(e.added))l(t);for(let[t,n]of eG(e.updated))s(t),l(n);for(let t of eG(e.removed))s(t)}return r??e})},l$=e=>{function t(e){let t=e.getCurrentPageShapeIds(),n=e.getViewportPageBounds(),r=new Set;return t.forEach(t=>{(function(e,t,n){let r=e.getShapeMaskedPageBounds(t);return void 0===r||!n.includes(r)})(e,t,n)&&r.add(t)}),r}return es("getCulledShapes",n=>{if(J(n))return t(e);let r=t(e);if(n.size!==r.size)return r;for(let e of n)if(!r.has(e))return r;return n})},lB=e=>{let t=e.query.ids("shape"),n=e.query.filterHistory("shape");function r(){let n={},r=t.get(),i=Array(r.size);return r.forEach(t=>i.push(e.get(t))),i.sort(ti),i.forEach(e=>{n[e.parentId]||(n[e.parentId]=[]),n[e.parentId].push(e.id)}),n}return es("parentsToChildrenWithIndexes",(t,i)=>{let o;if(J(t))return r();let s=n.getDiffSince(i);if(s===M)return r();if(0===s.length)return t;let a=null,l=e=>{a||(a={...t}),a[e]?a[e]===t[e]&&(a[e]=[...a[e]]):a[e]=[]},c=new Set;for(let e=0,t=s.length;e<t;e++){for(let t of Object.values((o=s[e]).added))nK(t)&&(l(t.parentId),a[t.parentId].push(t.id),c.add(a[t.parentId]));for(let[e,t]of Object.values(o.updated))if(nK(t)&&nK(e)){if(e.parentId!==t.parentId)l(e.parentId),l(t.parentId),a[e.parentId].splice(a[e.parentId].indexOf(t.id),1),a[t.parentId].push(t.id),c.add(a[t.parentId]);else if(e.index!==t.index){l(t.parentId);let e=a[t.parentId].indexOf(t.id);a[t.parentId][e]=t.id,c.add(a[t.parentId])}}for(let e of Object.values(o.removed))nK(e)&&(l(e.parentId),a[e.parentId].splice(a[e.parentId].indexOf(e.id),1))}for(let t of c){let n=ep(t.map(t=>e.get(t)));n.sort(ti),t.splice(0,t.length,...n.map(e=>e.id))}return a??t})},lU=(e,t,n)=>{for(;!rx(n.parentId);){let t=e.get(n.parentId);if(!t)return!1;n=t}return n.parentId===t},lV=(e,t)=>{let n=e.query.ids("shape"),r=null;function i(){let i=t();return r=i,new Set([...n.get()].filter(t=>lU(e,i,e.get(t))))}return es("_shapeIdsInCurrentPage",(n,o)=>{if(J(n))return i();let s=t();if(s!==r)return i();let a=e.history.getDiffSince(o);if(a===M)return i();let l=new tT(n);for(let t of a){for(let n of Object.values(t.added))nK(n)&&lU(e,s,n)&&l.add(n.id);for(let[n,r]of Object.values(t.updated))nK(r)&&(lU(e,s,r)?l.add(r.id):l.remove(r.id));for(let e of Object.keys(t.removed))nW(e)&&l.remove(e)}let c=l.get();return c?et(c.value,c.diff):n})},lH=(0,y.createContext)(null);function lK({context:e,editor:t,children:n}){return(0,m.jsx)(i6.Provider,{value:t,children:(0,m.jsx)(lH.Provider,{value:e,children:n})})}function lW(){let e=(0,y.useContext)(lH);return e?{isDarkMode:e.isDarkMode}:null}async function lG(e,t,n={}){let r="string"==typeof t[0]?t:t.map(e=>e.id);if(0===r.length)return;if(!window.document)throw Error("No document");let{scale:i=1,background:o=!1,padding:s=e.options.defaultSvgPadding,preserveAspectRatio:a=!1}=n,l=n.darkMode??e.user.getIsDarkMode(),c=n0({isDarkMode:l}),d=e.getShapeAndDescendantIds(r),u=e.getUnorderedRenderingShapes(!1).filter(({id:e})=>d.has(e)),h=null;if(n.bounds)h=n.bounds;else for(let{id:t}of u){let n=e.getShapeMaskedPageBounds(t);n&&(h?h.union(n):h=n.clone())}if(!h)return;let p=1===r.length&&e.isShapeOfType(e.getShape(r[0]),"frame")?r[0]:null;p||h.expandBy(s);let f=h.width*i,g=h.height*i;try{document.body.focus?.()}catch(e){}let b=[],x=new Map,v={isDarkMode:l,addExportDef:e=>{if(x.has(e.key))return;let t=(async()=>{let t=await e.getElement();t&&b.push((0,m.jsx)(y.Fragment,{children:t},b.length))})();x.set(e.key,t)}},w=(await Promise.all(u.map(async({id:t,opacity:n,index:r,backgroundIndex:i})=>{if(t===p)return[];let o=e.getShape(t);if(e.isShapeOfType(o,"group"))return[];let s=e.getShapeUtil(o),a=await s.toSvg?.(o,v),l=await s.toBackgroundSvg?.(o,v);if(!a&&!l){let t=e.getShapePageBounds(o);a=(0,m.jsx)("rect",{width:t.w,height:t.h,fill:c.solid,stroke:c.grey.pattern,strokeWidth:1})}let d=e.getShapePageTransform(o).toCssString();"scale"in o.props&&1!==o.props.scale&&(d=`${d} scale(${o.props.scale}, ${o.props.scale})`),a&&(a=(0,m.jsx)("g",{transform:d,opacity:n,children:a},o.id)),l&&(l=(0,m.jsx)("g",{transform:d,opacity:n,children:l},`bg_${o.id}`));let u=e.getShapeMask(o.id);if(u){let e=`mask_${o.id.replace(":","_")}`;b.push((0,m.jsx)("clipPath",{id:e,children:(0,m.jsx)("path",{d:`M${u.map(({x:e,y:t})=>`${e},${t}`).join("L")}Z`})},b.length)),a&&(a=(0,m.jsx)("g",{clipPath:`url(#${e})`,children:a},o.id)),l&&(l=(0,m.jsx)("g",{clipPath:`url(#${e})`,children:l},`bg_${o.id}`))}let h=[];return a&&h.push({zIndex:r,element:a}),l&&h.push({zIndex:i,element:l}),h}))).flat();return await Promise.all(x.values()),{jsx:(0,m.jsx)(lK,{editor:e,context:v,children:(0,m.jsxs)("svg",{preserveAspectRatio:a||void 0,direction:"ltr",width:f,height:g,viewBox:`${h.minX} ${h.minY} ${h.width} ${h.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:o?p?c.solid:c.background:"transparent"},children:[(0,m.jsx)("defs",{children:b}),w.sort((e,t)=>e.zIndex-t.zIndex).map(({element:e})=>e)]})}),width:f,height:g}}class lq{constructor(e){this.editor=e}_clickId="";_clickTimeout;_clickScreenPoint;_previousScreenPoint;_getClickTimeout=(e,t=a$())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}},"idle"===e||"pendingDouble"===e?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)};_clickState="idle";get clickState(){return this._clickState}lastPointerInfo={};handlePointerEvent=e=>{switch(e.name){case"pointer_down":if(!this._clickState)break;switch(this._clickScreenPoint=ot.From(e.point),this._previousScreenPoint&&ot.Dist2(this._previousScreenPoint,this._clickScreenPoint)>1600&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":this._clickState="pendingDouble";break;case"pendingOverflow":this._clickState="overflow"}this._clickTimeout=this._getClickTimeout(this._clickState);break;case"pointer_up":if(!this._clickState)break;switch(this._clickScreenPoint=ot.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}break;case"pointer_move":"idle"!==this._clickState&&this._clickScreenPoint&&ot.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout()}return e};cancelDoubleClickTimeout=()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}class lY{constructor(e){this.editor=e}_isEdgeScrolling=!1;_edgeScrollDuration=-1;updateEdgeScrolling(e){let{editor:t}=this,n=this.getEdgeScroll();if(0===n.x&&0===n.y)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){let e=t.options.edgeScrollEaseDuration>0?oe.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:n.x*e,y:n.y*e})}}getEdgeProximityFactors(e,t,n,r,i){let{editor:o}=this,s=o.options.edgeScrollDistance,a=n?o.options.coarsePointerWidth:0,l=e-a,c=e+a,d=r?0:s,u=i?t:t-s;return l<d?Math.min(1,(d-l)/s):c>u?-Math.min(1,(c-u)/s):0}getEdgeScroll(){let{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:n}}}=e,r=e.getViewportScreenBounds(),{isCoarsePointer:i,insets:[o,s,a,l]}=e.getInstanceState();return{x:this.getEdgeProximityFactors(t,r.w,i,l,s),y:this.getEdgeProximityFactors(n,r.h,i,o,a)}}moveCameraWhenCloseToEdge(e){let{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||0===e.x&&0===e.y)return;let n=t.getViewportScreenBounds(),r=n.w<1e3?.612:1,i=n.h<1e3?.612:1,o=t.getZoomLevel(),s=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,a=s*e.x*r/o,l=s*e.y*i/o,{x:c,y:d,z:u}=t.getCamera();t.setCamera(new ot(c+a,d+l,u))}}class lX{constructor(e){this.editor=e,"undefined"!=typeof window&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}isSafari;isIos;isChromeForIos;isFirefox;isAndroid}class lZ{constructor(e,t){this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(e,t)=>{e.isFocused!==t.isFocused&&(t.isFocused?this.focus():this.blur(),this.updateContainerClass())}),t!==e.getInstanceState().isFocused&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}disposeSideEffectListener;updateContainerClass(){let e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){this.disposeSideEffectListener?.()}}function lQ(e){if(e){let t=l0;for(;e.length;)t=t.push(e.pop());return t}return l0}class lJ{length=0;head=null;tail=this;push(e){return new l1(e,this)}toArray(){return j}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}}let l0=new lJ;class l1{constructor(e,t){this.head=e,this.tail=t,this.length=t.length+1}length;push(e){return new l1(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(!e.length)return{value:void 0,done:!0};{let t=e.head;return e=e.tail,{value:t,done:!1}}}}}}var l2=(e=>(e.Recording="recording",e.RecordingPreserveRedoStack="recordingPreserveRedoStack",e.Paused="paused",e))(l2||{});class l3{store;dispose;state="recording";pendingDiff=new l4;stacks=X("HistoryManager.stacks",{undos:lQ(),redos:lQ()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos});annotateError;constructor(e){this.store=e.store,this.annotateError=e.annotateError??eb,this.dispose=this.store.addHistoryInterceptor((e,t)=>{if("user"===t)switch(this.state){case"recording":this.pendingDiff.apply(e.changes),this.stacks.update(({undos:e})=>({undos:e,redos:lQ()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(e.changes);break;case"paused":break;default:ev(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;let e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:n})=>({undos:t.push({type:"diff",diff:e}),redos:n}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch=(e,t)=>{let n=this.state;"paused"!==n&&t?.history&&(this.state=l5[t.history]);try{if(this._isInBatch)return G(e),this;this._isInBatch=!0;try{G(e)}catch(e){throw this.annotateError(e),e}finally{this._isInBatch=!1}return this}finally{this.state=n}};_undo=({pushToRedoStack:e,toMark:t})=>{let n=this.state;this.state="paused";try{let{undos:n,redos:r}=this.stacks.get(),i=this.pendingDiff.clear(),o=tN(i),s=tR(i);e&&!o&&(r=r.push({type:"diff",diff:i}));let a=!1;if(o)for(;n.head?.type==="stop";){let i=n.head;if(n=n.tail,e&&(r=r.push(i)),i.id===t){a=!0;break}}if(!a)o:for(;n.head;){let i=n.head;switch(n=n.tail,e&&(r=r.push(i)),i.type){case"diff":t$(s,[tR(i.diff)]);break;case"stop":if(!t||i.id===t)break o;break;default:ev(i)}}this.store.applyDiff(s,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:n,redos:r})}finally{this.state=n}return this};undo=()=>(this._undo({pushToRedoStack:!0}),this);redo=()=>{let e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:e,redos:t}=this.stacks.get();if(0===t.length)return this;for(;t.head?.type==="stop";)e=e.push(t.head),t=t.tail;let n=tz();for(;t.head;){let r=t.head;if(e=e.push(r),t=t.tail,"diff"===r.type)t$(n,[r.diff]);else break}this.store.applyDiff(n,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:e,redos:t})}finally{this.state=e}return this};bail=()=>(this._undo({pushToRedoStack:!1}),this);bailToMark=e=>(this._undo({pushToRedoStack:!1,toMark:e}),this);squashToMark=e=>{let t=this.stacks.get().undos,n=[];for(;t.head&&!("stop"===t.head.type&&t.head.id===e);)"diff"===t.head.type&&n.push(t.head.diff),t=t.tail;if(!t.head||t.head?.id!==e)return console.error("Could not find mark to squash to: ",e),this;if(0===n.length)return this;let r=tz();return t$(r,n.reverse()),this.stacks.update(({redos:e})=>({undos:t.push({type:"diff",diff:r}),redos:e})),this};mark=(e=a$())=>(G(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:n})=>({undos:t.push({type:"stop",id:e}),redos:n}))}),e);clear(){this.stacks.set({undos:lQ(),redos:lQ()}),this.pendingDiff.clear()}debug(){let{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}let l5={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class l4{diff=tz();isEmptyAtom=X("PendingDiff.isEmpty",!0);clear(){let e=this.diff;return this.diff=tz(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){t$(this.diff,[e]),this.isEmptyAtom.set(tN(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class l6{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble=(e,t=a$())=>{let n={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,n),n};reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop=e=>{let t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t};addPoint=(e,t,n)=>{let r=this.scribbleItems.get(e);if(!r)throw Error(`Scribble with id ${e} not found`);let{prev:i}=r,o={x:t,y:n,z:.5};return(!i||ot.Dist(i,o)>=1)&&(r.next=o),r};tick=e=>{0!==this.scribbleItems.size&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if("starting"===t.scribble.state){let{next:e,prev:n}=t;e&&e!==n&&(t.prev=e,t.scribble.points.push(e)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);let{delayRemaining:n,timeoutMs:r,prev:i,next:o,scribble:s}=t;switch(s.state){case"active":o&&o!==i?(t.prev=o,s.points.push(o),0===n&&s.points.length>8&&s.points.shift()):0===r&&(s.points.length>1?s.points.shift():t.delayRemaining=s.delay);break;case"stopping":if(0===t.delayRemaining&&0===r){if(1===s.points.length){this.scribbleItems.delete(t.id);return}s.shrink&&(s.size=Math.max(1,s.size*(1-s.shrink))),s.points.shift()}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:e})=>({...e,points:[...e.points]})).slice(-5)})})}}var l8=Object.defineProperty,l9=Object.getOwnPropertyDescriptor,l7=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?l9(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&l8(t,n,o),o};let ce=e=>Math.round(1e8*e)/1e8;function ct(e,t,n,r,i){let o=e.filter(e=>("forward"===r?e.startNode.id===t:e.endNode.id===t)&&ce(e.length)===ce(n)&&ow(e.breadthIntersection[0],e.breadthIntersection[1],i[0],i[1]));if(0===o.length)return[];let s=new Set;return o.forEach(t=>{let a="forward"===r?t.endNode.id:t.startNode.id;if(!s.has(a)){s.add(a);let l=ct(e,a,n,r,ow(t.breadthIntersection[0],t.breadthIntersection[1],i[0],i[1]));o.push(...l)}}),o}class cn{constructor(e){this.manager=e,this.editor=e.editor}editor;getSnapPointsCache(){let{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{let n=e.getShapePageTransform(t.id);if(!n)return;let r=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(n&&r)return r.map((e,r)=>{let{x:i,y:o}=sz.applyToPoint(n,e);return{x:i,y:o,id:`${t.id}:${r}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){let e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),n=[];for(let r of t){let t=e.get(r);t&&n.push(...t)}return n}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:eS(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){var e,t,n,r,i,o;let s,a;let l=[],c=[],d=this.getSnappableGapNodes().sort((e,t)=>e.pageBounds.minX-t.pageBounds.minX);for(let r=0;r<d.length;r++){s=d[r];for(let i=r+1;i<d.length;i++)a=d[i],s.pageBounds.maxX<a.pageBounds.minX&&(e=s.pageBounds.minY,t=s.pageBounds.maxY,n=a.pageBounds.minY,e<a.pageBounds.maxY&&n<t)&&l.push({startNode:s,endNode:a,startEdge:[new ot(s.pageBounds.maxX,s.pageBounds.minY),new ot(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new ot(a.pageBounds.minX,a.pageBounds.minY),new ot(a.pageBounds.minX,a.pageBounds.maxY)],length:a.pageBounds.minX-s.pageBounds.maxX,breadthIntersection:ow(s.pageBounds.minY,s.pageBounds.maxY,a.pageBounds.minY,a.pageBounds.maxY)})}let u=d.sort((e,t)=>e.pageBounds.minY-t.pageBounds.minY);for(let e=0;e<u.length;e++){s=u[e];for(let t=e+1;t<u.length;t++)a=u[t],s.pageBounds.maxY<a.pageBounds.minY&&(r=s.pageBounds.minX,i=s.pageBounds.maxX,o=a.pageBounds.minX,r<a.pageBounds.maxX&&o<i)&&c.push({startNode:s,endNode:a,startEdge:[new ot(s.pageBounds.minX,s.pageBounds.maxY),new ot(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new ot(a.pageBounds.minX,a.pageBounds.minY),new ot(a.pageBounds.maxX,a.pageBounds.minY)],length:a.pageBounds.minY-s.pageBounds.maxY,breadthIntersection:ow(s.pageBounds.minX,s.pageBounds.maxX,a.pageBounds.minX,a.pageBounds.maxX)})}return{horizontal:l,vertical:c}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:n,dragDelta:r}){let i=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),s=t.clone().translate(r),a=n.map(({x:e,y:t},n)=>({id:"selection:"+n,x:e+r.x,y:t+r.y})),l=[],c=[],d=new ot(i,i);this.collectPointSnaps({minOffset:d,nearestSnapsX:l,nearestSnapsY:c,otherNodeSnapPoints:o,selectionSnapPoints:a}),this.collectGapSnaps({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:c,minOffset:d});let u=new ot("x"===e?0:l[0]?.nudge??0,"y"===e?0:c[0]?.nudge??0);d.x=0,d.y=0,l.length=0,c.length=0,a.forEach(e=>{e.x+=u.x,e.y+=u.y}),s.translate(u),this.collectPointSnaps({minOffset:d,nearestSnapsX:l,nearestSnapsY:c,otherNodeSnapPoints:o,selectionSnapPoints:a}),this.collectGapSnaps({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:c,minOffset:d});let h=this.getPointSnapLines({nearestSnapsX:l,nearestSnapsY:c}),p=this.getGapSnapLines({selectionPageBounds:s,nearestSnapsX:l,nearestSnapsY:c});return this.manager.setIndicators([...p,...h]),{nudge:u}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:n,isAspectRatioLocked:r,isResizingFromCenter:i}){var o;let s=this.manager.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=sL.Resize(e,n,i?2*t.x:t.x,i?2*t.y:t.y,r),d=n;l<0&&(d=function(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}(d)),c<0&&(d=function(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}(d)),i&&(a.center=e.center);let u="top"===d||"bottom"===d,h="left"===d||"right"===d,p=cr(d,a),f=this.getSnappablePoints(),g=[],m=[],y=new ot(s,s);this.collectPointSnaps({minOffset:y,nearestSnapsX:g,nearestSnapsY:m,otherNodeSnapPoints:f,selectionSnapPoints:p});let b=new ot(u?0:g[0]?.nudge??0,h?0:m[0]?.nudge??0);if(r&&("top_left"===(o=d)||"top_right"===o||"bottom_right"===o||"bottom_left"===o)&&0!==b.len()){let t=g.length&&m.length?Math.abs(b.x)<Math.abs(b.y)?"x":"y":g.length?"x":"y",n=e.aspectRatio;"x"===t?(m.length=0,b.y=b.x/n,("bottom_left"===d||"top_right"===d)&&(b.y=-b.y)):(g.length=0,b.x=b.y*n,("bottom_left"===d||"top_right"===d)&&(b.x=-b.x))}let x=ot.Add(t,b),{box:v}=sL.Resize(e,n,i?2*x.x:x.x,i?2*x.y:x.y,r);i&&(v.center=e.center);let w=cr("any",v);g.length=0,m.length=0,y.x=0,y.y=0,this.collectPointSnaps({minOffset:y,nearestSnapsX:g,nearestSnapsY:m,otherNodeSnapPoints:f,selectionSnapPoints:w});let S=this.getPointSnapLines({nearestSnapsX:g,nearestSnapsY:m});return this.manager.setIndicators([...S]),{nudge:b}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}){for(let o of e)for(let e of t){let t=ot.Sub(o,e),s=Math.abs(t.x),a=Math.abs(t.y);ce(s)<=ce(n.x)&&(ce(s)<ce(n.x)&&(r.length=0),r.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.x-o.x}),n.x=s),ce(a)<=ce(n.y)&&(ce(a)<ce(n.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.y-o.y}),n.y=a)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:n,nearestSnapsY:r}){var i,o,s,a,l,c,d,u,h;let{horizontal:p,vertical:f}=this.getVisibleGaps();for(let r of p){if(i=r.breadthIntersection[0],o=r.breadthIntersection[1],s=e.minY,!(i<e.maxY)||!(s<o))continue;let a=r.startEdge[0].x+r.length/2-e.center.x;if(r.length>e.width&&ce(Math.abs(a))<=ce(t.x)){ce(Math.abs(a))<ce(t.x)&&(n.length=0),t.x=Math.abs(a);let e={type:"gap_center",gap:r,nudge:a},i=n.find(({type:e})=>"gap_center"===e),o=i&&ow(r.breadthIntersection[0],r.breadthIntersection[1],i.gap.breadthIntersection[0],i.gap.breadthIntersection[1]);i&&i.gap.length>r.length&&o?n[n.indexOf(i)]=e:i&&o||n.push(e)}let l=r.startNode.pageBounds.minX-r.length-e.maxX;ce(Math.abs(l))<=ce(t.x)&&(ce(Math.abs(l))<ce(t.x)&&(n.length=0),t.x=Math.abs(l),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"left",nudge:l}));let c=r.endNode.pageBounds.maxX+r.length-e.minX;ce(Math.abs(c))<=ce(t.x)&&(ce(Math.abs(c))<ce(t.x)&&(n.length=0),t.x=Math.abs(c),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"right",nudge:c}))}for(let n of f){if(a=n.breadthIntersection[0],l=n.breadthIntersection[1],c=e.minX,!(a<e.maxX)||!(c<l))continue;let i=n.startEdge[0].y+n.length/2-e.center.y;if(n.length>e.height&&ce(Math.abs(i))<=ce(t.y)){ce(Math.abs(i))<ce(t.y)&&(r.length=0),t.y=Math.abs(i);let e={type:"gap_center",gap:n,nudge:i},o=r.find(({type:e})=>"gap_center"===e),s=o&&(d=o.gap.breadthIntersection[0],u=o.gap.breadthIntersection[1],h=n.breadthIntersection[0],d<n.breadthIntersection[1]&&h<u);o&&o.gap.length>n.length&&s?r[r.indexOf(o)]=e:o&&s||r.push(e);continue}let o=n.startNode.pageBounds.minY-n.length-e.maxY;ce(Math.abs(o))<=ce(t.y)&&(ce(Math.abs(o))<ce(t.y)&&(r.length=0),t.y=Math.abs(o),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"top",nudge:o}));let s=n.endNode.pageBounds.maxY+n.length-e.minY;ce(Math.abs(s))<=ce(t.y)&&(ce(Math.abs(s))<ce(t.y)&&(r.length=0),t.y=Math.abs(s),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"bottom",nudge:s}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){let n={},r={};if(e.length>0){for(let t of e)if("points"===t.type){let e=ce(t.points.otherPoint.x);n[e]||(n[e]=[]),n[e].push(t.points)}}if(t.length>0){for(let e of t)if("points"===e.type){let t=ce(e.points.otherPoint.y);r[t]||(r[t]=[]),r[t].push(e.points)}}return Object.values(n).concat(Object.values(r)).map(e=>({id:a$(),type:"points",points:eh(e.map(e=>ot.From(e.otherPoint)).concat(e.map(e=>ot.From(e.thisPoint))),(e,t)=>e.equals(t))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:n}){let{vertical:r,horizontal:i}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},s=[];if(t.length>0)for(let n of t){if("points"===n.type)continue;let{gap:{breadthIntersection:t,startEdge:r,startNode:a,endNode:l,length:c,endEdge:d}}=n;switch(n.type){case"gap_center":{let n=(c-e.width)/2,u=ow(t[0],t[1],e.minY,e.maxY);s.push({type:"gaps",direction:"horizontal",id:a$(),gaps:[...ct(i,a.id,n,"backward",u),{startEdge:r,endEdge:o.left},{startEdge:o.right,endEdge:d},...ct(i,l.id,n,"forward",u)]});break}case"gap_duplicate":{let u=ow(t[0],t[1],e.minY,e.maxY);s.push({type:"gaps",direction:"horizontal",id:a$(),gaps:"left"===n.protrusionDirection?[{startEdge:o.right,endEdge:r.map(e=>e.clone().addXY(-a.pageBounds.width,0))},{startEdge:r,endEdge:d},...ct(i,l.id,c,"forward",u)]:[...ct(i,a.id,c,"backward",u),{startEdge:r,endEdge:d},{startEdge:d.map(e=>e.clone().addXY(n.gap.endNode.pageBounds.width,0)),endEdge:o.left}]})}}}if(n.length>0)for(let t of n){if("points"===t.type)continue;let{gap:{breadthIntersection:n,startEdge:i,startNode:a,endNode:l,length:c,endEdge:d}}=t;switch(t.type){case"gap_center":{let l=(c-e.height)/2,u=ow(n[0],n[1],e.minX,e.maxX);s.push({type:"gaps",direction:"vertical",id:a$(),gaps:[...ct(r,a.id,l,"backward",u),{startEdge:i,endEdge:o.top},{startEdge:o.bottom,endEdge:d},...ct(r,t.gap.endNode.id,l,"forward",u)]});break}case"gap_duplicate":{let u=ow(n[0],n[1],e.minX,e.maxX);s.push({type:"gaps",direction:"vertical",id:a$(),gaps:"top"===t.protrusionDirection?[{startEdge:o.bottom,endEdge:i.map(e=>e.clone().addXY(0,-a.pageBounds.height))},{startEdge:i,endEdge:d},...ct(r,l.id,c,"forward",u)]:[...ct(r,a.id,c,"backward",u),{startEdge:i,endEdge:d},{startEdge:d.map(e=>e.clone().addXY(0,l.pageBounds.height)),endEdge:o.top}]})}}}return function(e){e.sort((e,t)=>t.gaps.length-e.gaps.length);for(let t=e.length-1;t>0;t--){let n=e[t];for(let r=t-1;r>=0;r--){let i=e[r];if(i.direction===n.direction&&n.gaps.every(e=>i.gaps.some(t=>ce(e.startEdge[0].x)===ce(t.startEdge[0].x)&&ce(e.startEdge[0].y)===ce(t.startEdge[0].y)&&ce(e.startEdge[1].x)===ce(t.startEdge[1].x)&&ce(e.startEdge[1].y)===ce(t.startEdge[1].y))&&i.gaps.some(t=>ce(e.endEdge[0].x)===ce(t.endEdge[0].x)&&ce(e.endEdge[0].y)===ce(t.endEdge[0].y)&&ce(e.endEdge[1].x)===ce(t.endEdge[1].x)&&ce(e.endEdge[1].y)===ce(t.endEdge[1].y)))){e.splice(t,1);break}}}}(s),s}}function cr(e,t){let{minX:n,maxX:r,minY:i,maxY:o}=t,s=[];switch(e){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(e){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(e){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(e){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return s}l7([es],cn.prototype,"getSnapPointsCache",1),l7([es],cn.prototype,"getSnappablePoints",1),l7([es],cn.prototype,"getSnappableGapNodes",1),l7([es],cn.prototype,"getVisibleGaps",1);var ci=Object.defineProperty,co=Object.getOwnPropertyDescriptor;let cs=()=>null,ca=()=>[];class cl{constructor(e){this.manager=e,this.editor=e.editor}editor;getSnapGeometryCache(){let{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{let n=e.getShapeUtil(t).getHandleSnapGeometry(t);return{outline:void 0===n.outline?e.getShapeGeometry(t):n.outline,points:n.points??[],getSelfSnapOutline:n.getSelfSnapOutline??cs,getSelfSnapPoints:n.getSelfSnapPoints??ca}})}*iterateSnapPointsInPageSpace(e,t){let n=this.getSnapGeometryCache().get(e)?.getSelfSnapPoints(t);if(n&&n.length){let t=eS(this.editor.getShapePageTransform(e));for(let e of n)yield t.applyToPoint(e)}for(let t of this.manager.getSnappableShapes()){if(t===e)continue;let n=this.getSnapGeometryCache().get(t)?.points;if(!n||!n.length)continue;let r=eS(this.editor.getShapePageTransform(t));for(let e of n)yield r.applyToPoint(e)}}*iterateSnapOutlines(e,t){let n=this.getSnapGeometryCache().get(e)?.getSelfSnapOutline(t);for(let t of(n&&(yield{shapeId:e,outline:n}),this.manager.getSnappableShapes())){if(t===e)continue;let n=this.getSnapGeometryCache().get(t)?.outline;n&&(yield{shapeId:t,outline:n})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:n}){let r=this.manager.getSnapThreshold(),i=r,o=null;for(let r of this.iterateSnapPointsInPageSpace(e,t))ot.DistMin(n,r,i)&&(i=ot.Dist(n,r),o=r);if(o)return o;let s=r,a=null;for(let{shapeId:r,outline:i}of this.iterateSnapOutlines(e,t)){let e=eS(this.editor.getShapePageTransform(r)),t=this.editor.getPointInShapeSpace(r,n),o=i.nearestPoint(t),l=e.applyToPoint(o);ot.DistMin(n,l,s)&&(s=ot.Dist(n,l),a=l)}return a||null}snapHandle({currentShapeId:e,handle:t}){let n=eS(this.editor.getShapePageTransform(e)).applyToPoint(t),r=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:n});return r?(this.manager.setIndicators([{id:a$(),type:"points",points:[r]}]),{nudge:ot.Sub(r,n)}):null}}((e,t,n,r)=>{for(var i,o=r>1?void 0:r?co(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&ci(t,n,o)})([es],cl.prototype,"getSnapGeometryCache",1);var cc=Object.defineProperty,cd=Object.getOwnPropertyDescriptor,cu=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?cd(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&cc(t,n,o),o};class ch{constructor(e){this.editor=e,this.shapeBounds=new cn(this),this.handles=new cl(this)}shapeBounds;handles;_snapIndicators=X("snapLines",void 0);getIndicators(){return this._snapIndicators.get()??j}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){let{editor:e}=this,t=e.getViewportPageBounds(),n=e.getSelectedShapeIds(),r=new Set,i=o=>{if(nW(o)){let t=e.getShape(o);t&&e.isShapeOfType(t,"frame")&&r.add(o)}for(let s of e.getSortedChildIdsForParent(o)){if(n.includes(s))continue;let o=e.getShape(s);if(!o||!e.getShapeUtil(o).canSnap(o))continue;let a=e.getShapePageBounds(s);if(a&&t.includes(a)){if(e.isShapeOfType(o,"group")){i(s);continue}r.add(s)}}};return i(this.getCurrentCommonAncestor()??e.getCurrentPageId()),r}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}cu([es],ch.prototype,"getSnapThreshold",1),cu([es],ch.prototype,"getSnappableShapes",1),cu([es],ch.prototype,"getCurrentCommonAncestor",1);let cp=/\r?\n|\r/g;function cf(e){return e.replace(cp,"\n").split("\n").map(e=>e||" ").join("\n")}let cg={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},cm=/\s/;class cy{constructor(e){this.editor=e;let t=this.editor.getContainer(),n=document.createElement("div");n.classList.add("tl-text"),n.classList.add("tl-text-measure"),n.tabIndex=-1,t.appendChild(n),this.baseElm=n,e.disposables.add(()=>{n.remove()})}baseElm;measureText=(e,t)=>{let n=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",n),n.setAttribute("dir","auto"),n.style.setProperty("unicode-bidi","plaintext"),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-style",t.fontStyle),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("font-size",t.fontSize+"px"),n.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),n.style.setProperty("max-width",null===t.maxWidth?null:t.maxWidth+"px"),n.style.setProperty("min-width",null===t.minWidth?null:t.minWidth+"px"),n.style.setProperty("padding",t.padding),n.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),n.textContent=cf(e);let r=n.scrollWidth,i=n.getBoundingClientRect();return n.remove(),{x:0,y:0,w:i.width,h:i.height,scrollWidth:r}};measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){let n=[],r=e.getBoundingClientRect(),i=-r.left,o=-r.top,s=new Range,a=e.childNodes[0],l=0,c=null,d=null,u=0,h=0,p=!1;for(let r of e.childNodes)if(r.nodeType===Node.TEXT_NODE)for(let e of r.textContent??""){s.setStart(a,l),s.setEnd(a,l+e.length);let r=s.getClientRects(),f=r[r.length-1],g=f.top+o,m=f.left+i,y=f.right+i,b=m<h,x=cm.test(e);if(x===d&&g===u&&c)b&&(c.box.x=m),c.box.w=b?c.box.w+f.width:y-c.box.x,c.text+=e;else{if(c){if(t&&g!==u){p=!0;break}n.push(c)}c={box:{x:m,y:g,w:f.width,h:f.height},text:e},h=m}"\n"===e&&(h=0),d=x,u=g,l+=e.length}return c&&n.push(c),{spans:n,didTruncate:p}}measureTextSpans(e,t){if(""===e)return[];let n=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",n);let r=Math.ceil(t.width-2*t.padding);n.setAttribute("dir","auto"),n.style.setProperty("unicode-bidi","plaintext"),n.style.setProperty("width",`${r}px`),n.style.setProperty("height","min-content"),n.style.setProperty("font-size",`${t.fontSize}px`),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),n.style.setProperty("text-align",cg[t.textAlign]);let i="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow;i&&(n.style.setProperty("overflow-wrap","anywhere"),n.style.setProperty("word-break","break-all"));let o=cf(e);n.textContent=o;let{spans:s,didTruncate:a}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:i});if("truncate-ellipsis"===t.overflow&&a){n.textContent="";let e=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width",`${r-e}px`),n.textContent=o;let i=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,s=i[i.length-1];return i.push({text:"",box:{x:Math.min(s.box.x+s.box.w,t.width-t.padding-e),y:s.box.y,w:e,h:s.box.h}}),i}return n.remove(),s}}class cb{constructor(e){this.editor=e,this.editor.disposables.add(this.dispose),this.start()}cancelRaf;isPaused=!0;now=0;start=()=>{this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=tb(this.tick),this.now=Date.now()};tick=()=>{if(this.isPaused)return;let e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=tb(this.tick)};dispose=()=>{this.isPaused=!0,this.cancelRaf?.()};prevPoint=new ot;updatePointerVelocity=e=>{let{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:r}}}=this;if(0===e)return;let i=ot.Sub(n,t);this.prevPoint=n.clone();let o=i.len(),s=o?i.div(o):new ot(0,0),a=r.clone().lrp(s.mul(o/e),.5);.01>Math.abs(a.x)&&(a.x=0),.01>Math.abs(a.y)&&(a.y=0),r.equals(a)||(this.editor.inputs.pointerVelocity=a)}}var cx=Object.defineProperty,cv=Object.getOwnPropertyDescriptor,cw=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?cv(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&cx(t,n,o),o};class cS{constructor(e,t){if(this.user=e,this.inferDarkMode=t,"undefined"==typeof window||!("matchMedia"in window))return;let n=window.matchMedia("(prefers-color-scheme: dark)");n?.matches&&this.systemColorScheme.set("dark"),n?.addEventListener("change",e=>{e.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")})}systemColorScheme=X("systemColorScheme","light");updateUserPreferences=e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})};getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return"dark"===this.systemColorScheme.get();default:return!!this.inferDarkMode&&"dark"===this.systemColorScheme.get()}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??aG.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??aG.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??aG.name}getLocale(){return this.user.userPreferences.get().locale??aG.locale}getColor(){return this.user.userPreferences.get().color??aG.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??aG.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??aG.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??aG.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??aG.isPasteAtCursorMode}}cw([es],cS.prototype,"getUserPreferences",1),cw([es],cS.prototype,"getIsDarkMode",1),cw([es],cS.prototype,"getEdgeScrollSpeed",1),cw([es],cS.prototype,"getAnimationSpeed",1),cw([es],cS.prototype,"getId",1),cw([es],cS.prototype,"getName",1),cw([es],cS.prototype,"getLocale",1),cw([es],cS.prototype,"getColor",1),cw([es],cS.prototype,"getIsSnapMode",1),cw([es],cS.prototype,"getIsWrapMode",1),cw([es],cS.prototype,"getIsDynamicResizeMode",1),cw([es],cS.prototype,"getIsPasteAtCursorMode",1);let ck={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},cC=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class cP{constructor(e,t){this.editor=e;let{id:n,children:r,initial:i,isLockable:o}=this.constructor;this.id=n,this._isActive=X("toolIsActive"+this.id,!1),this._current=X("toolState"+this.id,void 0),this._path=es("toolPath"+this.id,()=>{let e=this.getCurrent();return this.id+(e?`.${e.getPath()}`:"")}),this.parent=t??{},this.parent?r&&i?(this.type="branch",this.initial=i,this.children=Object.fromEntries(r().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",r&&i&&(this.initial=i,this.children=Object.fromEntries(r().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.performanceTracker=new eu}performanceTracker;static id;static initial;static children;static isLockable=!0;id;type;shapeType;initial;children;isLockable;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition=(e,t={})=>{let n=e.split("."),r=this;for(let e=0;e<n.length;e++){let i=n[e],o=r.getCurrent(),s=r.children?.[i];if(!s)throw Error(`${r.id} - no child state exists with the id ${i}.`);if(o?.id!==s.id&&(o?.exit(t,i),r._current.set(s),s.enter(t,o?.id||"initial"),!s.getIsActive()))break;r=s}return this};handleEvent=e=>{let t=ck[e.name],n=this._current.__unsafe__getWithoutCapture();this[t]?.(e),this._isActive.__unsafe__getWithoutCapture()&&n&&n===this._current.__unsafe__getWithoutCapture()&&n.handleEvent(e)};enter=(e,t)=>{if(t_.measurePerformance.get()&&cC.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(e,t),this.children&&this.initial&&this.getIsActive()){let n=this.children[this.initial];this._current.set(n),n.enter(e,t)}};exit=(e,t)=>{t_.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(e,t),this.getIsActive()||this.getCurrent()?.exit(e,t)};_currentToolIdMask=X("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}onWheel;onPointerDown;onPointerMove;onLongPress;onPointerUp;onDoubleClick;onTripleClick;onQuadrupleClick;onRightClick;onMiddleClick;onKeyDown;onKeyUp;onKeyRepeat;onCancel;onComplete;onInterrupt;onTick;onEnter;onExit}class c_ extends cP{static id="root";static initial="";static children=()=>[];onKeyDown=e=>{if("KeyZ"===e.code&&!(e.shiftKey||e.ctrlKey)){let t=this.getCurrent();t&&t.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:t.id})}}}var cI=Object.defineProperty,cE=Object.getOwnPropertyDescriptor,cj=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?cE(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&cI(t,n,o),o};class cT extends a6{constructor({store:e,user:t,shapeUtils:n,bindingUtils:r,tools:i,getContainer:o,cameraOptions:s,initialState:a,autoFocus:l,inferDarkMode:c,options:d}){super(),this.options={...lM,...d},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new l3({store:e,annotateError:e=>{this.annotateError(e,{origin:"history.batch",willCrashApp:!0}),this.crash(e)}}),this.snaps=new ch(this),this.timers=new tx,this.disposables.add(this.timers.dispose.bind(this.timers)),this._cameraOptions.set({...oM,...s}),this.user=new cS(t??a4(),c??!1),this.getContainer=o??(()=>document.body),this.textMeasure=new cy(this),this._tickManager=new cb(this);class u extends c_{static initial=a??""}this.root=new u(this),this.root.children={};let h=lT(n),p={},f={},g=new Map;for(let e of h){let t=new e(this);p[e.type]=t;let n=nq(e.props??{});for(let t of(f[e.type]=n,n.keys()))if(g.has(t.id)){if(g.get(t.id)!==t)throw Error(`Multiple style props with id "${t.id}" in use. Style prop IDs must be unique.`)}else g.set(t.id,t)}this.shapeUtils=p,this.styleProps=f;let m=lc(r),y={};for(let e of m){let t=new e(this);y[e.type]=t}for(let e of(this.bindingUtils=y,[...i])){if(eH(this.root.children,e.id))throw Error(`Can't override tool with id "${e.id}"`);this.root.children[e.id]=new e(this,this.root)}this.environment=new lX(this),this.scribbles=new l6(this);let b=(e,t)=>{let n=null,r=e.selectedShapeIds.filter(e=>!t.has(e));r.length!==e.selectedShapeIds.length&&(n||(n={...e}),n.selectedShapeIds=r);let i=e.erasingShapeIds.filter(e=>!t.has(e));i.length!==e.erasingShapeIds.length&&(n||(n={...e}),n.erasingShapeIds=i),e.hoveredShapeId&&t.has(e.hoveredShapeId)&&(n||(n={...e}),n.hoveredShapeId=null),e.editingShapeId&&t.has(e.editingShapeId)&&(n||(n={...e}),n.editingShapeId=null);let o=e.hintingShapeIds.filter(e=>!t.has(e));return o.length!==e.hintingShapeIds.length&&(n||(n={...e}),n.hintingShapeIds=o),e.focusedGroupId&&t.has(e.focusedGroupId)&&(n||(n={...e}),n.focusedGroupId=null),n};this.sideEffects=this.store.sideEffects;let x=new Map,v=new Set,w=new Set,S=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{for(let e of(v.clear(),w)){w.delete(e);let t=this.getShape(e);if(!t)continue;let n=this.getShapeUtil(t),r=n.onChildrenChange?.(t);r?.length&&this.updateShapes(r)}if(S.size){let e=S;for(let t of(S=new Set,e)){let e=this.getBindingUtil(t);e.onOperationComplete?.()}}if(x.size){let e=x;for(let t of(x=new Map,e.values()))this.getBindingUtil(t.binding).onAfterDelete?.(t)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(e,t)=>{for(let n of this.getBindingsInvolvingShape(t))S.add(n.type),n.fromId===t.id&&this.getBindingUtil(n).onAfterChangeFromShape?.({binding:n,shapeBefore:e,shapeAfter:t}),n.toId===t.id&&this.getBindingUtil(n).onAfterChangeToShape?.({binding:n,shapeBefore:e,shapeAfter:t});if(e.parentId!==t.parentId){let e=e=>{let t=this.getShape(e);if(t)for(let e of this.getBindingsInvolvingShape(t))S.add(e.type),e.fromId===t.id&&this.getBindingUtil(e).onAfterChangeFromShape?.({binding:e,shapeBefore:t,shapeAfter:t}),e.toId===t.id&&this.getBindingUtil(e).onAfterChangeToShape?.({binding:e,shapeBefore:t,shapeAfter:t})};e(t.id),this.visitDescendants(t.id,e)}if(e.parentId!==t.parentId&&rx(t.parentId)){let n=new Set([e.id]);for(let r of(this.visitDescendants(e.id,e=>{n.add(e)}),this.getPageStates())){if(r.pageId===t.parentId)continue;let e=b(r,n);e&&this.store.put([e])}}e.parentId&&nW(e.parentId)&&w.add(e.parentId),t.parentId!==e.parentId&&nW(t.parentId)&&w.add(t.parentId)},beforeDelete:e=>{if(v.has(e.id))return;e.parentId&&nW(e.parentId)&&w.add(e.parentId),v.add(e.id);let t=[];for(let n of this.getBindingsInvolvingShape(e)){S.add(n.type),t.push(n.id);let r=this.getBindingUtil(n);n.fromId===e.id?(r.onBeforeIsolateToShape?.({binding:n,removedShape:e}),r.onBeforeDeleteFromShape?.({binding:n,shape:e})):(r.onBeforeIsolateFromShape?.({binding:n,removedShape:e}),r.onBeforeDeleteToShape?.({binding:n,shape:e}))}t.length&&this.deleteBindings(t);let n=new Set([e.id]),r=ep(this.getPageStates().map(e=>b(e,n)));r.length&&this.store.put(r)}},binding:{beforeCreate:e=>this.getBindingUtil(e).onBeforeCreate?.({binding:e})||e,afterCreate:e=>{S.add(e.type),this.getBindingUtil(e).onAfterCreate?.({binding:e})},beforeChange:(e,t)=>this.getBindingUtil(t).onBeforeChange?.({bindingBefore:e,bindingAfter:t})||t,afterChange:(e,t)=>{S.add(t.type),this.getBindingUtil(t).onAfterChange?.({bindingBefore:e,bindingAfter:t})},beforeDelete:e=>{this.getBindingUtil(e).onBeforeDelete?.({binding:e})},afterDelete:e=>{this.getBindingUtil(e).onAfterDelete?.({binding:e}),S.add(e.type)}},page:{afterCreate:e=>{let t=rc.createId(e.id),n=rE.createId(e.id);this.store.has(t)||this.store.put([rc.create({id:t})]),this.store.has(n)||this.store.put([rE.create({id:n,pageId:e.id})])},afterDelete:(e,t)=>{if(this.getInstanceState()?.currentPageId===e.id){let n=this.getPages().find(t=>t.id!==e.id)?.id;n?this.store.put([{...this.getInstanceState(),currentPageId:n}]):"user"===t&&this.store.ensureStoreIsUsable()}let n=rc.createId(e.id),r=rE.createId(e.id);this.store.remove([n,r])}},instance:{afterChange:(e,t,n)=>{if(!this.store.has(t.currentPageId)){let r=this.store.has(e.currentPageId)?e.currentPageId:this.getPages()[0]?.id;r?this.store.update(t.id,e=>({...e,currentPageId:r})):"user"===n&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(e,t)=>{if(e?.selectedShapeIds!==t?.selectedShapeIds){let e=t.selectedShapeIds.filter(e=>{let n=this.getShape(e)?.parentId;for(;nW(n);){if(t.selectedShapeIds.includes(n))return!1;n=this.getShape(n)?.parentId}return!0}),n=null;if(e.length>0){let t=this.findCommonAncestor(ep(e.map(e=>this.getShape(e))),e=>this.isShapeOfType(e,"group"));t&&(n=t)}else t?.focusedGroupId&&(n=t.focusedGroupId);(e.length!==t.selectedShapeIds.length||n!==t.focusedGroupId)&&this.store.put([{...t,selectedShapeIds:e,focusedGroupId:n??null}])}}}})),this._currentPageShapeIds=lV(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=lB(this.store),this.disposables.add(this.store.listen(e=>{this.emit("change",e)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),a&&void 0===this.root.children[a])throw Error(`No state found for initialState "${a}".`);this.root.enter(void 0,"initial"),this.edgeScrollManager=new lY(this),this.focusManager=new lZ(this,l),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new eu}options;store;root;disposables=new Set;isDisposed=!1;_tickManager;snaps;timers;user;textMeasure;environment;scribbles;sideEffects;edgeScrollManager;focusManager;getContainer;dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}shapeUtils;styleProps;getShapeUtil(e){let t="string"==typeof e?e:e.type,n=eK(this.shapeUtils,t);return ew(n,`No shape util found for type "${t}"`),n}bindingUtils;getBindingUtil(e){let t="string"==typeof e?e:e.type,n=eK(this.bindingUtils,t);return ew(n,`No binding util found for type "${t}"`),n}history;undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return this.history.mark(e),this}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}_shouldIgnoreShapeLock=!1;run(e,t){let n=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=t?.ignoreShapeLock??n;try{this.history.batch(e,t)}finally{this._shouldIgnoreShapeLock=n}return this}batch(e,t){return this.run(e,t)}annotateError(e,{origin:t,willCrashApp:n,tags:r,extras:i}){let o=this.createErrorAnnotations(t,n);return eP(e,{tags:{...o.tags,...r},extras:{...o.extras,...i}}),n&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{let n=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:n?this.getShape(n):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}_crashingError=null;getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){let t=e.split(".").reverse(),n=this.root;for(;t.length>0;){let e=t.pop();if(!e)return!0;let r=n.getCurrent();if(r?.id===e){if(0===t.length)return!0;n=r;continue}break}return!1}isInAny(...e){return e.some(e=>this.isIn(e))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){let e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){let t=e.split(".").reverse(),n=this.root;for(;t.length>0;){let e=t.pop();if(!e)break;let r=n.children?.[e];if(!r)return;n=r}return n}getDocumentSettings(){return this.store.get(rB)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(rC)}updateInstanceState(e,t){return this._updateInstanceState(e,{history:"ignore",...t}),void 0!==e.isChangingStyle&&(clearTimeout(this._isChangingStyleTimeout),!0===e.isChangingStyle&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}_updateInstanceState=(e,t)=>{this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},t)};_isChangingStyleTimeout=-1;getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(e){let t=new Set(this.getOpenMenus());return t.has(e)||(t.add(e),this.updateInstanceState({openMenus:[...t]})),this}deleteOpenMenu(e){let t=new Set(this.getOpenMenus());return t.has(e)&&(t.delete(e),this.updateInstanceState({openMenus:[...t]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}setCursor=e=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this);getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return rE.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState=e=>{this.store.update(e.id??this.getCurrentPageState().id,t=>({...t,...e}))};getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){let{selectedShapeIds:e}=this.getCurrentPageState();return ep(e.map(e=>this.store.get(e)))}setSelectedShapes(e){return this.run(()=>{let t=e.map(e=>"string"==typeof e?e:e.id),{selectedShapeIds:n}=this.getCurrentPageState(),r=new Set(n);if(t.length===r.size&&t.every(e=>r.has(e)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){let t="string"==typeof e?e:e?.id??null,n=this.getShape(t);if(!n)return!1;let r=this.getSelectedShapeIds();return!!this.findShapeAncestor(n,e=>r.includes(e.id))}select(...e){let t="string"==typeof e[0]?e:e.map(e=>e.id);return this.setSelectedShapes(t),this}deselect(...e){let t="string"==typeof e[0]?e:e.map(e=>e.id),n=this.getSelectedShapeIds();return n.length>0&&t.length>0&&this.setSelectedShapes(n.filter(e=>!t.includes(e))),this}selectAll(){let e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0||this.setSelectedShapes(this._getUnlockedShapeIds(e)),this}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){return this.getOnlySelectedShape()?.id??null}getOnlySelectedShape(){let e=this.getSelectedShapes();return 1===e.length?e[0]:null}getSelectionPageBounds(){let e=this.getCurrentPageState().selectedShapeIds;return 0===e.length?null:sL.Common(ep(e.map(e=>this.getShapePageBounds(e))))}getSelectionRotation(){let e=this.getSelectedShapeIds(),t=!1,n=0;for(let r=0,i=e.length;r<i;r++){let i=this.getShapePageTransform(e[r]);if(i){if(t){if(i.rotation()!==n)return 0}else t=!0,n=i.rotation()}}return n}getSelectionRotatedPageBounds(){let e=this.getSelectedShapeIds();if(0===e.length)return;let t=this.getSelectionRotation();if(0===t)return this.getSelectionPageBounds();if(1===e.length){let t=this.getShapeGeometry(e[0]).bounds.clone(),n=this.getShapePageTransform(e[0]);return t.point=n.applyToPoint(t.point),t}let n=sL.FromPoints(this.getSelectedShapeIds().flatMap(e=>{let t=this.getShapePageTransform(e);return t?t.applyToPoints(this.getShapeGeometry(e).bounds.corners):[]}).map(e=>e.rot(-t)));return n.point=n.point.rot(t),n}getSelectionRotatedScreenBounds(){let e=this.getSelectionRotatedPageBounds();if(!e)return;let{x:t,y:n}=this.pageToScreen(e.point),r=this.getZoomLevel();return new sL(t,n,e.width*r,e.height*r)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){let e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){let t="string"==typeof e?e:e?.id??null;if(null!==t){let e=this.getShape(t);if(!e)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(e,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${e.type}`)}return t===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,e=>({...e,focusedGroupId:t}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){let e=this.getFocusedGroup();if(e){let t=this.findShapeAncestor(e,e=>this.isShapeOfType(e,"group"));this.setFocusedGroup(t?.id??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){let e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){let t="string"==typeof e?e:e?.id??null;if(t!==this.getEditingShapeId()){if(t){let e=this.getShape(t);if(e&&this.getShapeUtil(e).canEdit(e))return this.run(()=>{this._updateCurrentPageState({editingShapeId:t})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){let e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){let t="string"==typeof e?e:e?.id??null;return t===this.getHoveredShapeId()||this.run(()=>{this.updateCurrentPageState({hoveredShapeId:t})},{history:"ignore"}),this}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){return ep(this.getHintingShapeIds().map(e=>this.getShape(e)))}setHintingShapes(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:eh(t)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){return ep(this.getErasingShapeIds().map(e=>this.getShape(e)))}setErasingShapes(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);t.sort();let n=this.getErasingShapeIds();return this.run(()=>{if(t.length===n.length){for(let e=0;e<t.length;e++)if(t[e]!==n[e]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){let t="string"==typeof e?e:e?.id??null;return t!==this.getCroppingShapeId()&&this.run(()=>{if(t){let e=this.getShape(t),n=this.getShapeUtil(e);e&&n.canCrop(e)&&this.updateCurrentPageState({croppingShapeId:t})}else this.updateCurrentPageState({croppingShapeId:null})},{history:"ignore"}),this}_unsafe_getCameraId(){return rc.createId(this.getCurrentPageId())}getCamera(){let e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){let t=this.getCameraForFollowing();if(t)return{...e,...t}}return e}getViewportPageBoundsForFollowing(){let e=this.getInstanceState().followingUserId;if(!e)return null;let t=this.getCollaborators().find(t=>t.userId===e);if(!t)return null;let{w:n,h:r}=t.screenBounds,{x:i,y:o,z:s}=t.camera,a=new sL(-i,-o,n/s,r/s),l=this.getViewportScreenBounds().clone(),c=l.width/l.height;return l.width=a.width,l.height=l.width/c,l.height<a.height&&(l.height=a.height,l.width=l.height*c),l.center=a.center,l}getCameraForFollowing(){let e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){let e=this.getCameraOptions();if(!e.constraints||"default"===e.constraints.initialZoom)return 1;let{zx:t,zy:n}=cL(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw ev(e.constraints.initialZoom)}}getBaseZoom(){let e=this.getCameraOptions();if(!e.constraints||"default"===e.constraints.baseZoom)return 1;let{zx:t,zy:n}=cL(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,n);case"fit-max":return Math.min(t,n);case"fit-x":return t;case"fit-y":return n;case"fit-min-100":return Math.min(1,Math.max(t,n));case"fit-max-100":return Math.min(1,Math.min(t,n));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,n);default:throw ev(e.constraints.baseZoom)}}_cameraOptions=X("camera options",oM);getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){let t=tS({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return t.zoomSteps?.length<1&&(t.zoomSteps=[1]),this._cameraOptions.set(t),this}getConstrainedCamera(e,t){let n=this.getCamera(),{x:r,y:i,z:o=n.z}=e;if(!t?.force){let e=this.getCameraOptions(),s=e.zoomSteps[0],a=ef(e.zoomSteps),l=this.getViewportScreenBounds();if(e.constraints){let{constraints:c}=e,d=Math.min(c.padding.y,l.w/2),u=Math.min(c.padding.x,l.h/2),h=sL.From(e.constraints.bounds),p=(l.w-2*u)/h.w,f=(l.h-2*d)/h.h,g=this.getBaseZoom(),m=a*g,y=s*g;if(t?.reset&&(o=this.getInitialZoom()),o<y||o>m){let{x:e,y:t,z:s}=n,a=-e+l.w/s/2,c=-t+l.h/s/2;o=oc(o,y,m);let d=-e+l.w/o/2,u=-t+l.h/o/2;r=e+d-a,i=t+u-c}let b=u/o-h.x,x=d/o-h.y,v=(l.w-2*u)/o-h.w,w=(l.h-2*d)/o-h.h,S=b+v*c.origin.x,k=x+w*c.origin.y,C="string"==typeof c.behavior?c.behavior:c.behavior.x,P="string"==typeof c.behavior?c.behavior:c.behavior.y;if(t?.reset)r=S,i=k;else{switch(C){case"fixed":r=S;break;case"contain":r=o<p?S:oc(r,b+v,b);break;case"inside":r=o<p?oc(r,b,(l.w-u)/o-h.w):oc(r,b+v,b);break;case"outside":r=oc(r,u/o-h.w,(l.w-u)/o);break;case"free":break;default:throw ev(C)}switch(P){case"fixed":i=k;break;case"contain":i=o<f?k:oc(i,x+w,x);break;case"inside":i=o<f?oc(i,x,(l.h-d)/o-h.h):oc(i,x+w,x);break;case"outside":i=oc(i,d/o-h.h,(l.h-d)/o);break;case"free":break;default:throw ev(P)}}}else if(o>a||o<s){let{x:e,y:t,z:c}=n;o=oc(o,s,a),r=e+(-e+l.w/o/2)-(-e+l.w/c/2),i=t+(-t+l.h/o/2)-(-t+l.h/c/2)}}return{x:r,y:i,z:o}}_setCamera(e,t){let n=this.getCamera(),{x:r,y:i,z:o}=this.getConstrainedCamera(e,t);return n.x===r&&n.y===i&&n.z===o||G(()=>{let e={...n,x:r,y:i,z:o};this.run(()=>{this.store.put([e])},{history:"ignore"});let{currentScreenPoint:s,currentPagePoint:a}=this.inputs,{screenBounds:l}=this.store.unsafeGetWithoutCapture(rC);if(s.x/o-r!==a.x||s.y/o-i!==a.y){let e={type:"pointer",target:"canvas",name:"pointer_move",point:ot.AddXY(s,l.x,l.y),pointerId:oO.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1};t?.immediate?this._flushEventForTick(e):this.dispatch(e)}this._tickCameraState()}),this}setCamera(e,t){let{isLocked:n}=this._cameraOptions.__unsafe__getWithoutCapture();if(n&&!t?.force)return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();let r=ot.Cast(e);Number.isFinite(r.x)||(r.x=0),Number.isFinite(r.y)||(r.y=0),void 0!==r.z&&Number.isFinite(r.z)||(e.z=this.getZoomLevel());let i=this.getConstrainedCamera(r,t);if(t?.animation){let{width:e,height:n}=this.getViewportScreenBounds();this._animateToViewport(new sL(-i.x,-i.y,e/i.z,n/i.z),t)}else this._setCamera(i,{...t,force:!0});return this}centerOnPoint(e,t){let{isLocked:n}=this.getCameraOptions();if(n&&!t?.force)return this;let{width:r,height:i}=this.getViewportPageBounds();return this.setCamera(new ot(-(e.x-r/2),-(e.y-i/2),this.getCamera().z),t),this}zoomToFit(e){let t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;let n=sL.Common(ep(t.map(e=>this.getShapePageBounds(e))));return this.zoomToBounds(n,e),this}resetZoom(e=this.getViewportScreenCenter(),t){let{isLocked:n,constraints:r}=this.getCameraOptions();if(n&&!t?.force)return this;let{x:i,y:o,z:s}=this.getCamera(),{x:a,y:l}=e,c=1;if(r){let e=this.getInitialZoom();s!==e&&(c=e)}return this.setCamera(new ot(i+(a/c-a)-(a/s-a),o+(l/c-l)-(l/s-l),c),t),this}zoomIn(e=this.getViewportScreenCenter(),t){let{isLocked:n}=this.getCameraOptions();if(n&&!t?.force)return this;let{x:r,y:i,z:o}=this.getCamera(),{zoomSteps:s}=this.getCameraOptions();if(null!==s&&s.length>1){let n=this.getBaseZoom(),a=ef(s)*n;for(let e=1;e<s.length;e++){let t=s[e-1]*n,r=s[e]*n;if(!(r-o<=(r-t)/2)){a=r;break}}this.setCamera(new ot(r+(e.x/a-e.x)-(e.x/o-e.x),i+(e.y/a-e.y)-(e.y/o-e.y),a),t)}return this}zoomOut(e=this.getViewportScreenCenter(),t){let{isLocked:n}=this.getCameraOptions();if(n&&!t?.force)return this;let{zoomSteps:r}=this.getCameraOptions();if(null!==r&&r.length>1){let n=this.getBaseZoom(),{x:i,y:o,z:s}=this.getCamera(),a=r[0]*n;for(let e=r.length-1;e>0;e--){let t=r[e-1]*n,i=r[e]*n;if(!(i-s>=(i-t)/2)){a=t;break}}this.setCamera(new ot(i+(e.x/a-e.x)-(e.x/s-e.x),o+(e.y/a-e.y)-(e.y/s-e.y),a),t)}return this}zoomToSelection(e){let{isLocked:t}=this.getCameraOptions();if(t&&!e?.force)return this;let n=this.getSelectionPageBounds();return n&&this.zoomToBounds(n,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,t){let n=this._cameraOptions.__unsafe__getWithoutCapture();if(n.isLocked&&!t?.force)return this;let r=this.getViewportScreenBounds(),i=t?.inset??Math.min(128,.28*r.width),o=this.getBaseZoom(),s=n.zoomSteps[0],a=ef(n.zoomSteps),l=oc(Math.min((r.width-i)/e.w,(r.height-i)/e.h),s*o,a*o);return t?.targetZoom!==void 0&&(l=Math.min(t.targetZoom,l)),this.setCamera(new ot(-e.x+(r.width-e.w*l)/2/l,-e.y+(r.height-e.h*l)/2/l,l),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_viewportAnimation=null;_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;let{elapsed:t,easing:n,duration:r,start:i,end:o}=this._viewportAnimation;if(t>r){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new ot(-o.x,-o.y,this.getViewportScreenBounds().width/o.width));return}let s=n(1-(r-t)/r),a=i.minX+(o.minX-i.minX)*s,l=i.minY+(o.minY-i.minY)*s,c=i.maxX+(o.maxX-i.maxX)*s;this._setCamera(new ot(-a,-l,this.getViewportScreenBounds().width/(c-a)),{force:!0})}_animateToViewport(e,t={animation:oA}){let{animation:n,...r}=t;if(!n)return;let{duration:i=0,easing:o=oe.easeInOutCubic}=n,s=this.user.getAnimationSpeed(),a=this.getViewportPageBounds();return(this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),0===i||0===s)?this._setCamera(new ot(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...r}):(this._viewportAnimation={elapsed:0,duration:i/s,easing:o,start:a.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){let{isLocked:t}=this.getCameraOptions();if(t&&!e?.force||0===this.user.getAnimationSpeed())return this;this.stopCameraAnimation();let{speed:n,friction:r=this.options.cameraSlideFriction,direction:i,speedThreshold:o=.01}=e,s=Math.min(n,1),a=()=>{this.off("tick",l),this.off("stop-camera-animation",a)};this.once("stop-camera-animation",a);let l=e=>{let{x:t,y:n,z:l}=this.getCamera(),c=ot.Mul(i,s*e/l);(s*=1-r)<o?a():this._setCamera(new ot(t+c.x,n+c.y,l))};return this.on("tick",l),this}zoomToUser(e,t={animation:{duration:500}}){let n=this.getCollaborators().find(t=>t.userId===e);return n&&this.run(()=>{null!==this.getInstanceState().followingUserId&&this.stopFollowingUser();let r=n.currentPageId===this.getCurrentPageId();r||this.setCurrentPage(n.currentPageId),t&&t.animation&&!r&&(t.animation=void 0),this.centerOnPoint(n.cursor,t);let{highlightedUserIds:i}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...i,e]}),this.timers.setTimeout(()=>{let t=[...this.getInstanceState().highlightedUserIds],n=t.indexOf(e);n<0||(t.splice(n,1),this.updateInstanceState({highlightedUserIds:t}))},this.options.collaboratorIdleTimeoutMs)}),this}_willSetInitialBounds=!0;updateViewportScreenBounds(e,t=!1){e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);let n=[0!==e.minY,!ou(document.body.scrollWidth,e.maxX,1),!ou(document.body.scrollHeight,e.maxY,1),0!==e.minX],{screenBounds:r,insets:i}=this.getInstanceState();if(e.equals(r)&&n.every((e,t)=>e===i[t]))return this;let{_willSetInitialBounds:o}=this;if(this._willSetInitialBounds=!1,o)this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){let t=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this.centerOnPoint(t)}else this.updateInstanceState({screenBounds:e.toJson(),insets:n}),this._setCamera(ot.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){let{x:e,y:t,w:n,h:r}=this.getInstanceState().screenBounds;return new sL(e,t,n,r)}getViewportScreenCenter(){let e=this.getViewportScreenBounds();return new ot(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){let{w:e,h:t}=this.getViewportScreenBounds(),{x:n,y:r,z:i}=this.getCamera();return new sL(-n,-r,e/i,t/i)}screenToPage(e){let{screenBounds:t}=this.store.unsafeGetWithoutCapture(rC),{x:n,y:r,z:i=1}=this.getCamera();return new ot((e.x-t.x)/i-n,(e.y-t.y)/i-r,e.z??.5)}pageToScreen(e){let{screenBounds:t}=this.store.unsafeGetWithoutCapture(rC),{x:n,y:r,z:i=1}=this.getCamera();return new ot((e.x+n)*i+t.x,(e.y+r)*i+t.y,e.z??.5)}pageToViewport(e){let{x:t,y:n,z:r=1}=this.getCamera();return new ot((e.x+t)*r,(e.y+n)*r,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){let e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(e=>e.userId))].sort().map(t=>e.filter(e=>e.userId===t).sort((e,t)=>t.lastActivityTimestamp-e.lastActivityTimestamp)[0]):j}getCollaboratorsOnCurrentPage(){let e=this.getCurrentPageId();return this.getCollaborators().filter(t=>t.currentPageId===e)}_isLockedOnFollowingUser=X("isLockedOnFollowingUser",!1);startFollowingUser(e){this.stopFollowingUser();let t=this._getCollaboratorsQuery().get().filter(t=>t.userId===e);if(!t.length)return console.warn("User not found"),this;let n=this.user.getId();if(n||console.warn("You should set the userId for the current instance before following a user"),t.some(e=>e.followingUserId===n))return this;let r=es("latestLeaderPresence",()=>this.getCollaborators().find(t=>t.userId===e));return G(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});let t=B("update current page",()=>{let e=r.get();if(!e){this.stopFollowingUser();return}e.currentPageId!==this.getCurrentPageId()&&this.getPage(e.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:e.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),n=()=>{t(),this._isLockedOnFollowingUser.set(!1),this.off("frame",i),this.off("stop-following",n)},i=()=>{var e,t,n,i;if(!r.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;let o=this.user.getAnimationSpeed();if(0===o){this._isLockedOnFollowingUser.set(!0);return}let s=this.getViewportPageBoundsForFollowing();if(!s){this.stopFollowingUser();return}let a=this.getViewportPageBounds(),l=Math.abs(s.minX-a.minX)+Math.abs(s.maxX-a.maxX),c=Math.abs(s.minY-a.minY)+Math.abs(s.maxY-a.maxY);if(l<this.options.followChaseViewportSnap&&c<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}let d=oc(.5*o,.1,.8),u=new sL((e=a.minX)+(s.minX-e)*d,(t=a.minY)+(s.minY-t)*d,(n=a.width)+(s.width-n)*d,(i=a.height)+(s.height-i)*d),h=new ot(-u.x,-u.y,this.getViewportScreenBounds().width/u.width);this.stopCameraAnimation(),this._setCamera(h)};this.once("stop-following",n),this.addListener("frame",i),i()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){let t=[],n=2*this.options.maxShapesPerPage,r=this.options.maxShapesPerPage,i=this.getErasingShapeIds(),o=(s,a,l)=>{let c=this.getShape(s);if(!c)return;a*=c.opacity;let d=!1,u=this.getShapeUtil(c);e&&(d=!l&&i.includes(s))&&(a*=.32),t.push({id:s,shape:c,util:u,index:n,backgroundIndex:r,opacity:a}),n+=1,r+=1;let h=this.getSortedChildIdsForParent(s);if(!h.length)return;let p=null;for(let e of(u.providesBackgroundForChildren(c)&&(p=r,r=n,n+=this.options.maxShapesPerPage),h))o(e,a,l||d);null!==p&&(r=p)};for(let t of e?[this.getCurrentPage()]:this.getPages())for(let e of this.getSortedChildIdsForParent(t.id))o(e,1,!1);return t}_cameraState=X("camera state","idle");_cameraStateTimeoutRemaining=0;_decayCameraStateTimeout=e=>{this._cameraStateTimeoutRemaining-=e,this._cameraStateTimeoutRemaining>0||(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))};_tickCameraState=()=>{this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,"idle"===this._cameraState.__unsafe__getWithoutCapture()&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))};getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(to)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(ti)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get("string"==typeof e?e:e.id)}_currentPageShapeIds;getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){let t="string"==typeof e?e:e.id,n=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(n.map(e=>e.id))}setCurrentPage(e){let t="string"==typeof e?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:t}])},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getInstanceState().isReadonly||!this.getPage(e.id)?this:this.run(()=>this.store.update(e.id,t=>({...t,...e})))}createPage(e){return this.run(()=>{if(this.getInstanceState().isReadonly||this.getPages().length>=this.options.maxPages)return;let t=this.getPages(),n=function(e,t){let n=e,r=new Set(t);for(;r.has(n);)n=/^.*(\d+)$/.exec(n)?.[1]?n.replace(/(\d+)(?=\D?)$/,e=>(+e+1).toString()):`${n} 1`;return n}(e.name??"Page 1",t.map(e=>e.name)),r=e.index;(!r||t.some(e=>e.index===r))&&(r=tn(t[t.length-1].index));let i=rb.create({meta:{},...e,name:n,index:r});this.store.put([i])}),this}deletePage(e){let t="string"==typeof e?e:e.id;return this.run(()=>{if(this.getInstanceState().isReadonly)return;let e=this.getPages();if(1===e.length)return;let n=this.getPage(t);if(n){if(t===this.getCurrentPageId()){let n=e.findIndex(e=>e.id===t),r=e[n-1]??e[n+1];this.setCurrentPage(r.id)}this.store.remove([n.id])}}),this}duplicatePage(e,t=rb.createId()){if(this.getPages().length>=this.options.maxPages)return this;let n="string"==typeof e?e:e.id,r=this.getPage(n);if(!r)return this;let i={...this.getCamera()},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(r.id));return this.run(()=>{let e=this.getPages(),n=tt(r.index,e[e.indexOf(r)+1]?.index);if(this.createPage({name:r.name+" Copy",id:t,index:n}),this.setCurrentPage(t),this.setCamera(i),o)return this.putContentOntoCurrentPage(o)}),this}renamePage(e,t){let n="string"==typeof e?e:e.id;return this.getInstanceState().isReadonly||this.updatePage({id:n,name:t}),this}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getInstanceState().isReadonly||e.length<=0||this.run(()=>this.store.put(e),{history:"ignore"}),this}updateAssets(e){return this.getInstanceState().isReadonly||e.length<=0||this.run(()=>{this.store.put(e.map(e=>({...this.store.get(e.id),...e})))},{history:"ignore"}),this}deleteAssets(e){if(this.getInstanceState().isReadonly)return this;let t="string"==typeof e[0]?e:e.map(e=>e.id);return t.length<=0||this.run(()=>this.store.remove(t),{history:"ignore"}),this}getAsset(e){return this.store.get("string"==typeof e?e:e.id)}async resolveAssetUrl(e,t){if(!e)return null;let n=this.getAsset(e);if(!n)return null;let{screenScale:r=1,shouldResolveToOriginal:i=!1}=t,o=Math.max(.125,Math.pow(2,Math.ceil(Math.log2(r)))),s="connection"in navigator?navigator.connection.effectiveType:null,a=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(n,{screenScale:r||1,steppedScreenScale:o,dpr:a,networkEffectiveType:s,shouldResolveToOriginal:i})}async uploadAsset(e,t){return await this.store.props.assets.upload(e,t)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,t)=>e.props===t.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get("string"==typeof e?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>this.getShapeUtil(e).getHandles?.(e))}getShapeHandles(e){return this._getShapeHandlesCache().get("string"==typeof e?e:e.id)}getShapeLocalTransform(e){let t="string"==typeof e?e:e.id,n=this.getShape(t);if(!n)throw Error("Editor.getTransform: shape not found");return sz.Identity().translate(n.x,n.y).rotate(n.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(rx(e.parentId))return this.getShapeLocalTransform(e);let t=this._getShapePageTransformCache().get(e.parentId)??sz.Identity();return sz.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){let t="string"==typeof e?e:e.id,n=this.getShape(t);return!n||rx(n.parentId)?sz.Identity():this._getShapePageTransformCache().get(n.parentId)??sz.Identity()}getShapePageTransform(e){let t="string"==typeof e?e:e.id;return this._getShapePageTransformCache().get(t)??sz.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{let t=this._getShapePageTransformCache().get(e.id);return t?sL.FromPoints(sz.applyToPoints(t,this.getShapeGeometry(e).vertices)):new sL})}getShapePageBounds(e){return this._getShapePageBoundsCache().get("string"==typeof e?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{let t=this._getShapeMaskCache().get(e.id);if(!t)return;if(0===t.length)return"polygon(0px 0px, 0px 0px, 0px 0px)";let n=this._getShapePageTransformCache().get(e.id);if(!n)return;let r=sz.applyToPoints(sz.Inverse(n),t);return`polygon(${r.map(e=>`${e.x}px ${e.y}px`).join(",")})`})}getShapeClipPath(e){return this._getShapeClipPathCache().get("string"==typeof e?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(rx(e.parentId))return;let t=this.getShapeAncestors(e.id).filter(e=>this.isShapeOfType(e,"frame"));if(0!==t.length)return t.map(e=>this._getShapePageTransformCache().get(e.id).applyToPoints(this.getShapeGeometry(e).vertices)).reduce((e,t)=>{if(!(t&&e))return;let n=lb(e,t);return n?n.map(ot.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get("string"==typeof e?e:e.id)}getShapeMaskedPageBounds(e){return"string"!=typeof e&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{let t=this._getShapePageBoundsCache().get(e.id);if(!t)return;let n=this._getShapeMaskCache().get(e.id);if(n){if(0===n.length)return;let{corners:e}=t;if(e.every((e,t)=>e&&ot.Equals(e,n[t])))return t.clone();let r=lb(n,e);if(!r)return;return sL.FromPoints(r)}return t})}getShapeAncestors(e,t=[]){let n="string"==typeof e?e:e.id,r=this.getShape(n);if(!r)return t;let i=r.parentId;if(rx(i))return t.reverse(),t;let o=this.store.get(i);return o?(t.push(o),this.getShapeAncestors(o,t)):t}findShapeAncestor(e,t){let n="string"==typeof e?e:e.id,r=this.getShape(n);if(!r)return;let i=r.parentId;if(rx(i))return;let o=this.getShape(i);if(o)return t(o)?o:this.findShapeAncestor(o,t)}hasAncestor(e,t){let n="string"==typeof e?e:e?.id,r=n&&this.getShape(n);return!!r&&(r.parentId===t||this.hasAncestor(this.getShapeParent(r),t))}findCommonAncestor(e,t){if(0===e.length)return;let n=ep(("string"==typeof e[0]?e:e.map(e=>e.id)).map(e=>this.getShape(e)));if(1===n.length){let e=n[0].parentId;if(rx(e))return;return t?this.findShapeAncestor(n[0],t)?.id:e}let[r,...i]=n,o=this.getShapeParent(r);for(;o;){if(t&&!t(o)){o=this.getShapeParent(o);continue}if(i.every(e=>this.hasAncestor(e,o.id)))return o.id;o=this.getShapeParent(o)}}isShapeOrAncestorLocked(e){let t="string"==typeof e?this.getShape(e):e;return void 0!==t&&(!!t.isLocked||this.isShapeOrAncestorLocked(this.getShapeParent(t)))}_notVisibleShapes(){return l$(this)}getCulledShapes(){let e=this._notVisibleShapes().get(),t=this.getSelectedShapeIds(),n=this.getEditingShapeId(),r=new Set(e);return n&&r.delete(n),t.forEach(e=>{r.delete(e)}),r}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(t=>{let n=this.getShapeMaskedPageBounds(t);n&&(e=e?e.expand(n):n.clone())}),e}getSelectedShapeAtPoint(e){let t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(e=>"group"!==e.type&&t.includes(e.id)).reverse().find(t=>this.isPointInShape(t,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){let n=this.getZoomLevel(),r=this.getViewportPageBounds(),{filter:i,margin:o=0,hitLocked:s=!1,hitLabels:a=!1,hitInside:l=!1,hitFrameInside:c=!1}=t,d=1/0,u=null,h=1/0,p=null,f=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(t=>{if(t.isLocked&&!s||this.isShapeOfType(t,"group"))return!1;let n=this.getShapeMask(t);return(!n||!!ok(e,n))&&(!i||i(t))});for(let t=f.length-1;t>=0;t--){let i;let s=f[t],g=this.getShapeGeometry(s),m=g instanceof sF,y=this.getPointInShapeSpace(s,e);if((this.isShapeOfType(s,"arrow")||this.isShapeOfType(s,"geo")&&"none"===s.props.fill)&&s.props.text.trim()){for(let e of g.children)if(e.isLabel&&e.isPointInBounds(y))return s}if(this.isShapeOfType(s,"frame")){if(Math.abs(g.distanceToPoint(y,l))<=o)return p||s;if(g.hitTestPoint(y,0,!0))return p||u||(c?s:void 0);continue}if(m){let e=1/0;for(let t of g.children){if(t.isLabel&&!a)continue;let n=t.distanceToPoint(y,l);n<e&&(e=n)}i=e}else i=0===o&&(g.bounds.w<1||g.bounds.h<1)?g.distanceToPoint(y,l):g.bounds.containsPoint(y,o)?g.distanceToPoint(y,l):1/0;if(g.isClosed){if(i<=o){if(g.isFilled||m&&g.children[0].isFilled)return p||s;if(this.getShapePageBounds(s).contains(r))continue;if(Math.abs(i)<o)Math.abs(i)<h&&(h=Math.abs(i),p=s);else if(!p){let{area:e}=g;e<d&&(d=e,u=s)}}}else if(i<this.options.hitTestMargin/n)return s}return p||u||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapes().filter(n=>this.isPointInShape(n,e,t))}isPointInShape(e,t,n={}){let{hitInside:r=!1,margin:i=0}=n,o="string"==typeof e?e:e.id,s=this.getShapeMask(o);return(!s||!!ok(t,s))&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,t),i,r)}getPointInShapeSpace(e,t){let n="string"==typeof e?e:e.id;return this._getShapePageTransformCache().get(n).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){let n="string"==typeof e?e:e.id,r=this.getShape(n);if(!r)return new ot(0,0);if(rx(r.parentId))return ot.From(t);let i=this.getShapePageTransform(r.parentId);return i?i.clone().invert().applyToPoint(t):ot.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){let e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let n=0,r=t.length;n<r;n++)(function e(t,n,r){let i=t.getShape(n);if(!i)return;r.push(i);let o=t.getSortedChildIdsForParent(n);for(let n=0,i=o.length;n<i;n++)e(t,o[n],r)})(this,t[n],e);return e}getCurrentPageRenderingShapesSorted(){let e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:t})=>!e.has(t))}isShapeOfType(e,t){let n="string"==typeof e?this.getShape(e):e;return!!n&&n.type===t}getShape(e){let t="string"==typeof e?e:e.id;if(nW(t))return this.store.get(t)}getShapeParent(e){let t="string"==typeof e?e:e?.id;if(!t)return;let n=this.getShape(t);if(void 0!==n&&nW(n.parentId))return this.store.get(n.parentId)}getShapeNearestSibling(e,t){return t?t.parentId===e.parentId?t:this.findShapeAncestor(t,t=>t.parentId===e.parentId):void 0}isShapeInPage(e,t=this.getCurrentPageId()){let n="string"==typeof e?e:e.id,r=this.getShape(n);if(!r)return!1;let i=!1;if(r.parentId===t)i=!0;else{let e=this.getShape(r.parentId);for(;e;){if(e.parentId===t){i=!0;break}e=this.getShape(e.parentId)}}return i}getAncestorPageId(e){let t="string"==typeof e?e:e?.id,n=t&&this.getShape(t);if(n)return rx(n.parentId)?n.parentId:this.getAncestorPageId(this.getShape(n.parentId))}_parentIdsToChildIds;reparentShapes(e,t,n){let r="string"==typeof e[0]?e:e.map(e=>e.id);if(0===r.length)return this;let i=[],o=rx(t)?sz.Identity():this.getShapePageTransform(t),s=o.rotation(),a=[],l=ep(this.getSortedChildIdsForParent(t).map(e=>this.getShape(e)));if(n){let e=l.find(e=>e.index===n);if(e){let t=l[l.indexOf(e)+1];a=t?e7(n,t.index,r.length):te(n,r.length)}else{let e=l.sort(ti).find(e=>e.index>n);a=e?e7(n,e.index,r.length):te(n,r.length)}}else{let e=l.length&&l[l.length-1];a=e?te(e.index,r.length):tr(r.length)}let c=o.clone().invert(),d=ep(r.map(e=>this.getShape(e)));return this.run(()=>{for(let e=0;e<d.length;e++){let n=d[e],r=this.getShapePageTransform(n);if(!r)continue;let o=r.point();if(!o)continue;let l=c.applyToPoint(o),u=r.rotation()-s;i.push({id:n.id,type:n.type,parentId:t,x:l.x,y:l.y,rotation:u,index:a[e]})}this.updateShapes(i)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){let t="string"==typeof e?e:e.id,n=this._parentIdsToChildIds.get()[t];return n&&0!==n.length?tn(this.getShape(n[n.length-1]).index):"a1"}getSortedChildIdsForParent(e){let t="string"==typeof e?e:e.id;return this._parentIdsToChildIds.get()[t]||j}visitDescendants(e,t){let n="string"==typeof e?e:e.id;for(let e of this.getSortedChildIdsForParent(n))!1!==t(e)&&this.visitDescendants(e,t);return this}getShapeAndDescendantIds(e){let t=new Set;for(let n of e.map(e=>this.getShape(e)).sort(ti))t.add(n.id),this.visitDescendants(n,e=>{t.add(e)});return t}getDroppingOverShape(e,t=[]){let n=this.getCurrentPageShapesSorted();for(let r=n.length-1;r>=0;r--){let i=n[r];if(this.getSelectedShapeIds().includes(i.id)||!this.getShapeUtil(i).canDropShapes(i,t)||t.find(e=>e.id===i.id||this.hasAncestor(i,e.id)))continue;let o=this.getShapeMaskedPageBounds(i.id);if(o&&o.containsPoint(e)&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(i,e),0,!0))return i}}getOutermostSelectableShape(e,t){let n="string"==typeof e?e:e.id,r=this.getShape(n),i=r,o=r,s=this.getFocusedGroup();for(;o;){if(this.isShapeOfType(o,"group")&&s?.id!==o.id&&!this.hasAncestor(s,o.id)&&(t?.(o)??!0))i=o;else if(s?.id===o.id)break;o=this.getShapeParent(o)}return i}_getBindingsIndexCache(){let e=lF(this);return this.store.createComputedCache("bindingsIndex",t=>e.get().get(t.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){let n="string"==typeof e?e:e.id;return this.getBindingsInvolvingShape(n).filter(e=>e.fromId===n&&e.type===t)}getBindingsToShape(e,t){let n="string"==typeof e?e:e.id;return this.getBindingsInvolvingShape(n).filter(e=>e.toId===n&&e.type===t)}getBindingsInvolvingShape(e,t){let n="string"==typeof e?e:e.id,r=this._getBindingsIndexCache().get(n)??j;return t?r.filter(e=>e.type===t):r}createBindings(e){let t=[];for(let n of e){let e=this.getShape(n.fromId),r=this.getShape(n.toId);if(!e||!r||!this.canBindShapes({fromShape:e,toShape:r,binding:n}))continue;let i=this.getBindingUtil(n.type).getDefaultProps(),o=this.store.schema.types.binding.create({...n,id:n.id??n$(),props:{...i,...n.props}});t.push(o)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){let t=[];for(let n of e){if(!n)continue;let e=this.getBinding(n.id);if(!e)continue;let r=cA(e,n);if(r===e)continue;let i=this.getShape(r.fromId),o=this.getShape(r.toId);i&&o&&this.canBindShapes({fromShape:i,toShape:o,binding:r})&&t.push(r)}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:t=!1}={}){let n=e.map(e=>"string"==typeof e?e:e.id);return t?this.store.atomic(()=>{for(let e of n){let t=this.getBinding(e);if(!t)continue;let n=this.getBindingUtil(t);n.onBeforeIsolateFromShape?.({binding:t,removedShape:this.getShape(t.toId)}),n.onBeforeIsolateToShape?.({binding:t,removedShape:this.getShape(t.fromId)}),this.store.remove([e])}}):this.store.remove(n),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes({fromShape:e,toShape:t,binding:n}){let r="string"==typeof e?e:e.type,i="string"==typeof t?t:t.type,o={fromShapeType:r,toShapeType:i,bindingType:"string"==typeof n?n:n.type};return r===i?this.getShapeUtil(r).canBind(o):this.getShapeUtil(r).canBind(o)&&this.getShapeUtil(i).canBind(o)}rotateShapesBy(e,t){if(("string"==typeof e[0]?e:e.map(e=>e.id)).length<=0)return this;let n=lR({editor:this});return n&&lN({delta:t,snapshot:n,editor:this,stage:"one-off"}),this}getChangesToTranslateShape(e,t){let n=e,r=this.getShapeUtil(e);return n=cA(n,r.onTranslateStart?.(n)??void 0),n=cA(n,{id:e.id,type:e.type,x:t.x,y:t.y}),n=cA(n,r.onTranslate?.(e,n)??void 0),n=cA(n,r.onTranslateEnd?.(e,n)??void 0)}nudgeShapes(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(n.length<=0)return this;let r=[];for(let e of n){let n=this.getShape(e),i=ot.From(t),o=this.getShapeParentTransform(n);o&&i.rot(-o.rotation()),r.push(this.getChangesToTranslateShape(n,i.add(n)))}return this.updateShapes(r),this}duplicateShapes(e,t){return this.run(()=>{let n="string"==typeof e[0]?e:e.map(e=>e.id);if(n.length<=0)return this;let r=new Set(n),i=this.getShapeAndDescendantIds(n),o=[...i].reverse(),s=new Map;for(let e of i)s.set(e,nG());let{shapesToCreate:a,bindingsToCreate:l}=cO(this,i,e=>{let n=[];for(let t of e){let e=this.getBinding(t);if(!e)continue;let r=n$();n.push({...e,id:r,fromId:eS(s.get(e.fromId)),toId:eS(s.get(e.toId))})}let i=[];for(let e of o){let n=eS(s.get(e)),o=this.getShape(e);if(!o)continue;let a=0,l=0;if(t&&r.has(e)){let e=this.getShapeParentTransform(o),n=new ot(t.x,t.y).rot(-e.rotation());a=n.x,l=n.y}let c=o.parentId,d=this.getSortedChildIdsForParent(c),u=d.indexOf(o.id),h=d[u+1],p=h?this.getShape(h):null,f=p?tt(o.index,p.index):tn(o.index);i.push({...o,id:n,x:o.x+a,y:o.y+l,index:f,parentId:s.get(o.parentId)??o.parentId})}return{shapesToCreate:i,bindingsToCreate:n}});if(a.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){cM(this);return}if(this.createShapes(a),this.createBindings(l),this.setSelectedShapes(ep(n.map(e=>s.get(e)))),void 0!==t){let e=this.getSelectionPageBounds(),t=this.getViewportPageBounds();e&&!t.contains(e)&&this.centerOnPoint(e.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(0===n.length||this.getInstanceState().isReadonly||t===this.getCurrentPageId()||!this.store.has(t))return this;let r=this.getContentFromCurrentPage(n);if(!r)return this;if(this.getPageShapeIds(t).size+r.shapes.length>this.options.maxShapesPerPage)return cM(this,t),this;let i=this.getCamera().z;return this.run(()=>{this.deleteShapes(n),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(r,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:i}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||0===t.length)return this;let n=!0,r=!0,i=[];for(let e of t){let t=this.getShape(e);t&&(i.push(t),t.isLocked?r=!1:n=!1)}return this.run(()=>{r?(this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!0}))),this.setSelectedShapes([])):n?this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!1}))):this.updateShapes(i.map(e=>({id:e.id,type:e.type,isLocked:!0})))}),this}sendToBack(e){let t=lz(this,"toBack","string"==typeof e[0]?e:e.map(e=>e.id));return t&&this.updateShapes(t),this}sendBackward(e){let t=lz(this,"backward","string"==typeof e[0]?e:e.map(e=>e.id));return t&&this.updateShapes(t),this}bringForward(e){let t=lz(this,"forward","string"==typeof e[0]?e:e.map(e=>e.id));return t&&this.updateShapes(t),this}bringToFront(e){let t=lz(this,"toFront","string"==typeof e[0]?e:e.map(e=>e.id));return t&&this.updateShapes(t),this}flipShapes(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly)return this;let r=ep(n.map(e=>this.getShape(e)));if(!r.length)return this;r=ep(r.map(e=>this.isShapeOfType(e,"group")?this.getSortedChildIdsForParent(e.id).map(e=>this.getShape(e)):e).flat());let i=sL.Common(ep(r.map(e=>this.getShapePageBounds(e)))).center;return this.run(()=>{for(let e of r){let n=this.getShapeGeometry(e).bounds,r=this.getShapePageTransform(e.id);r&&this.resizeShape(e.id,{x:"horizontal"===t?-1:1,y:"vertical"===t?-1:1},{initialBounds:n,initialPageTransform:r,initialShape:e,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleOrigin:i,scaleAxisRotation:0})}}),this}stackShapes(e,t,n){let r,i,o,s,a;let l="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly)return this;let c=l.map(e=>this.getShape(e)).filter(e=>!!e&&this.getShapeUtil(e).canBeLaidOut(e)),d=c.length;if(0===n&&d<3||d<2)return this;let u=Object.fromEntries(c.map(e=>[e.id,this.getShapePageBounds(e)]));if("horizontal"===t?(r="x",i="minX",o="maxX",s="width"):(r="y",i="minY",o="maxY",s="height"),0===n){let e=[];c.sort((e,t)=>u[e.id][i]-u[t.id][i]);for(let t=0;t<d-1;t++){let n=c[t],r=c[t+1],s=u[n.id],a=u[r.id][i]-s[o],l=e.find(e=>e.gap===a);l?l.count++:e.push({gap:a,count:1})}let t=0;e.forEach(e=>{e.count>t&&(t=e.count,a=e.gap)}),1===t&&(a=Math.max(0,e.reduce((e,t)=>e+t.gap*t.count,0)/(d-1)))}else a=n;let h=[],p=u[c[0].id][o];return c.forEach((e,t)=>{if(0===t)return;let n={x:0,y:0};n[r]=p+a-u[e.id][r];let i=this.getShapeParent(e),o=i?ot.Rot(n,-this.getShapePageTransform(i).decompose().rotation):n,l=this.getShapeUtil(e).onTranslateStart?.(e);h.push(l?{...l,[r]:e[r]+o[r]}:{id:e.id,type:e.type,[r]:e[r]+o[r]}),p+=u[e.id][s]+a}),this.updateShapes(h),this}packShapes(e,t){let n,r,i;let o="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||o.length<2)return this;let s=o.map(e=>this.getShape(e)).filter(e=>!!e&&this.getShapeUtil(e).canBeLaidOut(e)),a={},l={},c,d,u=0;for(let e=0;e<s.length;e++)c=s[e],d=this.getShapePageBounds(c),a[c.id]=d,l[c.id]=d.clone(),u+=d.width*d.height;let h=sL.Common(ep(Object.values(a))),p=h.width;s.sort((e,t)=>a[t.id].height-a[e.id].height);let f=Math.max(Math.ceil(Math.sqrt(u/.95)),p),g=[new sL(h.x,h.y,f,1/0)],m=0,y=0;for(let e=0;e<s.length;e++){d=l[(c=s[e]).id];for(let e=g.length-1;e>=0;e--)if(n=g[e],!(d.width>n.width)&&!(d.height>n.height)){d.x=n.x,d.y=n.y,y=Math.max(y,d.maxY),m=Math.max(m,d.maxX),d.width===n.width&&d.height===n.height?(r=g.pop(),e<g.length&&(g[e]=r)):d.height===n.height?(n.x+=d.width+t,n.width-=d.width+t):(d.width===n.width||g.push(new sL(n.x+(d.width+t),n.y,n.width-(d.width+t),d.height)),n.y+=d.height+t,n.height-=d.height+t);break}}let b=sL.Common(Object.values(l)),x=ot.Sub(h.center,b.center),v=[];for(let e=0;e<s.length;e++){d=a[(c=s[e]).id],i=l[c.id];let t=ot.Sub(i.point,d.point).add(x),n=this.getShapeParentTransform(c);n&&t.rot(-n.rotation());let r={id:c.id,type:c.type,x:c.x+t.x,y:c.y+t.y},o=this.getShapeUtil(c).onTranslateStart?.({...c,...r});o?v.push({...r,...o}):v.push(r)}return v.length&&this.updateShapes(v),this}alignShapes(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||n.length<2)return this;let r=ep(n.map(e=>this.getShape(e))),i=Object.fromEntries(r.map(e=>[e.id,this.getShapePageBounds(e)])),o=sL.Common(ep(Object.values(i))),s=[];return r.forEach(e=>{let n=i[e.id];if(!n)return;let r={x:0,y:0};switch(t){case"top":r.y=o.minY-n.minY;break;case"center-vertical":r.y=o.midY-n.minY-n.height/2;break;case"bottom":r.y=o.maxY-n.minY-n.height;break;case"left":r.x=o.minX-n.minX;break;case"center-horizontal":r.x=o.midX-n.minX-n.width/2;break;case"right":r.x=o.maxX-n.minX-n.width}let a=this.getShapeParent(e),l=a?ot.Rot(r,-this.getShapePageTransform(a).decompose().rotation):r;s.push(this.getChangesToTranslateShape(e,ot.Add(e,l)))}),this.updateShapes(s),this}distributeShapes(e,t){let n,r,i,o,s;let a="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||a.length<3)return this;let l=a.length,c=ep(a.map(e=>this.getShape(e))),d=Object.fromEntries(c.map(e=>[e.id,this.getShapePageBounds(e)]));"horizontal"===t?(n="x",r="minX",i="maxX",o="midX",s="width"):(n="y",r="minY",i="maxY",o="midY",s="height");let u=[],h=c.sort((e,t)=>d[e.id][r]-d[t.id][r])[0],p=c.sort((e,t)=>d[t.id][i]-d[e.id][i])[0],f=d[h.id][o],g=(d[p.id][o]-f)/(l-1),m=f+g;return c.filter(e=>e!==h&&e!==p).sort((e,t)=>d[e.id][o]-d[t.id][o]).forEach((e,t)=>{let r={x:0,y:0};r[n]=m+g*t-d[e.id][s]/2-d[e.id][n];let i=this.getShapeParent(e),o=i?ot.Rot(r,-this.getShapePageTransform(i).rotation()):r;u.push(this.getChangesToTranslateShape(e,ot.Add(e,o)))}),this.updateShapes(u),this}stretchShapes(e,t){let n="string"==typeof e[0]?e:e.map(e=>e.id);if(this.getInstanceState().isReadonly||n.length<2)return this;let r=ep(n.map(e=>this.getShape(e))),i=Object.fromEntries(n.map(e=>[e,this.getShapeGeometry(e).bounds])),o=Object.fromEntries(n.map(e=>[e,this.getShapePageBounds(e)])),s=sL.Common(ep(Object.values(o)));switch(t){case"vertical":this.run(()=>{for(let e of r){if(this.getShapePageTransform(e).rotation()%oa)continue;let t=i[e.id],n=o[e.id],r=new ot(0,s.minY-n.minY),a=this.getShapeParentTransform(e);a&&r.rot(-a.rotation());let{x:l,y:c}=ot.Add(r,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:c}]);let d=new ot(1,s.height/n.height);this.resizeShape(e.id,d,{initialBounds:t,scaleOrigin:new ot(n.center.x,s.minY),isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleAxisRotation:0})}});break;case"horizontal":this.run(()=>{for(let e of r){let t=i[e.id],n=o[e.id];if(this.getShapePageTransform(e).rotation()%oa)continue;let r=new ot(s.minX-n.minX,0),a=this.getShapeParentTransform(e);a&&r.rot(-a.rotation());let{x:l,y:c}=ot.Add(r,e);this.updateShapes([{id:e.id,type:e.type,x:l,y:c}]);let d=new ot(s.width/n.width,1);this.resizeShape(e.id,d,{initialBounds:t,scaleOrigin:new ot(s.minX,n.center.y),isAspectRatioLocked:this.getShapeUtil(e).isAspectRatioLocked(e),scaleAxisRotation:0})}})}return this}resizeShape(e,t,n={}){let r="string"==typeof e?e:e.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(t.x)||(t=new ot(1,t.y)),Number.isFinite(t.y)||(t=new ot(t.x,1));let i=n.initialShape??this.getShape(r);if(!i)return this;let o=n.scaleOrigin??this.getShapePageBounds(r)?.center;if(!o)return this;let s=n.initialPageTransform?sz.Cast(n.initialPageTransform):this.getShapePageTransform(r);if(!s)return this;let a=s.rotation();if(null==a)return this;let l=n.scaleAxisRotation??a,c=n.initialBounds??this.getShapeGeometry(r).bounds;if(!c)return this;let d=n.isAspectRatioLocked??this.getShapeUtil(i).isAspectRatioLocked(i);if(!ob(a,l))return this._resizeUnalignedShape(r,t,{...n,initialBounds:c,scaleOrigin:o,scaleAxisRotation:l,initialPageTransform:s,isAspectRatioLocked:d,initialShape:i});let u=this.getShapeUtil(i);if(d&&(t=Math.abs(t.x)>Math.abs(t.y)?new ot(t.x,Math.sign(t.y)*Math.abs(t.x)):new ot(Math.sign(t.x)*Math.abs(t.y),t.y)),u.onResize&&u.canResize(i)){let e=this._scalePagePoint(sz.applyToPoint(s,new ot(0,0)),o,t,l),d=this.getPointInParentSpace(i.id,e),h=new ot(t.x,t.y),p=ou((a-l)%Math.PI,0);h.x=p?t.x:t.y,h.y=p?t.y:t.x;let f=sz.applyToPoint(s,new ot),{x:g,y:m}=this.getPointInParentSpace(i.id,f),y=i;n.skipStartAndEndCallbacks||(y=cA(i,u.onResizeStart?.(i)??void 0)),y=cA(y,{id:r,type:i.type,x:d.x,y:d.y,...u.onResize({...i,x:g,y:m},{newPoint:d,handle:n.dragHandle??"bottom_right",mode:n.mode??"scale_shape",scaleX:h.x,scaleY:h.y,initialBounds:c,initialShape:i})}),n.skipStartAndEndCallbacks||(y=cA(y,u.onResizeEnd?.(i,y)??void 0)),this.updateShapes([y])}else{let e=sz.applyToPoint(s,c.center),n=this._scalePagePoint(e,o,t,l),a=this.getPointInParentSpace(i.id,e),d=this.getPointInParentSpace(i.id,n),u=ot.Sub(d,a);this.updateShapes([{id:r,type:i.type,x:i.x+u.x,y:i.y+u.y}])}return this}_scalePagePoint(e,t,n,r){let i=ot.RotWith(e,t,-r).sub(t),o=ot.MulV(i,n);return ot.Add(o,t).rotWith(t,r)}_resizeUnalignedShape(e,t,n){let{type:r}=n.initialShape,i=new ot(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?i.x=Math.sign(t.x)*Math.abs(t.y):i.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,i,{initialShape:n.initialShape,initialBounds:n.initialBounds,isAspectRatioLocked:n.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:t}=sz.Decompose(n.initialPageTransform);t-=2*t,this.updateShapes([{id:e,type:r,rotation:t}])}let o=sz.applyToPoint(n.initialPageTransform,n.initialBounds.center),s=this._scalePagePoint(o,n.scaleOrigin,t,n.scaleAxisRotation),a=this.getShapePageBounds(e),l=this.getShapePageTransform(e),c=a.center,d=l.point();if(!c||!d)return this;let u=ot.Sub(s,c),h=ot.Add(d,u),{x:p,y:f}=this.getPointInParentSpace(e,h);return this.updateShapes([{id:e,type:r,x:p,y:f}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getInstanceState().isReadonly||e.length<=0)return this;let t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return cM(this),this;let n=this.getFocusedGroupId();return this.run(()=>{let t=this.getCurrentPageShapesSorted(),r=e.map(r=>{if(r.id||(r={id:nG(),...r}),!r.parentId||!(this.store.has(r.parentId)||e.some(e=>e.id===r.parentId))){let e=this.getFocusedGroupId();for(let n=t.length-1;n>=0;n--){let i=t[n];if(this.getShapeUtil(i).canReceiveNewChildrenOfType(i,r.type)&&this.isPointInShape(i,{x:r.x??0,y:r.y??0},{margin:0,hitInside:!0})){e=i.id;break}}let i=r.parentId;if(e===r.id&&(e=n),e!==i&&((r={...r}).parentId=e,nW(e))){let t=this.getPointInShapeSpace(this.getShape(e),{x:r.x??0,y:r.y??0});r.x=t.x,r.y=t.y,r.rotation=-this.getShapePageTransform(e).rotation()+(r.rotation??0)}}return r}),i=new Map,o=[],{opacityForNextShape:s}=this.getInstanceState();for(let e of r){let t=this.getShapeUtil(e),r=e.index;if(!r){let t=e.parentId??n;i.has(t)||i.set(t,this.getHighestIndexForParent(t)),r=i.get(t),i.set(t,tn(r))}let a=t.getDefaultProps();for(let[t,n]of this.styleProps[e.type])a[n]=this.getStyleForNextShape(t);let l=this.store.schema.types.shape.create({...e,index:r,opacity:e.opacity??s,parentId:e.parentId??n,props:"props"in e?{...a,...e.props}:a});if(void 0===l.index)throw Error("no index!");let c=this.getShapeUtil(l).onBeforeCreate?.(l);c&&(l=c),o.push(l)}o.forEach(e=>{e.meta={...this.getInitialMetaForShape(e),...e.meta}}),this.store.put(o)}),this}animatingShapes=new Map;animateShape(e,t={animation:oA}){return this.animateShapes([e],t)}animateShapes(e,t={animation:oA}){let n,r,i;if(!t.animation)return this;let{duration:o=500,easing:s=oe.linear}=t.animation,a=a$(),l=o,c=[];for(let t=0,n=e.length;t<n;t++){if(!(r=e[t]))continue;let n=this.getShape(r.id);n&&(i={start:tS(n),end:cA(tS(n),r)},c.push(i),this.animatingShapes.set(n.id,a))}let d=t=>{if((l-=t)<0){let{animatingShapes:t}=this,n=e.filter(e=>e&&t.get(e.id)===a);n.length&&this.updateShapes(n),this.off("tick",d);return}n=s(1-l/o);let{animatingShapes:r}=this,i=[];for(let e=0,t=c.length;e<t;e++){let{start:t,end:o}=c[e];r.get(t.id)===a&&i.push({...o,x:t.x+(o.x-t.x)*n,y:t.y+(o.y-t.y)*n,opacity:t.opacity+(o.opacity-t.opacity)*n,rotation:t.rotation+(o.rotation-t.rotation)*n,props:this.getShapeUtil(o).getInterpolatedProps?.(t,o,n)??o.props})}this._updateShapes(i)};return this.on("tick",d),this}groupShapes(e,t={}){let{groupId:n=nG(),select:r=!0}=t;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;let i="string"==typeof e[0]?e:e.map(e=>e.id);if(i.length<=1)return this;let o=ep((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(e=>this.getShape(e))),s=o.sort(ti).map(e=>e.id),{x:a,y:l}=sL.Common(ep(o.map(e=>this.getShapePageBounds(e)))).point,c=this.findCommonAncestor(o)??this.getCurrentPageId();if("select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();let d=o.filter(e=>e.parentId===c).sort(ti),u=d[d.length-1]?.index;return this.run(()=>{this.createShapes([{id:n,type:"group",parentId:c,index:u,x:a,y:l,opacity:1,props:{}}]),this.reparentShapes(s,n),r&&this.select(n)}),this}ungroupShapes(e,t={}){if(this.getInstanceState().isReadonly)return this;let{select:n=!0}=t,r="string"==typeof e[0]?e:e.map(e=>e.id),i=ep((this._shouldIgnoreShapeLock?r:this._getUnlockedShapeIds(r)).map(e=>this.getShape(e)));if(0===i.length||"select"!==this.getCurrentToolId())return this;this.isIn("select.idle")||this.cancel();let o=new Set,s=[];return i.forEach(e=>{this.isShapeOfType(e,"group")?s.push(e):o.add(e.id)}),0===s.length||this.run(()=>{let e;for(let t=0,n=s.length;t<n;t++){e=s[t];let n=this.getSortedChildIdsForParent(e.id);for(let e=0,t=n.length;e<t;e++)o.add(n[e]);this.reparentShapes(n,e.parentId,e.index)}this.deleteShapes(s.map(e=>e.id)),n&&this.select(...o)}),this}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){let t=Array(e.length);for(let n=0,r=e.length;n<r;n++){let r=e[n];if(!r)continue;let i=this.getShape(r.id);if(i){if(!this._shouldIgnoreShapeLock){if(i.isLocked){if(!(Object.hasOwn(r,"isLocked")&&!r.isLocked))continue}else if(this.isShapeOrAncestorLocked(i))continue}this.animatingShapes.delete(r.id),t.push(r)}}return this._updateShapes(t),this}_updateShapes=e=>{this.getInstanceState().isReadonly||this.run(()=>{let t,n;let r=[];for(let i=0,o=e.length;i<o;i++){let o=e[i];o&&(t=this.getShape(o.id))&&(n=cA(t,o))!==t&&(n=this.getShapeUtil(t).onBeforeUpdate?.(t,n)??n,r.push(n))}this.store.put(r)})};_getUnlockedShapeIds(e){return e.filter(e=>!this.getShape(e)?.isLocked)}deleteShapes(e){if(this.getInstanceState().isReadonly)return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");let t="string"==typeof e[0]?e:e.map(e=>e.id),n=this._shouldIgnoreShapeLock?t:this._getUnlockedShapeIds(t);if(0===n.length)return this;let r=new Set(n);for(let e of n)this.visitDescendants(e,e=>{r.add(e)});return this.run(()=>this.store.remove([...r]))}deleteShape(e){return this.deleteShapes(["string"==typeof e?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){let n=this._parentIdsToChildIds.get()[e.id];if(n)for(let e=0,r=n.length;e<r;e++)this._extractSharedStyles(this.getShape(n[e]),t)}else for(let[n,r]of this.styleProps[e.type])t.applyValue(n,eK(e.props,r))}_getSelectionSharedStyles(){let e=this.getSelectedShapes(),t=new lL;for(let n of e)this._extractSharedStyles(n,t);return t}getStyleForNextShape(e){let t=this.getInstanceState().stylesForNextShape[e.id];return void 0===t?e.defaultValue:t}getShapeStyleIfExists(e,t){let n=this.styleProps[e.type].get(t);if(void 0!==n)return eK(e.props,n)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();let e=this.root.getCurrent(),t=new lL;if(!e)return t;if(e.shapeType)for(let n of this.styleProps[e.shapeType].keys())t.applyValue(n,this.getStyleForNextShape(n));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){let e=[],t=n=>{let r=this.getShape(n);if(r){if(this.isShapeOfType(r,"group"))for(let e of this.getSortedChildIdsForParent(r.id))t(e);else e.push(r)}};for(let e of this.getSelectedShapeIds())t(e);let n=null;for(let t of e)if(null===n)n=t.opacity;else if(n!==t.opacity)return{type:"mixed"};if(null!==n)return{type:"shared",value:n}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){let t=this.getSelectedShapes();if(t.length>0){let n=[],r=e=>{if(this.isShapeOfType(e,"group"))for(let t of this.getSortedChildIdsForParent(e))r(this.getShape(t));else n.push(e)};for(let e of t)r(e);this.updateShapes(n.map(t=>({id:t.id,type:t.type,opacity:e})))}return this}setStyleForNextShapes(e,t,n){let r=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...r,[e.id]:t}},n),this}setStyleForSelectedShapes(e,t){let n=this.getSelectedShapes();if(n.length>0){let r=[],i=n=>{if(this.isShapeOfType(n,"group"))for(let e of this.getSortedChildIdsForParent(n.id))i(this.getShape(e));else{let i=this.getShapeUtil(n),o=this.styleProps[n.type].get(e);if(o){let e={id:n.id,type:n.type,props:{[o]:t}};r.push({util:i,originalShape:n,updatePartial:e})}}};for(let e of n)i(e);this.updateShapes(r.map(({updatePartial:e})=>e))}return this}externalAssetContentHandlers={file:null,url:null};registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}async getAssetForExternalContent(e){return await this.externalAssetContentHandlers[e.type]?.(e)}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}externalContentHandlers={text:null,files:null,embed:null,"svg-text":null,url:null};registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){return this.externalContentHandlers[e.type]?.(e)}getContentFromCurrentPage(e){let t="string"==typeof e[0]?e:e.map(e=>e.id);if(!t||0===t.length)return;let n=this.getShapeAndDescendantIds(t);return cO(this,n,e=>{let t=[];for(let n of e){let e=this.getBinding(n);e&&t.push(e)}let r=[],i=[];for(let e of n){let t=this.getShape(e);if(t){if(n.has(t.parentId))i.push(t);else{let e=this.getShapePageTransform(t.id),n=e.point();i.push({...t,x:n.x,y:n.y,rotation:e.rotation(),parentId:this.getCurrentPageId()}),r.push(t.id)}}}let o=[],s=new Set;for(let e of i){if(!("assetId"in e.props))continue;let t=e.props.assetId;if(!t||s.has(t))continue;s.add(t);let n=this.getAsset(t);n&&o.push(n)}return{schema:this.store.schema.serialize(),shapes:i,rootShapeIds:r,bindings:t,assets:o}})}async resolveAssetsInContent(e){if(!e)return;let t=[];return await Promise.allSettled(e.assets.map(async e=>{if("image"!==e.type&&"video"!==e.type||e.props.src?.startsWith("data:image")||e.props.src?.startsWith("http"))t.push(e);else{let n=tS(e),r=await this.store.props.assets.resolve(e,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});n.props.src=await eE.blobToDataUrl(await e_(r).then(e=>e.blob())),t.push(n)}})),e.assets=t,e}putContentOntoCurrentPage(e,t={}){if(this.getInstanceState().isReadonly)return this;if(!e.schema)throw Error("Could not put content:\ncontent is missing a schema.");let{select:n=!1,preserveIds:r=!1,preservePosition:i=!1}=t,{point:o}=t,s=this.getCurrentPageId(),{rootShapeIds:a}=e,l=[],c=[],d=[],u={store:{...Object.fromEntries(e.assets.map(e=>[e.id,e])),...Object.fromEntries(e.shapes.map(e=>[e.id,e])),...Object.fromEntries(e.bindings?.map(e=>[e.id,e])??[])},schema:e.schema},h=this.store.schema.migrateStoreSnapshot(u);if("error"===h.type)throw Error("Could not put content: could not migrate content");for(let e of Object.values(h.value))switch(e.typeName){case"asset":l.push(e);break;case"shape":c.push(e);break;case"binding":d.push(e)}let p=new Map(r?c.map(e=>[e.id,e.id]):c.map(e=>[e.id,nG()])),f=new Map(r?d.map(e=>[e.id,e.id]):d.map(e=>[e.id,n$()])),g=this.getCurrentPageId(),m=1/0,y=[];for(let e of this.getSelectedShapes()){if(0===m)break;let t=this.isShapeOfType(e,"frame"),n=this.getShapeAncestors(e);t&&n.push(e);let r=t?n.length+1:n.length;if(r<m)m=r,y=n,g=t?e.id:e.parentId;else if(r===m){if(y.length!==n.length)throw Error(`Ancestors: ${y.length} !== ${n.length}`);if(0===y.length){g=s;break}g=s;for(let e=0;e<y.length&&n[e]===y[e];e++)g=n[e].id}}let b=!1;if(!rx(g)){let e=this.getShape(g);if(e){if(this.getViewportPageBounds().includes(this.getShapePageBounds(e))){if(1===a.length){let t=c.find(e=>e.id===a[0]);this.isShapeOfType(e,"frame")&&this.isShapeOfType(t,"frame")&&t.props.w===e?.props.w&&t.props.h===e?.props.h&&(b=!0)}}else g=s}else g=s}b||(b=p.has(g)),b&&(g=this.getShape(g).parentId);let x=this.getHighestIndexForParent(g),v=[],w=c.map(e=>{let t=p.get(e.id),n={...e,id:t};return a.includes(e.id)&&(n.parentId=s,v.push(n)),p.has(n.parentId)?n.parentId=p.get(e.parentId):(a.push(n.id),n.index=x,x=tn(x)),n});if(w.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return cM(this),this;let S=d.map(e=>({...e,id:eS(f.get(e.id)),fromId:eS(p.get(e.fromId)),toId:eS(p.get(e.toId))})),k=[],C=[];for(let e of l)this.store.has(e.id)||(("image"===e.type||"video"===e.type)&&e.props.src?.startsWith("data:image")&&(C.push(tS(e)),e.props.src=null),k.push(e));return Promise.allSettled(C.map(async e=>{var t,n,r;let i=await (t=e.props.src,n=e.props.name,r=e.props.mimeType??"image/png",e_(t).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],n,{type:r})})),o=await this.getAssetForExternalContent({type:"file",file:i});if(!o){this.deleteAssets([e.id]);return}this.updateAssets([{...o,id:e.id}])})),this.run(()=>{k.length>0&&this.createAssets(k),this.createShapes(w),this.createBindings(S),n&&this.select(...v.map(e=>e.id)),g!==s&&this.reparentShapes(v.map(e=>e.id),g);let e=w.map(e=>this.getShape(e.id)),t=sL.Common(e.map(e=>this.getShapePageBounds(e)));if(void 0===o){if(rx(g)){let e=this.getViewportPageBounds();o=i||e.includes(sL.From(t))?t.center:e.center}else{let e=this.getShape(g);o=sz.applyToPoint(this.getShapePageTransform(e),this.getShapeGeometry(e).bounds.center)}}if(1===v.length){let e=v[0];if(this.isShapeOfType(e,"frame"))for(;this.getShapesAtPoint(o).some(t=>this.isShapeOfType(t,"frame")&&t.props.w===e.props.w&&t.props.h===e.props.h);)o.x+=t.w+16}let r=sL.Common(ep(v.map(({id:e})=>this.getShapePageBounds(e)))).center,a=ot.Sub(o,r);this.updateShapes(v.map(({id:e})=>{let t=this.getShape(e),n=this.getShapeParentTransform(e).decompose().rotation,r=ot.Rot(a,-n);return{id:t.id,type:t.type,x:t.x+r.x,y:t.y+r.y}}))}),this}async getSvgElement(e,t={}){let n=await lG(this,e,t);if(!n)return;let r=document.createDocumentFragment(),i=(0,a9.createRoot)(r);(0,a8.flushSync)(()=>{i.render(n.jsx)});let o=r.firstElementChild;return ew(o instanceof SVGSVGElement,"Expected an SVG element"),i.unmount(),{svg:o,width:n.width,height:n.height}}async getSvgString(e,t={}){let n=await this.getSvgElement(e,t);if(n)return{svg:new XMLSerializer().serializeToString(n.svg),width:n.width,height:n.height}}async getSvg(e,t={}){let n=await this.getSvgElement(e,t);if(n)return n.svg}inputs={originPagePoint:new ot,originScreenPoint:new ot,previousPagePoint:new ot,previousScreenPoint:new ot,currentPagePoint:new ot,currentScreenPoint:new ot,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new ot};_updateInputsFromEvent(e){let{pointerVelocity:t,previousScreenPoint:n,previousPagePoint:r,currentScreenPoint:i,currentPagePoint:o}=this.inputs,{screenBounds:s}=this.store.unsafeGetWithoutCapture(rC),{x:a,y:l,z:c}=D(()=>this.getCamera()),d=e.point.x-s.x,u=e.point.y-s.y,h=e.point.z??.5;n.setTo(i),r.setTo(o),i.set(d,u);let p=d/c-a,f=u/c-l;isFinite(p)&&isFinite(f)&&o.set(p,f,h),this.inputs.isPen="pointer"===e.type&&e.isPen,("pointer_down"===e.name||this.inputs.isPinching)&&(t.set(0,0),this.inputs.originScreenPoint.setTo(i),this.inputs.originPagePoint.setTo(o)),this.run(()=>{this.store.put([{id:rA,typeName:"pointer",x:o.x,y:o.y,lastActivityTimestamp:"pointer"===e.type&&e.pointerId===oO.CAMERA_MOVE?this.store.unsafeGetWithoutCapture(rA)?.lastActivityTimestamp??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()||(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0})),this}blur({blurContainer:e=!0}={}){return this.getIsFocused()&&(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1})),this}getIsFocused(){return this.getInstanceState().isFocused}getSnapshot(){return function(e){let t=ll.get(e,lo).get();if(!t)throw Error("Session state is not ready yet");return{document:e.getStoreSnapshot(),session:t}}(this.store)}loadSnapshot(e){return la(this.store,e),this}_clickManager=new lq(this);cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_prevCursor="default";_shiftKeyTimeout=-1;_setShiftKeyTimeout=()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})};_altKeyTimeout=-1;_setAltKeyTimeout=()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})};_ctrlKeyTimeout=-1;_setCtrlKeyTimeout=()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})};_restoreToolId="select";_pinchStart=1;_didPinch=!1;_selectedShapeIdsAtPointerDown=[];_longPressTimeout=-1;capturedPointerId=null;performanceTracker;performanceTrackerTimeout=-1;dispatch=e=>(this._pendingEventsForNextTick.push(e),"pointer"===e.type&&"pointer_move"===e.name||"wheel"===e.type||"pinch"===e.type||this._flushEventsForTick(0),this);_pendingEventsForNextTick=[];_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){let e=[...this._pendingEventsForNextTick];for(let t of(this._pendingEventsForNextTick.length=0,e))this._flushEventForTick(t)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick=e=>{if(this.getCrashingError())return this;let{inputs:t}=this,{type:n}=e;if("misc"===e.type){("cancel"===e.name||"complete"===e.name)&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&-1===this._shiftKeyTimeout&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&-1===this._altKeyTimeout&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&-1===this._ctrlKeyTimeout&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150));let{originPagePoint:r,currentPagePoint:i}=t;t.isPointing||(t.isDragging=!1);let o=this.store.unsafeGetWithoutCapture(rC),s=this.store.get(this._getCurrentPageStateId()),a=this._cameraOptions.__unsafe__getWithoutCapture();switch(n){case"pinch":if(a.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":if(t.isPinching)return;t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...s.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt());return;case"pinch":{if(!t.isPinching)return;let{point:{z:n=1},delta:{x:r,y:i}}=e,{x:s,y:l}=ot.SubXY(e.point,o.screenBounds.x,o.screenBounds.y);this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();let{x:c,y:d,z:u}=D(()=>this.getCamera()),{panSpeed:h,zoomSpeed:p}=a;this._setCamera(new ot(c+r*h/u-s/u+s/(n*p),d+i*h/u-l/u+l/(n*p),n*p),{immediate:!0});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;let{_selectedShapeIdsAtPointerDown:e}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,e.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(e)}));return}}case"wheel":if(a.isLocked)return;if(this._updateInputsFromEvent(e),this.getIsMenuOpen());else{let{panSpeed:n,zoomSpeed:r,wheelBehavior:i}=a;if("none"!==i){this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();let{x:s,y:a,z:l}=D(()=>this.getCamera()),{x:c,y:d,z:u=0}=e.delta,h=i;switch(t.ctrlKey&&(h="pan"===i?"zoom":"pan"),h){case"zoom":{let{x:e,y:t}=this.inputs.currentScreenPoint,n=u;"zoom"===i&&(n=Math.abs(d)>10?10*Math.sign(d)/100:d/100);let o=l+(n??0)*r*l;this._setCamera(new ot(s+(e/o-e)-(e/l-e),a+(t/o-t)-(t/l-t),o),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":this._setCamera(new ot(s+c*n/l,a+d*n/l,l),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break;case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);let{isPen:n}=e,{isPenMode:s}=o;switch(e.name){case"pointer_down":if(s&&!n)return;if(this.clearOpenMenus(),this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...e,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),0===e.button&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!s&&n&&this.updateInstanceState({isPenMode:!0}),5===e.button?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):1===e.button&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break;case"pointer_move":{if(!n&&s)return;let{x:e,y:l,z:c}=D(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){let{currentScreenPoint:t,previousScreenPoint:n}=this.inputs,{panSpeed:r}=a,i=ot.Sub(t,n);this.setCamera(new ot(e+i.x*r/c,l+i.y*r/c,c),{immediate:!0}),this.maybeTrackPerformance("Panning");return}t.isPointing&&!t.isDragging&&ot.Dist2(r,i)*this.getZoomLevel()>(o.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/c&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),this.getIsMenuOpen()||o.isPenMode&&!n)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1);let n=this.inputs.pointerVelocity,r=Math.min(2,n.len());switch(e.button){case 0:this.setCursor({type:"grab",rotation:0});break;case 1:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}r>0&&this.slideCamera({speed:r,direction:n})}else 5===e.button&&(this.complete(),this.setCurrentTool(this._restoreToolId))}break}case"keyboard":switch("ShiftRight"===e.key&&(e.key="ShiftLeft"),"AltRight"===e.key&&(e.key="AltLeft"),"ControlRight"===e.code&&(e.code="ControlLeft"),e.name){case"key_down":t.keys.add(e.code),"Space"!==e.code||e.ctrlKey||(this.inputs.isPanning||(this._prevCursor=o.cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0}));break;case"key_up":t.keys.delete(e.code),"Space"===e.code&&(this.inputs.buttons.has(1)||(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})))}}if("pointer"===e.type){1===e.button?e.name="middle_click":2===e.button&&(e.name="right_click");let{isPenMode:t}=this.store.unsafeGetWithoutCapture(rC);if(e.isPen===t){let t=this._clickManager.handlePointerEvent(e);if(e.name!==t.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(t),this.emit("event",t);return}}}return this.root.handleEvent(e),this.emit("event",e),this};maybeTrackPerformance(e){t_.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}function cM(e,t=e.getCurrentPageId()){let n=e.getPage(t).name;e.emit("max-shapes",{name:n,pageId:t,count:e.options.maxShapesPerPage})}function cA(e,t){if(!t)return e;let n=null,r=Object.entries(t);for(let t=0,i=r.length;t<i;t++){let[i,o]=r[t];if(void 0!==o&&"id"!==i&&"type"!==i&&"typeName"!==i&&o!==e[i]){if(n||(n={...e}),"props"===i||"meta"===i){for(let[t,r]of(n[i]={...e[i]},Object.entries(o)))void 0!==r&&(n[i][t]=r);continue}n[i]=o}}return n||e}function cO(e,t,n){let r;if(e.run(()=>{let i=e.store.extractingChanges(()=>{let i=new Set,o=new Set;for(let n of t)if(e.getShape(n))for(let r of e.getBindingsInvolvingShape(n)){let e=t.has(r.fromId),n=t.has(r.toId);if(e&&n){i.add(r.id);continue}e&&n||o.add(r.id)}e.deleteBindings([...o],{isolateShapes:!0});try{r=ex.ok(n(i))}catch(e){r=ex.err(e)}});e.store.applyDiff(tR(i))},{history:"ignore"}),r.ok)return r.value;throw r.error}function cL(e,t){if(!t.constraints)throw Error("Should have constraints here");let{padding:{x:n,y:r}}=t.constraints,i=e.getViewportScreenBounds(),o=sL.From(t.constraints.bounds);return{zx:(i.w-2*n)/o.w,zy:(i.h-2*r)/o.h}}function cD(){let e=i8(),t=lW();return iJ("isDarkMode",()=>t?.isDarkMode??e.user.getIsDarkMode(),[t,e])}cj([es],cT.prototype,"getCanUndo",1),cj([es],cT.prototype,"getCanRedo",1),cj([es],cT.prototype,"getPath",1),cj([es],cT.prototype,"getCurrentTool",1),cj([es],cT.prototype,"getCurrentToolId",1),cj([es],cT.prototype,"getDocumentSettings",1),cj([es],cT.prototype,"getInstanceState",1),cj([es],cT.prototype,"getOpenMenus",1),cj([es],cT.prototype,"getIsMenuOpen",1),cj([es],cT.prototype,"getPageStates",1),cj([es],cT.prototype,"_getPageStatesQuery",1),cj([es],cT.prototype,"getCurrentPageState",1),cj([es],cT.prototype,"_getCurrentPageStateId",1),cj([es],cT.prototype,"getSelectedShapeIds",1),cj([es],cT.prototype,"getSelectedShapes",1),cj([es],cT.prototype,"getOnlySelectedShapeId",1),cj([es],cT.prototype,"getOnlySelectedShape",1),cj([es],cT.prototype,"getSelectionPageBounds",1),cj([es],cT.prototype,"getSelectionRotation",1),cj([es],cT.prototype,"getSelectionRotatedPageBounds",1),cj([es],cT.prototype,"getSelectionRotatedScreenBounds",1),cj([es],cT.prototype,"getFocusedGroupId",1),cj([es],cT.prototype,"getFocusedGroup",1),cj([es],cT.prototype,"getEditingShapeId",1),cj([es],cT.prototype,"getEditingShape",1),cj([es],cT.prototype,"getHoveredShapeId",1),cj([es],cT.prototype,"getHoveredShape",1),cj([es],cT.prototype,"getHintingShapeIds",1),cj([es],cT.prototype,"getHintingShape",1),cj([es],cT.prototype,"getErasingShapeIds",1),cj([es],cT.prototype,"getErasingShapes",1),cj([es],cT.prototype,"_unsafe_getCameraId",1),cj([es],cT.prototype,"getCamera",1),cj([es],cT.prototype,"getViewportPageBoundsForFollowing",1),cj([es],cT.prototype,"getCameraForFollowing",1),cj([es],cT.prototype,"getZoomLevel",1),cj([es],cT.prototype,"getViewportScreenBounds",1),cj([es],cT.prototype,"getViewportScreenCenter",1),cj([es],cT.prototype,"getViewportPageBounds",1),cj([es],cT.prototype,"_getCollaboratorsQuery",1),cj([es],cT.prototype,"getCollaborators",1),cj([es],cT.prototype,"getCollaboratorsOnCurrentPage",1),cj([es],cT.prototype,"getRenderingShapes",1),cj([es],cT.prototype,"_getAllPagesQuery",1),cj([es],cT.prototype,"getPages",1),cj([es],cT.prototype,"getCurrentPageId",1),cj([es],cT.prototype,"getCurrentPageShapeIdsSorted",1),cj([es],cT.prototype,"_getAllAssetsQuery",1),cj([es],cT.prototype,"_getShapeGeometryCache",1),cj([es],cT.prototype,"_getShapeHandlesCache",1),cj([es],cT.prototype,"_getShapePageTransformCache",1),cj([es],cT.prototype,"_getShapePageBoundsCache",1),cj([es],cT.prototype,"_getShapeClipPathCache",1),cj([es],cT.prototype,"_getShapeMaskCache",1),cj([es],cT.prototype,"_getShapeMaskedPageBoundsCache",1),cj([es],cT.prototype,"_notVisibleShapes",1),cj([es],cT.prototype,"getCulledShapes",1),cj([es],cT.prototype,"getCurrentPageBounds",1),cj([es],cT.prototype,"getCurrentPageShapes",1),cj([es],cT.prototype,"getCurrentPageShapesSorted",1),cj([es],cT.prototype,"getCurrentPageRenderingShapesSorted",1),cj([es],cT.prototype,"_getBindingsIndexCache",1),cj([es],cT.prototype,"_getSelectionSharedStyles",1),cj([es({isEqual:(e,t)=>e.equals(t)})],cT.prototype,"getSharedStyles",1),cj([es],cT.prototype,"getSharedOpacity",1),cj([es],cT.prototype,"getIsFocused",1);let cz="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",cR="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",cN='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function cF(e,t,n,r,i,o=16,s=16){let a=oo/180*(-n-t),l=Math.sin(a),c=Math.cos(a);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${1*c-1*l}' dy='${1*l+1*c}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${o} ${s}, pointer`}let c$=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],cB={none:()=>"none","ew-resize":(e,t,n)=>cF(cR,e,0,t,n),"ns-resize":(e,t,n)=>cF(cR,e,90,t,n),"nesw-resize":(e,t,n)=>cF(cz,e,0,t,n),"nwse-resize":(e,t,n)=>cF(cz,e,90,t,n),"nwse-rotate":(e,t,n)=>cF(cN,e,0,t,n),"nesw-rotate":(e,t,n)=>cF(cN,e,90,t,n),"senw-rotate":(e,t,n)=>cF(cN,e,180,t,n),"swne-rotate":(e,t,n)=>cF(cN,e,270,t,n)};function cU(e,t=0,n="black"){return cB[e](180*t/oo,!1,n)}function cV(e){let t=(0,y.useRef)();return(0,y.useLayoutEffect)(()=>{t.current=e}),(0,y.useDebugValue)(e),(0,y.useCallback)((...e)=>{let n=t.current;return ew(n,"fn does not exist"),n(...e)},[])}let cH=e=>e.props.src,cK={upload:(e,t)=>eE.blobToDataUrl(t)};function cW({initialData:e,defaultName:t="",id:n,assets:r=cK,onMount:i,collaboration:o,...s}={}){let a=new tG({id:n,schema:"schema"in s&&s.schema?s.schema:function({shapes:e=iV,bindings:t=iH,migrations:n}={}){let r=new Map;for(let t of eG(e))for(let e of nq(t.props??{}).keys()){if(r.has(e.id)&&r.get(e.id)!==e)throw Error(`Multiple StyleProp instances with the same id: ${e.id}`);r.set(e.id,e)}let i=tD("shape",{scope:"document",validator:nx("shape",nb("type",eZ(e,(e,{props:t,meta:n})=>nf({id:nN,typeName:nu("shape"),x:ni,y:ni,rotation:ni,index:nE,parentId:nR,type:nu(e),isLocked:nd,opacity:nz,props:t?nf(t):nm,meta:n?nf(n):nm}))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}})),o=tD("binding",{scope:"document",validator:nx("binding",nb("type",eZ(t,(e,{props:t,meta:n})=>nf({id:nF,typeName:nu("binding"),type:nu(e),fromId:nN,toId:nN,props:t?nf(t):nm,meta:n?nf(n):nm}))))}).withDefaultProperties(()=>({meta:{}})),s=function(e){let t={};for(let[n,r]of e)t[n]=nw(r);return tD("instance",{validator:nx("instance",nf({typeName:nu("instance"),id:nj("instance"),currentPageId:rg,followingUserId:nr.nullable(),brush:nO.nullable(),opacityForNextShape:nz,stylesForNextShape:nf(t),cursor:ru,scribbles:np(rf),isFocusMode:nd,isDebugMode:nd,isToolLocked:nd,exportBackground:nd,screenBounds:nO,insets:np(nd),zoomBrush:nO.nullable(),isPenMode:nd,isGridMode:nd,chatMessage:nr,isChatting:nd,highlightedUserIds:np(nr),isFocused:nd,devicePixelRatio:ni,isCoarsePointer:nd,isHoveringCanvas:nd.nullable(),openMenus:np(nr),isChangingStyle:nd,isReadonly:nd,meta:nm,duplicateProps:nf({shapeIds:np(nj("shape")),offset:nf({x:ni,y:ni})}).nullable()})),scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:"undefined"==typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}(r);return t2.create({asset:r3,binding:o,camera:rc,document:r$,instance:s,instance_page_state:rE,page:rb,instance_presence:rz,pointer:rM,shape:i},{migrations:[iU,r2,rl,rF,rk,rI,ry,rD,rT,nH,rq,rZ,r0,...nX("shape",e),...nX("binding",t),...n??[]],onValidationFailure:rH,createIntegrityChecker:rK})}({shapes:"shapeUtils"in s&&s.shapeUtils?cG(lT(s.shapeUtils)):void 0,bindings:"bindingUtils"in s&&s.bindingUtils?cG(lc(s.bindingUtils)):void 0,migrations:"migrations"in s?s.migrations:void 0}),initialData:e,props:{defaultName:t,assets:{upload:r.upload,resolve:r.resolve??cH},onMount:e=>{ew(e instanceof cT),i?.(e)},collaboration:o}});if(s.snapshot){if(e)throw Error("Cannot provide both initialData and snapshot");la(a,s.snapshot)}return a}function cG(e){return Object.fromEntries(e.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}let cq=(e,t)=>t.some(t=>e instanceof t),cY=new WeakMap,cX=new WeakMap,cZ=new WeakMap,cQ=new WeakMap,cJ=new WeakMap,c0={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return cX.get(e);if("objectStoreNames"===t)return e.objectStoreNames||cZ.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return c1(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function c1(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",o)},i=()=>{t(c1(e.result)),r()},o=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",o)});return t.then(t=>{t instanceof IDBCursor&&cY.set(t,e)}).catch(()=>{}),cJ.set(t,e),t}(e);if(cQ.has(e))return cQ.get(e);let n="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(u||(u=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(c2(this),e),c1(cY.get(this))}:function(...e){return c1(t.apply(c2(this),e))}:function(e,...n){let r=t.call(c2(this),e,...n);return cZ.set(r,e.sort?e.sort():[e]),c1(r)}:(t instanceof IDBTransaction&&function(e){if(cX.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",o),e.removeEventListener("abort",o)},i=()=>{t(),r()},o=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",o),e.addEventListener("abort",o)});cX.set(e,t)}(t),cq(t,d||(d=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,c0):t;return n!==e&&(cQ.set(e,n),cJ.set(n,e)),n}let c2=e=>cJ.get(e);function c3(e,t,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){let s=indexedDB.open(e,t),a=c1(s);return r&&s.addEventListener("upgradeneeded",e=>{r(c1(s.result),e.oldVersion,e.newVersion,c1(s.transaction),e)}),n&&s.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{o&&e.addEventListener("close",()=>o()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}function c5(e,{blocked:t}={}){let n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",e=>t(e.oldVersion,e)),c1(n).then(()=>void 0)}let c4=["get","getKey","getAll","getAllKeys","count"],c6=["put","add","delete","clear"],c8=new Map;function c9(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(c8.get(t))return c8.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=c6.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||c4.includes(n)))return;let o=async function(e,...t){let o=this.transaction(e,i?"readwrite":"readonly"),s=o.store;return r&&(s=s.index(t.shift())),(await Promise.all([s[n](...t),i&&o.done]))[0]};return c8.set(t,o),o}c0=(e=>({...e,get:(t,n,r)=>c9(t,n)||e.get(t,n,r),has:(t,n)=>!!c9(t,n)||e.has(t,n)}))(c0);let c7="TLDRAW_DB_NAME_INDEX_v2",de={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function dt(e){let t="TLDRAW_DOCUMENT_v2"+e;return function(e){let t=new Set(di());t.add(e),ta(c7,JSON.stringify([...t]))}(t),await c3(t,4,{upgrade(e){e.objectStoreNames.contains(de.Records)||e.createObjectStore(de.Records),e.objectStoreNames.contains(de.Schema)||e.createObjectStore(de.Schema),e.objectStoreNames.contains(de.SessionState)||e.createObjectStore(de.SessionState),e.objectStoreNames.contains(de.Assets)||e.createObjectStore(de.Assets)}})}async function dn(e){let t=window.indexedDB.databases?(await window.indexedDB.databases()).map(e=>e.name):di(),n="TLDRAW_ASSET_STORE_v1"+e;if(!t.find(e=>e===n))return;let r=await c3(n,1,{upgrade(e){e.objectStoreNames.contains("assets")||e.createObjectStore("assets")}}),i=r.transaction(["assets"],"readonly"),o=i.objectStore("assets"),s=await o.getAllKeys(),a=await Promise.all(s.map(async e=>[e,await o.get(e)]));await i.done;let l=await dt(e),c=l.transaction([de.Assets],"readwrite"),d=c.objectStore(de.Assets);for(let[e,t]of a)d.put(t,e);await c.done,r.close(),l.close(),await c5(n)}class dr{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(e){dr.connectedInstances.add(this),this.getDbPromise=(async()=>(await dn(e),await dt(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(eb)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),dr.connectedInstances.delete(this))}tx(e,t,n){let r=(async()=>{ew(!this.isClosed,"db is closed");let r=(await this.getDb()).transaction(t,e),i=r.done.catch(e=>{if(!this.isClosed)throw e});try{return await n(r)}finally{this.isClosed?r.abort():await i}})();return this.pendingTransactionSet.add(r),r.finally(()=>this.pendingTransactionSet.delete(r)),r}async load({sessionId:e}={}){return await this.tx("readonly",[de.Records,de.Schema,de.SessionState],async t=>{let n=t.objectStore(de.Records),r=t.objectStore(de.Schema),i=t.objectStore(de.SessionState),o=e?(await i.get(e))?.snapshot:null;if(!o){let e=await i.getAll();o=e.sort((e,t)=>e.updatedAt-t.updatedAt).pop()?.snapshot}return{records:await n.getAll(),schema:await r.get(de.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:t,sessionId:n,sessionStateSnapshot:r}){await this.tx("readwrite",[de.Records,de.Schema,de.SessionState],async i=>{let o=i.objectStore(de.Records),s=i.objectStore(de.Schema),a=i.objectStore(de.SessionState);for(let[e,n]of Object.entries(t.added))await o.put(n,e);for(let[e,n]of Object.values(t.updated))await o.put(n,n.id);for(let e of Object.keys(t.removed))await o.delete(e);s.put(e.serialize(),de.Schema),r&&n?a.put({snapshot:r,updatedAt:Date.now(),id:n},n):(r||n)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:n,sessionStateSnapshot:r}){await this.tx("readwrite",[de.Records,de.Schema,de.SessionState],async i=>{let o=i.objectStore(de.Records),s=i.objectStore(de.Schema),a=i.objectStore(de.SessionState);for(let[e,n]of(await o.clear(),Object.entries(t)))await o.put(n,e);s.put(e.serialize(),de.Schema),r&&n?a.put({snapshot:r,updatedAt:Date.now(),id:n},n):(r||n)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[de.SessionState],async e=>{let t=e.objectStore(de.SessionState),n=(await t.getAll()).sort((e,t)=>e.updatedAt-t.updatedAt);if(n.length<10){await e.done;return}for(let{id:e}of n.slice(0,n.length-10))await t.delete(e)})}async getAsset(e){return await this.tx("readonly",[de.Assets],async t=>{let n=t.objectStore(de.Assets);return await n.get(e)})}async storeAsset(e,t){await this.tx("readwrite",[de.Assets],async n=>{let r=n.objectStore(de.Assets);await r.put(t,e)})}}function di(){let e=JSON.parse(ts(c7)||"[]")??[];return Array.isArray(e)?e:[]}let ds=Symbol("UPDATE_INSTANCE_STATE"),da=e=>e;class dl{onmessage;constructor(e){}postMessage(e){}close(){}}let dc="undefined"==typeof BroadcastChannel?dl:BroadcastChannel;class dd{constructor(e,{persistenceKey:t,sessionId:n=lt,onLoad:r,onLoadError:i},o=new dc(`tldraw-tab-sync-${t}`)){this.store=e,this.channel=o,"undefined"!=typeof window&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=n,this.db=new dr(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=lo(this.store),this.disposables.add(e.listen(({changes:e})=>{this.diffQueue.push(e),this.channel.postMessage(da({type:"diff",storeId:this.store.id,changes:e,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(ds),this.schedulePersist()},{scope:"session"})),this.connect(r,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){let n;this.debug("connecting");try{n=await this.db.load({sessionId:this.sessionId})}catch(e){t(e),window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`);return}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){let e=Object.fromEntries(n.records.map(e=>[e.id,e])),r=n.sessionStateSnapshot??function(e){let t=[];for(let n of Object.values(e))n.typeName?.match(/^(instance.*|pointer|camera)$/)&&t.push(n);let n=t.filter(e=>"instance"===e.typeName&&e.id!==rC)[0];if(!n)return null;let r={version:lr,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:t.filter(e=>"instance_page_state"===e.typeName&&e.instanceId===n.id).map(t=>{let n=e[t.cameraId]??{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:n.x,y:n.y,z:n.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}})};try{return li.validate(r),r}catch(e){return null}}(e),i=this.store.schema.migrateStoreSnapshot({store:e,schema:n.schema??this.store.schema.serializeEarliestVersion()});if("error"===i.type){console.error("failed to migrate store",i),t(Error(`Failed to migrate store: ${i.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(i.value).filter(e=>this.documentTypes.has(e.typeName)),"initialize")}),r&&ls(this.store,r)}this.channel.onmessage=({data:e})=>{this.debug("got message",e);let n=this.store.schema.getMigrationsSince(e.schema);if(n.ok){if(n.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}"diff"===e.type&&(this.debug("applying diff"),G(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(e.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(e){if(this.debug("error loading data from store",e),this.didDispose)return;t(e);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||!this.shouldDoFullDBWrite&&!(this.diffQueue.length>0)||this.doPersist()}async doPersist(){if(ew(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");let e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{let t=tF(e.filter(e=>e!==ds));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(e){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",e),window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`),"undefined"!=typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function du(e){let t=(0,y.useRef)(e),[n,r]=(0,y.useState)(e);return n!==t.current&&r(t.current),[n,(0,y.useCallback)(e=>{"function"==typeof e?t.current=e(t.current):t.current=e,r(t.current)},[])]}function dh(e){let t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0,r=e.length;t<r;t++)n[t]=e.charCodeAt(t);return t}let dp={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4},df=Math.max(...Object.values(dp)),dg={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},dm=Object.keys(dg).length,dy="sales@tldraw.com";class db{publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=X("license state","pending");constructor(e,t,n){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(n),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,tC.enableLicensing.get()?this.getLicenseFromKey(e).then(e=>{let t=function(e){if(!e.isLicenseParseable||!e.isDomainValid&&!e.isDevelopment)return!0;if(e.isPerpetualLicenseExpired||e.isAnnualLicenseExpired){if(e.isInternalLicense)throw Error("License: Internal license expired.");return!0}return!1}(e);this.state.set(t?"unlicensed":"licensed")}):this.state.set("licensed")}getIsDevelopment(e){return"development"===e||"production"!==e&&"https:"!==window.location.protocol}async extractLicenseKey(e){let t,n;let[r,i]=e.split("."),[o,s]=r.split("/");if(!o.startsWith("tldraw-"))throw Error(`Unsupported prefix '${o}'`);let a=await function(e){let t=dh(atob(e));return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}(this.publicKey);try{t=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},a,new Uint8Array(dh(atob(i))),new Uint8Array(dh(atob(s))))}catch(e){throw console.error(e),Error("Could not perform signature validation")}if(!t)throw Error("Invalid signature");try{n=JSON.parse(atob(s))}catch(e){throw Error("Could not parse object")}return n.length>dm&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:n[dg.ID],hosts:n[dg.HOSTS],flags:n[dg.FLAGS],expiryDate:n[dg.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately."),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{let e=await this.extractLicenseKey(t),n=new Date(e.expiryDate),r=this.isFlagEnabled(e.flags,dp.ANNUAL_LICENSE),i=this.isFlagEnabled(e.flags,dp.PERPETUAL_LICENSE),o={license:e,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(e),expiryDate:n,isAnnualLicense:r,isAnnualLicenseExpired:r&&this.isAnnualLicenseExpired(n),isPerpetualLicense:i,isPerpetualLicenseExpired:i&&this.isPerpetualLicenseExpired(n),isInternalLicense:this.isFlagEnabled(e.flags,dp.INTERNAL_LICENSE)};return this.outputLicenseInfoIfNeeded(o),o}catch(e){return this.outputInvalidLicenseKey(e.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){let t=window.location.hostname.toLowerCase();return e.hosts.some(e=>{let n=e.toLowerCase().trim();return n===t||`www.${n}`===t||n===`www.${t}`||"*"===e||!!e.includes("*")&&new RegExp(e.replace(/\*/g,".*?")).test(t)})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+5+1)}isAnnualLicenseExpired(e){let t=this.getExpirationDateWithGracePeriod(e),n=new Date>=t;return!n&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${dy} if you would like to renew your license.`]),n}isPerpetualLicenseExpired(e){let t=this.getExpirationDateWithGracePeriod(e),n={major:new Date(i2.major),minor:new Date(i2.minor)};return n.major>=t||n.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){this.outputMessages(["No tldraw license key provided!",`Please reach out to ${dy} if you would like to license tldraw or if you'd like a trial.`])}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${dy} to renew.`]),e.isDomainValid||e.isDevelopment||this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${dy} if you would like to use tldraw on other domains.`]),e.license.flags>=2*df&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest){for(let t of(this.outputDelimiter(),e))console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}static className="tl-watermark_SEE-LICENSE"}let dx=(0,y.createContext)({}),dv=()=>(0,y.useContext)(dx);function dw({licenseKey:e,children:t}){let[n]=(0,y.useState)(()=>new db(e));return(0,m.jsx)(dx.Provider,{value:n,children:t})}let dS=`${lD()}/watermarks/watermark-desktop.svg`,dk=`data:image/svg+xml;utf8,${encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>')}`,dC=null;async function dP(e){return e?dk:(dC||(dC=Promise.race([(async()=>{try{let e=await e_(dS);if(!e.ok)return dk;let t=await e.blob();return URL.createObjectURL(t)}catch{return dk}})(),new Promise(e=>{setTimeout(()=>{e(dk)},3e3)})])),dC)}let d_=y.memo(function({forceLocal:e=!1}){let t=oU(),n=i8(),r=dv(),i=iJ("show watermark",()=>tC.enableLicensing.get()&&n.getViewportScreenBounds().width>760&&"unlicensed"===r.state.get(),[n,r]),o=iJ("debug mode",()=>n.getInstanceState().isDebugMode,[n]),s=iJ("is menu open",()=>n.getIsMenuOpen(),[n]),[a,l]=(0,y.useState)(null),c=e||r.isDevelopment;if((0,y.useEffect)(()=>{if(!i)return;let e=!1;return(async()=>{let t=await dP(c);e||l(t)})(),()=>{e=!0}},[c,i]),!i||!a)return null;let d=db.className,u=`url('${a}') center 100% / 100% no-repeat`;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("style",{children:`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
users. By using this library, you agree to keep the watermark's behavior, 
keeping it visible, unobscured, and available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${d} {
	position: absolute;
	bottom: var(--space-2);
	right: var(--space-2);
	width: 96px;
	height: 32px;
	z-index: 2147483647 !important;
	pointer-events: ${s?"none":"all"};
	background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
	border-radius: 5px;
	padding: 2px;
	box-sizing: content-box;
}

.${d}[data-debug='true'] {
	bottom: 46px;
}

.${d} > a {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: none;
	cursor: inherit;
	color: var(--color-text);
	background-color: currentColor;
	opacity: .28;
}

@media (hover: hover) {
	.${d}:hover {
		background-color: var(--color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}
	.${d}:hover > a {
		animation: delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}
}

@keyframes delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}
`}),(0,m.jsx)("div",{className:d,"data-debug":o,draggable:!1,...t,children:(0,m.jsx)("a",{href:"https://tldraw.dev",target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:oF,style:{mask:u,WebkitMask:u}})})]})}),dI=[],dE=[],dj=[],dT=(0,y.memo)(function({store:e,components:t,className:n,user:r,...i}){let[o,s]=y.useState(null),a=(0,y.useMemo)(()=>r??a4(),[r]),l=t?.ErrorFallback===void 0?aR:t?.ErrorFallback,c={...i,shapeUtils:i.shapeUtils??dI,bindingUtils:i.bindingUtils??dE,tools:i.tools??dj,components:t};return(0,m.jsx)("div",{ref:s,"data-tldraw":i1,draggable:!1,className:i0("tl-container tl-theme__light",n),onPointerDown:oF,tabIndex:-1,children:(0,m.jsx)(i4,{fallback:l,onError:e=>eP(e,{tags:{origin:"react.tldraw-before-app"}}),children:o&&(0,m.jsx)(dw,{licenseKey:i.licenseKey,children:(0,m.jsx)(oH,{container:o,children:(0,m.jsx)(aO,{overrides:t,children:e?e instanceof tG?(0,m.jsx)(dL,{...c,store:e,user:a}):(0,m.jsx)(dA,{...c,store:e,user:a}):(0,m.jsx)(dM,{...c,store:e,user:a})})})})})})});function dM(e){let{defaultName:t,snapshot:n,initialData:r,shapeUtils:i,bindingUtils:o,persistenceKey:s,sessionId:a,user:l,assets:c}=e,d=function(e){let[t,n]=du({status:"loading"});return e=aT(e,aM),(0,y.useEffect)(()=>{let{persistenceKey:t,sessionId:r,...i}=e;if(!t){n({status:"not-synced",store:cW(i)});return}n({status:"loading"});let o=new em,s={upload:async(e,t)=>(await c.db.storeAsset(e.id,t),e.id),resolve:async e=>e.props.src?e.props.src.startsWith("asset:")?await o.get(e,async()=>{let t=await c.db.getAsset(e.id);return t?URL.createObjectURL(t):null}):e.props.src:null,...i.assets},a=cW({...i,assets:s}),l=!1,c=new dd(a,{sessionId:r,persistenceKey:t,onLoad(){l||n({store:a,status:"synced-local"})},onLoadError(e){l||n({status:"error",error:e})}});return()=>{l=!0,c.close()}},[e,n]),t}({shapeUtils:i,bindingUtils:o,initialData:r,persistenceKey:s,sessionId:a,defaultName:t,snapshot:n,assets:c});return(0,m.jsx)(dA,{...e,store:d,user:l})}let dA=(0,y.memo)(function({store:e,user:t,...n}){let r=oK();(0,y.useLayoutEffect)(()=>{"dark"===t.userPreferences.get().colorScheme&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,t]);let{LoadingScreen:i}=aL();switch(e.status){case"error":throw e.error;case"loading":return i?(0,m.jsx)(i,{}):null}return(0,m.jsx)(dL,{...n,store:e.store,user:t})}),dO=()=>document.location.search.includes("tldraw_preserve_focus");function dL({onMount:e,children:t,store:n,tools:r,shapeUtils:i,bindingUtils:o,user:s,initialState:a,autoFocus:l=!0,inferDarkMode:c,cameraOptions:d,options:u,licenseKey:h}){let{ErrorFallback:p}=aL(),f=oK(),[g,b]=du(null),x=(0,y.useRef)({autoFocus:l&&!dO(),inferDarkMode:c,initialState:a,cameraOptions:d});(0,y.useLayoutEffect)(()=>{x.current={autoFocus:l&&!dO(),inferDarkMode:c,initialState:a,cameraOptions:d}},[l,c,a,d]),(0,y.useLayoutEffect)(()=>{let{autoFocus:e,inferDarkMode:t,initialState:a,cameraOptions:l}=x.current,c=new cT({store:n,shapeUtils:i,bindingUtils:o,tools:r,getContainer:()=>f,user:s,initialState:a,autoFocus:e,inferDarkMode:t,cameraOptions:l,options:u,licenseKey:h});return b(c),()=>{c.dispose()}},[o,f,u,i,n,r,s,b,h]),(0,y.useLayoutEffect)(()=>{g&&d&&g.setCameraOptions(d)},[g,d]);let v=(0,y.useSyncExternalStore)((0,y.useCallback)(e=>g?(g.on("crash",e),()=>g.off("crash",e)):()=>{},[g]),()=>g?.getCrashingError()??null);(0,y.useEffect)(function(){if(g&&l&&dO())return g.getContainer().addEventListener("pointerdown",e),document.body.addEventListener("pointerdown",t),()=>{g.getContainer()?.removeEventListener("pointerdown",e),document.body.removeEventListener("pointerdown",t)};function e(){g&&g.focus()}function t(){g&&g.blur()}},[g,l]);let{Canvas:w}=aL();return g?(0,m.jsx)(i4,{fallback:p,onError:e=>g.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:v?(0,m.jsx)(dz,{crashingError:v}):(0,m.jsx)(i6.Provider,{value:g,children:(0,m.jsxs)(dD,{onMount:e,children:[t??(w?(0,m.jsx)(w,{}):null),(0,m.jsx)(d_,{})]})})}):null}function dD({children:e,onMount:t}){return function(){let e=i8(),t=oK();y.useEffect(()=>{let n=e=>t.style.setProperty("--tl-zoom",e.toString()),r=ek(n,100),i=new $("useZoomCss",()=>{e.getCurrentPageShapeIds().size<300?n(e.getZoomLevel()):r(e.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),r.cancel()}},[e,t])}(),function(){let e=i8(),t=oK(),n=cD();iQ("useCursor",()=>{let{type:r,rotation:i}=e.getInstanceState().cursor;if(c$.includes(r)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}t.style.setProperty("--tl-cursor",cU(r,i,n?"white":"black"))},[e,t,n])}(),function(){let e=i8(),t=oK(),n=cD(),r=iJ(t_.forceSrgb);y.useEffect(()=>{n?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),r?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[e,t,r,n])}(),function(){let[e,t]=(0,y.useState)(0);(0,y.useEffect)(()=>t(e=>e+1),[])}(),dF(e=>{let n=e.store.props.onMount(e),r=t?.(e);return()=>{n?.(),r?.()}}),e}function dz({crashingError:e}){throw e}function dR({children:e}){return(0,m.jsx)("div",{className:"tl-loading",children:e})}function dN({children:e}){return(0,m.jsx)("div",{className:"tl-loading",children:e})}function dF(e){let t=i8(),n=cV(t=>{let n;return t.run(()=>{n=e?.(t),t.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,n});y.useLayoutEffect(()=>{if(t)return n?.(t)},[t,n])}function d$({children:e,className:t="",...n}){return(0,m.jsx)("div",{...n,className:i0("tl-html-container",t),children:e})}class dB{constructor(e){this.editor=e}static props;static migrations;static type}function dU(e,t,n={}){let{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=n,u=e.props.w*o,h=e.props.h*s,p=new ot(0,0);if(u>0){if(u<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=u-a;break;case"top":case"bottom":p.x=(u-a)/2;break;default:p.x=0}u=a}}else if(p.x=u,(u=-u)<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=-u;break;default:p.x=-a}u=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":p.y=h-c;break;case"right":case"left":p.y=(h-c)/2;break;default:p.y=0}h=c}}else if(p.y=h,(h=-h)<c){switch(i){case"top_left":case"top":case"top_right":p.y=-h;break;default:p.y=-c}h=c}let{x:f,y:g}=p.rot(e.rotation).add(r);return{...e,x:f,y:g,props:{w:Math.min(l,u),h:Math.min(d,h)}}}class dV extends lP{getGeometry(e){return new lC({width:e.props.w,height:e.props.h,isFilled:!0})}onResize=(e,t)=>dU(e,t);getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,n){var r,i;return{...t.props,w:(r=e.props.w)+(t.props.w-r)*n,h:(i=e.props.h)+(t.props.h-i)*n}}}class dH extends cP{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}}class dK extends cP{static id="pointing";markId="";wasFocusedOnEnter=!1;onEnter=()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,n=this.parent.shapeType,r=nG();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:n,x:t.x,y:t.y,props:{w:1,h:1}}]).select(r),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);let t=this.parent.shapeType,n=nG();this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);let r=this.editor.getShape(n);if(!r){this.cancel();return}let{w:i,h:o}=r.props,s=new ot(i/2,o/2),a=this.editor.getShapeParentTransform(r);a&&s.rot(-a.rotation());let l=1;this.editor.user.getIsDynamicResizeMode()&&(i*=l=1/this.editor.getZoomLevel(),o*=l,s.mul(l));let c=tS(r);c.x=r.x-s.x,c.y=r.y-s.y,c.props.w=i,c.props.h=o,"scale"in r.props&&(c.props.scale=l),this.editor.updateShape(c),this.editor.setSelectedShapes([n]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}}class dW extends cP{static id="box";static initial="idle";static children=()=>[dH,dK];onCreate}function dG(e){let t=i8();return iJ("isEditing",()=>t.getEditingShapeId()===e,[t,e])}function dq(e){let t=i8();return(0,y.useMemo)(function(){let n,r;return{onPointerDown:n=>{if(n.isKilled)return;if(2===n.button){t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...oB(n)});return}if(0!==n.button)return;let r=oD(n.currentTarget);oR(r,n),r.addEventListener("pointerup",function e(){r.removeEventListener("pointerup",e),oN(r,n)}),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...oB(n)}),oF(n)},onPointerMove:function(i){i.isKilled||0!==i.button||i.clientX===n&&i.clientY===r||(n=i.clientX,r=i.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...oB(i)}))},onPointerUp:n=>{n.isKilled||0!==n.button||t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...oB(n)})}}},[t,e])}function dY(e,t=20){return Math.max(8,Math.ceil(e/t))}class dX extends sN{_center;radius;start;end;largeArcFlag;sweepFlag;measure;angleStart;angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});let{center:t,sweepFlag:n,largeArcFlag:r,start:i,end:o}=e;if(i.equals(o))throw Error("Arc must have different start and end points.");this.angleStart=ot.Angle(t,i),this.angleEnd=ot.Angle(t,o),this.radius=ot.Dist(t,i),this.measure=function(e,t,n,r){let i=(t-e)%oa*2%oa-(t-e)%oa;return r?(oa-Math.abs(i))*(n?1:-1):i}(this.angleStart,this.angleEnd,n,r),this.start=i,this.end=o,this.sweepFlag=n,this.largeArcFlag=r,this._center=t}nearestPoint(e){let t,n;let{_center:r,measure:i,radius:o,angleEnd:s,angleStart:a,start:l,end:c}=this,d=oE(i,a,s,r.angle(e));if(d<=0)return l;if(d>=1)return c;let u=r.clone().add(e.clone().sub(r).uni().mul(o)),h=1/0;for(let r of[l,c,u])(n=ot.Dist2(e,r))<h&&(t=r,h=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){let{_center:n,radius:r,measure:i,angleStart:o,angleEnd:s}=this,a=lh(e,t,n,r);return null!==a&&a.some(e=>{let t=oE(i,o,s,n.angle(e));return t>=0&&t<=1})}getVertices(){let{_center:e,measure:t,length:n,radius:r,angleStart:i}=this,o=[];for(let s=0,a=dY(Math.abs(n));s<a+1;s++){let n=i+s/a*t;o.push(ox(e,r,n))}return o}getSvgPathData(e=!0){let{start:t,end:n,radius:r,largeArcFlag:i,sweepFlag:o}=this;return`${e?`M${t.toFixed()}`:""} A${r} ${r} 0 ${i} ${o} ${n.toFixed()}`}getLength(){return this.measure*this.radius}}class dZ extends sN{constructor(e){super({isClosed:!0,...e}),this.config=e;let{x:t=0,y:n=0,radius:r}=e;this.x=t,this.y=n,this._center=new ot(r+t,r+n),this.radius=r}_center;radius;x;y;getBounds(){return new sL(this.x,this.y,2*this.radius,2*this.radius)}getVertices(){let{_center:e,radius:t}=this,n=[];for(let r=0,i=dY(oa*t);r<i;r++){let o=r/i*oa;n.push(ox(e,t,o))}return n}nearestPoint(e){let{_center:t,radius:n}=this;return t.equals(e)?ot.AddXY(t,n,0):t.clone().add(e.clone().sub(t).uni().mul(n))}hitTestLineSegment(e,t,n=0){let{_center:r,radius:i}=this;return null!==lh(e,t,r,i+n)}getSvgPathData(){let{_center:e,radius:t}=this;return`M${e.x+t},${e.y} a${t},${t} 0 1,0 ${2*t},0a${t},${t} 0 1,0 -${2*t},0`}}class dQ extends lS{a;b;c;d;constructor(e){let{start:t,cp1:n,cp2:r,end:i}=e;super({...e,points:[t,i]}),this.a=t,this.b=n,this.c=r,this.d=i}getVertices(){let e=[],{a:t,b:n,c:r,d:i}=this;for(let o=0;o<=10;o++){let s=o/10;e.push(new ot((1-s)*(1-s)*(1-s)*t.x+(1-s)*(1-s)*3*s*n.x+3*(1-s)*(s*s)*r.x+s*s*s*i.x,(1-s)*(1-s)*(1-s)*t.y+(1-s)*(1-s)*3*s*n.y+3*(1-s)*(s*s)*r.y+s*s*s*i.y))}return e}midPoint(){return dQ.GetAtT(this,.5)}nearestPoint(e){let t,n,r;let i=1/0;for(let o of this.segments)r=o.nearestPoint(e),(n=ot.Dist2(r,e))<i&&(t=r,i=n);if(!t)throw Error("nearest point not found");return t}getSvgPathData(e=!0){let{a:t,b:n,c:r,d:i}=this;return`${e?`M ${t.toFixed()} `:""} C${n.toFixed()} ${r.toFixed()} ${i.toFixed()}`}static GetAtT(e,t){let{a:n,b:r,c:i,d:o}=e;return new ot((1-t)*(1-t)*(1-t)*n.x+(1-t)*(1-t)*3*t*r.x+3*(1-t)*(t*t)*i.x+t*t*t*o.x,(1-t)*(1-t)*(1-t)*n.y+(1-t)*(1-t)*3*t*r.y+3*(1-t)*(t*t)*i.y+t*t*t*o.y)}getLength(e=32){let t,n=this.a,r=0;for(let i=1;i<=e;i++)t=dQ.GetAtT(this,i/e),r+=ot.Dist(n,t),n=t;return r}}class dJ extends sN{points;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{points:e}=this,t=e.length,n=t-2;for(let r=0;r<t-1;r++){let t=0===r?e[0]:e[r-1],i=e[r],o=e[r+1],s=r===n?o:e[r+2],a=0===r?t:new ot(i.x+(o.x-t.x)/6*1.25,i.y+(o.y-t.y)/6*1.25),l=r===n?o:new ot(o.x-(s.x-i.x)/6*1.25,o.y-(s.y-i.y)/6*1.25);this._segments.push(new dQ({start:i,cp1:a,cp2:l,end:o}))}}return this._segments}getLength(){return this.segments.reduce((e,t)=>e+t.length,0)}getVertices(){let e=this.segments.reduce((e,t)=>e.concat(t.vertices),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let t,n,r;let i=1/0;for(let o of this.segments)r=o.nearestPoint(e),(n=ot.Dist2(r,e))<i&&(t=r,i=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.segments.some(n=>n.hitTestLineSegment(e,t))}getSvgPathData(){let e=this.segments.reduce((e,t,n)=>e+t.getSvgPathData(0===n),"");return this.isClosed&&(e+="Z"),e}}class d0 extends sN{constructor(e){super({...e,isClosed:!0}),this.config=e;let{width:t,height:n}=e;this.w=t,this.h=n}w;h;_edges;get edges(){if(!this._edges){let{vertices:e}=this;this._edges=[];for(let t=0,n=e.length;t<n;t++){let r=e[t],i=e[(t+1)%n];this._edges.push(new lw({start:r,end:i}))}}return this._edges}getVertices(){let e=Math.max(1,this.w),t=Math.max(1,this.h),n=e/2,r=t/2,i=Math.pow(n-r,2)/Math.pow(n+r,2),o=dY(oo*(n+r)*(1+3*i/(10+Math.sqrt(4-3*i)))),s=oa/o,a=Math.cos(s),l=Math.sin(s),c=0,d=1,u=0,h=1,p=Array(o);for(let e=0;e<o;e++)p[e]=new ot(n+n*d,r+r*c),u=l*d+a*c,h=a*d-l*c,c=u,d=h;return p}nearestPoint(e){let t,n,r;let i=1/0;for(let o of this.edges)r=o.nearestPoint(e),(n=ot.Dist2(r,e))<i&&(t=r,i=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){return this.edges.some(n=>n.hitTestLineSegment(e,t))}getBounds(){return new sL(0,0,this.w,this.h)}getLength(){let{w:e,h:t}=this;return oh(Math.max(0,e/2),Math.max(0,t/2))}getSvgPathData(e=!1){let{w:t,h:n}=this,r=t/2,i=n/2,o=Math.max(0,r),s=Math.max(0,i);return`${e?`M${r-o},${i}`:""} a${o},${s},0,1,1,${2*o},0a${o},${s},0,1,1,-${2*o},0`}}class d1 extends sN{constructor(e){super({...e,isClosed:!0}),this.config=e;let{width:t,height:n}=e;if(this.w=t,this.h=n,n>t){let e=t/2;this.a=new dX({start:new ot(0,e),end:new ot(t,e),center:new ot(t/2,e),sweepFlag:1,largeArcFlag:1}),this.b=new lw({start:new ot(t,e),end:new ot(t,n-e)}),this.c=new dX({start:new ot(t,n-e),end:new ot(0,n-e),center:new ot(t/2,n-e),sweepFlag:1,largeArcFlag:1}),this.d=new lw({start:new ot(0,n-e),end:new ot(0,e)})}else{let e=n/2;this.a=new dX({start:new ot(e,n),end:new ot(e,0),center:new ot(e,e),sweepFlag:1,largeArcFlag:1}),this.b=new lw({start:new ot(e,0),end:new ot(t-e,0)}),this.c=new dX({start:new ot(t-e,0),end:new ot(t-e,n),center:new ot(t-e,e),sweepFlag:1,largeArcFlag:1}),this.d=new lw({start:new ot(t-e,n),end:new ot(e,n)})}}w;h;a;b;c;d;nearestPoint(e){let t,n,r;let i=1/0,{a:o,b:s,c:a,d:l}=this;for(let c of[o,s,a,l])r=c.nearestPoint(e),(n=ot.Dist2(r,e))<i&&(t=r,i=n);if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t){let{a:n,b:r,c:i,d:o}=this;return[n,r,i,o].some(n=>n.hitTestLineSegment(e,t))}getVertices(){let{a:e,b:t,c:n,d:r}=this;return[e,t,n,r].reduce((e,t)=>(e.push(...t.vertices),e),[])}getBounds(){return new sL(0,0,this.w,this.h)}getLength(){let{h:e,w:t}=this;return e>t?(t/2*oo+(e-t))*2:(e/2*oo+(t-e))*2}getSvgPathData(){let{a:e,b:t,c:n,d:r}=this;return[e,t,n,r].map((e,t)=>e.getSvgPathData(0===t)).join(" ")+" Z"}}async function d2({shouldReload:e=!0}={}){for(let e of(function(){try{sessionStorage.clear()}catch{}}(),dr.connectedInstances))await e.close();await Promise.all(di().map(e=>c5(e))),function(){try{localStorage.clear()}catch{}}(),e&&window.location.reload()}function d3({children:e}){let t=i8();return iJ("shouldDisplayHandles",()=>{if(t.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(t.isInAny("select.editing_shape")){let e=t.getOnlySelectedShape();return e&&t.isShapeOfType(e,"note")}return!1},[t])?(0,m.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e}):null}"undefined"!=typeof window&&(window.__tldraw__hardReset=d2);let{PI:d5}=Math,d4=d5+1e-4;function d6(e,t={}){let n;let{size:r=16,smoothing:i=.5}=t;if(0===e.length||r<=0)return{left:[],right:[]};let o=e[0],s=e[e.length-1],a=s.runningLength,l=Math.pow(r*i,2),c=[],d=[],u=e[0].vector,h=e[0].point,p=h,f=h,g=p,m=!1;for(let t=0;t<e.length;t++){n=e[t];let{point:r,vector:i}=e[t],y=n.vector.dpr(u),b=(t<e.length-1?e[t+1]:e[t]).vector,x=t<e.length-1?b.dpr(n.vector):1,v=null!==x&&x<.2;if(y<0&&!m||v){if(x>-.62&&a-n.runningLength>n.radius){let e=u.clone().mul(n.radius);0>u.clone().cpr(b)?(f=ot.Add(r,e),g=ot.Sub(r,e)):(f=ot.Sub(r,e),g=ot.Add(r,e)),c.push(f),d.push(g)}else{let e=u.clone().mul(n.radius).per(),t=ot.Sub(n.input,e);for(let e=1/13,r=0;r<1;r+=e)f=ot.RotWith(t,n.input,d4*r),c.push(f),g=ot.RotWith(t,n.input,d4+-(d4*r)),d.push(g)}h=f,p=g,v&&(m=!0);continue}if(m=!1,n===o||n===s){let e=ot.Per(i).mul(n.radius);c.push(ot.Sub(r,e)),d.push(ot.Add(r,e));continue}let w=ot.Lrp(b,i,x).per().mul(n.radius);f=ot.Sub(r,w),(t<=1||ot.Dist2(h,f)>l)&&(c.push(f),h=f),g=ot.Add(r,w),(t<=1||ot.Dist2(p,g)>l)&&(d.push(g),p=g),u=i}return{left:c,right:d}}function d8(e,t={}){let{size:n=16,start:r={},end:i={},last:o=!1}=t,{cap:s=!0}=r,{cap:a=!0}=i;if(0===e.length||n<=0)return[];let l=e[0],c=e[e.length-1],d=c.runningLength,u=!1===r.taper?0:!0===r.taper?Math.max(n,d):r.taper,h=!1===i.taper?0:!0===i.taper?Math.max(n,d):i.taper,{left:p,right:f}=d6(e,t),g=l.point,m=e.length>1?e[e.length-1].point:ot.AddXY(l.point,1,1);if(1===e.length&&(!(u||h)||o)){let e=ot.Add(g,ot.Sub(g,m).uni().per().mul(-l.radius)),t=[];for(let n=1/13,r=n;r<=1;r+=n)t.push(ot.RotWith(e,g,2*d4*r));return t}let y=[];if(u||h&&1===e.length);else if(s)for(let e=1/8,t=e;t<=1;t+=e){let e=ot.RotWith(f[0],g,d4*t);y.push(e)}else{let e=ot.Sub(p[0],f[0]),t=ot.Mul(e,.5),n=ot.Mul(e,.51);y.push(ot.Sub(g,t),ot.Sub(g,n),ot.Add(g,n),ot.Add(g,t))}let b=[],x=c.vector.clone().per().neg();if(h||u&&1===e.length)b.push(m);else if(a){let e=ot.Add(m,ot.Mul(x,c.radius));for(let t=1/29,n=t;n<1;n+=t)b.push(ot.RotWith(e,m,3*d4*n))}else b.push(ot.Add(m,ot.Mul(x,c.radius)),ot.Add(m,ot.Mul(x,.99*c.radius)),ot.Sub(m,ot.Mul(x,.99*c.radius)),ot.Sub(m,ot.Mul(x,c.radius)));return p.concat(b,f.reverse(),y)}function d9(e,t={}){let n,r;let{streamline:i=.5,size:o=16,simulatePressure:s=!1}=t;if(0===e.length)return[];let a=.15+(1-i)*.85,l=e.map(ot.From),c=0;if(!s){let e=l[0];for(;e&&!(e.z>=.025);)l.shift(),e=l[0]}if(!s){let e=l[l.length-1];for(;e&&!(e.z>=.01);)l.pop(),e=l[l.length-1]}if(0===l.length)return[{point:ot.From(e[0]),input:ot.From(e[0]),pressure:s?.5:.15,vector:new ot(1,1),distance:0,runningLength:0,radius:1}];let d=l[1];for(;d&&!(ot.Dist2(d,l[0])>(o/3)**2);)l[0].z=Math.max(l[0].z,d.z),l.splice(1,1),d=l[1];let u=l.pop();for(d=l[l.length-1];d&&!(ot.Dist2(d,u)>(o/3)**2);)l.pop(),d=l[l.length-1],c++;l.push(u);let h=t.last||!t.simulatePressure||l.length>1&&ot.Dist2(l[l.length-1],l[l.length-2])<o**2||c>0;if(2===l.length&&t.simulatePressure){let e=l[1];l=l.slice(0,-1);for(let t=1;t<5;t++){let n=ot.Lrp(l[0],e,t/4);n.z=(l[0].z+(e.z-l[0].z))*t/4,l.push(n)}}let p=[{point:l[0],input:l[0],pressure:s?.5:l[0].z,vector:new ot(1,1),distance:0,runningLength:0,radius:1}],f=0,g=p[0];h&&i>0&&l.push(l[l.length-1].clone());for(let e=1,i=l.length;e<i;e++)if(n=!a||t.last&&e===i-1?l[e].clone():l[e].clone().lrp(g.point,1-a),!g.point.equals(n)){if(f+=r=ot.Dist(n,g.point),e<4&&f<o)continue;g={input:l[e],point:n,pressure:s?.5:l[e].z,vector:ot.Sub(g.point,n).uni(),distance:r,runningLength:f,radius:1},p.push(g)}if(p[1]?.vector&&(p[0].vector=p[1].vector.clone()),f<1){let e=Math.max(.5,...p.map(e=>e.pressure));p.forEach(t=>t.pressure=e)}return p}let{min:d7}=Math;function ue(e,t){let n,r;let{size:i=16,thinning:o=.5,simulatePressure:s=!0,easing:a=e=>e,start:l={},end:c={}}=t,{easing:d=oe.easeOutQuad}=l,{easing:u=oe.easeOutCubic}=c,h=e[e.length-1].runningLength,p=e[0].pressure;if(!s&&h<i){let t=e.reduce((e,t)=>Math.max(e,t.pressure),.5);return e.forEach(e=>{e.pressure=t,e.radius=i*a(.5-o*(.5-e.pressure))}),e}{let t;for(let n=0,o=e.length;n<o&&!((r=e[n]).runningLength>5*i);n++){let e=d7(1,r.distance/i);if(s){let n=d7(1,1-e);t=d7(1,p+.275*e*(n-p))}else t=d7(1,p+(r.pressure-p)*.5);p+=(t-p)*.5}for(let t=0;t<e.length;t++){if(r=e[t],o){let{pressure:e}=r,t=d7(1,r.distance/i);if(s){let n=d7(1,1-t);e=d7(1,p+.275*t*(n-p))}else e=d7(1,p+.275*t*(e-p));r.radius=i*a(.5-o*(.5-e)),p=e}else r.radius=i/2;void 0===n&&(n=r.radius)}}let f=!1===l.taper?0:!0===l.taper?Math.max(i,h):l.taper,g=!1===c.taper?0:!0===c.taper?Math.max(i,h):c.taper;if(f||g)for(let t=0;t<e.length;t++){let{runningLength:n}=r=e[t],i=n<f?d(n/f):1,o=h-n<g?u((h-n)/g):1;r.radius=Math.max(.01,r.radius*Math.min(i,o))}return e}function ut({scribble:e,zoom:t,color:n,opacity:r,className:i}){let o;if(!e.points.length)return null;let s=function(e,t={}){return d8(ue(d9(e,t),t),t)}(e.points,{size:e.size/t,start:{taper:e.taper,easing:oe.linear},last:"stopping"===e.state,simulatePressure:!1,streamline:.32});if(s.length<4){let n=e.size/t/2,{x:r,y:i}=e.points[e.points.length-1];o=`M ${r-n},${i} a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 ${-(2*n)},0`}else o=ag(s);return(0,m.jsx)("svg",{className:i?i0("tl-overlays__item",i):i,children:(0,m.jsx)("path",{className:"tl-scribble",d:o,fill:n??`var(--color-${e.color})`,opacity:r??e.opacity})})}let un=({bounds:e,rotation:t})=>{let n=i8();return iJ("should display",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[n])?(0,m.jsx)(ay,{bounds:e,rotation:t}):null};function ur(){let e=i8();return iJ("isReadonlyMode",()=>e.getInstanceState().isReadonly,[e])}function ui({size:e,width:t,height:n,hideAlternateHandles:r}){let i=oC(e/3),o=i/2;return(0,m.jsxs)("svg",{className:"tl-overlays__item",children:[(0,m.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${oC(0-o)},${oC(e)} 
						${oC(0-o)},${oC(0-o)} 
						${oC(e)},${oC(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),(0,m.jsx)("line",{className:i0("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:oC(t/2-e),y1:oC(0-o),x2:oC(t/2+e),y2:oC(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),(0,m.jsx)("polyline",{className:i0("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${oC(t-e)},${oC(0-o)} 
						${oC(t+o)},${oC(0-o)} 
						${oC(t+o)},${oC(e)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),(0,m.jsx)("line",{className:i0("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:oC(t+o),y1:oC(n/2-e),x2:oC(t+o),y2:oC(n/2+e),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),(0,m.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${oC(t+o)},${oC(n-e)} 
						${oC(t+o)},${oC(n+o)}
						${oC(t-e)},${oC(n+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),(0,m.jsx)("line",{className:i0("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:oC(t/2-e),y1:oC(n+o),x2:oC(t/2+e),y2:oC(n+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),(0,m.jsx)("polyline",{className:i0("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${oC(0+e)},${oC(n+o)} 
						${oC(0-o)},${oC(n+o)}
						${oC(0-o)},${oC(n-e)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),(0,m.jsx)("line",{className:i0("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:oC(0-o),y1:oC(n/2-e),x2:oC(0-o),y2:oC(n/2+e),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}let uo=iZ(function({bounds:e,rotation:t}){let n=i8(),r=(0,y.useRef)(null),i=ur(),o=dq("top"),s=dq("right"),a=dq("bottom"),l=dq("left"),c=dq("top_left"),d=dq("top_right"),u=dq("bottom_right"),h=dq("bottom_left"),p=!n.getIsMenuOpen()&&"default"===n.getInstanceState().cursor.type,f=n.getInstanceState().isCoarsePointer,g=n.getOnlySelectedShape(),b=g&&n.isShapeOrAncestorLocked(g),x=g?n.getShapeUtil(g).expandSelectionOutlinePx(g):0;if(i7(r,e?.x,e?.y,1,n.getSelectionRotation(),{x:-x,y:-x}),!e)return null;e=e.clone().expandBy(x).zeroFix();let v=n.getZoomLevel(),w=n.getInstanceState().isChangingStyle,S=e.width,k=e.height,C=8/v,P=S<2*C,_=k<2*C,I=S<4*C,E=k<4*C,j=S<5*C,T=k<5*C,M=f?1.75:1,A=6/v*M,O=.75*M*(I?A/2:A),L=.75*M*(E?A/2:A),D=(!g||!n.getShapeUtil(g).hideSelectionBoundsFg(g))&&!w,z=D&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||D&&n.isIn("select.resizing")&&g&&n.isShapeOfType(g,"text");g&&z&&n.environment.isFirefox&&n.isShapeOfType(g,"embed")&&(z=!1);let R=n.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!w&&!i,N=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!w&&!i,F=!f&&!(P||_)&&(N||R)&&(!g||!n.getShapeUtil(g).hideRotateHandle(g))&&!b,$=f&&(!I||!E)&&(N||R)&&(!g||!n.getShapeUtil(g).hideRotateHandle(g))&&!b,B=N&&(!g||n.getShapeUtil(g).canResize(g)&&!n.getShapeUtil(g).hideResizeHandles(g))&&!R&&!b,U=P||_,V=P&&_,H=j||T,K=B||R,W=!F,G=!N||!$,q=!N||!K,Y=!N||!K||U,X=!N||!K||U,Z=!N||!K||V&&!R,Q=!0,J=!0;if(R)Q=H,J=H;else if(B){Q=U||V||f;let e=f&&g&&"text"===g.type;J=Q&&!e}let ee=Math.min(24/v,k-3*L),et=N&&f&&g&&n.isShapeOfType(g,"text")&&ee*v>=4;return(0,m.jsx)("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,m.jsxs)("g",{ref:r,children:[z&&(0,m.jsx)("rect",{className:"tl-selection__fg__outline",width:oC(S),height:oC(k)}),(0,m.jsx)(us,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:A,corner:"top_left_rotate",cursor:p?cU("nwse-rotate",t):void 0,isHidden:W}),(0,m.jsx)(us,{"data-testid":"selection.rotate.top-right",cx:S+3*A,cy:0,targetSize:A,corner:"top_right_rotate",cursor:p?cU("nesw-rotate",t):void 0,isHidden:W}),(0,m.jsx)(us,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:k+3*A,targetSize:A,corner:"bottom_left_rotate",cursor:p?cU("swne-rotate",t):void 0,isHidden:W}),(0,m.jsx)(us,{"data-testid":"selection.rotate.bottom-right",cx:S+3*A,cy:k+3*A,targetSize:A,corner:"bottom_right_rotate",cursor:p?cU("senw-rotate",t):void 0,isHidden:W}),(0,m.jsx)(ul,{"data-testid":"selection.rotate.mobile",cx:I?-(1.5*A):S/2,cy:I?k/2:-(1.5*A),size:C,isHidden:G}),(0,m.jsx)("rect",{className:i0("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:oC(0-(E?2*L:L)),width:oC(S),height:oC(Math.max(1,2*L)),style:p?{cursor:cU("ns-resize",t)}:void 0,...o}),(0,m.jsx)("rect",{className:i0("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:oC(S-(I?0:O)),y:0,height:oC(k),width:oC(Math.max(1,2*O)),style:p?{cursor:cU("ew-resize",t)}:void 0,...s}),(0,m.jsx)("rect",{className:i0("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:oC(k-(E?0:L)),width:oC(S),height:oC(Math.max(1,2*L)),style:p?{cursor:cU("ns-resize",t)}:void 0,...a}),(0,m.jsx)("rect",{className:i0("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:oC(0-(I?2*O:O)),y:0,height:oC(k),width:oC(Math.max(1,2*O)),style:p?{cursor:cU("ew-resize",t)}:void 0,...l}),(0,m.jsx)("rect",{className:i0("tl-transparent",{"tl-hidden":q}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:oC(0-(I?2*O:1.5*O)),y:oC(0-(E?2*L:1.5*L)),width:oC(3*O),height:oC(3*L),style:p?{cursor:cU("nwse-resize",t)}:void 0,...c}),(0,m.jsx)("rect",{className:i0("tl-transparent",{"tl-hidden":Y}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:oC(S-(I?0:1.5*O)),y:oC(0-(E?2*L:1.5*L)),width:oC(3*O),height:oC(3*L),style:p?{cursor:cU("nesw-resize",t)}:void 0,...d}),(0,m.jsx)("rect",{className:i0("tl-transparent",{"tl-hidden":Z}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:oC(S-(I?O:1.5*O)),y:oC(k-(E?L:1.5*L)),width:oC(3*O),height:oC(3*L),style:p?{cursor:cU("nwse-resize",t)}:void 0,...u}),(0,m.jsx)("rect",{className:i0("tl-transparent",{"tl-hidden":X}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:oC(0-(I?3*O:1.5*O)),y:oC(k-(E?0:1.5*L)),width:oC(3*O),height:oC(3*L),style:p?{cursor:cU("nesw-resize",t)}:void 0,...h}),B&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("rect",{"data-testid":"selection.resize.top-left",className:i0("tl-corner-handle",{"tl-hidden":q}),"aria-label":"top_left handle",x:oC(0-C/2),y:oC(0-C/2),width:oC(C),height:oC(C)}),(0,m.jsx)("rect",{"data-testid":"selection.resize.top-right",className:i0("tl-corner-handle",{"tl-hidden":Y}),"aria-label":"top_right handle",x:oC(S-C/2),y:oC(0-C/2),width:oC(C),height:oC(C)}),(0,m.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:i0("tl-corner-handle",{"tl-hidden":Z}),"aria-label":"bottom_right handle",x:oC(S-C/2),y:oC(k-C/2),width:oC(C),height:oC(C)}),(0,m.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:i0("tl-corner-handle",{"tl-hidden":X}),"aria-label":"bottom_left handle",x:oC(0-C/2),y:oC(k-C/2),width:oC(C),height:oC(C)})]}),et&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:oC(0-C/4),y:oC(k/2-ee/2),rx:C/4,width:oC(C/2),height:oC(ee)}),(0,m.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:C/4,x:oC(S-C/4),y:oC(k/2-ee/2),width:oC(C/2),height:oC(ee)})]}),R&&(0,m.jsx)(ui,{size:C,width:S,height:k,hideAlternateHandles:H})]})})}),us=function({cx:e,cy:t,targetSize:n,corner:r,cursor:i,isHidden:o,"data-testid":s}){let a=dq(r);return(0,m.jsx)("rect",{className:i0("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":s,"aria-label":`${r} target`,pointerEvents:"all",x:oC(e-3*n),y:oC(t-3*n),width:oC(Math.max(1,3*n)),height:oC(Math.max(1,3*n)),cursor:i,...a})},ua=Math.sqrt(Math.PI),ul=function({cx:e,cy:t,size:n,isHidden:r,"data-testid":i}){let o=dq("mobile_rotate"),s=i8(),a=iJ("zoom level",()=>s.getZoomLevel(),[s]),l=Math.max(1/a*14,20/Math.max(1,a));return(0,m.jsxs)("g",{children:[(0,m.jsx)("circle",{"data-testid":i,pointerEvents:"all",className:i0("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:e,cy:t,r:l,...o}),(0,m.jsx)("circle",{className:i0("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:e,cy:t,r:n/ua})]})};function uc(){let e=i8();return iJ("is in a valid select state",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[e])?(0,m.jsx)(aC,{}):null}function ud(e,t,n){let{arrowheadStart:r,arrowheadEnd:i}=t.props,o=ub(e,t,n),s=o.start.clone(),a=o.end.clone(),l=ot.Med(s,a);if(ot.Equals(s,a))return{bindings:n,isStraight:!0,start:{handle:s,point:s,arrowhead:t.props.arrowheadStart},end:{handle:a,point:a,arrowhead:t.props.arrowheadEnd},middle:l,isValid:!1,length:0};let c=ot.Sub(a,s).uni(),d=up(e,t,"start"),u=up(e,t,"end"),h=e.getShapePageTransform(t);uu(a,o.start,h,u),uu(s,o.end,h,d);let p=0,f=0,g=0,m=0,y=uw*t.props.scale,b=d&&u&&d.shape===u.shape,x=d&&u?uP(e,d.shape.id,u.shape.id):"safe";"safe"===x&&d&&u&&!b&&!d.isExact&&!u.isExact&&(u.didIntersect&&!d.didIntersect?d.isClosed&&s.setTo(a.clone().add(c.clone().mul(uw*t.props.scale))):!u.didIntersect&&u.isClosed&&a.setTo(s.clone().sub(c.clone().mul(uw*t.props.scale))));let v=ot.Sub(a,s),w=ot.Len(v)?v.uni():ot.From(v),S=!ot.Equals(w,c);b||("start-contains-end"!==x&&d&&"none"!==r&&!d.isExact&&(p=(uS+(g=uC[t.props.size]/2+("size"in d.shape.props?uC[d.shape.props.size]/2:0)))*t.props.scale,y+=g*t.props.scale),"end-contains-start"===x||!u||"none"===i||u.isExact||(f=(uS+(m=uC[t.props.size]/2+("size"in u.shape.props?uC[u.shape.props.size]/2:0)))*t.props.scale,y+=m*t.props.scale));let k=s.clone().add(w.clone().mul(p*(S?-1:1))),C=a.clone().sub(w.clone().mul(f*(S?-1:1)));ot.DistMin(k,C,y)&&(0!==p&&0!==f?(p*=-1.5,f*=-1.5):0!==p?p*=-1:0!==f&&(f*=-1)),s.add(w.clone().mul(p*(S?-1:1))),a.sub(w.clone().mul(f*(S?-1:1))),S?(d&&u&&a.setTo(ot.Add(s,w.clone().mul(-uw*t.props.scale))),l.setTo(ot.Med(o.start,o.end))):l.setTo(ot.Med(s,a));let P=ot.Dist(s,a);return{bindings:n,isStraight:!0,start:{handle:o.start,point:s,arrowhead:t.props.arrowheadStart},end:{handle:o.end,point:a,arrowhead:t.props.arrowheadEnd},middle:l,isValid:P>0,length:P}}function uu(e,t,n,r){let i;if(void 0===r||r.isExact)return;let o=sz.applyToPoint(n,t),s=sz.applyToPoint(n,e),a=sz.applyToPoint(sz.Inverse(r.transform),o),l=sz.applyToPoint(sz.Inverse(r.transform),s),c=r.isClosed,d=(c?lp:function(e,t,n){let r;let i=[];for(let o=0,s=n.length-1;o<s;o++)(r=lu(e,t,n[o],n[o+1]))&&i.push(r);return 0===i.length?null:i})(a,l,r.outline);if(null!==d&&(i=d.sort((e,t)=>ot.Dist2(e,a)-ot.Dist2(t,a))[0]??(c?void 0:l)),void 0===i)return;let u=sz.applyToPoint(r.transform,i),h=sz.applyToPoint(sz.Inverse(n),u);e.setTo(h),r.didIntersect=!0}function uh(e,t,n){let r=oj(e,t,n),i=ot.Dist(r,e),o=+ot.Clockwise(e,n,t),s=((e.y-t.y)**2+(e.x-t.x)**2)**.5,a=((t.y-n.y)**2+(t.x-n.x)**2)**.5,l=((n.y-e.y)**2+(n.x-e.x)**2)**.5,c=2*Math.acos((a*a+l*l-s*s)/(2*a*l)),d=+(oo>c),u=(oa-c)*(o?1:-1);return{center:r,radius:i,size:u,length:u*i,largeArcFlag:d,sweepFlag:o}}function up(e,t,n){let r=e.getBindingsFromShape(t,"arrow").find(e=>e.props.terminal===n);if(!r)return;let i=e.getShape(r.toId);if(!i)return;let o=e.getShapePageTransform(i),s=e.getShapeGeometry(i),a=s instanceof sF?s.children[0].vertices:s.vertices;return{shape:i,transform:o,isClosed:s.isClosed,isExact:r.props.isExact,didIntersect:!1,outline:a}}function uf(e,t,n,r){let i=e.getShape(n.toId);if(!i)return new ot(0,0);{let{point:o,size:s}=e.getShapeGeometry(i).bounds,a=ot.Add(o,ot.MulV(n.props.isPrecise||r?n.props.normalizedAnchor:{x:.5,y:.5},s)),l=sz.applyToPoint(e.getShapePageTransform(i),a);return sz.applyToPoint(sz.Inverse(t),l)}}function ug(e,t){let n=e.getBindingsFromShape(t,"arrow");return{start:n.find(e=>"start"===e.props.terminal),end:n.find(e=>"end"===e.props.terminal)}}let um=function(e,t,n){let r=new em;return{get:(n,i)=>r.get(n,()=>(n instanceof tG?n:n.store).createComputedCache(e,e=>t(n,e),void 0)).get(i)}}("arrow info",(e,t)=>{let n=ug(e,t);return!function(e){return Math.abs(e.props.bend)<8*e.props.scale}(t)?function(e,t,n){let{arrowheadEnd:r,arrowheadStart:i}=t.props,o=t.props.bend;if(Math.abs(o)>Math.abs(t.props.bend*(uk*t.props.scale)))return ud(e,t,n);let s=ub(e,t,n),a=ot.Med(s.start,s.end),l=ot.Sub(s.end,s.start),c=ot.Len(l)?l.uni():ot.From(l),d=ot.Add(a,c.per().mul(-o)),u=up(e,t,"start"),h=up(e,t,"end"),p=s.start.clone(),f=s.end.clone(),g=d.clone();if(ot.Equals(p,f))return{bindings:n,isStraight:!0,start:{handle:p,point:p,arrowhead:t.props.arrowheadStart},end:{handle:f,point:f,arrowhead:t.props.arrowheadEnd},middle:g,isValid:!1,length:0};let m=t.props.bend<0,y=m?of:og,b=uh(p,f,g),x=ot.Angle(b.center,p),v=y(x,ot.Angle(b.center,f));if(0===b.length||0===b.size||!o_(b.length)||!o_(b.size))return ud(e,t,n);let w=p.clone(),S=f.clone(),k=g.clone(),C=e.getShapePageTransform(t),P=0,_=0,I=uw*t.props.scale;if(u&&!u.isExact){let n;let r=sz.applyToPoint(C,w),o=sz.applyToPoint(C,b.center),s=sz.applyToPoint(C,S),a=sz.Inverse(u.transform),l=sz.applyToPoint(a,r),c=sz.applyToPoint(a,o),d=sz.applyToPoint(a,s),{isClosed:h}=u,p=(h?lf:lg)(c,b.radius,u.outline);if(p){let e=c.angle(l),t=y(e,c.angle(d));p=p.filter(n=>y(e,c.angle(n))<=t);let r=.25*t;p.sort(h?(t,n)=>Math.abs(y(e,c.angle(t))-r)<Math.abs(y(e,c.angle(n))-r)?-1:1:(t,n)=>y(e,c.angle(t))<y(e,c.angle(n))?-1:1),n=p[0]??(h?void 0:l)}else n=h?void 0:l;if(n&&(w.setTo(e.getPointInShapeSpace(t,sz.applyToPoint(u.transform,n))),u.didIntersect=!0,"none"!==i)){let e=uC[t.props.size]/2+("size"in u.shape.props?uC[u.shape.props.size]/2:0);P=(uS+e)*t.props.scale,I+=e*t.props.scale}}if(h&&!h.isExact){let n;let i=sz.applyToPoint(C,w),o=sz.applyToPoint(C,S),s=sz.applyToPoint(C,b.center),a=sz.Inverse(h.transform),l=sz.applyToPoint(a,i),c=sz.applyToPoint(a,s),d=sz.applyToPoint(a,o),u=h.isClosed,p=(u?lf:lg)(c,b.radius,h.outline);if(p){let e=c.angle(l),t=y(e,c.angle(d)),r=.75*t;(p=p.filter(n=>y(e,c.angle(n))<=t)).sort(u?(t,n)=>Math.abs(y(e,c.angle(t))-r)<Math.abs(y(e,c.angle(n))-r)?-1:1:(t,n)=>y(e,c.angle(t))<y(e,c.angle(n))?-1:1),n=p[0]?p[0]:u?void 0:d}else n=u?void 0:d;if(n&&(S.setTo(e.getPointInShapeSpace(t,sz.applyToPoint(h.transform,n))),h.didIntersect=!0,"none"!==r)){let e=uC[t.props.size]/2+("size"in h.shape.props?uC[h.shape.props.size]/2:0);_=(uS+e)*t.props.scale,I+=e*t.props.scale}}let E=ot.Angle(b.center,w),j=ot.Angle(b.center,S),T=y(E,j),M=T*b.radius,A=w.clone(),O=S.clone();if(0!==P&&A.setTo(b.center).add(ot.FromAngle(E+P/M*(m?1:-1)*T).mul(b.radius)),0!==_&&O.setTo(b.center).add(ot.FromAngle(j+_/M*(m?-1:1)*T).mul(b.radius)),ot.DistMin(A,O,I)&&(0!==P&&0!==_?(P*=-1.5,_*=-1.5):0!==P?P*=-2:0!==_&&(_*=-2)),0!==P&&w.setTo(b.center).add(ot.FromAngle(E+P/M*(m?1:-1)*T).mul(b.radius)),0!==_&&S.setTo(b.center).add(ot.FromAngle(j+_/M*(m?-1:1)*T).mul(b.radius)),u&&h&&!u.isExact&&!h.isExact){M=(T=y(E=ot.Angle(b.center,w),j=ot.Angle(b.center,S)))*b.radius;let n=uP(e,u.shape.id,h.shape.id);"double-bound"===n&&M<30?(w.setTo(p),S.setTo(f),k.setTo(g)):"safe"===n&&(u&&!u.didIntersect&&w.setTo(p),(h&&!h.didIntersect||y(x,E)>y(x,j))&&S.setTo(b.center).add(ot.FromAngle(E+T*(Math.min(.9,uw*t.props.scale/M)*(m?1:-1))).mul(b.radius)))}(function(e,t,n,r,i,o,s){let a=ot.Angle(e,n),l=of(a,ot.Angle(e,r));if(s||(l=oa-l),i.setTo(e).add(ot.FromAngle(a+.5*(s?1:-1)*l).mul(t)),l>o){i.rotWith(e,oo);let t=r.clone();r.setTo(n),n.setTo(t)}})(b.center,b.radius,w,S,k,v,m),w.equals(S)&&(w.setTo(k.clone().addXY(1,1)),S.setTo(k.clone().subXY(1,1))),p.setTo(w),f.setTo(S),g.setTo(k);let L=uh(p,f,g);return{bindings:n,isStraight:!1,start:{point:p,handle:s.start,arrowhead:t.props.arrowheadStart},end:{point:f,handle:s.end,arrowhead:t.props.arrowheadEnd},middle:g,handleArc:b,bodyArc:L,isValid:0!==L.length&&isFinite(L.center.x)&&isFinite(L.center.y)}}(e,t,n):ud(e,t,n)});function uy(e,t){let n="string"==typeof t?t:t.id;return um.get(e,n)}function ub(e,t,n){let r=e.getShapePageTransform(t),i=uP(e,n.start?.toId,n.end?.toId);return{start:n.start?uf(e,r,n.start,"double-bound"===i||"start-contains-end"===i):ot.From(t.props.start),end:n.end?uf(e,r,n.end,"double-bound"===i||"end-contains-start"===i):ot.From(t.props.end)}}function ux(e,t,n,r){let i="string"==typeof t?t:t.id,o="string"==typeof n?n:n.id,s=e.getBindingsFromShape(i,"arrow").filter(e=>e.props.terminal===r.terminal);s.length>1&&e.deleteBindings(s.slice(1));let a=s[0];a?e.updateBinding({...a,toId:o,props:r}):e.createBinding({type:"arrow",fromId:i,toId:o,props:r})}function uv(e,t,n){let r=e.getBindingsFromShape(t,"arrow").filter(e=>e.props.terminal===n);e.deleteBindings(r)}let uw=10,uS=10,uk=10,uC={s:2,m:3.5,l:5,xl:10};function uP(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";let r=e.getShapePageBounds(t),i=e.getShapePageBounds(n);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}class u_ extends dB{static type="arrow";static props=ro;static migrations=rs;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){uE(this.editor,this.editor.getShape(e.fromId))}onAfterChange({bindingAfter:e}){uE(this.editor,this.editor.getShape(e.fromId))}onAfterChangeFromShape({shapeAfter:e}){uE(this.editor,e)}onAfterChangeToShape({binding:e}){uI(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){let t=this.editor.getShape(e.fromId);t&&uj({editor:this.editor,arrow:t,terminal:e.props.terminal})}}function uI(e,t){let n,r,i;let o=e.getShape(t);if(!o)return;let{start:s,end:a}=ug(e,o),l=s?e.getShape(s.toId):void 0,c=a?e.getShape(a.toId):void 0,d=e.getAncestorPageId(o);if(!d)return;if(l&&c)n=e.findCommonAncestor([l,c])??d;else{if(!l&&!c)return;let e=(l||c)?.parentId;n=e&&e===o.parentId?o.parentId:d}n&&n!==o.parentId&&e.reparentShapes([t],n);let u=e.getShape(t);if(!u)throw Error("no reparented arrow");let h=e.getShapeNearestSibling(u,l),p=e.getShapeNearestSibling(u,c);if(h&&p)r=h.index>p.index?h:p;else if(h&&!p)r=h;else{if(!p||h)return;r=p}let f=e.getSortedChildIdsForParent(r.parentId).map(t=>e.getShape(t)).filter(e=>e.index>r.index);if(f.length){let e=f.find(e=>"arrow"!==e.type);if(u.index>r.index&&(!e||u.index<e.index))return;i=tt(r.index,f[0].index)}else i=tn(r.index);i!==u.index&&e.updateShapes([{id:t,type:"arrow",index:i}])}function uE(e,t){let n=ug(e,t);for(let r of["start","end"]){let i=n[r];if(!i)continue;let o=e.getShape(i.toId),s=e.getAncestorPageId(t)===e.getAncestorPageId(o);o&&s||uj({editor:e,arrow:t,terminal:r,unbind:!0})}uI(e,t.id)}function uj({editor:e,arrow:t,terminal:n,unbind:r=!1,useHandle:i=!1}){let o=uy(e,t);if(!o)throw Error("expected arrow info");let s=i?o.start.handle:o.start.point,a=i?o.end.handle:o.end.point,l="start"===n?s:a,c={id:t.id,type:"arrow",props:{[n]:{x:l.x,y:l.y},bend:t.props.bend}};if(!o.isStraight){let e="start"===n?s:o.start.handle,r="end"===n?a:o.end.handle,i=ot.Med(e,r),l=ot.Sub(e,r).per().uni().mul(2*o.handleArc.radius*Math.sign(t.props.bend)),d=lh(o.handleArc.center,ot.Add(i,l),o.handleArc.center,o.handleArc.radius);ew(d?.length===1);let u=ot.Dist(i,d[0])*Math.sign(t.props.bend);ou(u,c.props.bend)||(c.props.bend=u)}e.updateShape(c),r&&uv(e,t,n)}let uT=[u_],uM={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},uA={s:2,m:3.5,l:5,xl:10},uO={s:18,m:24,l:36,xl:44},uL={s:18,m:22,l:26,xl:32},uD={s:18,m:20,l:24,xl:28},uz={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};function uR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function uN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?uR(Object(n),!0).forEach(function(t){var r,i;r=t,i=n[t],(r=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uR(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function uF(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=o.call(n)).done)&&(a.push(r.value),a.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw i}}return a}}(e,t)||uB(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u$(e){return function(e){if(Array.isArray(e))return uU(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||uB(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uB(e,t){if(e){if("string"==typeof e)return uU(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uU(e,t)}}function uU(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function uV(e){var t,n,r=e.sizes.shift(),i=Math.max(Math.ceil(r[0]),1),o=Math.max(Math.ceil(r[1]),1),s=Date.now(),a="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;a?(t=new OffscreenCanvas(1,1),n=new OffscreenCanvas(i,o)):((t=document.createElement("canvas")).width=1,t.height=1,(n=document.createElement("canvas")).width=i,n.height=o);var l=t.getContext("2d"),c=n.getContext("2d");c&&(c.fillRect.apply(c,[i-1,o-1,1,1]),l.drawImage(n,i-1,o-1,1,1,0,0,1,1));var d=l&&0!==l.getImageData(0,0,1,1).data[3],u=Date.now()-s;return[t,n].forEach(function(e){e.height=0,e.width=0}),a?(postMessage({width:i,height:o,benchmark:u,isTestPass:d}),!d&&e.sizes.length&&uV(e)):d?e.onSuccess(i,o,u):(e.onError(i,o,u),e.sizes.length&&uV(e)),d}var uH={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},uK=["onError","onSuccess"],uW={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},uG={};function uq(e){var t=e.width===e.height,n=1===e.height,r=1===e.width,i=[];if(e.width&&e.height)for(var o=e.min||uW.min,s=e.step||uW.step,a=Math.max(e.width,e.height);a>=o;){var l=t||n?a:1,c=t||r?a:1;i.push([l,c]),a-=s}else e.sizes.forEach(function(e){var o=t||n?e:1,s=t||r?e:1;i.push([o,s])});return i}function uY(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),i=e.onError,o=e.onSuccess,s=function(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}(e,uK),a=null;if(!t)return!1;if(e.useWorker&&n){var l=new Blob(["\n            var canvasTest = ".concat(uV.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        ")],{type:"application/javascript"}),c=URL.createObjectURL(l);a=new Worker(c),URL.revokeObjectURL(c),a.onmessage=function(e){var t=e.data,n=t.width,i=t.height,o=t.benchmark;t.isTestPass?(uG[r].onSuccess(n,i,o),delete uG[r]):uG[r].onError(n,i,o)}}return e.usePromise?new Promise(function(t,n){var l=uN(uN({},e),{},{onError:function(t,r,o){var s;if(0===e.sizes.length)s=!0;else{var a=uF(e.sizes.slice(-1),1),l=uF(a[0],2),c=l[0],d=l[1];s=t===c&&r===d}i(t,r,o),s&&n({width:t,height:r,benchmark:o})},onSuccess:function(e,n,r){o(e,n,r),t({width:e,height:n,benchmark:r})}});if(a){var c=l.onError,d=l.onSuccess;uG[r]={onError:c,onSuccess:d},a.postMessage(s)}else uV(l)}):a?void(uG[r]={onError:i,onSuccess:o},a.postMessage(s)):uV(e)}var uX={maxArea:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=uq({width:e.max,height:e.max,min:e.min,step:e.step,sizes:u$(uH.area)});return uY(uN(uN(uN({},uW),e),{},{sizes:t}))},maxHeight:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=uq({width:1,height:e.max,min:e.min,step:e.step,sizes:u$(uH.height)});return uY(uN(uN(uN({},uW),e),{},{sizes:t}))},maxWidth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=uq({width:e.max,height:1,min:e.min,step:e.step,sizes:u$(uH.width)});return uY(uN(uN(uN({},uW),e),{},{sizes:t}))}};let uZ=null;async function uQ(){let e=await uX.maxWidth({usePromise:!0}),t=await uX.maxHeight({usePromise:!0}),n=await uX.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}async function uJ(e,t){if(e<=8192&&t<=8192&&e*t<=0x1000000)return[e,t];let{maxWidth:n,maxHeight:r,maxArea:i}=await (uZ||(uZ=uQ()),uZ),o=e/t;if(e>n&&(t=(e=n)/o),t>r&&(e=(t=r)*o),e*t>i){let n=Math.sqrt(i/(e*t));e*=n,t*=n}return[e,t]}let u0=e=>e.split("*").map(e=>(function(e){if("string"!=typeof e)throw TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")})(e)).join(".+"),u1=(e,t)=>!!e.find(e=>{let n=new RegExp(u0(e));return t.match(n)});function u2(e){return function(e){let t=new URL(e).host.replace("www.","");for(let n of ii)if(u1(n.hostnames,t)){let t=n.toEmbedUrl(e);if(t)return{definition:n,embedUrl:t,url:e}}}(e)??function(e){let t=new URL(e).host.replace("www.","");for(let n of ii)if(u1(n.hostnames,t)){let t=n.fromEmbedUrl(e);if(t)return{definition:n,url:t,embedUrl:e}}}(e)}function u3(e){try{return u2(e)}catch(e){console.error(e)}}class u5{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){let n=e.ownerDocument,r=n.activeElement;r!==e&&e.focus(),n.execCommand("insertText",!1,t)||u5.insertTextFirefox(e,t),r===n.body?e.blur():r instanceof HTMLElement&&r!==e&&r.focus()}static set(e,t){e.select(),u5.insert(e,t)}static getSelection(e){let{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(e,t,n){let{selectionStart:r,selectionEnd:i}=e,o=u5.getSelection(e);u5.insert(e,t+o+(n??t)),e.selectionStart=(r||0)+t.length,e.selectionEnd=(i||0)+t.length}static replace(e,t,n){let r=0;e.value.replace(t,(...t)=>{let i=r+t[t.length-2],o=t[0].length;e.selectionStart=i,e.selectionEnd=i+o;let s="string"==typeof n?n:n(...t);return u5.insert(e,s),e.selectionStart=i,r+=s.length-o,s})}static findLineEnd(e,t){let n=e.lastIndexOf("\n",t-1)+1;return"	"!==e.charAt(n)?t:n+1}static indent(e){let{selectionStart:t,selectionEnd:n,value:r}=e,i=r.slice(t,n),o=/\n/g.exec(i)?.length;if(o&&o>0){let i=r.lastIndexOf("\n",t-1)+1,o=e.value.slice(i,n-1),s=o.replace(/^|\n/g,"$&  "),a=s.length-o.length;e.setSelectionRange(i,n-1),u5.insert(e,s),e.setSelectionRange(t+1,n+a)}else u5.insert(e,"  ")}static unindent(e){let{selectionStart:t,selectionEnd:n,value:r}=e,i=r.lastIndexOf("\n",t-1)+1,o=u5.findLineEnd(r,n),s=e.value.slice(i,o),a=s.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=s.length-a.length;e.setSelectionRange(i,o),u5.insert(e,a);let c=/\t| {1,2}/.exec(r.slice(i,t)),d=c?c[0].length:0,u=t-d;e.setSelectionRange(t-d,Math.max(u,n-l))}static indentCE(e){let t=window.getSelection(),n=e.innerText,r=u4(e)??0,i=u4(e)??0,o=n.slice(r,i),s=/\n/g.exec(o)?.length;if(s&&s>0){let o=n.lastIndexOf("\n",r-1)+1,s=n.slice(o,i-1),a=s.replace(/^|\n/g,"$&  ").length-s.length;t&&t.setBaseAndExtent(e,r+1,e,i+a)}else{let t=window.getSelection();e.innerText=n.slice(0,r)+"  "+n.slice(r),t?.setBaseAndExtent(e,r+1,e,r+2)}}static unindentCE(e){let t=window.getSelection(),n=e.innerText,r=u4(e)??0,i=u4(e)??0,o=n.lastIndexOf("\n",r-1)+1,s=u5.findLineEnd(n,i),a=n.slice(o,s),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;if(t){t.setBaseAndExtent(e,o,e,s);let a=/\t| {1,2}/.exec(n.slice(o,r)),l=a?a[0].length:0,d=r-l;t.setBaseAndExtent(e,r-l,e,Math.max(d,i-c))}}static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(u5.fixNewLines,"\n")}static normalizeTextForDom(e){return e.replace(u5.fixNewLines,"\n").split("\n").map(e=>e||" ").join("\n")}}function u4(e){if(void 0===window.getSelection)return;let t=window.getSelection();if(!t)return;let n=0;if(0!==t.rangeCount){let r=t.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(e),i.setEnd(r.endContainer,r.endOffset),n=i.toString().length}return n}let u6=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;async function u8(e,t,n){if(!t.length)return[];let r=ot.From(n),i=[];for(let e=0;e<t.length;e++){let n=t[e];switch(n.type){case"bookmark":i.push({id:nG(),type:"bookmark",x:r.x,y:r.y,opacity:1,props:{assetId:n.id,url:n.props.src}}),r.x+=300;break;case"image":i.push({id:nG(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:n.id,w:n.props.w,h:n.props.h}}),r.x+=n.props.w;break;case"video":i.push({id:nG(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:n.id,w:n.props.w,h:n.props.h}}),r.x+=n.props.w}}return e.run(()=>{let r=t.filter(t=>!e.getAsset(t.id));r.length&&e.createAssets(r),e.createShapes(i).select(...i.map(e=>e.id)),u9(e,n)}),i.map(e=>e.id)}function u9(e,t){let n=e.getViewportPageBounds(),r=e.getSelectionPageBounds();if(r){let n=r.center.sub(t);e.updateShapes(e.getSelectedShapes().map(t=>{let r=e.getShapeParentTransform(t).decompose().rotation,i=ot.Rot(n,-r);return{id:t.id,type:t.type,x:t.x-i.x,y:t.y-i.y}}))}(r=e.getSelectionPageBounds())&&!n.contains(r)&&e.zoomToSelection()}class u7 extends cP{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")};onKeyUp=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}}class he extends cP{static id="pointing";shape;markId="";onEnter=()=>{this.didTimeout=!1;let e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:e=>!e.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:e,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()};onExit=()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()};onPointerMove=()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,onInteractionEnd:"arrow"})}};onPointerUp=()=>{this.cancel()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){let{originPagePoint:e}=this.editor.inputs,t=nG();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShape({id:t,type:"arrow",x:e.x,y:e.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});let n=this.editor.getShape(t);if(!n)throw Error("expected shape");let r=this.editor.getShapeHandles(n);if(!r)throw Error("expected handles for arrow");let i=this.editor.getShapeUtil("arrow"),o=this.shape,s=r.find(e=>"start"===e.id),a=i.onHandleDrag?.(n,{handle:{...s,x:0,y:0},isPrecise:!0,initial:o});a&&this.editor.updateShapes([a]),this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){let e=this.shape;if(!e)throw Error("expected shape");let t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");{let n=this.editor.getShapeUtil("arrow"),r=this.shape,i=t.find(e=>"start"===e.id),o=n.onHandleDrag?.(e,{handle:{...i,x:0,y:0},isPrecise:this.didTimeout,initial:r});o&&this.editor.updateShapes([o])}{let n=this.editor.getShapeUtil("arrow"),r=this.shape,i=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),o=t.find(e=>"end"===e.id),s=n.onHandleDrag?.(this.editor.getShape(e),{handle:{...o,x:i.x,y:i.y},isPrecise:!1,initial:r});s&&this.editor.updateShapes([s])}this.shape=this.editor.getShape(e.id)}preciseTimeout=-1;didTimeout=!1;startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}}class ht extends cP{static id="arrow";static initial="idle";static children=()=>[u7,he];shapeType="arrow"}class hn extends cP{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;canDraw=!1;markId=null;onEnter=e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()};onPointerMove=()=>{let{inputs:e}=this.editor;if(this.isPen&&!e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?ot.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())};onKeyDown=e=>{if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()};onKeyUp=e=>{if("Shift"===e.key)switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateDrawingShape()};onExit=()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()};canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t,n){if(!this.canClose())return!1;let r=uA[t],i=e[0].points[0],o=e[e.length-1],s=o.points[o.points.length-1];return i!==s&&this.currentLineLength>4*r*n&&ot.DistMin(i,s,2*r*n)}startShape(){let{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId="draw start "+a$(),this.editor.mark(this.markId);let{z:n=.5}=this.info.point;this.isPen=t,this.isPenOrStylus=t||n>0&&n<.5||n>.5&&n<1;let r=this.isPenOrStylus?1.25*n:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){let t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;let n=ef(t.props.segments);if(!n)throw Error("Expected a previous segment!");let i=ef(n.points);if(!i)throw Error("Expected a previous point!");let{x:o,y:s}=this.editor.getPointInShapeSpace(t,e).toFixed(),a={type:this.segmentMode,points:[{x:i.x,y:i.y,z:+r.toFixed(2)},{x:o,y:s,z:+r.toFixed(2)}]},l=sz.applyToPoint(this.editor.getShapePageTransform(t.id),i);this.pagePointWhereCurrentSegmentChanged=l,this.pagePointWhereNextSegmentChanged=null;let c=[...t.props.segments,a];this.currentLineLength<4*uA[t.props.size]&&(this.currentLineLength=this.getLineLength(c));let d={id:t.id,type:this.shapeType,props:{segments:c}};this.canClose()&&(d.props.isClosed=this.getIsClosed(c,t.props.size,t.props.scale)),this.editor.updateShapes([d]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();let i=nG();this.editor.createShapes([{id:i,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+r.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(i)}updateDrawingShape(){let{initialShape:e}=this,{inputs:t}=this.editor;if(!e)return;let{id:n,props:{size:r,scale:i}}=e,o=this.editor.getShape(n);if(!o)return;let{segments:s}=o.props,{x:a,y:l,z:c}=this.editor.getPointInShapeSpace(o,t.currentPagePoint).toFixed(),d={x:a,y:l,z:this.isPenOrStylus?+(1.25*t.currentPagePoint.z).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{let{pagePointWhereNextSegmentChanged:e}=this;if(null===e)throw Error("We should have a point where the segment changed");if(ot.Dist2(e,t.currentPagePoint)>this.editor.options.dragDistanceSquared){let e;this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";let t=ef(s);if(!t)throw Error("Expected a previous segment!");let a=ef(t.points);if(!a)throw Error("Expected a previous last point!");let l=this.editor.getPointInShapeSpace(o,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===t.type){this.currentLineLength+=ot.Dist(a,l),e={type:"straight",points:[{...a},l]};let t=this.editor.getShapePageTransform(o);this.pagePointWhereCurrentSegmentChanged=sz.applyToPoint(t,a)}else e={type:"straight",points:[l,d]};let c={id:n,type:this.shapeType,props:{segments:[...s,e]}};this.canClose()&&(c.props.isClosed=this.getIsClosed(s,r,i)),this.editor.updateShapes([c])}break}case"starting_free":{let{pagePointWhereNextSegmentChanged:e}=this;if(null===e)throw Error("We should have a point where the segment changed");if(ot.Dist2(e,t.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";let e=s.slice(),t=ef(e[e.length-1].points);if(!t)throw Error("No previous point!");let a=[...e,{type:"free",points:[...ot.PointsBetween(t,d,6).map(e=>({x:oP(e.x),y:oP(e.y),z:oP(e.z)}))]}];this.currentLineLength<4*uA[o.props.size]&&(this.currentLineLength=this.getLineLength(a));let l={id:n,type:this.shapeType,props:{segments:a}};this.canClose()&&(l.props.isClosed=this.getIsClosed(a,r,i)),this.editor.updateShapes([l])}break}case"straight":{let e,t;let a=s.slice(),l=a[a.length-1],{pagePointWhereCurrentSegmentChanged:c}=this,{ctrlKey:d,currentPagePoint:u}=this.editor.inputs;if(!c)throw Error("We should have a point where the segment changed");let h=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(h=!d,this.didJustShiftClickToExtendPreviousShapeLine=!1):h=!d;let p=this.editor.getPointInShapeSpace(o,u).toFixed().toJson(),f=!1;if((this.editor.user.getIsSnapMode()?!d:d)&&a.length>2){let e;let n=8/this.editor.getZoomLevel();for(let r=0,i=s.length-2;r<i;r++){let i=s[r];if(!i)break;if("free"===i.type)continue;let o=i.points[0],a=ef(i.points);if(!(o&&a))continue;let l=ot.NearestPointOnLineSegment(o,a,p);if(ot.DistMin(l,p,n)){e=l.toFixed().toJson(),n=ot.Dist(l,p),t=i;break}}e&&(f=!0,p=e)}if(f&&t){let e=this.editor.getShapePageTransform(o),n=t.points[0],r=ef(t.points);if(!r)throw Error("Expected a last point!");let i=sz.applyToPoint(e,n),s=sz.applyToPoint(e,r),a=sz.applyToPoint(e,p);this.editor.snaps.setIndicators([{id:a$(),type:"points",points:[i,a,s]}])}else{if(this.editor.snaps.clearIndicators(),h){let t=ot.Angle(c,u),n=oy(t,24);e=ot.RotWith(u,c,n-t)}else e=u;p=this.editor.getPointInShapeSpace(o,e).toFixed().toJson()}this.currentLineLength+=ot.Dist(l.points[0],p),a[a.length-1]={...l,type:"straight",points:[l.points[0],p]};let g={id:n,type:this.shapeType,props:{segments:a}};this.canClose()&&(g.props.isClosed=this.getIsClosed(s,r,i)),this.editor.updateShapes([g]);break}case"free":{let e=s.slice(),a=e[e.length-1],l=[...a.points];if(l.length&&this.mergeNextPoint){let{z:e}=l[l.length-1];l[l.length-1]={x:d.x,y:d.y,z:e?Math.max(e,d.z):d.z}}else this.currentLineLength+=ot.Dist(l[l.length-1],d),l.push(d);e[e.length-1]={...a,points:l},this.currentLineLength<4*uA[o.props.size]&&(this.currentLineLength=this.getLineLength(e));let u={id:n,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(u.props.isClosed=this.getIsClosed(e,r,i)),this.editor.updateShapes([u]),l.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);let e=nG(),r=this.editor.getShape(n).props;this.editor.createShapes([{id:e,type:this.shapeType,x:oP(t.currentPagePoint.x),y:oP(t.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:r.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(1.25*c).toFixed():.5}]}]}}]),this.initialShape=tS(this.editor.getShape(e)),this.mergeNextPoint=!1,this.lastRecordedPoint=t.currentPagePoint.clone(),this.currentLineLength=0}}}}getLineLength(e){let t=0;for(let n of e)for(let e=0;e<n.points.length-1;e++){let r=n.points[e],i=n.points[e+1];t+=ot.Dist2(i,r)}return Math.sqrt(t)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())};complete(){if(!this.canDraw){this.cancel();return}let{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}class hr extends cP{static id="idle";onPointerDown=e=>{this.parent.transition("drawing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}}class hi extends cP{static id="draw";static initial="idle";static isLockable=!1;static children=()=>[hr,hn];shapeType="draw";onExit=()=>{this.children.drawing.initialShape=void 0}}class ho extends dW{static id="frame";static initial="idle";shapeType="frame";onCreate=e=>{if(!e)return;let t=this.editor.getShapePageBounds(e),n=[],r=this.editor.getShapeAncestors(e).map(e=>e.id);this.editor.getSortedChildIdsForParent(e.parentId).map(i=>{let o=this.editor.getShape(i);if(!o||o.id===e.id||o.isLocked)return;let s=this.editor.getShapePageBounds(o);s&&t.contains(s)&&function(e,t,n){return!t.includes(e.id)&&e.parentId===n.parentId}(o,r,e)&&n.push(o.id)}),this.editor.reparentShapes(n,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}class hs extends cP{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyUp=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}};onCancel=()=>{this.editor.setCurrentTool("select")}}class ha extends cP{static id="pointing";markId="";onPointerUp=()=>{this.complete()};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,n=nG();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(ip),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(n).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{originPagePoint:e}=this.editor.inputs,t=nG();this.markId=`creating:${t}`,this.editor.mark(this.markId);let n=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,r=this.editor.getStyleForNextShape(ip);this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(ip),scale:n,..."star"===r?{w:200,h:190}:"cloud"===r?{w:300,h:180}:{w:200,h:200}}}]);let i=this.editor.getShape(t);if(!i)return;let{w:o,h:s}=i.props,a=new ot(o/2,s/2).mul(n),l=this.editor.getShapeParentTransform(i);l&&a.rot(-l.rotation()),this.editor.select(t),this.editor.updateShape({id:i.id,type:"geo",x:i.x-a.x,y:i.y-a.y,props:{geo:this.editor.getStyleForNextShape(ip),w:o*n,h:s*n}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}}class hl extends cP{static id="geo";static initial="idle";static children=()=>[hs,ha];shapeType="geo"}class hc extends cP{static id="highlight";static initial="idle";static children=()=>[hr,hn];static isLockable=!1;shapeType="highlight";onExit=()=>{this.children.drawing.initialShape=void 0}}class hd extends cP{static id="idle";shapeId="";onEnter=e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})};onPointerDown=()=>{this.parent.transition("pointing",{shapeId:this.shapeId})};onCancel=()=>{this.editor.setCurrentTool("select")}}class hu extends cP{static id="pointing";shape={};markId;onEnter=e=>{let{inputs:t}=this.editor,{currentPagePoint:n}=t;this.markId=void 0;let r=e.shapeId&&this.editor.getShape(e.shapeId);if(r&&t.shiftKey){this.markId=`creating:${r.id}`,this.editor.mark(this.markId),this.shape=r;let e=this.editor.getShapeHandles(this.shape);if(!e)return;let t=e.filter(e=>"vertex"===e.type).sort(ti),i=t[t.length-1],o=t[t.length-2],s=sz.applyToPoint(this.editor.getShapeParentTransform(this.shape),new ot(this.shape.x,this.shape.y)),a=ot.Sub(n,s).addXY(.1,.1),l=tS(this.shape.props.points);if(ot.DistMin(i,o,2)||ot.DistMin(a,i,2))l[i.id]={id:i.id,index:i.index,x:a.x,y:a.y};else{let e=tn(i.index);l[e]={id:e,index:e,x:a.x,y:a.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:l}}])}else{let e=nG();this.markId=`creating:${e}`,this.editor.mark(this.markId),this.editor.createShapes([{id:e,type:"line",x:n.x,y:n.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(e),this.shape=this.editor.getShape(e)}};onPointerMove=()=>{if(this.shape&&this.editor.inputs.isDragging){let e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");let t=ef(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()};complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}}class hh extends cP{static id="line";static initial="idle";static children=()=>[hd,hu];shapeType="line"}class hp extends cP{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}}function hf(e,t){let n=new Set;for(let r of t){let t=e.getShape(r);if(!t)continue;e.getShapeUtil(t).onDragShapesOut&&n.add(t);let i=e.getShape(t.parentId);i&&e.getShapeUtil(i).onDragShapesOut&&n.add(i)}let r=new Map;for(let t of n){let n=hg(e,t);n.length&&r.set(t,n)}for(let[t,n]of r){let r=e.getShapeUtil(t),i=ep(n.map(t=>e.getShape(t)));r.onDragShapesOut?.(t,i)}}function hg(e,t){let n,r,i;let o=e.getSortedChildIdsForParent(t.id);if(0===o.length)return[];let s=e.getShapePageBounds(t);if(!s)return[];let a=[];for(let l of o){let o=e.getShapePageBounds(l);if(!o)continue;if(!s.includes(o)){a.push(l);continue}n??=e.getShapeGeometry(t),r??=e.getShapePageTransform(t),i??=r.applyToPoints(n.vertices);let c=e.getShapePageTransform(l).clone().invert().applyToPoints(i),{vertices:d,isClosed:u}=e.getShapeGeometry(l);if(!d.some(e=>ok(e,c))){if(u){if(lv(c,d))continue}else if(function(e,t){let n,r;for(let i=0,o=e.length;i<o;i++){n=e[i],r=e[(i+1)%o];for(let e=1,i=t.length;e<i;e++)if(ly(n,r,t[e-1],t[e]))return!0}return!1}(c,d))continue;a.push(l)}}return a}function hm(e,t,n=!1){e.select(t),e.setEditingShape(t),e.setCurrentTool("select.editing_shape",{target:"shape",shape:t}),n&&e.emit("select-all-text",{shapeId:t.id}),hy(e)}function hy(e){let t=e.getSelectionPageBounds(),n=e.getViewportPageBounds();if(t&&!n.contains(t)){let r=t.clone().expandBy(16/e.getZoomLevel()).expand(n),i=n.clone().translate({x:(r.center.x-n.center.x)*2,y:(r.center.y-n.center.y)*2});e.zoomToBounds(i,{animation:{duration:e.options.animationMediumMs},inset:0})}}let hb=new ot(100,100),hx=e=>[[["a1"],new ot(100,-100-e.options.adjacentShapeMargin)],[["a2"],new ot(300+e.options.adjacentShapeMargin,100)],[["a3"],new ot(100,300+e.options.adjacentShapeMargin)],[["a4"],new ot(-100-e.options.adjacentShapeMargin,100)]];function hv(e,t,n,r,i,o){return Object.fromEntries((function(e,t){if(1===t)return hx(e);let n=200*t,r=e.options.adjacentShapeMargin*t;return[[["a1"],new ot(.5*n,-.5*n-r)],[["a2"],new ot(1.5*n+r,.5*n)],[["a3"],new ot(.5*n,1.5*n+r)],[["a4"],new ot(-.5*n-r,.5*n)]]})(e,o).map(([e,o],s)=>{let a=o.clone();return 0===s&&i?a.y-=i:2===s&&r&&(a.y+=r),[e,a.rot(n).add(t)]}))}function hw(e,t,n,r){let i;let o=new Set(e.getSelectedShapeIds()),s=(200+e.options.adjacentShapeMargin+r)**2,a=new Map,l=[];for(let i of e.getCurrentPageShapes()){if(!e.isShapeOfType(i,"note")||n!==i.props.scale||o.has(i.id))continue;let s=e.getShapePageTransform(i.id);t===s.rotation()&&(a.set(i,e.getShapePageBounds(i).center),l.push(...Object.values(hv(e,s.point(),t,i.props.growY,r,n))))}let c=l.length;for(let[t,n]of a)for(let r=0;r<c;r++)(i=l[r])&&!(ot.Dist2(n,i)>s)&&e.isPointInShape(t,i)&&(l[r]=void 0);return ep(l)}function hS(e,t,n,r,i=!1){let o;let s=e.getCurrentPageShapesSorted(),a=(200+e.options.adjacentShapeMargin**2)**t.props.scale;for(let r=s.length-1;r>=0;r--){let i=s[r];if("note"===i.type&&i.id!==t.id){let t=e.getShapePageBounds(i);if(t&&ot.Dist2(t.center,n)<a&&e.isPointInShape(i,n)){o=i;break}}}if(e.complete(),!o||i){e.mark("creating note shape");let i=nG();e.createShape({id:i,type:"note",x:n.x,y:n.y,rotation:r,opacity:t.opacity,props:{...t.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});let s=e.getShape(i);if(!s)return;let a=e.getPointInParentSpace(s,ot.Sub(n,ot.Rot(hb.clone().mul(s.props.scale),r)));e.updateShape({id:i,type:"note",x:a.x,y:a.y}),o=e.getShape(i)}return hy(e),o}class hk extends cP{static id="pointing";dragged=!1;info={};wasFocusedOnEnter=!1;markId="";shape={};onEnter=()=>{let{editor:e}=this;if(this.wasFocusedOnEnter=!e.getIsMenuOpen(),this.wasFocusedOnEnter){let t=nG();this.markId=`creating:${t}`,e.mark(this.markId);let n=this.editor.inputs.originPagePoint.clone(),r=hC(this.editor,n,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);r&&n.sub(r),this.shape=hP(this.editor,t,n)}};onPointerMove=e=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){let e=nG(),t=this.editor.inputs.originPagePoint.clone(),n=hC(this.editor,t,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);n&&t.sub(n),this.shape=hP(this.editor,e,t)}this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}};onPointerUp=()=>{this.complete()};onInterrupt=()=>{this.cancel()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}function hC(e,t,n){let r,i=10/e.getZoomLevel();for(let o of hw(e,0,n,0)){let e=ot.Sub(t,o),n=e.len();n<i&&(i=n,r=e)}return r}function hP(e,t,n){e.createShape({id:t,type:"note",x:n.x,y:n.y,props:{scale:e.user.getIsDynamicResizeMode()?1/e.getZoomLevel():1}}).select(t);let r=e.getShape(t),i=e.getShapeGeometry(r).bounds;return e.updateShapes([{id:t,type:"note",x:r.x-i.width/2,y:r.y-i.height/2}]),e.getShape(t)}class h_ extends cP{static id="note";static initial="idle";static children=()=>[hp,hk];shapeType="note"}let hI=ea(function(e){let t;let n=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:e.options.hitTestMargin/e.getZoomLevel(),renderingOnly:!0});if(!n)return e.setHoveredShape(null);let r=e.getOutermostSelectableShape(n);return t=r===n?n:r.id===e.getFocusedGroupId()||e.getSelectedShapeIds().includes(r.id)?n:r,e.setHoveredShape(t.id)},32);class hE extends cP{static id="idle";onPointerMove=e=>{switch(e.target){case"shape":case"canvas":hI(this.editor)}};onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onExit=()=>{hI.cancel()};onKeyDown=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}};onCancel=()=>{this.editor.setCurrentTool("select")}}class hj extends cP{static id="pointing";shape;markId="";onExit=()=>{this.editor.setHintingShapes([])};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{inputs:{originPagePoint:t}}=this.editor,n=nG();this.markId=`creating:${n}`,this.editor.mark(this.markId);let r=this.createTextShape(n,t,!1);if(!r){this.cancel();return}this.shape=this.editor.getShape(r),this.editor.select(n),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:18,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(r.id),this.editor.setCurrentTool("select.editing_shape")}})}};onPointerUp=()=>{this.complete()};onComplete=()=>{this.cancel()};onCancel=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.editor.mark("creating text shape");let e=nG(),{currentPagePoint:t}=this.editor.inputs;this.createTextShape(e,t,!0)&&(this.editor.select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),this.editor.root.getCurrent()?.transition("editing_shape"))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,t,n){this.editor.createShape({id:e,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:n,w:20,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});let r=this.editor.getShape(e);if(!r){this.cancel();return}let i=this.editor.getShapePageBounds(r),o=new ot;if(n)switch(r.props.textAlign){case"start":o.x=0;break;case"middle":o.x=-i.width/2;break;case"end":o.x=-i.width}else o.x=0;if(o.y=-i.height/2,nW(r.parentId)){let e=this.editor.getShapeParentTransform(r);o.rot(-e.rotation())}return this.editor.updateShape({...r,x:r.x+o.x,y:r.y+o.y}),r}}class hT extends cP{static id="text";static initial="idle";static children=()=>[hE,hj];static isLockable=!1;shapeType="text"}let hM=[hT,hi,hl,h_,hh,ho,ht,hc];function hA(){return n0({isDarkMode:cD()})}function hO(e){return{key:`${n4.id}:${e}`,getElement:async()=>{let t=function(e){let t=n6[e];for(let e of document.fonts)if(t.includes(e.family))return e;return null}(e);if(!t)return null;let n=t.$$_url,r=t.$$_fontface;if(!n||!r)return null;let i=await (await e_(n)).blob(),o=await eE.blobToDataUrl(i),s=r.replace(n,o);return(0,m.jsx)("style",{children:s})}}}function hL(e){return{key:`${n4.id}:${e}`,getElement:async()=>"pattern"!==e?null:(0,m.jsx)(hD,{})}}function hD(){let e=hA(),t=8/12;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("mask",{id:"hash_pattern_mask",children:[(0,m.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),(0,m.jsxs)("g",{strokeLinecap:"round",stroke:"black",children:[(0,m.jsx)("line",{x1:1*t,y1:3*t,x2:3*t,y2:1*t}),(0,m.jsx)("line",{x1:5*t,y1:7*t,x2:7*t,y2:5*t}),(0,m.jsx)("line",{x1:9*t,y1:11*t,x2:11*t,y2:9*t})]})]}),(0,m.jsx)("pattern",{id:hB(1,e.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:(0,m.jsx)("rect",{x:"0",y:"0",width:"8",height:"8",fill:e.solid,mask:"url(#hash_pattern_mask)"})})]})}function hz(){return{key:`${n4.id}:pattern`,component:hV}}let hR=(e,t,n)=>new Promise((r,i)=>{let o=8*t*e,s=document.createElement("canvas");s.width=o,s.height=o;let a=s.getContext("2d");if(!a)return;a.fillStyle=n?nJ.darkMode.solid:nJ.lightMode.solid,a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*t*e;let l=8/12;a.beginPath(),a.moveTo(1*l*t*e,3*l*t*e),a.lineTo(3*l*t*e,1*l*t*e),a.moveTo(5*l*t*e,7*l*t*e),a.lineTo(7*l*t*e,5*l*t*e),a.moveTo(9*l*t*e,11*l*t*e),a.lineTo(11*l*t*e,9*l*t*e),a.stroke(),s.toBlob(e=>{!e||t_.throwToBlob.get()?i():r(e)})}),hN=(e,t)=>{let n=document.createElement("canvas");n.width=e[0],n.height=e[1];let r=n.getContext("2d");return r?(t(r),n.toDataURL()):""},hF=null;function h$(e){return Math.ceil(Math.log2(Math.max(1,e)))}function hB(e,t){let n=h$(e);return`tldraw_hash_pattern_${t}_${n}`}function hU(e){let t=[],n=h$(e);for(let e=0;e<=n;e++)t.push(Math.pow(2,e));return t}function hV(){let e=i8(),t=(0,y.useRef)(null),{defs:n,isReady:r}=function(){let e=i8(),t=iJ("devicePixelRatio",()=>e.getInstanceState().devicePixelRatio,[e]),n=iJ("maxZoom",()=>Math.ceil(ef(e.getCameraOptions().zoomSteps)),[e]),[r,i]=(0,y.useState)(!1),[o,s]=(0,y.useState)(()=>(function(e){let t=(hF||(hF={white:hN([1,1],e=>{e.fillStyle="#f8f9fa",e.fillRect(0,0,1,1)}),black:hN([1,1],e=>{e.fillStyle="#212529",e.fillRect(0,0,1,1)})}),hF);return hU(e).flatMap(e=>[{zoom:e,url:t.white,theme:"light"},{zoom:e,url:t.black,theme:"dark"}])})(n));return(0,y.useEffect)(()=>{let e=Promise.all(hU(n).flatMap(e=>[hR(t,e,!1).then(t=>({zoom:e,theme:"light",url:URL.createObjectURL(t)})),hR(t,e,!0).then(t=>({zoom:e,theme:"dark",url:URL.createObjectURL(t)}))])),r=!1;return e.then(e=>{r||(s(e),i(!0))}),()=>{r=!0,i(!1),e.then(e=>{for(let{url:t}of e)URL.revokeObjectURL(t)})}},[t,n]),{defs:(0,m.jsx)(m.Fragment,{children:o.map(e=>{let t=hB(e.zoom,e.theme);return(0,m.jsx)("pattern",{id:t,width:8,height:8,patternUnits:"userSpaceOnUse",children:(0,m.jsx)("image",{href:e.url,width:8,height:8})},t)})}),isReady:r}}();return(0,y.useEffect)(()=>{if(r&&e.environment.isSafari){let n=function e(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?e(t.parentElement):null}(t.current);n&&e.timers.requestAnimationFrame(()=>{n.style.display="none",e.timers.requestAnimationFrame(()=>{n.style.display=""})})}},[e,r]),(0,m.jsx)("g",{ref:t,"data-testid":r?"ready-pattern-fill-defs":void 0,children:n})}let hH=y.memo(function({theme:e,d:t,color:n,fill:r,scale:i}){switch(r){case"none":return null;case"solid":return(0,m.jsx)("path",{fill:e[n].semi,d:t});case"semi":return(0,m.jsx)("path",{fill:e.solid,d:t});case"fill":return(0,m.jsx)("path",{fill:e[n].fill,d:t});case"pattern":return(0,m.jsx)(hK,{theme:e,color:n,fill:r,d:t,scale:i})}});function hK({d:e,color:t,theme:n}){let r=i8(),i=lW(),o=iJ("zoomLevel",()=>r.getZoomLevel(),[r]),s=.18>=r.getZoomLevel();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("path",{fill:n[t].pattern,d:e}),(0,m.jsx)("path",{fill:i?`url(#${hB(1,n.id)})`:s?n[t].semi:`url(#${hB(o,n.id)})`,d:e})]})}function hW(e,t,n){let{padding:r=0}=n;if(0===t.length)return null;let i=sL.From(t[0].box);for(let{box:e}of t)i.union(e);let o=r+(n.offsetX??0),s=(n.offsetY??0)+n.fontSize/2+("start"===n.verticalTextAlign?r:"end"===n.verticalTextAlign?n.height-r-i.height:(Math.ceil(n.height)-i.height)/2),a=null,l=[];for(let{text:e,box:n}of t)null!==a&&n.y>a&&l.push((0,m.jsx)("tspan",{alignmentBaseline:"mathematical",x:o,y:n.y+s,children:"\n"},l.length)),l.push((0,m.jsx)("tspan",{alignmentBaseline:"mathematical",x:n.x+o,y:n.y+s,unicodeBidi:"plaintext",children:e.replace(/\s/g,"\xa0")},l.length)),a=n.y;return(0,m.jsx)("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:l})}function hG({fontSize:e,font:t,align:n,verticalAlign:r,text:i,labelColor:o,bounds:s,padding:a=16,stroke:l=!0}){let c=i8(),d=hA(),u={fontSize:e,fontFamily:n6[t],textAlign:n,verticalTextAlign:r,width:Math.ceil(s.width),height:Math.ceil(s.height),padding:a,lineHeight:uM.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:o,stroke:void 0,strokeWidth:void 0},h=c.textMeasure.measureTextSpans(i,u),p=function(e,t,n,r){if(("start-legacy"===e||"end-legacy"===e)&&0!==n.length){let i=sL.From(n[0].box);for(let{box:e}of n)i.union(e);if("start-legacy"===e)return(r-2*t-i.width)/2;if("end-legacy"===e)return-(r-2*t-i.width)/2}}(n,a,h,s.width);p&&(u.offsetX=p),u.offsetX+=s.x,u.offsetY+=s.y;let f=hW(c,h,u),g=null;return l&&(u.fill=d.background,u.stroke=d.background,u.strokeWidth=2,g=hW(c,h,u)),(0,m.jsxs)(m.Fragment,{children:[g,f]})}let hq=(0,y.forwardRef)(function({isEditing:e,text:t,handleFocus:n,handleChange:r,handleKeyDown:i,handleBlur:o,handleInputPointerDown:s,handleDoubleClick:a},l){return(0,m.jsx)("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:n,onChange:r,onKeyDown:i,onBlur:o,onTouchEnd:oF,onContextMenu:e?oF:void 0,onPointerDown:s,onDoubleClick:a,onDragStart:oz})}),hY=y.memo(function({id:e,type:t,text:n,labelColor:r,font:i,fontSize:o,lineHeight:s,align:a,verticalAlign:l,wrap:c,isSelected:d,padding:u=0,onKeyDown:h,classNamePrefix:p,style:f,textWidth:g,textHeight:b}){let{rInput:x,isEmpty:v,isEditing:w,isEditingAnything:S,...k}=function(e,t,n){let r=i8(),i=(0,y.useRef)(null),o=iJ("isEditing",()=>r.getEditingShapeId()===e,[r]),s=iJ("isEditingAnything",()=>!!r.getEditingShapeId(),[r]);return(0,y.useEffect)(()=>{function t({shapeId:t}){t===e&&i.current?.select()}return r.on("select-all-text",t),()=>{r.off("select-all-text",t)}},[r,e,o]),(0,y.useEffect)(()=>{o&&(document.activeElement!==i.current&&i.current?.focus(),r.getInstanceState().isCoarsePointer&&i.current?.select(),r.environment.isSafari&&(i.current?.blur(),i.current?.focus()))},[r,o]),{rInput:i,handleFocus:eb,handleBlur:eb,handleKeyDown:(0,y.useCallback)(t=>{r.getEditingShapeId()===e&&"Enter"===t.key&&(t.ctrlKey||t.metaKey)&&r.complete()},[r,e]),handleChange:(0,y.useCallback)(n=>{if(r.getEditingShapeId()!==e)return;let i=u5.normalizeText(n.currentTarget.value),o=i.replace(/\t/g,"  ");if(o!==i){let e=n.currentTarget.selectionStart;n.currentTarget.value=o,n.currentTarget.selectionStart=e+(o.length-i.length),n.currentTarget.selectionEnd=e+(o.length-i.length),i=o}r.updateShape({id:e,type:t,props:{text:i}})},[r,e,t]),handleInputPointerDown:(0,y.useCallback)(t=>{r.dispatch({...oB(t),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(e)}),oF(t)},[r,e]),handleDoubleClick:oF,isEmpty:0===n.trim().length,isEditing:o,isEditingAnything:s}}(e,t,n),[C,P]=(0,y.useState)(n);(0,y.useEffect)(()=>{w||P(n)},[w,n]);let _=u5.normalizeTextForDom(n),I=_.length>0,E="start-legacy"===a||"middle-legacy"===a||"end-legacy"===a;if(!w&&!I)return null;let j=p||"tl-text";return(0,m.jsx)("div",{className:`${j}-label tl-text-wrapper`,"data-font":i,"data-align":a,"data-hastext":!v,"data-isediting":w,"data-iseditinganything":S,"data-textwrap":!!c,"data-isselected":d,style:{justifyContent:"middle"===a||E?"center":a,alignItems:"middle"===l?"center":l,padding:u,...f},children:(0,m.jsxs)("div",{className:`${j}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:Math.floor(o*s)+"px",minHeight:Math.floor(o*s)+"px",minWidth:Math.ceil(g||0),color:r,width:g?Math.ceil(g):void 0,height:b?Math.ceil(b):void 0},children:[(0,m.jsx)("div",{className:`${j} tl-text tl-text-content`,dir:"auto",children:_.split("\n").map((e,t)=>(0,m.jsx)("div",{dir:"auto",children:e},t))}),(S||d)&&(0,m.jsx)(hq,{ref:x,text:n,isEditing:w,...k,handleKeyDown:h??k.handleKeyDown},C)]})})});function hX(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed"}=n,c=0,d=0,u=1,h=0,p=0;switch(l){case"dashed":u=1,c=Math.min(t*a,e/4);break;case"dotted":c=t/(u=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=c/2,p+=c/2):"skip"===o&&(e-=c,p-=c),"outset"===s?e+=c/2:"skip"!==s||(e-=c)),d=Math.floor(e/c/(2*u)),(d-=d%i)<3&&"dashed"===l?e/t<4?(c=e,d=1,h=0):(c=1/3*e,h=1/3*e):(c=e/d/(2*u),r?(p=c/2,h=(e-d*c)/d):h=(e-d*c)/Math.max(1,d-1)),{strokeDasharray:[c,h].join(" "),strokeDashoffset:p.toString()}}let hZ=new WeakMap;function hQ(e,t){let n=hZ.get(t);if(n)return n;let r=uy(e,t),i=0,o=0,s=r.isStraight?new lw({start:ot.From(r.start.point),end:ot.From(r.end.point)}):new dX({center:ot.Cast(r.handleArc.center),start:ot.Cast(r.start.point),end:ot.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});if(t.props.text.trim()){let n=s.bounds,r=h3(t),{w:a,h:l}=e.textMeasure.measureText(t.props.text,{...uM,fontFamily:uz[t.props.font],fontSize:r,maxWidth:null});if(i=a,o=l,n.width>n.height){i=Math.max(Math.min(a,64),Math.min(n.width-64,a));let{w:s,h:l}=e.textMeasure.measureText(t.props.text,{...uM,fontFamily:uz[t.props.font],fontSize:r,maxWidth:i});i=s,o=l}if(i>16*r){i=16*r;let{w:n,h:s}=e.textMeasure.measureText(t.props.text,{...uM,fontFamily:uz[t.props.font],fontSize:r,maxWidth:i});i=n,o=s}}let a=new ot(i,o).addScalar(8.5*t.props.scale);return hZ.set(t,a),a}function hJ(e){let t=uA[e.props.size];return(20+(t-uA.s)*2+(t===uA.xl?20:0))*e.props.scale}function h0(e,t){let n;let r=[],i=uy(e,t),o=!!i.bindings.start,s=!!i.bindings.end,a="none"!==i.start.arrowhead,l="none"!==i.end.arrowhead;if(i.isStraight){let r=function(e,t,n){let r=hQ(e,t),i=hJ(t),o=ot.Nudge(n.start.point,n.end.point,i),s=ot.Nudge(n.end.point,n.start.point,i),a=lp(o,s,sL.FromCenter(n.middle,r).corners);if(!a||2!==a.length)return{start:.5,end:.5};let[l,c]=a;ot.Dist2(l,o)>ot.Dist2(c,o)&&([c,l]=a);let d=o.add(ot.Sub(n.middle,l)),u=s.add(ot.Sub(n.middle,c));return{start:ot.Dist(n.start.point,d)/n.length,end:ot.Dist(n.start.point,u)/n.length}}(e,t,i),c=oc(t.props.labelPosition,a||o?r.start:0,l||s?r.end:1);c=c>=.48&&c<=.52?.5:c,n=ot.Lrp(i.start.point,i.end.point,c)}else{let c=function(e,t,n){let r=hQ(e,t),i=hJ(t),o=Math.sign(t.props.bend),s=i/n.handleArc.radius*o,a=ot.Angle(n.bodyArc.center,n.start.point)-s,l=ot.Angle(n.bodyArc.center,n.end.point)+s,c=ox(n.bodyArc.center,n.bodyArc.radius,a),d=ox(n.bodyArc.center,n.bodyArc.radius,l),u=[],h=h1(n.bodyArc.center,n.bodyArc.radius,a,l,o,sL.FromCenter(c,r).corners);u.push(new lk({points:sL.FromCenter(c,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));let p=h1(n.bodyArc.center,n.bodyArc.radius,a,l,o,sL.FromCenter(d,r).corners);for(let e of(u.push(new lk({points:sL.FromCenter(d,r).corners,debugColor:"lime",isFilled:!1,ignore:!0})),[...h??[],...p??[],c,d]))u.push(new dZ({x:e.x-3,y:e.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));let f=(h&&h2(n.start.point,h))??n.middle,g=(p&&h2(n.end.point,p))??n.middle,m=ot.Angle(n.bodyArc.center,n.start.point),y=ot.Angle(n.bodyArc.center,n.end.point),b=ot.Angle(n.bodyArc.center,f),x=ot.Angle(n.bodyArc.center,g);if(oI(m,b,o)>oI(m,x,o))return{start:.5,end:.5,dbg:u};let v=oI(m,y,o);return{start:oI(m,b,o)/v,end:oI(m,x,o)/v,dbg:u}}(e,t,i);c.dbg&&r.push(...c.dbg);let d=oc(t.props.labelPosition,a||o?c.start:0,l||s?c.end:1);d=d>=.48&&d<=.52?.5:d;let u=function(e,t,n,r){let i=oI(e,t,n);return e+-(i*r*n*1)}(ot.Angle(i.bodyArc.center,i.start.point),ot.Angle(i.bodyArc.center,i.end.point),Math.sign(t.props.bend),d);n=ox(i.bodyArc.center,i.bodyArc.radius,u)}let c=hQ(e,t);return{box:sL.FromCenter(n,c),debugGeom:r}}function h1(e,t,n,r,i,o){let s=lf(e,t,o),a=oI(n,r,i);return s?.filter(t=>{let r=oI(n,ot.Angle(e,t),i);return r>=0&&r<=a})}function h2(e,t){let n=null,r=-1/0;for(let i of t){let t=ot.Dist2(e,i);t>r&&(n=i,r=t)}return n}function h3(e){return uD[e.props.size]*e.props.scale}function h5(e,t,n){let r="end"===t?e.end.arrowhead:e.start.arrowhead;if("none"===r)return;let i=function(e,t,n){let r;let i="end"===t?e.end.point:e.start.point,o="end"===t?e.start.point:e.end.point,s=Math.max(Math.min((e.isStraight?ot.Dist(o,i):Math.abs(e.bodyArc.length))/5,3*n),n);if(e.isStraight)r=ot.Nudge(i,o,s);else{let n=function(e,t,n,r){let i=n.x-e.x,o=n.y-e.y,s=Math.sqrt(i*i+o*o),a=(s*s-r*r+t*t)/(2*s),l=Math.sqrt(t*t-a*a);return i/=s,o/=s,[new ot(e.x+i*a-o*l,e.y+o*a+i*l),new ot(e.x+i*a+o*l,e.y+o*a-i*l)]}(i,s,e.handleArc.center,e.handleArc.radius);r="end"===t?e.handleArc.sweepFlag?n[0]:n[1]:e.handleArc.sweepFlag?n[1]:n[0]}return ot.IsNaN(r)&&(r=e.start.point),{point:i,int:r}}(e,t,n);if(i){switch(r){case"bar":return function({int:e,point:t}){let n=ot.Sub(e,t).div(2),r=ot.Add(t,ot.Rot(n,os)),i=ot.Sub(t,ot.Rot(n,os));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}(i);case"square":return function({int:e,point:t}){let n=ot.Lrp(t,e,.85),r=ot.Sub(n,t).div(2),i=ot.Add(t,ot.Rot(r,os)),o=ot.Sub(t,ot.Rot(r,os)),s=ot.Add(n,ot.Rot(r,os)),a=ot.Sub(n,ot.Rot(r,os));return`M ${i.x} ${i.y} L ${s.x} ${s.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}(i);case"diamond":return function({point:e,int:t}){let n=ot.Lrp(e,t,.75),r=ot.RotWith(n,e,oo/4),i=ot.RotWith(n,e,-oo/4),o=ot.Lrp(r,i,.5);return o.add(ot.Sub(o,e)),`M ${o.x} ${o.y} L ${r.x} ${r.y} ${e.x} ${e.y} L ${i.x} ${i.y} Z`}(i);case"dot":return function({point:e,int:t}){let n=ot.Lrp(e,t,.45),r=ot.Dist(n,e);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${2*r},0
  a ${r},${r} 0 1,0 -${2*r},0 `}(i);case"inverted":return function({point:e,int:t}){let n=ot.Sub(t,e).div(2),r=ot.Add(e,ot.Rot(n,os)),i=ot.Sub(e,ot.Rot(n,os));return`M ${r.x} ${r.y} L ${t.x} ${t.y} L ${i.x} ${i.y} Z`}(i);case"arrow":return function({point:e,int:t}){let n=ot.RotWith(t,e,oo/6),r=ot.RotWith(t,e,-oo/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y}`}(i);case"triangle":return function({point:e,int:t}){let n=ot.RotWith(t,e,oo/6),r=ot.RotWith(t,e,-oo/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y} Z`}(i)}return""}}function h4(e){let{start:t,end:n,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.point.x},${t.point.y} A${r} ${r} 0 ${i} ${o} ${n.point.x},${n.point.y}`}function h6(e,t){return`M${e.x},${e.y}L${t.x},${t.y}`}function h8(e){return h6(e.start.point,e.end.point)}let h9=0;var h7=(e=>(e.START="start",e.MIDDLE="middle",e.END="end",e))(h7||{});class pe extends lP{static type="arrow";static props=rt;static migrations=ri;canEdit=()=>!0;canBind({toShapeType:e}){return"arrow"!==e}canSnap=()=>!1;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsBg=()=>!0;hideSelectionBoundsFg=()=>!0;canBeLaidOut=e=>{let t=ug(this.editor,e);return!t.start&&!t.end};getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(e){let t;let n=uy(this.editor,e),r=[],i=n.isStraight?new lw({start:ot.From(n.start.point),end:ot.From(n.end.point)}):new dX({center:ot.Cast(n.handleArc.center),start:ot.Cast(n.start.point),end:ot.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});if(e.props.text.trim()){let n=h0(this.editor,e);r.push(...n.debugGeom),t=new lC({x:n.box.x,y:n.box.y,width:n.box.w,height:n.box.h,isFilled:!0,isLabel:!0})}return new sF({children:[...t?[i,t]:[i],...r]})}getHandles(e){let t=uy(this.editor,e);return[{id:"start",type:"vertex",index:"a0",x:t.start.handle.x,y:t.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y}].filter(Boolean)}onHandleDrag=(e,{handle:t,isPrecise:n})=>{let r=t.id,i=ug(this.editor,e);if("middle"===r){let{start:n,end:r}=ub(this.editor,e,i),o=ot.Sub(r,n),s=ot.Per(o),a=ot.Med(r,n),l=ot.Sub(a,s),c=ot.Add(a,s),d=ot.NearestPointOnLineSegment(l,c,t,!1),u=ot.Dist(d,a);return ot.Clockwise(d,r,a)&&(u*=-1),{id:e.id,type:e.type,props:{bend:u}}}let o={id:e.id,type:"arrow",props:{}},s=i[r],a=i["start"===r?"end":"start"];if(this.editor.inputs.ctrlKey)return uv(this.editor,e,r),o.props[r]={x:t.x,y:t.y},o;let l=this.editor.getShapePageTransform(e.id).applyToPoint(t),c=this.editor.getShapeAtPoint(l,{hitInside:!0,hitFrameInside:!0,margin:0,filter:t=>!t.isLocked&&this.editor.canBindShapes({fromShape:e,toShape:t,binding:"arrow"})});if(!c)return uv(this.editor,e,r),o.props[r]={x:t.x,y:t.y},o;let d=this.editor.getShapeGeometry(c),u=sL.ZeroFix(d.bounds),h=this.editor.getShapePageTransform(o.id).applyToPoint(t),p=this.editor.getPointInShapeSpace(c,h),f=n;f||s&&(!s||c.id===s.toId)||(f=.5>this.editor.inputs.pointerVelocity.len()),!n&&(d.isClosed||(f=!0),a&&c.id===a.toId&&a.props.isPrecise&&(f=!0));let g={x:(p.x-u.minX)/u.width,y:(p.y-u.minY)/u.height};f&&ot.Dist(p,u.center)<Math.max(4,Math.min(.15*Math.min(u.width,u.height),16))/this.editor.getZoomLevel()&&(g.x=.5,g.y=.5);let m={terminal:r,normalizedAnchor:g,isPrecise:f,isExact:this.editor.inputs.altKey};ux(this.editor,e,c.id,m),this.editor.setHintingShapes([c.id]);let y=ug(this.editor,e);return y.start&&y.end&&y.start.toId===y.end.toId&&ot.Equals(y.start.props.normalizedAnchor,y.end.props.normalizedAnchor)&&ux(this.editor,e,y.end.toId,{...y.end.props,normalizedAnchor:{x:y.end.props.normalizedAnchor.x+.05,y:y.end.props.normalizedAnchor.y}}),o};onTranslateStart=e=>{let t=ug(this.editor,e),n=ub(this.editor,e,t),r=this.editor.getShapePageTransform(e.id),i=this.editor.getSelectedShapeIds();if(!(t.start&&(i.includes(t.start.toId)||this.editor.isAncestorSelected(t.start.toId))||t.end&&(i.includes(t.end.toId)||this.editor.isAncestorSelected(t.end.toId))))for(let i of(pn.set(e,{pagePosition:r.applyToPoint(e),terminalBindings:eZ(n,(e,n)=>{let i=t[e];return i?{binding:i,shapePosition:n,pagePosition:r.applyToPoint(n)}:null})}),t.start&&(uj({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),t.end&&uj({editor:this.editor,arrow:e,terminal:"end",useHandle:!0}),["start","end"])){let e=t[i];e&&this.editor.updateBinding({...e,props:{...e.props,isPrecise:!0}})}};onTranslate=(e,t)=>{let n=pn.get(e);if(!n)return;let r=this.editor.getShapePageTransform(t.id),i=ot.Sub(r.applyToPoint(t),n.pagePosition);for(let e of Object.values(n.terminalBindings)){if(!e)continue;let n=ot.Add(e.pagePosition,ot.Mul(i,.5)),r=this.editor.getShapeAtPoint(n,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:e,binding:"arrow"})});if(r?.id===e.binding.toId){let i=sL.ZeroFix(this.editor.getShapeGeometry(r).bounds),o=this.editor.getPointInShapeSpace(r,n),s={x:(o.x-i.minX)/i.width,y:(o.y-i.minY)/i.height};ux(this.editor,t,r.id,{...e.binding.props,normalizedAnchor:s,isPrecise:!0})}else uv(this.editor,t,e.binding.props.terminal)}};_resizeInitialBindings=new em;onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=this._resizeInitialBindings.get(e,()=>ug(this.editor,e)),o=ub(this.editor,e,i),{start:s,end:a}=tS(e.props),{bend:l}=e.props;i.start||(s.x=o.start.x*n,s.y=o.start.y*r),i.end||(a.x=o.end.x*n,a.y=o.end.y*r);let c=Math.abs(n),d=Math.abs(r),u=i?.start?ot.From(i.start.props.normalizedAnchor):null,h=i?.end?ot.From(i.end.props.normalizedAnchor):null;return n<0&&r>=0?(0!==l&&(l*=-1*Math.max(c,d)),u&&(u.x=1-u.x),h&&(h.x=1-h.x)):n>=0&&r<0?(0!==l&&(l*=-1*Math.max(c,d)),u&&(u.y=1-u.y),h&&(h.y=1-h.y)):n>=0&&r>=0?0!==l&&(l*=Math.max(c,d)):n<0&&r<0&&(0!==l&&(l*=Math.max(c,d)),u&&(u.x=1-u.x,u.y=1-u.y),h&&(h.x=1-h.x,h.y=1-h.y)),i.start&&u&&ux(this.editor,e,i.start.toId,{...i.start.props,normalizedAnchor:u.toJson()}),i.end&&h&&ux(this.editor,e,i.end.toId,{...i.end.props,normalizedAnchor:h.toJson()}),{props:{start:s,end:a,bend:l}}};onDoubleClickHandle=(e,t)=>{switch(t.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:"none"===e.props.arrowheadStart?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:"none"===e.props.arrowheadEnd?"arrow":"none"}}}};component(e){let t=hA(),n=this.editor.getOnlySelectedShape(),r=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,i=uy(this.editor,e);if(!i?.isValid)return null;let o=h0(this.editor,e),s=e.id===this.editor.getOnlySelectedShapeId(),a=this.editor.getEditingShapeId()===e.id||e.props.text;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ld,{id:e.id,style:{minWidth:50,minHeight:50},children:(0,m.jsx)(pt,{shape:e,shouldDisplayHandles:r&&n?.id===e.id})}),a&&(0,m.jsx)(hY,{id:e.id,classNamePrefix:"tl-arrow",type:"arrow",font:e.props.font,fontSize:h3(e),lineHeight:uM.lineHeight,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:t[e.props.labelColor].solid,textWidth:o.box.w,isSelected:s,padding:0,style:{transform:`translate(${o.box.center.x}px, ${o.box.center.y}px)`}})]})}indicator(e){let t=dG(e.id),n=uy(this.editor,e);if(!n)return null;let{start:r,end:i}=ub(this.editor,e,n?.bindings),o=this.editor.getShapeGeometry(e),s=o.bounds,a=e.props.text.trim()?o.children[1]:null;if(ot.Equals(r,i))return null;let l=uA[e.props.size]*e.props.scale,c=n.start.arrowhead&&h5(n,"start",l),d=n.end.arrowhead&&h5(n,"end",l),u=n.isStraight?h8(n):h4(n),h=c&&"arrow"!==n.start.arrowhead||d&&"arrow"!==n.end.arrowhead||!!a,p=(e.id+"_clip").replace(":","_");return t&&a?(0,m.jsx)("rect",{x:oC(a.x),y:oC(a.y),width:a.w,height:a.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale}):(0,m.jsxs)("g",{children:[h&&(0,m.jsx)("defs",{children:(0,m.jsxs)("mask",{id:p,children:[(0,m.jsx)("rect",{x:s.minX-100,y:s.minY-100,width:s.w+200,height:s.h+200,fill:"white"}),a&&(0,m.jsx)("rect",{x:oC(a.x),y:oC(a.y),width:a.w,height:a.h,fill:"black",rx:3.5*e.props.scale,ry:3.5*e.props.scale}),c&&(0,m.jsx)("path",{d:c,fill:"arrow"===n.start.arrowhead?"none":"black",stroke:"none"}),d&&(0,m.jsx)("path",{d:d,fill:"arrow"===n.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,m.jsxs)("g",{...h?{mask:`url(#${p})`}:void 0,children:[h&&(0,m.jsx)("rect",{x:s.minX-100,y:s.minY-100,width:s.width+200,height:s.height+200,opacity:0}),(0,m.jsx)("path",{d:u})]}),c&&(0,m.jsx)("path",{d:c}),d&&(0,m.jsx)("path",{d:d}),a&&(0,m.jsx)("rect",{x:oC(a.x),y:oC(a.y),width:a.w,height:a.h,rx:3.5,ry:3.5})]})}onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};toSvg(e,t){t.addExportDef(hL(e.props.fill)),e.props.text&&t.addExportDef(hO(e.props.font));let n=n0(t),r=1/e.props.scale;return(0,m.jsxs)("g",{transform:`scale(${r})`,children:[(0,m.jsx)(pt,{shape:e,shouldDisplayHandles:!1}),(0,m.jsx)(hG,{fontSize:h3(e),font:e.props.font,align:"middle",verticalAlign:"middle",text:e.props.text,labelColor:n[e.props.labelColor].solid,bounds:h0(this.editor,e).box,padding:4*e.props.scale})]})}getCanvasSvgDefs(){return[hz(),{key:"arrow:dot",component:pr},{key:"arrow:cross",component:pi}]}getInterpolatedProps(e,t,n){var r,i,o,s,a,l;return{...t.props,start:{x:(r=e.props.start.x)+(t.props.start.x-r)*n,y:(i=e.props.start.y)+(t.props.start.y-i)*n},end:{x:(o=e.props.end.x)+(t.props.end.x-o)*n,y:(s=e.props.end.y)+(t.props.end.y-s)*n},bend:(a=e.props.bend)+(t.props.bend-a)*n,labelPosition:(l=e.props.labelPosition)+(t.props.labelPosition-l)*n}}}let pt=iZ(function({shape:e,shouldDisplayHandles:t}){let n=i8(),r=hA(),i=uy(n,e),o=sL.ZeroFix(n.getShapeGeometry(e).bounds),s=ug(n,e),a=y.useMemo(()=>n.environment.isSafari?h9+=1:0,[e]);if(!i?.isValid)return null;let l=uA[e.props.size]*e.props.scale,c=i.start.arrowhead&&h5(i,"start",l),d=i.end.arrowhead&&h5(i,"end",l),u=i.isStraight?h8(i):h4(i),h=null;if(t){let t=2/n.getZoomLevel(),{strokeDasharray:r,strokeDashoffset:o}=hX(function(e,t){let n=uy(e,t);return n.isStraight?ot.Dist(n.start.handle,n.end.handle):Math.abs(n.handleArc.length)}(n,e),t,{end:"skip",start:"skip",lengthRatio:2.5});h=s.start||s.end?(0,m.jsx)("path",{className:"tl-arrow-hint",d:i.isStraight?h6(i.start.handle,i.end.handle):function(e){let{start:t,end:n,handleArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.handle.x},${t.handle.y} A${r} ${r} 0 ${i} ${o} ${n.handle.x},${n.handle.y}`}(i),strokeDasharray:r,strokeDashoffset:o,strokeWidth:t,markerStart:s.start?s.start.props.isExact?"":s.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:s.end?s.end.props.isExact?"":s.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}let{strokeDasharray:p,strokeDashoffset:f}=hX(i.isStraight?i.length:Math.abs(i.bodyArc.length),l,{style:e.props.dash}),g=h0(n,e),b=!("none"===i.start.arrowhead||"arrow"===i.start.arrowhead),x=!("none"===i.end.arrowhead||"arrow"===i.end.arrowhead),v=(e.id+"_clip_"+a).replace(":","_");return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("defs",{children:(0,m.jsxs)("mask",{id:v,children:[(0,m.jsx)("rect",{x:oC(-100+o.minX),y:oC(-100+o.minY),width:oC(o.width+200),height:oC(o.height+200),fill:"white"}),e.props.text.trim()&&(0,m.jsx)("rect",{x:g.box.x,y:g.box.y,width:g.box.w,height:g.box.h,fill:"black",rx:4,ry:4}),c&&b&&(0,m.jsx)("path",{d:c,fill:"arrow"===i.start.arrowhead?"none":"black",stroke:"none"}),d&&x&&(0,m.jsx)("path",{d:d,fill:"arrow"===i.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,m.jsxs)("g",{fill:"none",stroke:r[e.props.color].solid,strokeWidth:l,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[h,(0,m.jsxs)("g",{mask:`url(#${v})`,children:[(0,m.jsx)("rect",{x:oC(o.minX-100),y:oC(o.minY-100),width:oC(o.width+200),height:oC(o.height+200),opacity:0}),(0,m.jsx)("path",{d:u,strokeDasharray:p,strokeDashoffset:f})]}),c&&b&&"none"!==e.props.fill&&(0,m.jsx)(hH,{theme:r,d:c,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),d&&x&&"none"!==e.props.fill&&(0,m.jsx)(hH,{theme:r,d:d,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),c&&(0,m.jsx)("path",{d:c}),d&&(0,m.jsx)("path",{d:d})]})]})}),pn=new WeakMap;function pr(){return(0,m.jsx)("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,m.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function pi(){return(0,m.jsxs)("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,m.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,m.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}let po="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function ps({url:e,zoomLevel:t}){return(0,m.jsx)("a",{className:i0("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:oF,onPointerUp:oF,title:e,draggable:!1,children:(0,m.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${po}") center 100% / 100% no-repeat`,WebkitMask:`url("${po}") center 100% / 100% no-repeat`}})})}let pa="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",pl=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function pc(e){return pl.map(t=>{let{offsetX:n,offsetY:r,blur:i,spread:o,color:s}=t,{x:a,y:l}=new ot(n,r).rot(-e);return`${a}px ${l}px ${i}px ${o}px ${s}`}).join(", ")}class pd extends dV{static type="bookmark";static props=r5;static migrations=r6;canResize=()=>!1;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){let t=e.props.assetId?this.editor.getAsset(e.props.assetId):null,n=this.editor.getShapePageTransform(e).rotation(),r=ph(e);return(0,m.jsx)(d$,{children:(0,m.jsxs)("div",{className:"tl-bookmark__container",style:{boxShadow:pc(n),maxHeight:e.props.h},children:[(!t||t.props.image)&&(0,m.jsxs)("div",{className:"tl-bookmark__image_container",children:[t?(0,m.jsx)("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:t?.props.image,alt:t?.props.title||""}):(0,m.jsx)("div",{className:"tl-bookmark__placeholder"}),t?.props.image&&(0,m.jsx)(ps,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]}),(0,m.jsxs)("div",{className:"tl-bookmark__copy_container",children:[t?.props.title?(0,m.jsx)("h2",{className:"tl-bookmark__heading",children:t.props.title}):null,t?.props.description&&t?.props.image?(0,m.jsx)("p",{className:"tl-bookmark__description",children:t.props.description}):null,(0,m.jsxs)("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:oF,onPointerUp:oF,onClick:oF,children:[t?.props.favicon?(0,m.jsx)("img",{className:"tl-bookmark__favicon",src:t?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",alt:`favicon of ${r}`}):(0,m.jsx)("div",{className:"tl-hyperlink__icon",style:{mask:`url("${pa}") center 100% / 100% no-repeat`,WebkitMask:`url("${pa}") center 100% / 100% no-repeat`}}),(0,m.jsx)("span",{children:r})]})]})]})})}indicator(e){return(0,m.jsx)("rect",{width:oC(e.props.w),height:oC(e.props.h),rx:"6",ry:"6"})}onBeforeCreate=e=>pu(this.editor,e);onBeforeUpdate=(e,t)=>{if(e.props.url!==t.props.url){if(!nP.isValid(t.props.url))return{...t,props:{...t.props,url:e.props.url}};(function(e,t){let{url:n}=t.props,r=r3.createId(ej(n));e.getAsset(r)?t.props.assetId!==r&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:r}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),pp(e,t))})(this.editor,t)}if(e.props.assetId!==t.props.assetId)return pu(this.editor,t)}}function pu(e,t){let n=t.props.assetId?e.getAsset(t.props.assetId):null,r=320;return n&&!n.props.image&&(r=n.props.title?101:46),{...t,props:{...t.props,h:r}}}let ph=e=>{try{return new URL(e.props.url).hostname.replace(/^www\./,"")}catch(t){return e.props.url}},pp=ek(async(e,t)=>{if(e.isDisposed)return;let{url:n}=t.props,r=await e.getAssetForExternalContent({type:"url",url:n});r&&e.run(()=>{e.createAssets([r]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:r.id}}])})},500);function pf(e,t=!1){let n=e.length;if(n<2)return"";let r=e[0].point,i=e[1].point;if(2===n)return`M${or(r)}L${or(i)}`;let o="";for(let t=2,s=n-1;t<s;t++)o+=oi(r=e[t].point,i=e[t+1].point);return t?`M${oi(e[0].point,e[1].point)}Q${or(e[1].point)}${oi(e[1].point,e[2].point)}T${o}${oi(e[n-1].point,e[0].point)}${oi(e[0].point,e[1].point)}Z`:`M${or(e[0].point)}Q${or(e[1].point)}${oi(e[1].point,e[2].point)}${e.length>3?"T":""}${o}L${or(e[n-1].point)}`}function pg(e){let t,n;let r=e[0];for(;e.length>2;)if(t=e[1],ot.Dist2(r.point,t.point)<((r.radius+t.radius)/2*.5)**2)e.splice(1,1);else break;let i=e[e.length-1];for(;e.length>2;)if(n=e[e.length-2],ot.Dist2(i.point,n.point)<((i.radius+n.radius)/2*.5)**2)e.splice(e.length-2,1);else break;return e.length>1&&(e[0]={...e[0],vector:ot.Sub(e[0].point,e[1].point).uni()},e[e.length-1]={...e[e.length-1],vector:ot.Sub(e[e.length-2].point,e[e.length-1].point).uni()}),e}let pm=e=>.65*e+.35*ol(e*oo/2),py=e=>({size:e,thinning:.5,streamline:eV(e,[9,16],[.64,.74],!0),smoothing:.62,easing:oe.easeOutSine,simulatePressure:!0}),pb=e=>({size:1+1.2*e,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:pm}),px=e=>({size:e,thinning:0,streamline:eV(e,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:oe.linear}),pv=e=>({size:e,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:oe.linear});function pw({strokeWidth:e,showAsComplete:t}){return{size:1+e,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:oe.easeOutSine,last:t}}function pS(e,t,n,r){let i=e.isComplete||n;return r?e.isPen?{...pv(t),last:i}:{...px(t),last:i}:"draw"===e.dash?e.isPen?{...pb(t),last:i}:{...py(t),last:i}:{...px(t),last:i}}function pk(e){let t=[];for(let n of e)if("free"===n.type||n.points.length<2)t.push(...n.points.map(ot.Cast));else{let e=Math.max(4,Math.floor(ot.Dist(n.points[0],n.points[1])/16));t.push(...ot.PointsBetween(n.points[0],n.points[1],e))}return t}class pC extends lP{static type="draw";static props=r9;static migrations=ie;hideResizeHandles=e=>p_(e);hideRotateHandle=e=>p_(e);hideSelectionBoundsFg=e=>p_(e);getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){let t=pk(e.props.segments),n=(uA[e.props.size]+1)*e.props.scale;if(1===e.props.segments.length){let e=sL.FromPoints(t);if(e.width<2*n&&e.height<2*n)return new dZ({x:-n,y:-n,radius:n,isFilled:!0})}let r=d9(t,pS(e.props,n,e.props.isPen,!0)).map(e=>e.point);return e.props.isClosed?new lk({points:r,isFilled:"none"!==e.props.fill}):new lS({points:r})}component(e){return(0,m.jsx)(ld,{id:e.id,children:(0,m.jsx)(pI,{shape:e,zoomLevel:this.editor.getZoomLevel()})})}indicator(e){let t=pk(e.props.segments),n=(uA[e.props.size]+1)*e.props.scale,r=this.editor.getZoomLevel();r<.5&&r<1.5/n||e.props.isPen||"draw"!==e.props.dash||1!==t.length||(n+=eU(e.id)()*(n/6));let i=e.props.isComplete||ef(e.props.segments)?.type==="straight",o=d9(t,pS(e.props,n,i,!0)),s=o.length>1?pf(o,e.props.isClosed):pP(t[0],n);return(0,m.jsx)("path",{d:s})}toSvg(e,t){t.addExportDef(hL(e.props.fill));let n=1/e.props.scale;return(0,m.jsx)("g",{transform:`scale(${n})`,children:(0,m.jsx)(pI,{shape:e,zoomLevel:1})})}getCanvasSvgDefs(){return[hz()]}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:oP(n*e),y:oP(r*t),z:i}))});return{props:{segments:i}}};expandSelectionOutlinePx(e){let t="draw"===e.props.dash?1.6:1;return uA[e.props.size]*t/2*e.props.scale}}function pP(e,t){let n=(t+1)*.5;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}function p_(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function pI({shape:e,zoomLevel:t}){var n;let r=hA(),i=pk(e.props.segments),o=e.props.isComplete||ef(e.props.segments)?.type==="straight",s=(uA[e.props.size]+1)*e.props.scale,a=t<.5&&t<1.5/s;a||e.props.isPen||"draw"!==e.props.dash||1!==i.length||(s+=eU(e.id)()*(s/6));let l=pS(e.props,s,o,a);if(!a&&"draw"===e.props.dash)return(0,m.jsxs)(m.Fragment,{children:[e.props.isClosed&&e.props.fill&&i.length>1?(0,m.jsx)(hH,{d:pf(d9(i,l),e.props.isClosed),theme:r,color:e.props.color,fill:e.props.isClosed?e.props.fill:"none",scale:e.props.scale}):null,(0,m.jsx)("path",{d:function(e,t={}){let{start:n={},end:r={}}=t,{cap:i=!0}=n,{cap:o=!0}=r;ew(!n.taper&&!r.taper,"cap taper not supported here"),ew(!n.easing&&!r.easing,"cap easing not supported here"),ew(i&&o,"cap must be true");let s=d9(e,t);ue(s,t);let a=function(e){let t,n,r,i,o;if(e.length<=2)return[e];let s=[],a=[e[0]],l=ot.Sub(e[1].point,e[0].point).uni();for(let c=1,d=e.length;c<d-1;c++){if(r=e[c-1],i=e[c],o=e[c+1],t=ot.Sub(o.point,i.point).uni(),n=ot.Dpr(l,t),l=t,n<-.8){let e={...i,point:i.input};a.push(e),s.push(pg(a)),a=[e];continue}if(a.push(i),!(n>.7)&&(ot.Dist2(r.point,i.point)+ot.Dist2(i.point,o.point))/((r.radius+i.radius+o.radius)/3)**2<1.5){a.push(i),s.push(pg(a)),a=[i];continue}}return a.push(e[e.length-1]),s.push(pg(a)),s}(s),l="";for(let e of a)l+=function(e,t={}){if(0===e.length)return"";if(1===e.length){var n;return"M "+e[0].point.x+" "+e[0].point.y+" m -"+(n=e[0].radius)+", 0 a "+n+","+n+" 0 1,1 "+2*n+",0 a "+n+","+n+" 0 1,1 -"+2*n+",0"}let{left:r,right:i}=d6(e,t);i.reverse();let o=`M${or(r[0])}T`;for(let e=1;e<r.length;e++)o+=oi(r[e-1],r[e]);{let t=e[e.length-1],n=t.radius,r=t.vector.clone().per().neg(),i=ot.Add(t.point,ot.Mul(r,n)),s=ot.Add(t.point,ot.Mul(r,-n));o+=`${or(i)}A${oC(n)},${oC(n)} 0 0 1 ${or(s)}T`}for(let e=1;e<i.length;e++)o+=oi(i[e-1],i[e]);{let t=e[0],n=t.radius,r=t.vector.clone().per(),i=ot.Add(t.point,ot.Mul(r,n)),s=ot.Add(t.point,ot.Mul(r,-n));o+=`${or(i)}A${oC(n)},${oC(n)} 0 0 1 ${or(s)}Z`}return o}(e,t);return l}(i,l),strokeLinecap:"round",fill:r[e.props.color].solid})]});let c=d9(i,l),d=c.length<2,u=d?pP(i[0],0):pf(c,e.props.isClosed);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{d:u,theme:r,color:e.props.color,fill:d||e.props.isClosed?e.props.fill:"none",scale:e.props.scale}),(0,m.jsx)("path",{d:u,strokeLinecap:"round",fill:d?r[e.props.color].solid:"none",stroke:r[e.props.color].solid,strokeWidth:s,strokeDasharray:d?"none":(n=s,({draw:"none",solid:"none",dotted:`0.1 ${2*n}`,dashed:`${2*n} ${2*n}`})[e.props.dash]),strokeDashoffset:"0"})]})}let pE=e=>Object.entries(e).filter(([e,t])=>t).map(([e])=>e).join(" ");class pj extends dV{static type="embed";static props=is;static migrations=il;hideSelectionBoundsFg=e=>!this.canResize(e);canEdit=()=>!0;canResize=e=>!!u3(e.props.url)?.definition?.doesResize;canEditInReadOnly=()=>!0;getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked=e=>{let t=u3(e.props.url);return t?.definition.isAspectRatioLocked??!1};onResize=(e,t)=>{let n=this.isAspectRatioLocked(e),r=u3(e.props.url),i=r?.definition.minWidth??200,o=r?.definition.minHeight??200;if(n){let t=e.props.w/e.props.h;t>1?i*=t:o/=t}return function(e,t,n={}){let{newPoint:r,handle:i,scaleX:o,scaleY:s}=t,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=n,u=e.props.w*o,h=e.props.h*s,p=new ot(0,0);if(u>0){if(u<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=u-a;break;case"top":case"bottom":p.x=(u-a)/2;break;default:p.x=0}u=a}}else if(p.x=u,(u=-u)<a){switch(i){case"top_left":case"left":case"bottom_left":p.x=-u;break;default:p.x=-a}u=a}if(h>0){if(h<c){switch(i){case"top_left":case"top":case"top_right":p.y=h-c;break;case"right":case"left":p.y=(h-c)/2;break;default:p.y=0}h=c}}else if(p.y=h,(h=-h)<c){switch(i){case"top_left":case"top":case"top_right":p.y=-h;break;default:p.y=-c}h=c}let{x:f,y:g}=p.rot(e.rotation).add(r);return{x:f,y:g,props:{w:Math.min(l,u),h:Math.min(d,h)}}}(e,t,{minWidth:i,minHeight:o})};component(e){let{w:t,h:n,url:r}=e.props,i=dG(e.id),o=(0,y.useMemo)(()=>u2(r),[r]),s=iJ("is hovering",()=>{let{editingShapeId:e,hoveredShapeId:t}=this.editor.getCurrentPageState();if(e&&t!==e){let t=this.editor.getShape(e);if(t&&this.editor.isShapeOfType(t,"embed"))return!0}return!1},[]),a=this.editor.getShapePageTransform(e).rotation(),l=i||s;if("undefined"!=typeof window&&(window!==window.top||window.self!==window.parent)&&o?.definition.type==="tldraw")return null;if(o?.definition.type==="github_gist"){let r=o.url.split("/").pop();if(!r)throw Error("No gist id!");return(0,m.jsx)(d$,{className:"tl-embed-container",id:e.id,children:(0,m.jsx)(pT,{id:r,width:oC(t),height:oC(n),isInteractive:l,pageRotation:a})})}let c=pE({...io,...o?.definition.overridePermissions??{}});return(0,m.jsx)(d$,{className:"tl-embed-container",id:e.id,children:o?.definition?(0,m.jsx)("iframe",{className:"tl-embed",sandbox:c,src:o.embedUrl,width:oC(t),height:oC(n),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:l?"auto":"none",zIndex:l?"":"-1",boxShadow:pc(a),borderRadius:o?.definition.overrideOutlineRadius??8,background:o?.definition.backgroundColor}}):null})}indicator(e){let t=(0,y.useMemo)(()=>u3(e.props.url),[e.props.url]);return(0,m.jsx)("rect",{width:oC(e.props.w),height:oC(e.props.h),rx:t?.definition.overrideOutlineRadius??8,ry:t?.definition.overrideOutlineRadius??8})}}function pT({id:e,file:t,isInteractive:n,width:r,height:i,style:o,pageRotation:s}){return(0,m.jsx)("iframe",{className:"tl-embed",draggable:!1,width:oC(r),height:oC(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:pc(s)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=https://gist.github.com/${e}.js${t?`?file=${t}`:""}></script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}let pM=(0,y.forwardRef)(({id:e,name:t,isEditing:n},r)=>{let i=i8(),o=(0,y.useCallback)(e=>{"Enter"!==e.key||e.nativeEvent.isComposing||(oF(e),e.currentTarget.blur(),i.setEditingShape(null))},[i]),s=(0,y.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value.trim();r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}])},[e,i]),a=(0,y.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value;r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}])},[e,i]);return(0,m.jsxs)("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[(0,m.jsx)("input",{className:"tl-frame-name-input",ref:r,style:{display:n?void 0:"none"},value:t,autoFocus:!0,onKeyDown:o,onBlur:s,onChange:a}),pO(t,"Frame")+String.fromCharCode(8203)]})}),pA=function({id:e,name:t,width:n,height:r}){let i;let o=i8(),s=iJ("shape rotation",()=>op(o.getShapePageTransform(e).rotation()),[o,e]),a=dG(e),l=(0,y.useRef)(null),c=(0,y.useCallback)(t=>{let n=oB(t);t.preventDefault(),o.getEditingShapeId()!==e&&o.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:o.getShape(e),...n})},[o,e]);(0,y.useEffect)(()=>{let e=l.current;e&&a&&(e.focus(),e.select())},[l,a]);let d=["top","left","bottom","right"][Math.floor((2/Math.PI*(s+Math.PI/4)+4)%4)];switch(d){case"top":i="";break;case"right":i=`translate(${oC(n)}px, 0px) rotate(90deg)`;break;case"bottom":i=`translate(${oC(n)}px, ${oC(r)}px) rotate(180deg)`;break;case"left":i=`translate(0px, ${oC(r)}px) rotate(270deg)`}return(0,m.jsx)("div",{className:"tl-frame-heading",style:{overflow:a?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${"top"===d||"bottom"===d?Math.ceil(n):Math.ceil(r)}px + var(--space-5))`,bottom:"100%",transform:`${i} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:c,children:(0,m.jsx)("div",{className:"tl-frame-heading-hit-area",children:(0,m.jsx)(pM,{ref:l,id:e,name:t,isEditing:a})})})};function pO(e,t){return e.match(/^\s*$/)?t:e}class pL extends dV{static type="frame";static props=ic;static migrations=id;canEdit=()=>!0;getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){return new lC({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){let t=this.editor.getShapeGeometry(e).bounds,n=hA(),r=iJ("is creating this shape",()=>{let t=this.editor.getStateDescendant("select.resizing");if(!t||!t.getIsActive())return!1;let n=t?.info;return!!n&&n.isCreating&&this.editor.getOnlySelectedShapeId()===e.id},[e.id]);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ld,{children:(0,m.jsx)("rect",{className:i0("tl-frame__body",{"tl-frame__creating":r}),width:t.width,height:t.height,fill:n.solid,stroke:n.text})}),r?null:(0,m.jsx)(pA,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e,t){let n;let r=n0({isDarkMode:t.isDarkMode});switch(Math.floor((2/Math.PI*(op(this.editor.getShapePageTransform(e.id).rotation())+Math.PI/4)+4)%4)){case 0:n="";break;case 3:n=`translate(${oC(e.props.w)}, 0) rotate(90)`;break;case 2:n=`translate(${oC(e.props.w)}, ${oC(e.props.h)}) rotate(180)`;break;case 1:n=`translate(0, ${oC(e.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}let i={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},o=this.editor.textMeasure.measureTextSpans(pO(e.props.name,"Frame")+String.fromCharCode(8203),i),s=o[0],a=ef(o),l=a.box.w+a.box.x-s.box.x,c=hW(this.editor,o,{offsetY:-i.height-2,...i});return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("rect",{width:e.props.w,height:e.props.h,fill:r.solid,stroke:r.black.solid,strokeWidth:1,rx:1,ry:1}),(0,m.jsxs)("g",{transform:n,children:[(0,m.jsx)("rect",{x:-8,y:-i.height-4,width:l+16,height:i.height,fill:r.background,rx:4,ry:4}),c]})]})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,m.jsx)("rect",{width:oC(t.width),height:oC(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType=(e,t)=>!e.isLocked;providesBackgroundForChildren(){return!0}canDropShapes=(e,t)=>!e.isLocked;onDragShapesOver=(e,t)=>{t.every(t=>t.parentId===e.id)||this.editor.reparentShapes(t,e.id)};onDragShapesOut=(e,t)=>{let n=this.editor.getShape(e.parentId);n&&this.editor.isShapeOfType(n,"group")?this.editor.reparentShapes(t,n.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())};onResize=(e,t)=>dU(e,t)}function pD(e,t){return e>t?(t/2*oo+(e-t))*2:(e/2*oo+(t-e))*2}function pz(e,t){return pR(e,t).map((e,t)=>e.getSvgPathData(0===t)).join(" ")+" Z"}function pR(e,t){let n=e/4,r=t/4;return[new dQ({start:new ot(e/2,t),cp1:new ot(1.5*n,3*r),cp2:new ot(0,2.5*r),end:new ot(0,1.2*r)}),new dQ({start:new ot(0,1.2*r),cp1:new ot(0,-(.32*r)),cp2:new ot(1.85*n,-(.32*r)),end:new ot(e/2,.9*r)}),new dQ({start:new ot(e/2,.9*r),cp1:new ot(2.15*n,-(.32*r)),cp2:new ot(e,-(.32*r)),end:new ot(e,1.2*r)}),new dQ({start:new ot(e,1.2*r),cp1:new ot(e,2.5*r),cp2:new ot(2.5*n,3*r),end:new ot(e/2,t)})]}function pN(e){let t,n,r,i="M",o=e.length;for(let s=0;s<o;s+=3)t=e[s],n=e[s+1],r=e[s+2],i+=`${or(t)}L${or(n)}Q${or(r)}`;return i+`${or(e[0])}`}function pF(e,t,n,r,i){let o;let s=[],a=eU(e),l=t[0],c=t.length;for(let e=0,d=c*i;e<d;e++){o=ot.AddXY(t[(e+1)%c],a()*n,a()*n);let i=ot.Sub(o,l),d=ot.Len(i),u=ot.Div(i,d).mul(Math.min(d/4,r));s.push(ot.Add(l,u),ot.Add(o,u.neg()),o),l=o}return s}let p$={s:50,m:70,l:100,xl:130};function pB(e,t,n,r){let i=eU(n),o=pD(e,t),s=Math.max(Math.ceil(o/p$[r]),6,Math.ceil(o/Math.min(e,t))),a=o/s*.2,l=Math.max(e-2*a,1),c=Math.max(t-2*a,1),d=pD(l,c)/s,u=(e-l)/2,h=(t-c)/2,p=(function(e,t,n){let r=Math.min(e,t)/2,i=Math.max(e,t)-2*r,o=(2*r*Math.PI+2*i)/n,s=e>t?[{type:"straight",start:new ot(r,0),delta:new ot(1,0)},{type:"arc",center:new ot(e-r,r),startAngle:-oo/2},{type:"straight",start:new ot(e-r,t),delta:new ot(-1,0)},{type:"arc",center:new ot(r,r),startAngle:oo/2}]:[{type:"straight",start:new ot(e,r),delta:new ot(0,1)},{type:"arc",center:new ot(r,t-r),startAngle:0},{type:"straight",start:new ot(0,t-r),delta:new ot(0,-1)},{type:"arc",center:new ot(r,r),startAngle:oo}],a=0,l=[];for(let e=0;e<n;e++){let e=s[0];"straight"===e.type?l.push(ot.Add(e.start,ot.Mul(e.delta,a))):l.push(ox(e.center,r,e.startAngle+a/r)),a+=o;let t="straight"===e.type?i:oo*r;for(;a>t;)a-=t,s.push(s.shift()),t="straight"===s[0].type?i:oo*r}return l})(l,c,s).map(e=>e.addXY(u,h)),f=e<20?0:.3*a,g=t<20?0:.3*a,m=p.slice(0);for(let e=0;e<Math.floor(s/2);e++)m[e]=ot.AddXY(m[e],i()*f,i()*g),m[s-e-1]=ot.AddXY(m[s-e-1],i()*f,i()*g);let y=[];for(let n=0;n<m.length;n++){let r=n===m.length-1?0:n+1,i=m[n],o=m[r],s=p[n],a=p[r],l=ot.Dist(s,a),c=(Math.max(u,h)+(d-l))*(ot.Dist(i,o)/l),f=ot.Lrp(s,a,.5).add(ot.Sub(a,s).uni().per().mul(c));f.x<0?f.x=0:f.x>e&&(f.x=e),f.y<0?f.y=0:f.y>t&&(f.y=t);let g=oj(i,o,f),b=ot.Dist(g||ot.Average([i,o]),i);y.push({leftPoint:i,rightPoint:o,arcPoint:f,center:g,radius:b})}return y}function pU(e,t,n,r){let i=pB(e,t,n,r),o=`M${i[0].leftPoint.toFixed()}`;for(let{leftPoint:e,rightPoint:t,radius:n,center:r}of i){if(null===r){o+=` L${t.toFixed()}`;continue}let i=ot.Clockwise(e,t,r)?"0":"1";o+=` A${oC(n)},${oC(n)} 0 ${i},1 ${t.toFixed()}`}return o+" Z"}let pV={s:.5,m:.7,l:.9,xl:1.6};function pH(e,t){switch(e.geo){case"x-box":return function(e,t,n,r){let i="draw"===r?.62:0;if("dashed"===r)return[[new ot(0,0),new ot(e/2,t/2)],[new ot(e,t),new ot(e/2,t/2)],[new ot(0,t),new ot(e/2,t/2)],[new ot(e,0),new ot(e/2,t/2)]];let o=t=>Math.max(0,Math.min(e,t)),s=e=>Math.max(0,Math.min(t,e));return[[new ot(o(n*i),s(n*i)),new ot(o(e-n*i),s(t-n*i))],[new ot(o(n*i),s(t-n*i)),new ot(o(e-n*i),s(n*i))]]}(e.w,e.h,t,e.dash);case"check-box":return function(e,t){let n=.82*Math.min(e,t),r=(e-n)/2,i=(t-n)/2,o=t=>Math.max(0,Math.min(e,t)),s=e=>Math.max(0,Math.min(t,e));return[[new ot(o(r+.25*n),s(i+.52*n)),new ot(o(r+.45*n),s(i+.82*n))],[new ot(o(r+.45*n),s(i+.82*n)),new ot(o(r+.82*n),s(i+.22*n))]]}(e.w,e.h);default:return}}function pK({shape:e,shouldScale:t}){let n=t?e.props.scale:1,r=i8(),i=hA(),{id:o,props:s}=e,{w:a,color:l,fill:c,dash:d,growY:u,size:h}=s,p=uA[h]*n,f=s.h+u;switch(s.geo){case"cloud":if("solid"===d){let e=pU(a,f,o,h);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:e,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:e,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}if("draw"===d){let e=function(e,t,n,r){let i=eU(n),o=pV[r],s=pB(e,t,n,r),a=s.reduce((e,t)=>e+ot.Dist2(t.leftPoint,t.rightPoint),0)/s.length>(15*o)**2?e=>e.addXY(i()*o*2,i()*o*2):e=>e,l=`M${s[0].leftPoint.toFixed()}`,c=a(s[0].leftPoint),d=`M${c.toFixed()}`;for(let{leftPoint:e,center:t,rightPoint:n,radius:r,arcPoint:i}of s){if(null===t){l+=` L${n.toFixed()}`;let e=a(n);d+=` L${e.toFixed()}`,c=e;continue}let o=ot.Clockwise(e,n,t)?"0":"1";l+=` A${oC(r)},${oC(r)} 0 ${o},1 ${n.toFixed()}`;let s=a(n),u=oj(c,s,a(i));if(!Number.isFinite(u.x)||!Number.isFinite(u.y)){d+=` L${s.toFixed()}`,c=s;continue}let h=Math.abs(ot.Dist(u,c));d+=` A${oC(h)},${oC(h)} 0 ${o},1 ${s.toFixed()}`,c=s}return l+d+" Z"}(a,f,o,h);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:e,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:e,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}{let e=pU(a,f,o,h),t=pB(a,f,o,h);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:e,color:l,fill:c,scale:n}),(0,m.jsx)("g",{strokeWidth:p,stroke:i[l].solid,fill:"none",pointerEvents:"all",children:t.map(({leftPoint:e,rightPoint:t,center:n,radius:r},i)=>{let{strokeDasharray:o,strokeDashoffset:s}=hX(n?r*op(op(ot.Angle(n,t))-op(ot.Angle(n,e))):ot.Dist(e,t),p,{style:d,start:"outset",end:"outset"});return(0,m.jsx)("path",{d:n?`M${e.x},${e.y}A${r},${r},0,0,1,${t.x},${t.y}`:`M${e.x},${e.y}L${t.x},${t.y}`,strokeDasharray:o,strokeDashoffset:s},i)})})]})}case"ellipse":{let o=t?r.getShapeGeometry(e):r.getShapeUtil(e).getGeometry(e),s=o.getSvgPathData(!0);if("dashed"===d||"dotted"===d){let e=o.length,{strokeDasharray:t,strokeDashoffset:r}=hX(e<64?2*e:e,p,{style:d,snap:4,closed:!0});return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:s,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:s,strokeWidth:p,fill:"none",stroke:i[l].solid,strokeDasharray:t,strokeDashoffset:r})]})}{let o=(t?r.getShapeGeometry(e):r.getShapeUtil(e).getGeometry(e)).getSvgPathData(!0);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:o,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:o,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}}case"oval":{let o=t?r.getShapeGeometry(e):r.getShapeUtil(e).getGeometry(e),s=o.getSvgPathData(!0);if("dashed"!==d&&"dotted"!==d)return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:s,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:s,stroke:i[l].solid,strokeWidth:p,fill:"none"})]});{let e=o.getLength(),{strokeDasharray:t,strokeDashoffset:r}=hX(e<64?2*e:e,p,{style:d,snap:4,start:"outset",end:"outset",closed:!0});return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:s,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:s,strokeWidth:p,fill:"none",stroke:i[l].solid,strokeDasharray:t,strokeDashoffset:r})]})}}case"heart":if("dashed"===d||"dotted"===d||"solid"===d){let e=pz(a,f),t=pR(a,f);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:e,color:l,fill:c,scale:n}),t.map((e,t)=>{let{strokeDasharray:n,strokeDashoffset:r}=hX(e.length,p,{style:d,snap:1,start:"outset",end:"outset",closed:!0});return(0,m.jsx)("path",{d:e.getSvgPathData(),strokeWidth:p,fill:"none",stroke:i[l].solid,strokeDasharray:n,strokeDashoffset:r,pointerEvents:"all"},`curve_${t}`)})]})}{let t=function(e,t,n,r){let i=e/4,o=t/4,s=eU(r),a=.75*n,l=e=>e.addXY(s()*a,s()*a),c=new ot(e/2,t),d=new ot(0,1.2*o),u=new ot(e/2,.9*o),h=new ot(e,1.2*o),p=l(new ot(e/2,t)),f=l(new ot(0,1.2*o)),g=l(new ot(e/2,.9*o)),m=l(new ot(e,1.2*o));return[new dQ({start:c,cp1:new ot(1.5*i,3*o),cp2:new ot(0,2.5*o),end:d}),new dQ({start:d,cp1:new ot(0,-(.32*o)),cp2:new ot(1.85*i,-(.32*o)),end:u}),new dQ({start:u,cp1:new ot(2.15*i,-(.32*o)),cp2:new ot(e,-(.32*o)),end:h}),new dQ({start:h,cp1:new ot(e,2.5*o),cp2:new ot(2.5*i,3*o),end:p}),new dQ({start:p,cp1:new ot(1.5*i,3*o),cp2:new ot(0,2.5*o),end:f}),new dQ({start:f,cp1:new ot(0,-(.32*o)),cp2:new ot(1.85*i,-(.32*o)),end:g}),new dQ({start:g,cp1:new ot(2.15*i,-(.32*o)),cp2:new ot(e,-(.32*o)),end:m}),new dQ({start:m,cp1:new ot(e,2.5*o),cp2:new ot(2.5*i,3*o),end:c})].map((e,t)=>e.getSvgPathData(0===t)).join(" ")+" Z"}(a,f,p,e.id);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:t,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:t,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}default:{let s=t?r.getShapeGeometry(e):r.getShapeUtil(e).getGeometry(e),a=s instanceof sF?s.children[0].vertices:s.vertices,u=pH(e.props,p);if("solid"===d){let e="M"+a[0]+"L"+a.slice(1)+"Z";if(u)for(let[t,n]of u)e+=`M${t.x},${t.y}L${n.x},${n.y}`;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:e,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:e,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}if("dashed"===d||"dotted"===d){let e="M"+a[0]+"L"+a.slice(1)+"Z";return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:e,color:l,fill:c,scale:n}),(0,m.jsxs)("g",{strokeWidth:p,stroke:i[l].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(a.length)).map((e,t)=>{let n=ot.ToFixed(a[t]),r=ot.ToFixed(a[(t+1)%a.length]),{strokeDasharray:i,strokeDashoffset:o}=hX(ot.Dist(n,r),p,{style:d,start:"outset",end:"outset"});return(0,m.jsx)("line",{x1:n.x,y1:n.y,x2:r.x,y2:r.y,strokeDasharray:i,strokeDashoffset:o},t)}),u&&u.map(([e,t],n)=>{let{strokeDasharray:r,strokeDashoffset:o}=hX(ot.Dist(e,t),p,{style:d,start:"skip",end:"skip",snap:"dotted"===d?4:void 0});return(0,m.jsx)("path",{d:`M${e.x},${e.y}L${t.x},${t.y}`,stroke:i[l].solid,strokeWidth:p,fill:"none",strokeDasharray:r,strokeDashoffset:o},`line_fg_${n}`)})]})]})}if("draw"===d){let e=pN(pF(o,a,p/3,2*p,2));if(u)for(let[t,n]of u)e+=`M${t.toFixed()}L${n.toFixed()}`;let t=pN(pF(o,a,0,2*p,1));return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(hH,{theme:i,d:t,color:l,fill:c,scale:n}),(0,m.jsx)("path",{d:e,stroke:i[l].solid,strokeWidth:p,fill:"none"})]})}}}}class pW extends dV{static type="geo";static props=ig;static migrations=iy;canEdit=()=>!0;getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){let t;let n=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),i=n/2,o=r/2,s="none"!==e.props.fill;switch(e.props.geo){case"cloud":t=new lk({points:function(e,t,n,r){let i=[];for(let{center:o,radius:s,leftPoint:a,rightPoint:l}of pB(e,t,n,r))i.push(...function(e,t,n,r,i){if(null===n)return[ot.From(e),ot.From(t)];let o=[],s=ot.Angle(n,e),a=of(s,ot.Angle(n,t));for(let e=0;e<10;e++){let t=ox(n,r,s+e/9*a);o.push(t)}return o}(a,l,o,s,0));return i}(n,r,e.id,e.props.size),isFilled:s});break;case"triangle":t=new lk({points:[new ot(i,0),new ot(n,r),new ot(0,r)],isFilled:s});break;case"diamond":t=new lk({points:[new ot(i,0),new ot(n,o),new ot(i,r),new ot(0,o)],isFilled:s});break;case"pentagon":t=new lk({points:ov(n,r,5),isFilled:s});break;case"hexagon":t=new lk({points:ov(n,r,6),isFilled:s});break;case"octagon":t=new lk({points:ov(n,r,8),isFilled:s});break;case"ellipse":t=new d0({width:n,height:r,isFilled:s});break;case"oval":t=new d1({width:n,height:r,isFilled:s});break;case"star":{let e=oa/5/2,i=2*Math.floor(5/4),o=Math.cos(-os+i*e)*n/2,a=Math.cos(-os+(10-i)*e)*n/2,l=Math.sin(-os+0*e)*r/2,c=Math.sin(-os+2*Math.floor(2.5)*e)*r/2,d=n-Math.abs(o-a),u=r-Math.abs(c-l),h=n/2+a-(n/2-o),p=r/2+l-(r/2-c),f=(n-h)/2,g=(r-p)/2,m=(n+d)/2,y=(r+u)/2,b=1*m/2,x=1*y/2;t=new lk({points:Array.from(Array(10)).map((t,n)=>{let r=-os+n*e;return new ot(f+(n%2?b:m)*Math.cos(r),g+(n%2?x:y)*Math.sin(r))}),isFilled:s});break}case"rhombus":{let e=Math.min(.38*n,.38*r);t=new lk({points:[new ot(e,0),new ot(n,0),new ot(n-e,r),new ot(0,r)],isFilled:s});break}case"rhombus-2":{let e=Math.min(.38*n,.38*r);t=new lk({points:[new ot(0,0),new ot(n-e,0),new ot(n,r),new ot(e,r)],isFilled:s});break}case"trapezoid":{let e=Math.min(.38*n,.38*r);t=new lk({points:[new ot(e,0),new ot(n-e,0),new ot(n,r),new ot(0,r)],isFilled:s});break}case"arrow-right":{let e=.38*Math.min(n,r),i=.16*r;t=new lk({points:[new ot(0,i),new ot(n-e,i),new ot(n-e,0),new ot(n,r/2),new ot(n-e,r),new ot(n-e,r-i),new ot(0,r-i)],isFilled:s});break}case"arrow-left":{let e=.38*Math.min(n,r),i=.16*r;t=new lk({points:[new ot(e,0),new ot(e,i),new ot(n,i),new ot(n,r-i),new ot(e,r-i),new ot(e,r),new ot(0,r/2)],isFilled:s});break}case"arrow-up":{let e=.16*n,i=.38*Math.min(n,r);t=new lk({points:[new ot(n/2,0),new ot(n,i),new ot(n-e,i),new ot(n-e,r),new ot(e,r),new ot(e,i),new ot(0,i)],isFilled:s});break}case"arrow-down":{let e=.16*n,i=.38*Math.min(n,r);t=new lk({points:[new ot(e,0),new ot(n-e,0),new ot(n-e,r-i),new ot(n,r-i),new ot(n/2,r),new ot(0,r-i),new ot(e,r-i)],isFilled:s});break}case"check-box":case"x-box":case"rectangle":t=new lC({width:n,height:r,isFilled:s});break;case"heart":t=new lk({points:pR(n,r).reduce((e,t)=>(e.push(...t.vertices),e),[]),isFilled:s});break;default:ev(e.props.geo)}let a=pG(this.editor,e),l=n/e.props.scale,c=r/e.props.scale,d=Math.min(100,l/2),u=Math.min(uL[e.props.size]*uM.lineHeight+32,c/2),h=Math.min(l,Math.max(a.w,Math.min(d,Math.max(1,l-8)))),p=Math.min(c,Math.max(a.h,Math.min(u,Math.max(1,c-8)))),f=pH(e.props,uA[e.props.size]*e.props.scale),g=f?f.map(e=>new lS({points:e})):[];return new sF({children:[t,new lC({x:"start"===e.props.align?0:"end"===e.props.align?(l-h)*e.props.scale:(l-h)/2*e.props.scale,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?(c-p)*e.props.scale:(c-p)/2*e.props.scale,width:h*e.props.scale,height:p*e.props.scale,isFilled:!0,isLabel:!0}),...g]})}getHandleSnapGeometry(e){let t=this.getGeometry(e),n=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:n,points:[...n.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:n,points:[t.bounds.center]};default:ev(e.props.geo)}}onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};component(e){let{id:t,type:n,props:r}=e,{fill:i,font:o,align:s,verticalAlign:a,size:l,text:c}=r,d=hA(),u=null!==this.editor.getEditingShapeId(),h=iJ("isGeoOnlySelected",()=>e.id===this.editor.getOnlySelectedShapeId(),[]),p=u||e.props.text;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(ld,{id:t,children:(0,m.jsx)(pK,{shape:e,shouldScale:!0})}),p&&(0,m.jsx)(d$,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+r.growY},children:(0,m.jsx)(hY,{id:t,type:n,font:o,fontSize:uL[l]*e.props.scale,lineHeight:uM.lineHeight,padding:16*e.props.scale,fill:i,align:s,verticalAlign:a,text:c,isSelected:h,labelColor:d[r.labelColor].solid,wrap:!0})}),e.props.url&&(0,m.jsx)(ps,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){let{id:t,props:n}=e,{w:r,size:i}=n,o=n.h+n.growY,s=uA[i],a=this.editor.getShapeGeometry(e);switch(n.geo){case"ellipse":if("draw"===n.dash)return(0,m.jsx)("path",{d:pf(function(e,t,n,r){let i=eU(e),o=t/2,s=n/2,a=oh(o,s),l=[],c=oa*i(),d=oa+os/2+Math.abs(i())*os,u=Math.max(16,a/10);for(let e=0;e<u;e++){let r=e/(u-1),a=c+r*d,h=Math.cos(a),p=Math.sin(a);l.push(new ot(o*h+.5*t+.05*i(),s*p+n/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?oe.easeInOutSine(r):oe.easeInExpo(r)))/2)))}return d9(l,{size:1+r,thinning:.25,end:{taper:r},start:{taper:r},streamline:0,smoothing:1,simulatePressure:!1})}(t,r,o,s))});return(0,m.jsx)("path",{d:a.getSvgPathData(!0)});case"heart":return(0,m.jsx)("path",{d:pz(r,o)});case"oval":return(0,m.jsx)("path",{d:a.getSvgPathData(!0)});case"cloud":return(0,m.jsx)("path",{d:pU(r,o,t,i)});default:{let r;let i=this.editor.getShapeGeometry(e),o=i instanceof sF?i.children[0].vertices:i.vertices;r="draw"===n.dash?pN(pF(t,o,0,2*s*e.props.scale,1)):"M"+o[0]+"L"+o.slice(1)+"Z";let a=pH(e.props,s);if(a)for(let[e,t]of a)r+=`M${e.x},${e.y}L${t.x},${t.y}`;return(0,m.jsx)("path",{d:r})}}}toSvg(e,t){let n;let r={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},i=r.props;if(t.addExportDef(hL(i.fill)),i.text){t.addExportDef(hO(i.font));let e=n0(t),r=new sL(0,0,i.w,i.h+i.growY);n=(0,m.jsx)(hG,{fontSize:uL[i.size],font:i.font,align:i.align,verticalAlign:i.verticalAlign,text:i.text,labelColor:e[i.labelColor].solid,bounds:r,padding:16})}return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(pK,{shouldScale:!1,shape:r}),n]})}getCanvasSvgDefs(){return[hz()]}onResize=(e,{handle:t,newPoint:n,scaleX:r,scaleY:i,initialShape:o})=>{let s=o.props.w/o.props.scale,a=o.props.h/o.props.scale,l=o.props.growY/o.props.scale,c=s*r,d=(a+l)*i,u=0,h=0;if(e.props.text.trim()){let t=Math.max(Math.abs(c),51),n=Math.max(Math.abs(d),51);t<51&&51===n&&(t=51),51===t&&n<51&&(n=51);let r=pG(this.editor,{...e,props:{...e.props,w:t*e.props.scale,h:n*e.props.scale}}),i=Math.max(Math.abs(c),r.w)*Math.sign(c),o=Math.max(Math.abs(d),r.h)*Math.sign(d);u=Math.abs(i)-Math.abs(c),h=Math.abs(o)-Math.abs(d),c=i,d=o}let p=c*e.props.scale,f=d*e.props.scale,g=new ot(0,0);r<0&&(g.x+=p),("left"===t||"top_left"===t||"bottom_left"===t)&&(g.x+=r<0?u:-u),i<0&&(g.y+=f),("top"===t||"top_left"===t||"top_right"===t)&&(g.y+=i<0?h:-h);let{x:m,y}=g.rot(e.rotation).add(n);return{x:m,y,props:{w:Math.max(Math.abs(p),1),h:Math.max(Math.abs(f),1),growY:0}}};onBeforeCreate=e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;let t=e.props.h/e.props.scale,n=pG(this.editor,e).h,r=null;if(n>t?r=n-t:e.props.growY&&(r=0),null!==r)return{...e,props:{...e.props,growY:r*e.props.scale}}};onBeforeUpdate=(e,t)=>{let n=e.props.text,r=t.props.text;if(n===r&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(n&&!r)return{...t,props:{...t.props,growY:0}};let i=e.props.w/e.props.scale,o=e.props.h/e.props.scale,s=e.props.growY/e.props.scale,a=pG(this.editor,t);if(!n&&r&&1===r.length){let e=Math.max(i,a.w),n=Math.max(o,a.h);return i<51&&o<51&&(n=Math.max(e=Math.max(e=Math.max(e,51),n=Math.max(n,51)),n)),{...t,props:{...t.props,w:e*t.props.scale,h:n*t.props.scale,growY:0}}}let l=null;if(a.h>o?l=a.h-o:s&&(l=0),null!==l){let e=t.props.w/t.props.scale;return{...t,props:{...t.props,growY:l*t.props.scale,w:Math.max(e,a.w)*t.props.scale}}}if(a.w>i)return{...t,props:{...t.props,w:a.w*t.props.scale}}};onDoubleClick=e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}}function pG(e,t){let{text:n,font:r,size:i,w:o}=t.props;if(!n)return{w:0,h:0};let s=e.textMeasure.measureText("w",{...uM,fontFamily:uz[r],fontSize:uL[i],maxWidth:100}),a=e.textMeasure.measureText(n,{...uM,fontFamily:uz[r],fontSize:uL[i],minWidth:s.w,maxWidth:Math.max(0,Math.ceil(s.w+({s:2,m:3.5,l:5,xl:10})[i]),Math.ceil(o/t.props.scale-32))});return{w:a.w+32,h:a.h+32}}class pq extends lP{static type="highlight";static props=iv;static migrations=iw;hideResizeHandles=e=>pZ(e);hideRotateHandle=e=>pZ(e);hideSelectionBoundsFg=e=>pZ(e);getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){let t=pX(e);if(pZ(e))return new dZ({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});let{strokePoints:n,sw:r}=pY(e,t,!0),i=pw({strokeWidth:r,showAsComplete:!0});return ue(n,i),new lk({points:d8(n,i),isFilled:!0})}component(e){let t=pJ(this.editor,e),n=pX(e);return(0,m.jsx)(ld,{id:e.id,children:(0,m.jsx)(pQ,{shape:e,forceSolid:t,strokeWidth:n,opacity:.35})})}backgroundComponent(e){let t=pJ(this.editor,e),n=pX(e);return(0,m.jsx)(ld,{id:e.id,children:(0,m.jsx)(pQ,{shape:e,forceSolid:t,strokeWidth:n,opacity:.82})})}indicator(e){let t;let n=pJ(this.editor,e),r=pX(e),{strokePoints:i,sw:o}=pY(e,r,n),s=pk(e.props.segments);return t=i.length<2?function(e,t){let n=t/2;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}(s[0],o):pf(i,!1),(0,m.jsx)("path",{d:t})}toSvg(e){let t=pX(e),n=1/e.props.scale;return(0,m.jsx)("g",{transform:`scale(${n})`,children:(0,m.jsx)(pQ,{forceSolid:t<1.5,strokeWidth:t,shape:e,opacity:.35})})}toBackgroundSvg(e){let t=pX(e),n=1/e.props.scale;return(0,m.jsx)("g",{transform:`scale(${n})`,children:(0,m.jsx)(pQ,{forceSolid:t<1.5,strokeWidth:t,shape:e,opacity:.82})})}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:n*e,y:r*t,z:i}))});return{props:{segments:i}}}}function pY(e,t,n){let r=pk(e.props.segments),i=e.props.isComplete||ef(e.props.segments)?.type==="straight",o=t;return n||e.props.isPen||1!==r.length||(o+=eU(e.id)()*(t/6)),{strokePoints:d9(r,pw({strokeWidth:o,showAsComplete:i})),sw:o}}function pX(e){return 1.12*uO[e.props.size]*e.props.scale}function pZ(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function pQ({strokeWidth:e,forceSolid:t,shape:n,opacity:r}){var i;let o=hA(),s=pk(n.props.segments),a=e;t||n.props.isPen||1!==s.length||(a+=eU(n.id)()*(a/6));let l=d9(s,pw({strokeWidth:a,showAsComplete:n.props.isComplete||ef(n.props.segments)?.type==="straight"})),c=l.length>1?pf(l,!1):(i=n.props.segments[0].points[0],`M ${i.x} ${i.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`),d=function(){let[e,t]=(0,y.useState)(!1);return(0,y.useEffect)(()=>{let e=CSS.supports("color","color(display-p3 1 1 1)"),n=matchMedia("(color-gamut: p3)");t(e&&n.matches);let r=()=>t(e&&n.matches);return n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),iJ(t_.forceSrgb)||!e?"srgb":"p3"}(),u=o[n.props.color].highlight[d];return(0,m.jsx)("path",{d:c,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:u,strokeWidth:a,opacity:r})}function pJ(e,t){return iJ("forceSolid",()=>pX(t)/e.getZoomLevel()<1.5,[e])}function p0(){return(0,m.jsxs)("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,m.jsx)("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),(0,m.jsx)("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),(0,m.jsx)("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function p1(e,t,n){let r=i8(),[i,o]=(0,y.useState)(null),s=t?r.getAsset(t):null,a=r.getCulledShapes().has(e),l=(0,y.useRef)(!1);(0,y.useEffect)(()=>{i&&(l.current=!0)},[i]);let c=s&&"w"in s.props?n/s.props.w:1,d=iJ("zoom level",()=>r.getZoomLevel()*c,[r,c]);return(0,y.useEffect)(()=>{if(a)return;let e=!1,n=r.timers.setTimeout(async()=>{let n=await r.resolveAssetUrl(t,{screenScale:d});e||o(n)},l.current?500:0);return()=>{clearTimeout(n),e=!0}},[t,s?.props.src,a,d,r]),{asset:s,url:i}}function p2(){let[e,t]=(0,y.useState)(!1);return(0,y.useEffect)(()=>{if("undefined"==typeof window||!("matchMedia"in window))return;let e=window.matchMedia("(prefers-reduced-motion: reduce)"),n=()=>{t(e.matches)};return n(),e.addEventListener("change",n),()=>e.removeEventListener("change",n)},[]),e}async function p3(e){let t=await e_(e),n=await t.blob();return eE.blobToDataUrl(n)}class p5 extends dV{static type="image";static props=ik;static migrations=iP;isAspectRatioLocked=()=>!0;canCrop=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize=(e,t)=>{let n=dU(e,t),{flipX:r,flipY:i}=t.initialShape.props;return{...n,props:{...n.props,flipX:t.scaleX<0!==r,flipY:t.scaleY<0!==i}}};isAnimated(e){let t=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;return!!t&&("mimeType"in t.props&&eB.isAnimatedImageType(t?.props.mimeType)||"isAnimated"in t.props&&t.props.isAnimated)}component(e){let t=this.editor.getCroppingShapeId()===e.id,n=p2(),[r,i]=(0,y.useState)(""),[o,s]=(0,y.useState)(""),a=e.id===this.editor.getOnlySelectedShapeId(),{asset:l,url:c}=p1(e.id,e.props.assetId,e.props.w);if((0,y.useEffect)(()=>{if(c){let e=!1,t=eI();return t.onload=()=>{e||s(c)},t.src=c,()=>{e=!0}}},[c,e]),(0,y.useEffect)(()=>{if(c&&this.isAnimated(e)){let e=!1,t=eI();return t.onload=()=>{if(e)return;let n=document.createElement("canvas");n.width=t.width,n.height=t.height;let r=n.getContext("2d");r&&(r.drawImage(t,0,0),i(n.toDataURL()),s(c))},t.crossOrigin="anonymous",t.src=c,()=>{e=!0}}},[n,c,e]),l?.type==="bookmark")throw Error("Bookmark assets can't be rendered as images");let d=a&&t&&this.editor.isIn("select.crop"),u=n&&(l?.props.mimeType?.includes("video")||this.isAnimated(e)),h=p4(e);return l?.props.src?o?(0,m.jsxs)(m.Fragment,{children:[d&&(0,m.jsx)("div",{style:h,children:(0,m.jsx)("img",{className:"tl-image",crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||u?r:o,referrerPolicy:"strict-origin-when-cross-origin",style:{opacity:.1},draggable:!1})}),(0,m.jsxs)(d$,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[(0,m.jsxs)("div",{className:"tl-image-container",style:h,children:[(0,m.jsx)("img",{className:i0("tl-image",{"tl-flip-x":e.props.flipX&&!e.props.flipY,"tl-flip-y":e.props.flipY&&!e.props.flipX,"tl-flip-xy":e.props.flipY&&e.props.flipX}),crossOrigin:this.isAnimated(e)?"anonymous":void 0,src:!e.props.playing||u?r:o,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1}),this.isAnimated(e)&&!e.props.playing&&(0,m.jsx)("div",{className:"tl-image__tg",children:"GIF"})]}),e.props.url&&(0,m.jsx)(ps,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):null:(0,m.jsxs)(d$,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:l?"transparent":"var(--color-low)",border:l?"none":"1px solid var(--color-low-border)"},children:[(0,m.jsx)("div",{className:"tl-image-container",style:h,children:l?null:(0,m.jsx)(p0,{})}),"url"in e.props&&e.props.url&&(0,m.jsx)(ps,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:(0,m.jsx)("rect",{width:oC(e.props.w),height:oC(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let t=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!t)return null;(t.startsWith("blob:")||t.startsWith("http")||t.startsWith("/")||t.startsWith("./"))&&(t=await p3(t)||"");let n=p4(e),r=e.props.crop;if(!n.transform||!r)return(0,m.jsx)("image",{href:t,width:e.props.w,height:e.props.h});{let{transform:i,width:o,height:s}=n,a=(r.bottomRight.x-r.topLeft.x)*o,l=(r.bottomRight.y-r.topLeft.y)*s,c=[new ot(0,0),new ot(a,0),new ot(a,l),new ot(0,l)],d=`cropClipPath_${e.id.replace(":","_")}`;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("defs",{children:(0,m.jsx)("clipPath",{id:d,children:(0,m.jsx)("polygon",{points:c.map(e=>`${e.x},${e.y}`).join(" ")})})}),(0,m.jsx)("g",{clipPath:`url(#${d})`,children:(0,m.jsx)("image",{href:t,width:o,height:s,style:{transform:i}})})]})}}onDoubleClick=e=>{let t=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;t&&t.props.src&&this.isAnimated(e)&&this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])};onDoubleClickEdge=e=>{let t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;let n=tS(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},r=1/(n.bottomRight.x-n.topLeft.x)*e.props.w,i=1/(n.bottomRight.y-n.topLeft.y)*e.props.h,o=new ot(n.topLeft.x*r,n.topLeft.y*i).rot(e.rotation),s={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:r,h:i}};this.editor.updateShapes([s])}}function p4(e){let t=e.props.crop,n=t?.topLeft;if(!n)return{width:e.props.w,height:e.props.h};let r=1/(t.bottomRight.x-t.topLeft.x)*e.props.w,i=1/(t.bottomRight.y-t.topLeft.y)*e.props.h,o=-n.x*r,s=-n.y*i;return{transform:`translate(${o}px, ${s}px)`,width:r,height:i}}function p6(e){return{size:e,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function p8(e,t,n){return d9(t.vertices,p6(n))}function p9(e,t,n){let r,i,o=`M ${or(t[0])}L`,s=`M ${or(t[0])}L`,a=n/3,l=2*n,c=eU(e),d=t[0],u=t[0],h=t.length;for(let e=0,n=h-1;e<n;e++){r=t[e+1],i=ot.AddXY(t[e+1],c()*a,c()*a);let h=ot.Sub(r,d),p=ot.Len(h),f=ot.Div(h,p).mul(Math.min(p/4,l)),g=ot.Add(d,f),m=ot.Add(r,f.neg()),y=ot.Sub(i,u),b=ot.Len(y),x=ot.Div(y,b).mul(Math.min(b/4,l)),v=ot.Add(u,x),w=ot.Add(i,x.neg());e===n-1?(o+=`${or(g)}L ${or(r)}`,s+=`${or(v)}L ${or(i)}`):(o+=`${or(g)}L ${or(m)}Q ${or(r)}`,s+=`${or(v)}L ${or(w)}Q ${or(i)}`,d=r,u=i)}return[o,o+s]}let p7=new em;class fe extends lP{static type="line";static props=iE;static migrations=iT;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsFg=()=>!0;hideSelectionBoundsBg=()=>!0;getDefaultProps(){let[e,t]=tr(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){return fn(e)}getHandles(e){return p7.get(e.props,()=>{let t=fn(e),n=ft(e),r=n.map(e=>({...e,id:e.index,type:"vertex",canSnap:!0}));for(let e=0;e<n.length-1;e++){let i=tt(n[e].index,n[e+1].index),o=t.segments[e].midPoint();r.push({id:i,type:"create",index:i,x:o.x,y:o.y,canSnap:!0})}return r.sort(ti)})}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t;return{props:{points:eZ(e.props.points,(e,{id:t,index:i,x:o,y:s})=>({id:t,index:i,x:o*n,y:s*r}))}}};onHandleDrag=(e,{handle:t})=>{if("vertex"===t.type)return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:t.x,y:t.y}}}}};component(e){return(0,m.jsx)(ld,{id:e.id,children:(0,m.jsx)(fr,{shape:e})})}indicator(e){let t;let n=uA[e.props.size]*e.props.scale,r=fn(e),{dash:i}=e.props;if("line"===e.props.spline){let o=r.points;if("solid"===i||"dotted"===i||"dashed"===i)t="M"+o[0]+"L"+o.slice(1);else{let[r]=p9(e.id,o,n);t=r}}else t="draw"===e.props.dash?pf(p8(e,r,n)):r.getSvgPathData();return(0,m.jsx)("path",{d:t})}toSvg(e){return(0,m.jsx)(fr,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){let t=ft(e);return{points:t,getSelfSnapPoints:n=>{let r=this.getHandles(e).filter(e=>"vertex"===e.type).findIndex(e=>e.id===n.id);return t.filter((e,t)=>Math.abs(t-r)>1).map(ot.From)},getSelfSnapOutline:t=>{let n=this.getHandles(e).filter(e=>"vertex"===e.type).findIndex(e=>e.id===t.id),r=fn(e).segments.filter((e,t)=>t!==n-1&&t!==n);return r.length?new sF({children:r}):null}}}getInterpolatedProps(e,t,n){let r=ft(e),i=ft(t),o=[],s=[],a="a0";if(r.length>i.length)for(let e=0;e<r.length;e++)o[e]={...r[e]},void 0===i[e]?s[e]={...i[i.length-1],id:a}:s[e]={...i[e],id:a},a=tn(a);else if(i.length>r.length)for(let e=0;e<i.length;e++)s[e]={...i[e]},void 0===r[e]?o[e]={...r[r.length-1],id:a}:o[e]={...r[e],id:a},a=tn(a);else for(let e=0;e<i.length;e++)o[e]=r[e],s[e]=i[e];return{...t.props,points:Object.fromEntries(o.map((e,t)=>{var r,i;let o=s[t];return[e.id,{...e,x:(r=e.x)+(o.x-r)*n,y:(i=e.y)+(o.y-i)*n}]}))}}}function ft(e){return Object.values(e.props.points).sort(ti)}function fn(e){let t=ft(e).map(ot.From);switch(e.props.spline){case"cubic":return new dJ({points:t});case"line":return new lS({points:t})}}function fr({shape:e,shouldScale:t=!1}){let n=hA(),r=fn(e),{dash:i,color:o,size:s}=e.props,a=1/e.props.scale,l=t?a:1,c=uA[s]*e.props.scale;if("line"===e.props.spline){if("solid"===i){let e=r.points,t="M"+e[0]+"L"+e.slice(1);return(0,m.jsx)("path",{d:t,stroke:n[o].solid,strokeWidth:c,fill:"none",transform:`scale(${l})`})}if("dashed"===i||"dotted"===i)return(0,m.jsx)("g",{stroke:n[o].solid,strokeWidth:c,transform:`scale(${l})`,children:r.segments.map((e,t)=>{let{strokeDasharray:n,strokeDashoffset:o}=hX(e.length,c,{style:i,start:t>0?"outset":"none",end:t<r.segments.length-1?"outset":"none"});return(0,m.jsx)("path",{strokeDasharray:n,strokeDashoffset:o,d:e.getSvgPathData(!0),fill:"none"},t)})});if("draw"===i){let t=r.points,[i,s]=p9(e.id,t,c);return(0,m.jsx)("path",{d:s,stroke:n[o].solid,strokeWidth:c,fill:"none",transform:`scale(${l})`})}}if("cubic"===e.props.spline){let t=r.getSvgPathData();if("solid"===i)return(0,m.jsx)("path",{strokeWidth:c,stroke:n[o].solid,fill:"none",d:t,transform:`scale(${l})`});if("dashed"===i||"dotted"===i)return(0,m.jsx)("g",{stroke:n[o].solid,strokeWidth:c,transform:`scale(${l})`,children:r.segments.map((e,t)=>{let{strokeDasharray:n,strokeDashoffset:o}=hX(e.length,c,{style:i,start:t>0?"outset":"none",end:t<r.segments.length-1?"outset":"none"});return(0,m.jsx)("path",{strokeDasharray:n,strokeDashoffset:o,d:e.getSvgPathData(),fill:"none"},t)})});if("draw"===i)return(0,m.jsx)("path",{d:ag(function(e,t,n){let r=p6(n);return d8(ue(p8(e,t,n),r),r)}(e,r,c)),strokeWidth:1,stroke:n[o].solid,fill:n[o].solid,transform:`scale(${l})`})}}let fi=(0,y.createContext)(null);function fo({assetUrls:e,children:t}){return(0,y.useEffect)(()=>{for(let t of Object.values(e.icons)){let e=eI();e.src=t,e.decode()}for(let t of Object.values(e.embedIcons)){let e=eI();e.src=t,e.decode()}},[e]),(0,m.jsx)(fi.Provider,{value:e,children:t})}function fs(){let e=(0,y.useContext)(fi);if(!e)throw Error("useAssetUrls must be used within an AssetUrlsProvider");return e}let fa={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},fl=new Set(["ar","fa","he","ur","ku"]),fc={locale:"en",label:"English",messages:fa,dir:"ltr"};async function fd(e,t){if(!(await e_(t.translations.en)).ok)return console.warn("No main translations found."),fc;if("en"===e)return fc;let n=iK.find(t=>t.locale===e);if(!n)return console.warn(`No translation found for locale ${e}`),fc;let r=await e_(t.translations[n.locale]),i=await r.json();if(!i)return console.warn(`No messages found for locale ${e}`),fc;let o=[];for(let e in fc.messages)i[e]||o.push(e);return o.length,{locale:e,label:n.label,dir:fl.has(n.locale)?"rtl":"ltr",messages:{...fc.messages,...i}}}let fu=y.createContext(null);function fh(){let e=y.useContext(fu);if(!e)throw Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return e}let fp=iZ(function({overrides:e,children:t}){let n=i8().user.getLocale(),r=fs(),[i,o]=y.useState(()=>e&&e.en?{locale:"en",label:"English",dir:"ltr",messages:{...fa,...e.en}}:{locale:"en",label:"English",dir:"ltr",messages:fa});return y.useEffect(()=>{let t=!1;return async function(){let i=await fd(n,r);i&&!t&&(e&&e[n]?o({...i,messages:{...i.messages,...e[n]}}):o(i))}(),()=>{t=!0}},[r,n,e]),(0,m.jsx)(fu.Provider,{value:i,children:t})});function ff(){let e=fh();return y.useCallback(function(t){return e.messages[t]??t},[e])}class fg extends lP{static type="note";static props=iM;static migrations=iO;canEdit=()=>!0;hideResizeHandles=()=>!0;hideSelectionBoundsFg=()=>!1;getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){let{labelHeight:t,labelWidth:n}=fb(this.editor,e),{scale:r}=e.props,i=t*r,o=n*r,s=200*r,a=fx(e);return new sF({children:[new lC({width:s,height:a,isFilled:!0}),new lC({x:"start"===e.props.align?0:"end"===e.props.align?s-o:(s-o)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?a-i:(a-i)/2,width:o,height:i,isFilled:!0,isLabel:!0})]})}getHandles(e){let{scale:t}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];let n=this.editor.getZoomLevel();if(n*t<.25)return[];let r=fx(e),i=200*t,o=0/n*t;return n*t<.5?[{id:"bottom",index:"a3",type:"clone",x:i/2,y:r+o}]:[{id:"top",index:"a1",type:"clone",x:i/2,y:-o},{id:"right",index:"a2",type:"clone",x:i+o,y:r/2},{id:"bottom",index:"a3",type:"clone",x:i/2,y:r+o},{id:"left",index:"a4",type:"clone",x:-o,y:r/2}]}component(e){let{id:t,type:n,props:{scale:r,color:i,font:o,size:s,align:a,text:l,verticalAlign:c,fontSizeAdjustment:d}}=e,u=function(e){let t=i8(),n=fh();return(0,y.useCallback)(r=>{let i=t.getShape(e);if(!i)return;let o="Tab"===r.key,s=(r.metaKey||r.ctrlKey)&&"Enter"===r.key;if(o||s){var a;r.preventDefault();let l=t.getShapePageTransform(e),c=l.rotation(),d=!!("rtl"===n.dir||(a=i.props.text,u6.test(a))),u=(200+t.options.adjacentShapeMargin+(s&&!r.shiftKey?i.props.growY:0))*i.props.scale,h=new ot(o?r.shiftKey!=d?-1:1:0,s?r.shiftKey?-1:1:0).mul(u).add(hb.clone().mul(i.props.scale)).rot(c).add(l.point()),p=hS(t,i,h,c);p&&(t.mark("editing adjacent shape"),hm(t,p,!0))}},[e,t,n.dir])}(t),h=hA(),p=200*r,f=fx(e),g=iJ("shape rotation",()=>this.editor.getShapePageTransform(t)?.rotation()??0,[this.editor]),b=iJ("zoom",()=>this.editor.getZoomLevel()<.35/r,[r,this.editor]),x=e.id===this.editor.getOnlySelectedShapeId();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{id:t,className:"tl-note__container",style:{width:p,height:f,backgroundColor:h[i].note.fill,borderBottom:b?`${3*r}px solid rgb(15, 23, 31, .2)`:"none",boxShadow:b?"none":function(e,t,n){let r=eU(e),i=Math.abs(r())+.5,o=Math.cos(t),s=5*n,a=4*n,l=6*n,c=7*n;return`0px ${s-i}px ${s}px -${s}px rgba(15, 23, 31, .6),
	0px ${(a+i*c)*Math.max(0,o)}px ${l+i*c}px -${a+i*l}px rgba(15, 23, 31, ${(.3+.1*i).toFixed(2)}), 
	0px ${48*n}px ${10*n}px -${10*n}px inset rgba(15, 23, 44, ${((.022+.005*r())*((1+o)/2)).toFixed(2)})`}(e.id,g,r)},children:(0,m.jsx)(hY,{id:t,type:n,font:o,fontSize:(d||uL[s])*r,lineHeight:uM.lineHeight,align:a,verticalAlign:c,text:l,isNote:!0,isSelected:x,labelColor:h[i].note.text,wrap:!0,padding:16*r,onKeyDown:u})}),"url"in e.props&&e.props.url&&(0,m.jsx)(ps,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){let{scale:t}=e.props;return(0,m.jsx)("rect",{rx:t,width:oC(200*t),height:oC(fx(e))})}toSvg(e,t){e.props.text&&t.addExportDef(hO(e.props.font));let n=n0({isDarkMode:t.isDarkMode}),r=new sL(0,0,200,200+e.props.growY);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("rect",{x:5,y:5,rx:1,width:190,height:r.h,fill:"rgba(0,0,0,.1)"}),(0,m.jsx)("rect",{rx:1,width:200,height:r.h,fill:n[e.props.color].note.fill}),(0,m.jsx)(hG,{fontSize:e.props.fontSizeAdjustment||uL[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:n[e.props.color].note.text,bounds:r,stroke:!1})]})}onBeforeCreate=e=>fm(this.editor,e);onBeforeUpdate=(e,t)=>{if(e.props.text!==t.props.text||e.props.font!==t.props.font||e.props.size!==t.props.size)return fm(this.editor,t)};onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])}}function fm(e,t){let{labelHeight:n,fontSizeAdjustment:r}=fb(e,t),i=Math.max(0,n-200);if(i!==t.props.growY||r!==t.props.fontSizeAdjustment)return{...t,props:{...t.props,growY:i,fontSizeAdjustment:r}}}let fy=new em;function fb(e,t){return fy.get(t,()=>(function(e,t){let{text:n}=t.props;if(!n)return{labelHeight:uL[t.props.size]*uM.lineHeight+32,labelWidth:100,fontSizeAdjustment:0};let r=uL[t.props.size],i=0,o=0,s=200,a=200;do{i=Math.min(r,r-o);let l=e.textMeasure.measureText(n,{...uM,fontFamily:uz[t.props.font],fontSize:i,maxWidth:167,disableOverflowWrapBreaking:!0});if(s=l.h+32,a=l.w+32,i<=14){let r=e.textMeasure.measureText(n,{...uM,fontFamily:uz[t.props.font],fontSize:i,maxWidth:167});s=r.h+32,a=r.w+32;break}if(l.scrollWidth.toFixed(0)===l.w.toFixed(0))break}while(o++<50);return{labelHeight:s,labelWidth:a,fontSizeAdjustment:i}})(e,t))}function fx(e){return(200+e.props.growY)*e.props.scale}let fv=new em;class fw extends lP{static type="text";static props=iD;static migrations=iR;getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return fv.get(e.props,e=>fS(this.editor,e))}getGeometry(e){let{scale:t}=e.props,{width:n,height:r}=this.getMinDimensions(e);return new lC({width:n*t,height:r*t,isFilled:!0,isLabel:!0})}canEdit=()=>!0;isAspectRatioLocked=()=>!0;component(e){let{id:t,props:{font:n,size:r,text:i,color:o,scale:s,textAlign:a}}=e,{width:l,height:c}=this.getMinDimensions(e),d=e.id===this.editor.getOnlySelectedShapeId(),u=hA(),h=function(e){let t=i8();return(0,y.useCallback)(n=>{if(t.getEditingShapeId()===e)switch(n.key){case"Enter":(n.ctrlKey||n.metaKey)&&t.complete();break;case"Tab":oz(n),n.shiftKey?u5.unindent(n.currentTarget):u5.indent(n.currentTarget)}},[t,e])}(t);return(0,m.jsx)(hY,{id:t,classNamePrefix:"tl-text-shape",type:"text",font:n,fontSize:uO[r],lineHeight:uM.lineHeight,align:a,verticalAlign:"middle",text:i,labelColor:u[o].solid,isSelected:d,textWidth:l,textHeight:c,style:{transform:`scale(${s})`,transformOrigin:"top left"},wrap:!0,onKeyDown:h})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds,n=i8();return e.props.autoSize&&n.getEditingShapeId()===e.id?null:(0,m.jsx)("rect",{width:oC(t.width),height:oC(t.height)})}toSvg(e,t){e.props.text&&t.addExportDef(hO(e.props.font));let n=this.editor.getShapeGeometry(e).bounds,r=n.width/(e.props.scale??1),i=n.height/(e.props.scale??1),o=n0(t);return(0,m.jsx)(hG,{fontSize:uO[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:o[e.props.color].solid,bounds:new sL(0,0,r,i),padding:0})}onResize=(e,t)=>{let{newPoint:n,initialBounds:r,initialShape:i,scaleX:o,handle:s}=t;if("scale_shape"===t.mode||"right"!==s&&"left"!==s)return{id:e.id,type:e.type,...function(e,{initialBounds:t,scaleX:n,scaleY:r,newPoint:i}){let o=Math.max(.01,Math.min(Math.abs(n),Math.abs(r))),s=new ot(0,0);n<0&&(s.x=-(t.width*o)),r<0&&(s.y=-(t.height*o));let{x:a,y:l}=ot.Add(i,s.rot(e.rotation));return{x:a,y:l,props:{scale:o*e.props.scale}}}(e,t)};{let t=Math.max(1,Math.abs(r.width*o)),{x:s,y:a}=o<0?ot.Sub(n,ot.FromAngle(e.rotation).mul(t)):n;return{id:e.id,type:e.type,x:s,y:a,props:{w:t/i.props.scale,autoSize:!1}}}};onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e,i=e.props.text.trimEnd();0===i.length?this.editor.deleteShapes([e.id]):i!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};onBeforeUpdate=(e,t)=>{let n;if(!t.props.autoSize)return;let r=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||1!==e.props.scale&&1===t.props.scale,i=e.props.text!==t.props.text;if(!r&&!i)return;let o=this.getMinDimensions(e),s=fS(this.editor,t.props),a=o.width*e.props.scale,l=o.height*e.props.scale,c=s.width*t.props.scale,d=s.height*t.props.scale;switch(t.props.textAlign){case"middle":n=new ot((c-a)/2,i?0:(d-l)/2);break;case"end":n=new ot(c-a,i?0:(d-l)/2);break;default:if(i)break;n=new ot(0,(d-l)/2)}if(!n)return{...t,props:{...t.props,w:c}};{n.rot(t.rotation);let{x:e,y:r}=t;return{...t,x:e-n.x,y:r-n.y,props:{...t.props,w:c}}}}}function fS(e,t){let{font:n,text:r,autoSize:i,size:o,w:s}=t,a=i?16:Math.max(16,s),l=uO[o],c=i?null:Math.floor(Math.max(a,s)),d=e.textMeasure.measureText(r,{...uM,fontFamily:uz[n],fontSize:l,maxWidth:c});return i&&(d.w+=1),{width:Math.max(a,d.w),height:Math.max(l,d.h)}}class fk extends dV{static type="video";static props=iN;static migrations=i$;canEdit=()=>!0;isAspectRatioLocked=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){let{editor:t}=this,n=t.getShapeGeometry(e).bounds.w*t.getZoomLevel()>=110,{asset:r,url:i}=p1(e.id,e.props.assetId,e.props.w),{time:o,playing:s}=e.props,a=dG(e.id),l=p2(),c=(0,y.useRef)(null),d=(0,y.useCallback)(n=>{let r=n.currentTarget;r&&t.updateShapes([{type:"video",id:e.id,props:{playing:!0,time:r.currentTime}}])},[e.id,t]),u=(0,y.useCallback)(n=>{let r=n.currentTarget;r&&t.updateShapes([{type:"video",id:e.id,props:{playing:!1,time:r.currentTime}}])},[e.id,t]),h=(0,y.useCallback)(n=>{let r=n.currentTarget;r&&a&&t.updateShapes([{type:"video",id:e.id,props:{time:r.currentTime}}])},[a,e.id,t]),[p,f]=(0,y.useState)(!1),g=(0,y.useCallback)(e=>{let t=e.currentTarget;t&&(o!==t.currentTime&&(t.currentTime=o),s||t.pause(),f(!0))},[s,o]);return(0,y.useEffect)(()=>{let e=c.current;e&&(p&&!a&&o!==e.currentTime&&(e.currentTime=o),a&&document.activeElement!==e&&e.focus())},[a,p,o]),(0,y.useEffect)(()=>{if(l){let e=c.current;e&&(e.pause(),e.currentTime=0)}},[c,l]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(d$,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:r?"transparent":"var(--color-low)",border:r?"none":"1px solid var(--color-low-border)"},children:(0,m.jsx)("div",{className:"tl-counter-scaled",children:(0,m.jsx)("div",{className:"tl-video-container",children:r?.props.src?i?(0,m.jsx)("video",{ref:c,style:a?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${e.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:a&&n,onPlay:d,onPause:u,onTimeUpdate:h,onLoadedData:g,hidden:!p,children:(0,m.jsx)("source",{src:i})}):null:(0,m.jsx)(p0,{})})})}),"url"in e.props&&e.props.url&&(0,m.jsx)(ps,{url:e.props.url,zoomLevel:t.getZoomLevel()})]})}indicator(e){return(0,m.jsx)("rect",{width:oC(e.props.w),height:oC(e.props.h)})}toSvg(e){return(0,m.jsx)("image",{href:function(e){let t=e.split(":")[1],n=document.querySelector(`.tl-video-shape-${t}`);if(n){let e=document.createElement("canvas");return e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0),e.toDataURL("image/png")}throw Error("Video with not found when attempting serialization.")}(e.id),width:e.props.w,height:e.props.h})}}let fC=[fw,pd,pC,pW,fg,fe,pL,pe,pq,pj,p5,fk];class fP extends cP{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;onEnter=e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;let{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){let n=this.editor.getPointInShapeSpace(e,t);return this.editor.getShapeGeometry(e).bounds.containsPoint(n)}return!1}).map(e=>e.id));let n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};update(){let{editor:e,excludedShapeIds:t}=this,n=e.getErasingShapeIds(),r=e.getZoomLevel(),i=e.getCurrentPageShapes(),{inputs:{currentPagePoint:o,previousPagePoint:s}}=e;this.pushPointToScribble();let a=new Set(n),l=this.editor.options.hitTestMargin/r;for(let t of i){if(e.isShapeOfType(t,"group"))continue;let n=e.getShapeMask(t.id);if(n&&!ok(o,n))continue;let r=e.getShapeGeometry(t),i=e.getShapePageTransform(t);if(!r||!i)continue;let c=i.clone().invert(),d=c.applyToPoint(s),u=c.applyToPoint(o),{bounds:h}=r;!(h.minX-l>Math.max(d.x,u.x)||h.minY-l>Math.max(d.y,u.y)||h.maxX+l<Math.min(d.x,u.x)||h.maxY+l<Math.min(d.y,u.y))&&r.hitTestLineSegment(d,u,l)&&a.add(e.getOutermostSelectableShape(t).id)}this.editor.setErasingShapes([...a].filter(e=>!t.has(e)))}complete(){let{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),e.setErasingShapes([]),this.parent.transition("idle")}cancel(){let{editor:e}=this;e.setErasingShapes([]),e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}class f_ extends cP{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}}class fI extends cP{static id="pointing";onEnter=()=>{let e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:n}}=this.editor,r=new Set,i=r.size;for(let o=t.length,s=o-1;s>=0;s--){let o=t[s];if(!(this.editor.isShapeOrAncestorLocked(o)||this.editor.isShapeOfType(o,"group"))&&this.editor.isPointInShape(o,n,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){let e=this.editor.getOutermostSelectableShape(o);if(this.editor.isShapeOfType(e,"frame")&&r.size>i)break;r.add(e.id)}}this.editor.setErasingShapes([...r])};onLongPress=e=>{this.startErasing(e)};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startErasing(e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};startErasing(e){this.parent.transition("erasing",e)}complete(){let e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}}class fE extends cP{static id="eraser";static initial="idle";static isLockable=!1;static children=()=>[f_,fI,fP];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}class fj extends cP{static id="dragging";initialCamera=new ot;onEnter=()=>{this.initialCamera=ot.From(this.editor.getCamera()),this.update()};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.parent.transition("idle")};onComplete=()=>{this.complete()};update(){let{initialCamera:e,editor:t}=this,{currentScreenPoint:n,originScreenPoint:r}=t.inputs,i=ot.Sub(n,r).div(t.getZoomLevel());0!==i.len2()&&t.setCamera(e.clone().add(i))}complete(){let{editor:e}=this,{pointerVelocity:t}=e.inputs,n=Math.min(t.len(),2);n>.1&&this.editor.slideCamera({speed:n,direction:t}),this.parent.transition("idle")}}class fT extends cP{static id="idle";onEnter=()=>{this.editor.setCursor({type:"grab",rotation:0})};onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}}class fM extends cP{static id="pointing";onEnter=()=>{this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})};onLongPress=()=>{this.startDragging()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startDragging()};startDragging(){this.parent.transition("dragging")}onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.complete()};complete(){this.parent.transition("idle")}}class fA extends cP{static id="hand";static initial="idle";static isLockable=!1;static children=()=>[fT,fM,fj];onDoubleClick=e=>{if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomIn(e,{animation:{duration:220,easing:oe.easeOutQuint}})}};onTripleClick=e=>{if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomOut(e,{animation:{duration:320,easing:oe.easeOutQuint}})}};onQuadrupleClick=e=>{if("settle"===e.phase){let e=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:t}}=this.editor;1===e?this.editor.zoomToFit({animation:{duration:400,easing:oe.easeOutQuint}}):this.editor.resetZoom(t,{animation:{duration:320,easing:oe.easeOutQuint}})}}}class fO extends cP{static id="idle";onPointerDown=e=>{this.parent.transition("lasering",e)}}class fL extends cP{static id="lasering";scribbleId="id";onEnter=()=>{let e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.pushPointToScribble()};onPointerUp=()=>{this.complete()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class fD extends cP{static id="laser";static initial="idle";static children=()=>[fO,fL];static isLockable=!1;onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}}class fz extends cP{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;initialStartShape=null;onEnter=e=>{let{altKey:t,currentPagePoint:n}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),t){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>this.editor.isShapeOfType(e,"group")||this.editor.isShapeOrAncestorLocked(e)).map(e=>e.id)),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(n)[0],this.hitTestShapes()};onExit=()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})};onTick=({elapsed:e})=>{let{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.hitTestShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)};onKeyDown=e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()};onKeyUp=()=>{this.hitTestShapes()};complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){let e,t,n,r,i,o;let{editor:s,excludedShapeIds:a,isWrapMode:l}=this,{inputs:{originPagePoint:c,currentPagePoint:d,shiftKey:u,ctrlKey:h}}=s,p=new Set(u?this.initialSelectedShapeIds:[]),f=l?!h:h,g=sL.FromPoints([c,d]),{corners:m}=g,y=s.getCurrentPageShapes(),b=s.getCurrentPageId();for(let l=0,c=y.length;l<c;l++)if(n=y[l],!(a.has(n.id)||p.has(n.id))&&(r=s.getShapePageBounds(n))){if(g.contains(r)){this.handleHit(n,d,b,p,m);continue}if(!(f||s.isShapeOfType(n,"frame"))&&g.collides(r)){if(!(i=s.getShapePageTransform(n)))continue;o=i.clone().invert().applyToPoints(m);let r=s.getShapeGeometry(n);for(let i=0;i<4;i++)if(e=o[i],t=o[(i+1)%4],r.hitTestLineSegment(e,t,0)){this.handleHit(n,d,b,p,m);break}}}s.getInstanceState().isCoarsePointer;let x=s.getInstanceState().brush;x&&g.equals(x)||s.updateInstanceState({brush:{...g.toJson()}});let v=s.getSelectedShapeIds();(v.length!==p.size||v.some(e=>!p.has(e)))&&s.setSelectedShapes(Array.from(p))}onInterrupt=()=>{this.editor.updateInstanceState({brush:null})};handleHit(e,t,n,r,i){if(e.parentId===n){r.add(e.id);return}let o=this.editor.getOutermostSelectableShape(e),s=this.editor.getShapeMask(o.id);(!s||lv(s,i)||ok(t,s))&&r.add(o.id)}}let fR={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class fN extends cP{static id="pointing_resize_handle";info={};updateCursor(){let e=this.editor.getSelectedShapes(),t=fR[this.info.handle];this.editor.setCursor({type:t,rotation:1===e.length?this.editor.getSelectionRotation():0})}onEnter=e=>{this.info=e,this.updateCursor()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startResizing()};onLongPress=()=>{this.startResizing()};startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class fF extends cP{static id="cropping";info={};markId="";snapshot={};onEnter=e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};updateCursor(){if(!this.editor.getSelectedShapes()[0])return;let e=fR[this.info.handle];this.editor.setCursor({type:e,rotation:this.editor.getSelectionRotation()})}getDefaultCrop=()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}});updateShapes(){let{shape:e,cursorHandleOffset:t}=this.snapshot;if(!e||!this.editor.getShapeUtil("image"))return;let n=e.props,r=this.editor.inputs.currentPagePoint.clone().sub(t),i=this.editor.inputs.originPagePoint.clone().sub(t),o=r.clone().sub(i).rot(-e.rotation),s=n.crop??this.getDefaultCrop(),a=tS(s),l=new ot(e.x,e.y),c=new ot(0,0),d=1/(s.bottomRight.x-s.topLeft.x)*n.w,u=1/(s.bottomRight.y-s.topLeft.y)*n.h,h=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":if(u<8)break;h=!0,a.topLeft.y=a.topLeft.y+o.y/u,u*(a.bottomRight.y-a.topLeft.y)<8?(a.topLeft.y=a.bottomRight.y-8/u,c.y=(a.topLeft.y-s.topLeft.y)*u):a.topLeft.y<=0?(a.topLeft.y=0,c.y=(a.topLeft.y-s.topLeft.y)*u):c.y=o.y;break;case"bottom":case"bottom_left":case"bottom_right":if(u<8)break;h=!0,a.bottomRight.y=Math.min(1,a.bottomRight.y+o.y/u),u*(a.bottomRight.y-a.topLeft.y)<8&&(a.bottomRight.y=a.topLeft.y+8/u)}switch(this.info.handle){case"left":case"top_left":case"bottom_left":if(d<8)break;h=!0,a.topLeft.x=a.topLeft.x+o.x/d,d*(a.bottomRight.x-a.topLeft.x)<8?(a.topLeft.x=a.bottomRight.x-8/d,c.x=(a.topLeft.x-s.topLeft.x)*d):a.topLeft.x<=0?(a.topLeft.x=0,c.x=(a.topLeft.x-s.topLeft.x)*d):c.x=o.x;break;case"right":case"top_right":case"bottom_right":if(d<8)break;h=!0,a.bottomRight.x=Math.min(1,a.bottomRight.x+o.x/d),d*(a.bottomRight.x-a.topLeft.x)<8&&(a.bottomRight.x=a.topLeft.x+8/d)}if(!h)return;l.add(c.rot(e.rotation));let p={id:e.id,type:e.type,x:l.x,y:l.y,props:{crop:a,w:(a.bottomRight.x-a.topLeft.x)*d,h:(a.bottomRight.y-a.topLeft.y)*u}};this.editor.updateShapes([p]),this.updateCursor()}complete(){this.updateShapes(),hf(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){let e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:t}}=this.editor,n=this.editor.getOnlySelectedShape(),r=this.editor.getSelectionRotatedPageBounds(),i=ot.RotWith(r.getHandlePoint(this.info.handle),r.point,e);return{shape:n,cursorHandleOffset:ot.Sub(t,i)}}}function f$(e,t=!1){let n=e.getZoomLevel(),{inputs:{currentPagePoint:r}}=e;return e.getShapeAtPoint(r,{hitInside:!1,hitLabels:t,margin:e.options.hitTestMargin/n,renderingOnly:!0})??e.getSelectedShapeAtPoint(r)}function fB(e,t,n){if(!t)throw Error("Needs to translate a cropped shape!");let{crop:r}=t.props;if(!r)return;let i=e.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;"x"===i?n.x=0:"y"===i&&(n.y=0),n.rot(-t.rotation);let o=1/(r.bottomRight.x-r.topLeft.x)*t.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*t.props.h,a=r.bottomRight.y-r.topLeft.y,l=r.bottomRight.x-r.topLeft.x,c=tS(r);return c.topLeft.x=Math.min(1-l,Math.max(0,c.topLeft.x-n.x/o)),c.topLeft.y=Math.min(1-a,Math.max(0,c.topLeft.y-n.y/s)),c.bottomRight.x=c.topLeft.x+l,c.bottomRight.y=c.topLeft.y+a,{id:t.id,type:t.type,props:{crop:c}}}class fU extends cP{static id="idle";onEnter=()=>{this.editor.setCursor({type:"default",rotation:0});let e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)};onExit=()=>{this.editor.setCursor({type:"default",rotation:0})};onCancel=()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})};onPointerDown=e=>{if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{let t=f$(this.editor);if(t&&!this.editor.isShapeOfType(t,"group")){this.onPointerDown({...e,shape:t,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break;default:this.cancel()}}}};onDoubleClick=e=>{if(this.editor.inputs.shiftKey||"up"!==e.phase)return;let t=this.editor.getCroppingShapeId();if(!t)return;let n=this.editor.getShape(t);if(!n)return;let r=this.editor.getShapeUtil(n);if(r){if("selection"===e.target){r.onDoubleClickEdge?.(n);return}this.cancel(),this.editor.root.handleEvent(e)}};onKeyDown=()=>{this.nudgeCroppingImage(!1)};onKeyRepeat=()=>{this.nudgeCroppingImage(!0)};onKeyUp=e=>{"Enter"===e.code&&(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{}))};cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new ot(0,0);if(t.has("ArrowLeft")&&(r.x+=1),t.has("ArrowRight")&&(r.x-=1),t.has("ArrowUp")&&(r.y+=1),t.has("ArrowDown")&&(r.y-=1),r.equals(new ot(0,0)))return;n&&r.mul(10);let i=this.editor.getShape(this.editor.getCroppingShapeId());if(!i)return;let o=fB(this.editor,i,r);o&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([o]))}}class fV extends cP{static id="pointing_crop";onCancel=()=>{this.editor.setCurrentTool("select.crop.idle",{})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)};onPointerUp=e=>{this.editor.setCurrentTool("select.crop.idle",e)}}class fH extends cP{static id="pointing_crop_handle";info={};onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);let t=this.editor.getSelectedShapes()[0];if(!t)return;let n=fR[this.info.handle];this.editor.setCursor({type:n,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(t.id)};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startCropping()};onLongPress=()=>{this.startCropping()};startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp=()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}class fK extends cP{static id="translating_crop";info={};markId="translating crop";snapshot={};onEnter=e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()};onExit=()=>{this.editor.setCursor({type:"default",rotation:0})};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onKeyDown=e=>{switch(e.key){case"Alt":case"Shift":this.updateShapes();return}};onKeyUp=e=>{switch(e.key){case"Enter":this.complete();return;case"Alt":case"Shift":this.updateShapes()}};complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){let e=this.snapshot.shape;if(!e)return;let{originPagePoint:t,currentPagePoint:n}=this.editor.inputs,r=n.clone().sub(t),i=fB(this.editor,e,r);i&&this.editor.updateShapes([i])}}class fW extends cP{static id="crop";static initial="idle";static children=()=>[fU,fK,fV,fH,fF];markId="";onEnter=()=>{this.didCancel=!1,this.markId="crop",this.editor.mark(this.markId)};didCancel=!1;onExit=()=>{this.didCancel?this.editor.bailToMark(this.markId):this.editor.squashToMark(this.markId)};onCancel=()=>{this.didCancel=!0}}class fG extends cP{static id="dragging_handle";shapeId="";initialHandle={};initialAdjacentHandle=null;initialPagePoint={};markId="";initialPageTransform;initialPageRotation;info={};isPrecise=!1;isPreciseId=null;pointingId=null;onEnter=e=>{let{shape:t,isCreating:n,handle:r}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=t.id,this.markId=n?`creating:${t.id}`:"dragging handle",n||this.editor.mark(this.markId),this.initialHandle=tS(r),this.editor.isShapeOfType(t,"line")&&"create"===this.initialHandle.type){this.editor.updateShape({...t,props:{points:{...t.props.points,[r.index]:{id:r.index,index:r.index,x:r.x,y:r.y}}}});let e=this.editor.getShapeHandles(t).find(e=>e.index===r.index);this.initialHandle=tS(e)}this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:n?"cross":"grabbing",rotation:0});let i=this.editor.getShapeHandles(t).sort(ti),o=i.findIndex(t=>t.id===e.handle.id);this.initialAdjacentHandle=null;for(let t=o+1;t<i.length;t++){let n=i[t];if("vertex"===n.type&&"middle"!==n.id&&n.id!==e.handle.id){this.initialAdjacentHandle=n;break}}if(!this.initialAdjacentHandle)for(let t=i.length-1;t>=0;t--){let n=i[t];if("vertex"===n.type&&"middle"!==n.id&&n.id!==e.handle.id){this.initialAdjacentHandle=n;break}}if(this.editor.isShapeOfType(t,"arrow")){let n=ug(this.editor,t)[e.handle.id];this.isPrecise=!1,n?(this.editor.setHintingShapes([n.toId]),this.isPrecise=n.props.isPrecise,this.isPrecise?this.isPreciseId=n.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)};exactTimeout=-1;resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.update(),this.complete()};onCancel=()=>{this.cancel()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})};complete(){this.editor.snaps.clearIndicators(),hf(this.editor,[this.shapeId]);let{onInteractionEnd:e}=this.info;if(this.editor.getInstanceState().isToolLocked&&e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();let{onInteractionEnd:e}=this.info;if(e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){let{editor:e,shapeId:t,initialPagePoint:n}=this,{initialHandle:r,initialPageRotation:i,initialAdjacentHandle:o}=this,s=this.editor.getHintingShapeIds(),a=this.editor.user.getIsSnapMode(),{snaps:l,inputs:{currentPagePoint:c,shiftKey:d,ctrlKey:u,altKey:h,pointerVelocity:p}}=e,f=this.info.shape,g=e.getShape(t);if(!g)return;let m=e.getShapeUtil(g),y=c.clone().sub(n).rot(-i).add(r);if(d&&o&&"middle"!==r.id){let e=ot.Angle(o,y),t=oy(e,24);y=ot.RotWith(y,o,t-e)}e.snaps.clearIndicators();let b={...r,x:y.x,y:y.y};if(r.canSnap&&(a?!u:u)){if(!e.getShapePageTransform(g.id))throw Error("Expected a page transform");let n=l.handles.snapHandle({currentShapeId:t,handle:b});n&&(n.nudge.rot(-e.getShapeParentTransform(g).rotation()),y.add(n.nudge),b={...r,x:y.x,y:y.y})}let x=m.onHandleDrag?.(g,{handle:b,isPrecise:this.isPrecise||h,initial:f}),v={id:g.id,type:g.type,...x};if("vertex"===r.type&&this.editor.isShapeOfType(g,"arrow")){let t=ug(e,g)[r.id];t?s[0]!==t.toId&&(e.setHintingShapes([t.toId]),this.pointingId=t.toId,this.isPrecise=.5>p.len()||h,this.isPreciseId=this.isPrecise?t.toId:null,this.resetExactTimeout()):s.length>0&&(e.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}x&&e.updateShapes([v])}}function fq(e){return e.isLabel?[e]:e instanceof sF?e.children.filter(e=>e.isLabel):[]}class fY extends cP{static id="editing_shape";hitShapeForPointerUp=null;onEnter=()=>{let e=this.editor.getEditingShape();if(!e)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,hI(this.editor),this.editor.select(e)};onExit=()=>{let{editingShapeId:e}=this.editor.getCurrentPageState();if(!e)return;this.editor.setEditingShape(null),hI.cancel();let t=this.editor.getShape(e),n=this.editor.getShapeUtil(t);n.onEditEnd?.(t)};onPointerMove=e=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),this.hitShapeForPointerUp=null;return}switch(e.target){case"shape":case"canvas":hI(this.editor);return}};onPointerDown=e=>{if(this.hitShapeForPointerUp=null,"shape"===e.target){let{shape:t}=e,n=this.editor.getEditingShape();if(!n)throw Error("Expected an editing shape!");let r=fq(this.editor.getShapeUtil(t).getGeometry(t)),i=1===r.length?r[0]:void 0,o=this.editor.isShapeOfType(n,"text")&&""===n.props.text.trim();if(i&&!o){let e=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(i.bounds.containsPoint(e,0)&&i.hitTestPoint(e)){if(t.id===n.id)return;this.hitShapeForPointerUp=t,this.editor.mark("editing on pointer up"),this.editor.select(t.id);return}}else{t.id===n.id?this.editor.isShapeOfType(t,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",e)):this.parent.transition("pointing_shape",e);return}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)};onPointerUp=e=>{let t=this.hitShapeForPointerUp;if(!t)return;this.hitShapeForPointerUp=null;let n=this.editor.getShapeUtil(t);if(!t.isLocked){if(this.editor.getInstanceState().isReadonly&&!n.canEditInReadOnly(t)){this.parent.transition("pointing_shape",e);return}this.editor.select(t.id),this.editor.setEditingShape(t.id),hI(this.editor)}};onComplete=e=>{this.parent.transition("idle",e)};onCancel=e=>{this.parent.transition("idle",e)}}function fX(e){let t=e.getOnlySelectedShape();return!!(t&&!e.isShapeOrAncestorLocked(t)&&e.getShapeUtil(t).canCrop(t))}function fZ(e){let t=e.getSelectedShapeIds(),{shiftKey:n,altKey:r,currentPagePoint:i}=e.inputs,o=e.getShapeAtPoint(i,{hitInside:!1,margin:e.options.hitTestMargin/e.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(o){let i=e.getOutermostSelectableShape(o);if(n&&!r)e.cancelDoubleClick(),t.includes(i.id)?(e.mark("deselecting shape"),e.deselect(i)):(e.mark("shift selecting shape"),e.setSelectedShapes([...t,i.id]));else{let n;(n=i===o?o:i.id===e.getFocusedGroupId()||t.includes(i.id)?o:i)&&!t.includes(n.id)&&(e.mark("selecting shape"),e.select(n.id))}}else{if(n)return;{t.length>0&&(e.mark("selecting none"),e.selectNone());let n=e.getFocusedGroupId();if(nW(n)){let t=e.getShape(n);e.isPointInShape(t,i,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}let fQ=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];class fJ extends cP{static id="idle";onEnter=()=>{this.parent.setCurrentToolIdMask(void 0),hI(this.editor),this.editor.setCursor({type:"default",rotation:0})};onExit=()=>{hI.cancel()};onPointerMove=()=>{hI(this.editor)};onPointerDown=e=>{if(this.editor.getIsMenuOpen())return;let t=e.ctrlKey&&fX(this.editor);if(e.ctrlKey&&!t){if("shape"===e.target&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{let t=f$(this.editor);if(t&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}let n=this.editor.getSelectedShapeIds(),r=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((n.length>1||r&&!this.editor.getShapeUtil(r).hideSelectionBoundsBg(r))&&f3(this.editor,i)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{let{shape:t}=e;if(this.isOverArrowLabelTest(t)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":t?this.parent.transition("crop.pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break;default:{let t=this.editor.getHoveredShape();if(t&&!this.editor.getSelectedShapeIds().includes(t.id)&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}this.parent.transition("pointing_selection",e)}}}};onDoubleClick=e=>{if(!this.editor.inputs.shiftKey&&"up"===e.phase)switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),r=this.editor.getFocusedGroupId();if(n){if(this.editor.isShapeOfType(n,"group")){fZ(this.editor);return}{let e=this.editor.getShape(n.parentId);if(e&&this.editor.isShapeOfType(e,"group")){if(r&&e.id===r);else{fZ(this.editor);return}}}this.onDoubleClick({...e,shape:n,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;let t=this.editor.getOnlySelectedShape();if(t){let n=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){let e=n.onDoubleClickEdge?.(t);if(e){this.editor.mark("double click edge"),this.editor.updateShapes([e]),hf(this.editor,[t.id]);return}}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}break}case"shape":{let{shape:t}=e,n=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.getInstanceState().isReadonly)break;if(n.onDoubleClick){let r=n.onDoubleClick?.(t);if(r){this.editor.updateShapes([r]);return}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.editor.mark("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(t)?this.startEditingShape(t,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;let{shape:t,handle:n}=e,r=this.editor.getShapeUtil(t),i=r.onDoubleClickHandle?.(t,n);i?this.editor.updateShapes([i]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e,!0)}}};onRightClick=e=>{switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(n){this.onRightClick({...e,shape:n,target:"shape"});return}let r=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((r.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&f3(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{let{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,r=this.editor.getOutermostSelectableShape(n,e=>!t.includes(e.id));t.includes(r.id)||this.editor.findShapeAncestor(r,e=>t.includes(e.id))||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([r.id]))}}};onCancel=()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())};onKeyDown=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!1);return}if(t_.editOnType.get()&&!fQ.includes(e.key)&&!e.altKey&&!e.ctrlKey){let t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t)){this.startEditingShape(t,{...e,target:"shape",shape:t},!0);return}}};onKeyRepeat=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!0)}};onKeyUp=e=>{if("Enter"===e.code){let t=this.editor.getSelectedShapes();if(t.every(e=>this.editor.isShapeOfType(e,"group"))){this.editor.setSelectedShapes(t.flatMap(e=>this.editor.getSortedChildIdsForParent(e.id)));return}let n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n},!0);return}fX(this.editor)&&this.parent.transition("crop",e)}};shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!(!e||this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type)&&!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t,n){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.mark("editing shape"),hm(this.editor,e,n),this.parent.transition("editing_shape",t))}isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1;isOverArrowLabelTest(e){if(!e)return!1;let t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){let n=this.editor.getShapeGeometry(e).children[1];if(n&&ok(t,n.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");let t=nG(),{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:r,props:{text:"",autoSize:!0}}]);let i=this.editor.getShape(t);if(!i)return;let o=this.editor.getShapeUtil(i);(!this.editor.getInstanceState().isReadonly||o.canEditInReadOnly(i))&&(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new ot(0,0);if(t.has("ArrowLeft")&&(r.x-=1),t.has("ArrowRight")&&(r.x+=1),t.has("ArrowUp")&&(r.y-=1),t.has("ArrowDown")&&(r.y+=1),r.equals(new ot(0,0)))return;e||this.editor.mark("nudge shapes");let{gridSize:i}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?n?i*f2:i:n?f0:f1,s=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(s,r.mul(o)),hf(this.editor,s)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(e).canEditInReadOnly(e))}}let f0=10,f1=1,f2=5;function f3(e,t){let n=e.getSelectionRotatedPageBounds();if(!n)return!1;let r=e.getSelectionRotation();return r?ok(t,n.corners.map(e=>ot.RotWith(e,n.point,r))):n.containsPoint(t)}class f5 extends cP{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter=e=>{let{shape:t}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=t.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===t.id,this.updateCursor();let n=this.editor.getShapeGeometry(t).children[1];if(!n)throw Error(`Expected to find an arrow label geometry for shape: ${t.id}`);let{currentPagePoint:r}=this.editor.inputs,i=this.editor.getPointInShapeSpace(t,r);this._labelDragOffset=ot.Sub(n.center,i),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})};_labelDragOffset=new ot(0,0);onPointerMove=()=>{let e;let{isDragging:t}=this.editor.inputs;if(!t)return;let n=this.editor.getShape(this.shapeId);if(!n)return;let r=uy(this.editor,n),i=this.editor.getShapeGeometry(n),o=i.children[0],s=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),a=o.nearestPoint(ot.Add(s,this._labelDragOffset));if(r.isStraight){let t=ot.Dist(r.start.point,r.end.point);e=1-ot.Dist(r.end.point,a)/t}else{let{_center:t,measure:n,angleEnd:r,angleStart:o}=i.children[0];e=oE(n,o,r,t.angle(a))}isNaN(e)&&(e=.5),this.didDrag=!0,this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:e}})};onPointerUp=()=>{let e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class f4 extends cP{static id="pointing_canvas";onEnter=()=>{let{inputs:e}=this.editor;!e.shiftKey&&this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)};onPointerUp=()=>{fZ(this.editor),this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle")};complete(){this.parent.transition("idle")}}class f6 extends cP{static id="pointing_handle";info={};onEnter=e=>{this.info=e;let{shape:t}=e;if(this.editor.isShapeOfType(t,"arrow")){let n=ug(this.editor,t)[e.handle.id];n&&this.editor.setHintingShapes([n.toId])}this.editor.setCursor({type:"grabbing",rotation:0})};onExit=()=>{this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})};onPointerUp=()=>{let{shape:e,handle:t}=this.info;if(this.editor.isShapeOfType(e,"note")){let{editor:n}=this,r=f8(n,e,t,!1);if(r){hm(n,r,!0);return}}this.parent.transition("idle",this.info)};onPointerMove=()=>{let{editor:e}=this;e.inputs.isDragging&&this.startDraggingHandle()};onLongPress=()=>{this.startDraggingHandle()};startDraggingHandle(){let{editor:e}=this;if(e.getInstanceState().isReadonly)return;let{shape:t,handle:n}=this.info;if(e.isShapeOfType(t,"note")){let r=f8(e,t,n,!0);if(r){let n=e.getPointInParentSpace(r,e.inputs.originPagePoint).sub(ot.Rot(hb.clone().mul(t.props.scale),r.rotation));e.updateShape({...r,x:n.x,y:n.y}),e.setHoveredShape(r.id).select(r.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(r),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{hm(e,r,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}function f8(e,t,n,r){let i=e.getShapePageTransform(t.id),o=i.point(),s=i.rotation(),a=hv(e,o,s,t.props.growY,0,t.props.scale)[n.index];if(a)return hS(e,t,a,s,r)}class f9 extends cP{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:fR[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter=e=>{this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})};onPointerMove=()=>{this.editor.inputs.isDragging&&this.startRotating()};onLongPress=()=>{this.startRotating()};startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class f7 extends cP{static id="pointing_selection";info={};onEnter=e=>{this.info=e};onPointerUp=e=>{fZ(this.editor),this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startTranslating(e)};onLongPress=e=>{this.startTranslating(e)};startTranslating(e){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",e)}onDoubleClick=e=>{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(n){this.parent.transition("idle"),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(n)});return}};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class ge extends cP{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didSelectOnEnter=!1;onEnter=e=>{let t=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotatedPageBounds(),r=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:i,shiftKey:o,altKey:s}}=this.editor;this.hitShape=e.shape,this.isDoubleClick=!1;let a=this.editor.getOutermostSelectableShape(e.shape),l=this.editor.findShapeAncestor(a,e=>t.includes(e.id));if(this.editor.getShapeUtil(e.shape).onClick||a.id===r||t.includes(a.id)||l||t.length>1&&n?.containsPoint(i)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=a;return}this.didSelectOnEnter=!0,o&&!s?(this.editor.cancelDoubleClick(),t.includes(a.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...t,a.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([a.id]))};onPointerUp=e=>{let t=this.editor.getSelectedShapeIds(),n=this.editor.getFocusedGroupId(),r=this.editor.getZoomLevel(),{inputs:{currentPagePoint:i,shiftKey:o}}=this.editor,s=this.editor.getShapeAtPoint(i,{margin:this.editor.options.hitTestMargin/r,hitInside:!0,renderingOnly:!0})??this.hitShape,a=s?this.editor.getOutermostSelectableShape(s):this.hitShapeForPointerUp;if(a){let r=this.editor.getShapeUtil(a);if(r.onClick){let t=r.onClick?.(a);if(t){this.editor.mark("shape on click"),this.editor.updateShapes([t]),this.parent.transition("idle",e);return}}if(a.id===n){t.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){let e=this.editor.getOutermostSelectableShape(s,e=>!t.includes(e.id));if(t.includes(e.id)){if(o)this.editor.mark("deselecting on pointer up"),this.editor.deselect(a);else if(t.includes(a.id)){if(1===t.length){let e=fq(this.editor.getShapeUtil(a).getGeometry(a)),t=1===e.length?e[0]:void 0;if(t){let e=this.editor.getPointInShapeSpace(a,i);if(t.bounds.containsPoint(e,0)&&t.hitTestPoint(e)){this.editor.run(()=>{this.editor.mark("editing on pointer up"),this.editor.select(a.id);let e=this.editor.getShapeUtil(a);(!this.editor.getInstanceState().isReadonly||e.canEditInReadOnly(a))&&(this.editor.setEditingShape(a.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:a.id}))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(a.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(a)}else if(o){let t=this.editor.getShapeAncestors(e);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(e=>!t.find(t=>t.id===e)),e.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([e.id])}this.parent.transition("idle",e)};onDoubleClick=()=>{this.isDoubleClick=!0};onPointerMove=e=>{this.editor.inputs.isDragging&&this.startTranslating(e)};onLongPress=e=>{this.startTranslating(e)};startTranslating(e){this.editor.getInstanceState().isReadonly||(this.editor.focus(),this.parent.transition("translating",e))}onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}}class gt extends cP{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter=e=>{let{isCreating:t=!1,creationCursorOffset:n={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=n,this.snapshot=this._createSnapshot(),t?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.setCursor({type:"cross",rotation:0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()};onTick=({elapsed:e})=>{let{editor:t}=this;t.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{this.updateShapes()};onKeyUp=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){if(hf(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){this.info.onCreate?.(this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let n=this.editor.getShapeUtil(e),r=n.onResizeStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onResizeEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{altKey:e,shiftKey:t}=this.editor.inputs,{frames:n,shapeSnapshots:r,selectionBounds:i,cursorHandleOffset:o,selectedShapeIds:s,selectionRotation:a,canShapesDeform:l}=this.snapshot,c=t||!l;if(1===r.size){let e=[...r.values()][0];this.editor.isShapeOfType(e.shape,"text")&&(c=!("left"===this.info.handle||"right"===this.info.handle))}let{ctrlKey:d}=this.editor.inputs,u=this.editor.inputs.currentPagePoint.clone().sub(o).sub(this.creationCursorOffset),h=this.editor.inputs.originPagePoint.clone().sub(o);if(this.editor.getInstanceState().isGridMode&&!d){let{gridSize:e}=this.editor.getDocumentSettings();u.snapToGrid(e)}let p=this.info.handle,f=gr(p,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!d:d)&&a%os==0){let{nudge:t}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:ot.Sub(u,h),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:gr(p,a),isAspectRatioLocked:c,isResizingFromCenter:e});u.add(t)}let g=ot.RotWith(e?i.center:i.getHandlePoint(f),i.point,a),m=ot.Sub(u,g).rot(-a),y=ot.Sub(h,g).rot(-a),b=ot.DivV(m,y);Number.isFinite(b.x)||(b.x=1),Number.isFinite(b.y)||(b.y=1);let x="top"===p||"bottom"===p,v="left"===p||"right"===p;for(let e of(c?v?b.y=Math.abs(b.x):x?b.x=Math.abs(b.y):Math.abs(b.x)>Math.abs(b.y)?b.y=Math.abs(b.x)*(b.y<0?-1:1):b.x=Math.abs(b.y)*(b.x<0?-1:1):(x&&(b.x=1),v&&(b.y=1)),this.info.isCreating||this.updateCursor({dragHandle:p,isFlippedX:b.x<0,isFlippedY:b.y<0,rotation:a}),r.keys())){let t=r.get(e);this.editor.resizeShape(e,b,{initialShape:t.shape,initialBounds:t.bounds,initialPageTransform:t.pageTransform,dragHandle:p,mode:1===s.length&&e===s[0]?"resize_bounds":"scale_shape",scaleOrigin:g,isAspectRatioLocked:c,scaleAxisRotation:a,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey)for(let{id:e,children:t}of(this.didHoldCommand=!0,n)){if(!t.length)continue;let n=r.get(e).shape,i=this.editor.getShape(e);if(!(n&&i))continue;let o=new ot(i.x-n.x,i.y-n.y).rot(-n.rotation);if(0!==o.x||0!==o.y)for(let e of t)this.editor.updateShape({id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y})}else if(this.didHoldCommand){for(let{children:e}of(this.didHoldCommand=!1,n))if(e.length)for(let t of e)this.editor.updateShape({id:t.id,type:t.type,x:t.x,y:t.y})}}updateCursor({dragHandle:e,isFlippedX:t,isFlippedY:n,rotation:r}){let i={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":i.type="nwse-resize",t!==n&&(i.type="nesw-resize");break;case"top_right":case"bottom_left":i.type="nesw-resize",t!==n&&(i.type="nwse-resize")}i.rotation=r,this.editor.setCursor(i)}onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()};_createSnapshot=()=>{let e=this.editor.getSelectedShapeIds(),t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,r=this.editor.getSelectionRotatedPageBounds(),i=ot.RotWith(r.getHandlePoint(this.info.handle),r.point,t),o=ot.Sub(n,i),s=new Map,a=[];e.forEach(t=>{let n=this.editor.getShape(t);if(n){if("frame"===n.type&&a.push({id:t,children:ep(this.editor.getSortedChildIdsForParent(n).map(e=>this.editor.getShape(e)))}),s.set(n.id,this._createShapeSnapshot(n)),this.editor.isShapeOfType(n,"frame")&&1===e.length)return;this.editor.visitDescendants(n.id,e=>{let t=this.editor.getShape(e);if(t&&(s.set(t.id,this._createShapeSnapshot(t)),this.editor.isShapeOfType(t,"frame")))return!1})}});let l=![...s.values()].some(e=>!ob(e.pageRotation,t)||e.isAspectRatioLocked);return{shapeSnapshots:s,selectionBounds:r,cursorHandleOffset:o,selectionRotation:t,selectedShapeIds:e,canShapesDeform:l,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:a}};_createShapeSnapshot=e=>{let t=this.editor.getShapePageTransform(e),n=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:t,pageRotation:sz.Decompose(t).rotation,isAspectRatioLocked:n.isAspectRatioLocked(e)}}}let gn=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function gr(e,t){let n=Math.round((t%=oa)/(oo/4)),r=gn.indexOf(e);return gn[(r+n)%gn.length]}let gi=Math.PI/180;class go extends cP{static id="rotating";snapshot={};info={};markId="";onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);let t=lR({editor:this.editor});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t;let n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});lN({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:fR[this.info.handle],rotation:n+this.snapshot.initialSelectionRotation})};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}};onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};update=()=>{let e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});lN({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:fR[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation})};cancel=()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};complete=()=>{lN({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),hf(this.editor,this.snapshot.shapeSnapshots.map(e=>e.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};_getRotationFromPointerPosition({snapToNearestDegree:e}){let t=this.editor.getSelectionRotation(),n=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:r,currentPagePoint:i}}=this.editor,{initialCursorAngle:o,initialSelectionRotation:s}=this.snapshot;if(!n)return s;let a=s+(n.center.clone().rotWith(n.point,t).angle(i)-o);if(r)a=oy(a,24);else if(e&&(a=Math.round(a/gi)*gi,this.editor.getInstanceState().isCoarsePointer)){let e=oy(a,4);Math.abs(om(a,e))<5*oo/180&&(a=e)}return a-s}}class gs extends cP{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter=()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();let e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.updateScribbleSelection(!0)};onPointerUp=()=>{this.complete()};onKeyDown=()=>{this.updateScribbleSelection(!1)};onKeyUp=()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};updateScribbleSelection(e){let t,n,r,i;let{editor:o}=this,s=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:a,originPagePoint:l,previousPagePoint:c,currentPagePoint:d}}=this.editor,{newlySelectedShapeIds:u,initialSelectedShapeIds:h}=this;e&&this.pushPointToScribble();for(let e=0,a=s.length;e<a;e++){if(t=s[e],o.isShapeOfType(t,"group")||u.has(t.id)||o.isShapeOrAncestorLocked(t)||(n=o.getShapeGeometry(t),o.isShapeOfType(t,"frame")&&n.bounds.containsPoint(o.getPointInShapeSpace(t,l))))continue;let a=o.getShapePageTransform(t);if(!n||!a)continue;let h=a.clone().invert();r=h.applyToPoint(c),i=h.applyToPoint(d);let{bounds:p}=n;if(!(p.minX-0>Math.max(r.x,i.x)||p.minY-0>Math.max(r.y,i.y)||p.maxX+0<Math.min(r.x,i.x)||p.maxY+0<Math.min(r.y,i.y))&&n.hitTestLineSegment(r,i,0)){let e=this.editor.getOutermostSelectableShape(t),n=this.editor.getShapeMask(e.id);if(n&&null!==lp(c,d,n)&&!ok(d,n))continue;u.add(e.id)}}let p=o.getSelectedShapeIds(),f=new Set(a?[...u,...h]:[...u]);(p.length!==f.size||p.some(e=>!f.has(e)))&&this.editor.setSelectedShapes(Array.from(f))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}class ga{constructor(e){this.editor=e,e.disposables.add(this.dispose)}prevDroppingShapeId=null;droppingNodeTimer=null;first=!0;updateDroppingNode(e,t){this.first&&(this.editor.setHintingShapes(e.map(e=>this.editor.findShapeAncestor(e,e=>"group"!==e.type)).filter(e=>e)),this.prevDroppingShapeId=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e)?.id??null,this.first=!1),null===this.droppingNodeTimer?this.setDragTimer(e,20,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,100,t))}setDragTimer(e,t,n){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,n)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,n){t=ep(t.map(e=>this.editor.getShape(e.id)));let r=this.editor.getDroppingOverShape(e,t)?.id??null;if(r===this.prevDroppingShapeId){this.hintParents(t);return}let{prevDroppingShapeId:i}=this,o=i&&this.editor.getShape(i),s=r&&this.editor.getShape(r);o&&this.editor.getShapeUtil(o).onDragShapesOut?.(o,t),s&&this.editor.getShapeUtil(s).onDragShapesOver?.(s,t),this.hintParents(t),n?.(),this.prevDroppingShapeId=r}hintParents(e){let t=new Map;for(let n of e){let e=this.editor.findShapeAncestor(n,e=>"group"!==e.type);e&&(t.has(e.id)||t.set(e.id,[]),t.get(e.id).push(n.id))}let n=[];for(let[e,r]of t){let t=this.editor.getShape(e);t&&hg(this.editor,t).length<r.length&&n.push(t.id)}this.editor.setHintingShapes(n)}dropShapes(e){let{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){let n=this.editor.getShape(t);if(!n)return;this.editor.getShapeUtil(n).onDropShapesOver?.(n,e)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose=()=>{this.clear()}}class gl extends cP{static id="translating";info={};selectionSnapshot={};snapshot={};markId="";isCloning=!1;isCreating=!1;onCreate=()=>void 0;dragAndDropManager=new ga(this.editor);onEnter=e=>{let{isCreating:t=!1,onCreate:n=()=>void 0}=e;if(!this.editor.getSelectedShapeIds()?.length){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.onCreate=n,t?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=gc(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()};onTick=({elapsed:e})=>{let{editor:t}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),t.edgeScrollManager.updateEdgeScrolling(e)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()};onKeyUp=()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=gc(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),hf(this.editor,this.snapshot.movingShapes.map(e=>e.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let n=this.editor.getShapeUtil(e),r=n.onTranslateStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){let{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){let t=ot.Average(e.map(e=>this.editor.getShapePageTransform(e.id).point())),n=ot.Sub(t,this.selectionSnapshot.averagePagePoint);ot.IsNaN(n)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(e=>e.id),offset:{x:n.x,y:n.y}}})}let t=[];e.forEach(e=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslateEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),function({editor:e,snapshot:t}){let{inputs:n}=e,{noteSnapshot:r,noteAdjacentPositions:i,initialPageBounds:o,initialSnapPoints:s,shapeSnapshots:a,averagePagePoint:l}=t,c=e.getInstanceState().isGridMode,d=e.getDocumentSettings().gridSize,u=ot.Sub(n.currentPagePoint,n.originPagePoint),h=e.inputs.shiftKey?Math.abs(u.x)<Math.abs(u.y)?"x":"y":null;if("x"===h?u.x=0:"y"===h&&(u.y=0),e.snaps.clearIndicators(),(e.user.getIsSnapMode()?!n.ctrlKey:n.ctrlKey)&&.5>e.inputs.pointerVelocity.len()){let{nudge:t}=e.snaps.shapeBounds.snapTranslateShapes({dragDelta:u,initialSelectionPageBounds:o,lockedAxis:h,initialSelectionSnapPoints:s});u.add(t)}else if(r&&i){let{scale:t}=r.shape.props,n=r.pagePoint.clone().add(u).add(hb.clone().mul(t).rot(r.pageRotation)),o=10/e.getZoomLevel(),s=new ot(0,0);for(let e of i){let t=ot.Sub(n,e),r=t.len();r<o&&(o=r,s=t)}u.sub(s)}let p=ot.Add(l,u);c&&!n.ctrlKey&&p.snapToGrid(d);let f=ot.Sub(p,l);e.updateShapes(ep(a.map(({shape:e,pagePoint:t,parentTransform:n})=>{let r=ot.Add(t,f),i=n?sz.applyToPoint(n,r):r;return{id:e.id,type:e.type,x:i.x,y:i.y}})))}({editor:this.editor,snapshot:e});let{movingShapes:t}=e,n=[];t.forEach(e=>{let t=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslate?.(e,t);i&&n.push(i)}),n.length>0&&this.editor.updateShapes(n)}updateParentTransforms=()=>{let{editor:e,snapshot:{shapeSnapshots:t}}=this,n=[];t.forEach(t=>{let r=e.getShape(t.shape.id);if(!r)return null;n.push(r);let i=rx(r.parentId)?null:sz.Inverse(e.getShapePageTransform(r.parentId));t.parentTransform=i})}}function gc(e){let t,n;let r=[],i=[],o=ep(e.getSelectedShapeIds().map(t=>{let n=e.getShape(t);if(!n)return null;r.push(n);let o=e.getShapePageTransform(t),s=o.point(),a=o.rotation();i.push(s);let l=rb.isId(n.parentId)?null:sz.Inverse(e.getShapePageTransform(n.parentId));return{shape:n,pagePoint:s,pageRotation:a,parentTransform:l}})),s=e.getOnlySelectedShape(),a=[];if(s)a=e.snaps.shapeBounds.getSnapPoints(s.id);else{let t=e.getSelectionPageBounds();t&&(a=t.cornersAndCenter.map((e,t)=>({id:"selection:"+t,x:e.x,y:e.y})))}let{originPagePoint:l}=e.inputs,c=o.filter(t=>e.isShapeOfType(t.shape,"note")&&e.isPointInShape(t.shape,l));if(0===c.length);else if(1===c.length)n=c[0];else{let t=e.getCurrentPageShapesSorted();n=c.map(e=>({snapshot:e,index:t.findIndex(t=>t.id===e.shape.id)})).sort((e,t)=>t.index-e.index)[0]?.snapshot}return n&&(t=hw(e,n.pageRotation,n.shape.props.scale,n.shape.props.growY??0)),{averagePagePoint:ot.Average(i),movingShapes:r,shapeSnapshots:o,initialPageBounds:e.getSelectionPageBounds(),initialSnapPoints:a,noteAdjacentPositions:t,noteSnapshot:n}}class gd extends cP{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children=()=>[fW,fF,fJ,f4,ge,gl,fz,gs,fH,f7,fN,fY,gt,go,f9,f5,f6,fG];cleanUpDuplicateProps=()=>{let e=this.editor.getSelectedShapeIds(),t=this.editor.getInstanceState();if(!t.duplicateProps)return;let n=new Set(t.duplicateProps.shapeIds);e.length===n.size&&e.every(e=>n.has(e))||this.editor.updateInstanceState({duplicateProps:null})};onEnter=()=>{this.reactor=B("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})};onExit=()=>{this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}class gu extends cP{static id="idle";info={};onEnter=e=>{this.info=e};onPointerDown=()=>{this.parent.transition("pointing",this.info)}}class gh extends cP{static id="pointing";info={};onEnter=e=>{this.info=e};onPointerUp=()=>{this.complete()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)};onCancel=()=>{this.cancel()};complete(){let{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class gp extends cP{static id="zoom_brushing";info={};zoomBrush=new sL;onEnter=e=>{this.info=e,this.update()};onExit=()=>{this.editor.updateInstanceState({zoomBrush:null})};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};update(){let{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(sL.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){let{zoomBrush:e}=this,t=8/this.editor.getZoomLevel();if(e.width<t&&e.height<t){let e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}})}else{let t=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:t,animation:{duration:220}})}this.parent.transition("idle",this.info)}}class gf extends cP{static id="zoom";static initial="idle";static children=()=>[gu,gp,gh];static isLockable=!1;info={};onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)};onKeyDown=()=>{this.updateCursor()};onKeyUp=e=>{this.updateCursor(),"KeyZ"===e.code&&this.complete()};onInterrupt=()=>{this.complete()};complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}let gg=[fE,fA,fD,gf,gd];function gm(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(e?.(r),!1===n||!r.defaultPrevented)return t?.(r)}}function gy(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function gb(...e){return t=>{let n=!1,r=e.map(e=>{let r=gy(e,t);return n||"function"!=typeof r||(n=!0),r});if(n)return()=>{for(let t=0;t<r.length;t++){let n=r[t];"function"==typeof n?n():gy(e[t],null)}}}}function gx(...e){return y.useCallback(gb(...e),e)}function gv(e,t=[]){let n=[],r=()=>{let t=n.map(e=>y.createContext(e));return function(n){let r=n?.[e]||t;return y.useMemo(()=>({[`__scope${e}`]:{...n,[e]:r}}),[n,r])}};return r.scopeName=e,[function(t,r){let i=y.createContext(r),o=n.length;n=[...n,r];let s=t=>{let{scope:n,children:r,...s}=t,a=n?.[e]?.[o]||i,l=y.useMemo(()=>s,Object.values(s));return(0,m.jsx)(a.Provider,{value:l,children:r})};return s.displayName=t+"Provider",[s,function(n,s){let a=s?.[e]?.[o]||i,l=y.useContext(a);if(l)return l;if(void 0!==r)return r;throw Error(`\`${n}\` must be used within \`${t}\``)}]},function(...e){let t=e[0];if(1===e.length)return t;let n=()=>{let n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let r=n.reduce((t,{useScope:n,scopeName:r})=>{let i=n(e)[`__scope${r}`];return{...t,...i}},{});return y.useMemo(()=>({[`__scope${t.scopeName}`]:r}),[r])}};return n.scopeName=t.scopeName,n}(r,...t)]}"undefined"!=typeof window&&window.document&&window.document.createElement;var gw=globalThis?.document?y.useLayoutEffect:()=>{},gS=b[" useId ".trim().toString()]||(()=>void 0),gk=0;function gC(e){let[t,n]=y.useState(gS());return gw(()=>{e||n(e=>e??String(gk++))},[e]),e||(t?`radix-${t}`:"")}var gP=b[" useInsertionEffect ".trim().toString()]||gw;function g_({prop:e,defaultProp:t,onChange:n=()=>{},caller:r}){let[i,o,s]=function({defaultProp:e,onChange:t}){let[n,r]=y.useState(e),i=y.useRef(n),o=y.useRef(t);return gP(()=>{o.current=t},[t]),y.useEffect(()=>{i.current!==n&&(o.current?.(n),i.current=n)},[n,i]),[n,r,o]}({defaultProp:t,onChange:n}),a=void 0!==e,l=a?e:i;{let t=y.useRef(void 0!==e);y.useEffect(()=>{let e=t.current;if(e!==a){let t=a?"controlled":"uncontrolled";console.warn(`${r} is changing from ${e?"controlled":"uncontrolled"} to ${t}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`)}t.current=a},[a,r])}return[l,y.useCallback(t=>{if(a){let n="function"==typeof t?t(e):t;n!==e&&s.current?.(n)}else o(t)},[a,e,o,s])]}function gI(e){let t=function(e){let t=y.forwardRef((e,t)=>{let{children:n,...r}=e;if(y.isValidElement(n)){let e,i;let o=(e=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?n.ref:(e=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning?n.props.ref:n.props.ref||n.ref,s=function(e,t){let n={...t};for(let r in t){let i=e[r],o=t[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...e)=>{let t=o(...e);return i(...e),t}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}(r,n.props);return n.type!==y.Fragment&&(s.ref=t?gb(t,o):o),y.cloneElement(n,s)}return y.Children.count(n)>1?y.Children.only(null):null});return t.displayName=`${e}.SlotClone`,t}(e),n=y.forwardRef((e,n)=>{let{children:r,...i}=e,o=y.Children.toArray(r),s=o.find(gj);if(s){let e=s.props.children,r=o.map(t=>t!==s?t:y.Children.count(e)>1?y.Children.only(null):y.isValidElement(e)?e.props.children:null);return(0,m.jsx)(t,{...i,ref:n,children:y.isValidElement(e)?y.cloneElement(e,void 0,r):null})}return(0,m.jsx)(t,{...i,ref:n,children:r})});return n.displayName=`${e}.Slot`,n}Symbol("RADIX:SYNC_STATE");var gE=Symbol("radix.slottable");function gj(e){return y.isValidElement(e)&&"function"==typeof e.type&&"__radixId"in e.type&&e.type.__radixId===gE}var gT=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let n=gI(`Primitive.${t}`),r=y.forwardRef((e,r)=>{let{asChild:i,...o}=e,s=i?n:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,m.jsx)(s,{...o,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function gM(e,t){e&&a8.flushSync(()=>e.dispatchEvent(t))}function gA(e){let t=y.useRef(e);return y.useEffect(()=>{t.current=e}),y.useMemo(()=>(...e)=>t.current?.(...e),[])}var gO="dismissableLayer.update",gL=y.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),gD=y.forwardRef((e,t)=>{let{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:o,onInteractOutside:s,onDismiss:a,...l}=e,c=y.useContext(gL),[d,u]=y.useState(null),h=d?.ownerDocument??globalThis?.document,[,p]=y.useState({}),g=gx(t,e=>u(e)),b=Array.from(c.layers),[x]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),v=b.indexOf(x),w=d?b.indexOf(d):-1,S=c.layersWithOutsidePointerEventsDisabled.size>0,k=w>=v,C=function(e,t=globalThis?.document){let n=gA(e),r=y.useRef(!1),i=y.useRef(()=>{});return y.useEffect(()=>{let e=e=>{if(e.target&&!r.current){let r=function(){gN("dismissableLayer.pointerDownOutside",n,o,{discrete:!0})},o={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",i.current),i.current=r,t.addEventListener("click",i.current,{once:!0})):r()}else t.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(o),t.removeEventListener("pointerdown",e),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}(e=>{let t=e.target,n=[...c.branches].some(e=>e.contains(t));!k||n||(i?.(e),s?.(e),e.defaultPrevented||a?.())},h),P=function(e,t=globalThis?.document){let n=gA(e),r=y.useRef(!1);return y.useEffect(()=>{let e=e=>{e.target&&!r.current&&gN("dismissableLayer.focusOutside",n,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}(e=>{let t=e.target;[...c.branches].some(e=>e.contains(t))||(o?.(e),s?.(e),e.defaultPrevented||a?.())},h);return function(e,t=globalThis?.document){let n=gA(e);y.useEffect(()=>{let e=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[n,t])}(e=>{w!==c.layers.size-1||(r?.(e),!e.defaultPrevented&&a&&(e.preventDefault(),a()))},h),y.useEffect(()=>{if(d)return n&&(0===c.layersWithOutsidePointerEventsDisabled.size&&(f=h.body.style.pointerEvents,h.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(d)),c.layers.add(d),gR(),()=>{n&&1===c.layersWithOutsidePointerEventsDisabled.size&&(h.body.style.pointerEvents=f)}},[d,h,n,c]),y.useEffect(()=>()=>{d&&(c.layers.delete(d),c.layersWithOutsidePointerEventsDisabled.delete(d),gR())},[d,c]),y.useEffect(()=>{let e=()=>p({});return document.addEventListener(gO,e),()=>document.removeEventListener(gO,e)},[]),(0,m.jsx)(gT.div,{...l,ref:g,style:{pointerEvents:S?k?"auto":"none":void 0,...e.style},onFocusCapture:gm(e.onFocusCapture,P.onFocusCapture),onBlurCapture:gm(e.onBlurCapture,P.onBlurCapture),onPointerDownCapture:gm(e.onPointerDownCapture,C.onPointerDownCapture)})});gD.displayName="DismissableLayer";var gz=y.forwardRef((e,t)=>{let n=y.useContext(gL),r=y.useRef(null),i=gx(t,r);return y.useEffect(()=>{let e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),(0,m.jsx)(gT.div,{...e,ref:i})});function gR(){let e=new CustomEvent(gO);document.dispatchEvent(e)}function gN(e,t,n,{discrete:r}){let i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?gM(i,o):i.dispatchEvent(o)}gz.displayName="DismissableLayerBranch";var gF="focusScope.autoFocusOnMount",g$="focusScope.autoFocusOnUnmount",gB={bubbles:!1,cancelable:!0},gU=y.forwardRef((e,t)=>{let{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=e,[a,l]=y.useState(null),c=gA(i),d=gA(o),u=y.useRef(null),h=gx(t,e=>l(e)),p=y.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;y.useEffect(()=>{if(r){let e=function(e){if(p.paused||!a)return;let t=e.target;a.contains(t)?u.current=t:gK(u.current,{select:!0})},t=function(e){if(p.paused||!a)return;let t=e.relatedTarget;null===t||a.contains(t)||gK(u.current,{select:!0})};document.addEventListener("focusin",e),document.addEventListener("focusout",t);let n=new MutationObserver(function(e){if(document.activeElement===document.body)for(let t of e)t.removedNodes.length>0&&gK(a)});return a&&n.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",e),document.removeEventListener("focusout",t),n.disconnect()}}},[r,a,p.paused]),y.useEffect(()=>{if(a){gW.add(p);let e=document.activeElement;if(!a.contains(e)){let t=new CustomEvent(gF,gB);a.addEventListener(gF,c),a.dispatchEvent(t),t.defaultPrevented||(function(e,{select:t=!1}={}){let n=document.activeElement;for(let r of e)if(gK(r,{select:t}),document.activeElement!==n)return}(gV(a).filter(e=>"A"!==e.tagName),{select:!0}),document.activeElement===e&&gK(a))}return()=>{a.removeEventListener(gF,c),setTimeout(()=>{let t=new CustomEvent(g$,gB);a.addEventListener(g$,d),a.dispatchEvent(t),t.defaultPrevented||gK(e??document.body,{select:!0}),a.removeEventListener(g$,d),gW.remove(p)},0)}}},[a,c,d,p]);let f=y.useCallback(e=>{if(!n&&!r||p.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,i=document.activeElement;if(t&&i){let t=e.currentTarget,[r,o]=function(e){let t=gV(e);return[gH(t,e),gH(t.reverse(),e)]}(t);r&&o?e.shiftKey||i!==o?e.shiftKey&&i===r&&(e.preventDefault(),n&&gK(o,{select:!0})):(e.preventDefault(),n&&gK(r,{select:!0})):i===t&&e.preventDefault()}},[n,r,p.paused]);return(0,m.jsx)(gT.div,{tabIndex:-1,...s,ref:h,onKeyDown:f})});function gV(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function gH(e,t){for(let n of e)if(!function(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===t||e!==t);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}(n,{upTo:t}))return n}function gK(e,{select:t=!1}={}){if(e&&e.focus){var n;let r=document.activeElement;e.focus({preventScroll:!0}),e!==r&&(n=e)instanceof HTMLInputElement&&"select"in n&&t&&e.select()}}gU.displayName="FocusScope";var gW=function(){let e=[];return{add(t){let n=e[0];t!==n&&n?.pause(),(e=gG(e,t)).unshift(t)},remove(t){e=gG(e,t),e[0]?.resume()}}}();function gG(e,t){let n=[...e],r=n.indexOf(t);return -1!==r&&n.splice(r,1),n}var gq=y.forwardRef((e,t)=>{let{container:n,...r}=e,[i,o]=y.useState(!1);gw(()=>o(!0),[]);let s=n||i&&globalThis?.document?.body;return s?a8.createPortal((0,m.jsx)(gT.div,{...r,ref:t}),s):null});gq.displayName="Portal";var gY=e=>{let{present:t,children:n}=e,r=function(e){var t,n;let[r,i]=y.useState(),o=y.useRef(null),s=y.useRef(e),a=y.useRef("none"),[l,c]=(t=e?"mounted":"unmounted",n={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},y.useReducer((e,t)=>n[e][t]??e,t));return y.useEffect(()=>{let e=gX(o.current);a.current="mounted"===l?e:"none"},[l]),gw(()=>{let t=o.current,n=s.current;if(n!==e){let r=a.current,i=gX(t);e?c("MOUNT"):"none"===i||t?.display==="none"?c("UNMOUNT"):n&&r!==i?c("ANIMATION_OUT"):c("UNMOUNT"),s.current=e}},[e,c]),gw(()=>{if(r){let e;let t=r.ownerDocument.defaultView??window,n=n=>{let i=gX(o.current).includes(CSS.escape(n.animationName));if(n.target===r&&i&&(c("ANIMATION_END"),!s.current)){let n=r.style.animationFillMode;r.style.animationFillMode="forwards",e=t.setTimeout(()=>{"forwards"===r.style.animationFillMode&&(r.style.animationFillMode=n)})}},i=e=>{e.target===r&&(a.current=gX(o.current))};return r.addEventListener("animationstart",i),r.addEventListener("animationcancel",n),r.addEventListener("animationend",n),()=>{t.clearTimeout(e),r.removeEventListener("animationstart",i),r.removeEventListener("animationcancel",n),r.removeEventListener("animationend",n)}}c("ANIMATION_END")},[r,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:y.useCallback(e=>{o.current=e?getComputedStyle(e):null,i(e)},[])}}(t),i="function"==typeof n?n({present:r.isPresent}):y.Children.only(n),o=gx(r.ref,function(e){let t=Object.getOwnPropertyDescriptor(e.props,"ref")?.get,n=t&&"isReactWarning"in t&&t.isReactWarning;return n?e.ref:(n=(t=Object.getOwnPropertyDescriptor(e,"ref")?.get)&&"isReactWarning"in t&&t.isReactWarning)?e.props.ref:e.props.ref||e.ref}(i));return"function"==typeof n||r.isPresent?y.cloneElement(i,{ref:o}):null};function gX(e){return e?.animationName||"none"}gY.displayName="Presence";var gZ=0;function gQ(){y.useEffect(()=>{let e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??gJ()),document.body.insertAdjacentElement("beforeend",e[1]??gJ()),gZ++,()=>{1===gZ&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),gZ--}},[])}function gJ(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var g0=function(){return(g0=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function g1(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}Object.create,Object.create;var g2=("function"==typeof SuppressedError&&SuppressedError,"right-scroll-bar-position"),g3="width-before-scroll-bar";function g5(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}var g4="undefined"!=typeof window?y.useLayoutEffect:y.useEffect,g6=new WeakMap;function g8(e){return e}var g9=function(e){void 0===e&&(e={});var t,n,r,i=(void 0===t&&(t=g8),n=[],r=!1,{read:function(){if(r)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:null},useMedium:function(e){var i=t(e,r);return n.push(i),function(){n=n.filter(function(e){return e!==i})}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var i=n;n=[],i.forEach(e),t=n}var o=function(){var n=t;t=[],n.forEach(e)},s=function(){return Promise.resolve().then(o)};s(),n={push:function(e){t.push(e),s()},filter:function(e){return t=t.filter(e),n}}}});return i.options=g0({async:!0,ssr:!1},e),i}(),g7=function(){},me=y.forwardRef(function(e,t){var n,r,i,o,s=y.useRef(null),a=y.useState({onScrollCapture:g7,onWheelCapture:g7,onTouchMoveCapture:g7}),l=a[0],c=a[1],d=e.forwardProps,u=e.children,h=e.className,p=e.removeScrollBar,f=e.enabled,g=e.shards,m=e.sideCar,b=e.noRelative,x=e.noIsolation,v=e.inert,w=e.allowPinchZoom,S=e.as,k=e.gapMode,C=g1(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),P=(n=[s,t],r=function(e){return n.forEach(function(t){return g5(t,e)})},(i=(0,y.useState)(function(){return{value:null,callback:r,facade:{get current(){return i.value},set current(value){var e=i.value;e!==value&&(i.value=value,i.callback(value,e))}}}})[0]).callback=r,o=i.facade,g4(function(){var e=g6.get(o);if(e){var t=new Set(e),r=new Set(n),i=o.current;t.forEach(function(e){r.has(e)||g5(e,null)}),r.forEach(function(e){t.has(e)||g5(e,i)})}g6.set(o,n)},[n]),o),_=g0(g0({},C),l);return y.createElement(y.Fragment,null,f&&y.createElement(m,{sideCar:g9,removeScrollBar:p,shards:g,noRelative:b,noIsolation:x,inert:v,setCallbacks:c,allowPinchZoom:!!w,lockRef:s,gapMode:k}),d?y.cloneElement(y.Children.only(u),g0(g0({},_),{ref:P})):y.createElement(void 0===S?"div":S,g0({},_,{className:h,ref:P}),u))});me.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},me.classNames={fullWidth:g3,zeroRight:g2};var mt=function(e){var t=e.sideCar,n=g1(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw Error("Sidecar medium not found");return y.createElement(r,g0({},n))};mt.isSideCarExport=!0;var mn=function(){var e=0,t=null;return{add:function(r){if(0==e&&(t=function(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=g||n.nc;return t&&e.setAttribute("nonce",t),e}())){var i,o;(i=t).styleSheet?i.styleSheet.cssText=r:i.appendChild(document.createTextNode(r)),o=t,(document.head||document.getElementsByTagName("head")[0]).appendChild(o)}e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},mr=function(){var e=mn();return function(t,n){y.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},mi=function(){var e=mr();return function(t){return e(t.styles,t.dynamic),null}},mo={left:0,top:0,right:0,gap:0},ms=function(e){return parseInt(e||"",10)||0},ma=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[ms(n),ms(r),ms(i)]},ml=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return mo;var t=ma(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},mc=mi(),md="data-scroll-locked",mu=function(e,t,n,r){var i=e.left,o=e.top,s=e.right,a=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(a,"px ").concat(r,";\n  }\n  body[").concat(md,"] {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(o,"px;\n    padding-right: ").concat(s,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(a,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(g2," {\n    right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(g3," {\n    margin-right: ").concat(a,"px ").concat(r,";\n  }\n  \n  .").concat(g2," .").concat(g2," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(g3," .").concat(g3," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body[").concat(md,"] {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(a,"px;\n  }\n")},mh=function(){var e=parseInt(document.body.getAttribute(md)||"0",10);return isFinite(e)?e:0},mp=function(){y.useEffect(function(){return document.body.setAttribute(md,(mh()+1).toString()),function(){var e=mh()-1;e<=0?document.body.removeAttribute(md):document.body.setAttribute(md,e.toString())}},[])},mf=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,i=void 0===r?"margin":r;mp();var o=y.useMemo(function(){return ml(i)},[i]);return y.createElement(mc,{styles:mu(o,!t,i,n?"":"!important")})},mg=!1;if("undefined"!=typeof window)try{var mm=Object.defineProperty({},"passive",{get:function(){return mg=!0,!0}});window.addEventListener("test",mm,mm),window.removeEventListener("test",mm,mm)}catch(e){mg=!1}var my=!!mg&&{passive:!1},mb=function(e,t){if(!(e instanceof Element))return!1;var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&"TEXTAREA"!==e.tagName&&"visible"===n[t])},mx=function(e,t){var n=t.ownerDocument,r=t;do{if("undefined"!=typeof ShadowRoot&&r instanceof ShadowRoot&&(r=r.host),mv(e,r)){var i=mw(e,r);if(i[1]>i[2])return!0}r=r.parentNode}while(r&&r!==n.body);return!1},mv=function(e,t){return"v"===e?mb(t,"overflowY"):mb(t,"overflowX")},mw=function(e,t){return"v"===e?[t.scrollTop,t.scrollHeight,t.clientHeight]:[t.scrollLeft,t.scrollWidth,t.clientWidth]},mS=function(e,t,n,r,i){var o,s=(o=window.getComputedStyle(t).direction,"h"===e&&"rtl"===o?-1:1),a=s*r,l=n.target,c=t.contains(l),d=!1,u=a>0,h=0,p=0;do{if(!l)break;var f=mw(e,l),g=f[0],m=f[1]-f[2]-s*g;(g||m)&&mv(e,l)&&(h+=m,p+=g);var y=l.parentNode;l=y&&y.nodeType===Node.DOCUMENT_FRAGMENT_NODE?y.host:y}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return u&&(i&&1>Math.abs(h)||!i&&a>h)?d=!0:!u&&(i&&1>Math.abs(p)||!i&&-a>p)&&(d=!0),d},mk=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},mC=function(e){return[e.deltaX,e.deltaY]},mP=function(e){return e&&"current"in e?e.current:e},m_=0,mI=[];let mE=(p=function(e){var t=y.useRef([]),n=y.useRef([0,0]),r=y.useRef(),i=y.useState(m_++)[0],o=y.useState(mi)[0],s=y.useRef(e);y.useEffect(function(){s.current=e},[e]),y.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=(function(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))})([e.lockRef.current],(e.shards||[]).map(mP),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var a=y.useCallback(function(e,t){if("touches"in e&&2===e.touches.length||"wheel"===e.type&&e.ctrlKey)return!s.current.allowPinchZoom;var i,o=mk(e),a=n.current,l="deltaX"in e?e.deltaX:a[0]-o[0],c="deltaY"in e?e.deltaY:a[1]-o[1],d=e.target,u=Math.abs(l)>Math.abs(c)?"h":"v";if("touches"in e&&"h"===u&&"range"===d.type)return!1;var h=window.getSelection(),p=h&&h.anchorNode;if(p&&(p===d||p.contains(d)))return!1;var f=mx(u,d);if(!f)return!0;if(f?i=u:(i="v"===u?"h":"v",f=mx(u,d)),!f)return!1;if(!r.current&&"changedTouches"in e&&(l||c)&&(r.current=i),!i)return!0;var g=r.current||i;return mS(g,t,e,"h"===g?l:c,!0)},[]),l=y.useCallback(function(e){if(mI.length&&mI[mI.length-1]===o){var n="deltaY"in e?mC(e):mk(e),r=t.current.filter(function(t){var r;return t.name===e.type&&(t.target===e.target||e.target===t.shadowParent)&&(r=t.delta)[0]===n[0]&&r[1]===n[1]})[0];if(r&&r.should){e.cancelable&&e.preventDefault();return}if(!r){var i=(s.current.shards||[]).map(mP).filter(Boolean).filter(function(t){return t.contains(e.target)});(i.length>0?a(e,i[0]):!s.current.noIsolation)&&e.cancelable&&e.preventDefault()}}},[]),c=y.useCallback(function(e,n,r,i){var o={name:e,delta:n,target:r,should:i,shadowParent:function(e){for(var t=null;null!==e;)e instanceof ShadowRoot&&(t=e.host,e=e.host),e=e.parentNode;return t}(r)};t.current.push(o),setTimeout(function(){t.current=t.current.filter(function(e){return e!==o})},1)},[]),d=y.useCallback(function(e){n.current=mk(e),r.current=void 0},[]),u=y.useCallback(function(t){c(t.type,mC(t),t.target,a(t,e.lockRef.current))},[]),h=y.useCallback(function(t){c(t.type,mk(t),t.target,a(t,e.lockRef.current))},[]);y.useEffect(function(){return mI.push(o),e.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:h}),document.addEventListener("wheel",l,my),document.addEventListener("touchmove",l,my),document.addEventListener("touchstart",d,my),function(){mI=mI.filter(function(e){return e!==o}),document.removeEventListener("wheel",l,my),document.removeEventListener("touchmove",l,my),document.removeEventListener("touchstart",d,my)}},[]);var p=e.removeScrollBar,f=e.inert;return y.createElement(y.Fragment,null,f?y.createElement(o,{styles:"\n  .block-interactivity-".concat(i," {pointer-events: none;}\n  .allow-interactivity-").concat(i," {pointer-events: all;}\n")}):null,p?y.createElement(mf,{noRelative:e.noRelative,gapMode:e.gapMode}):null)},g9.useMedium(p),mt);var mj=y.forwardRef(function(e,t){return y.createElement(me,g0({},e,{ref:t,sideCar:mE}))});mj.classNames=me.classNames;var mT=new WeakMap,mM=new WeakMap,mA={},mO=0,mL=function(e){return e&&(e.host||mL(e.parentNode))},mD=function(e,t,n,r){var i=(Array.isArray(e)?e:[e]).map(function(e){if(t.contains(e))return e;var n=mL(e);return n&&t.contains(n)?n:(console.error("aria-hidden",e,"in not contained inside",t,". Doing nothing"),null)}).filter(function(e){return!!e});mA[n]||(mA[n]=new WeakMap);var o=mA[n],s=[],a=new Set,l=new Set(i),c=function(e){!e||a.has(e)||(a.add(e),c(e.parentNode))};i.forEach(c);var d=function(e){!e||l.has(e)||Array.prototype.forEach.call(e.children,function(e){if(a.has(e))d(e);else try{var t=e.getAttribute(r),i=null!==t&&"false"!==t,l=(mT.get(e)||0)+1,c=(o.get(e)||0)+1;mT.set(e,l),o.set(e,c),s.push(e),1===l&&i&&mM.set(e,!0),1===c&&e.setAttribute(n,"true"),i||e.setAttribute(r,"true")}catch(t){console.error("aria-hidden: cannot operate on ",e,t)}})};return d(t),a.clear(),mO++,function(){s.forEach(function(e){var t=mT.get(e)-1,i=o.get(e)-1;mT.set(e,t),o.set(e,i),t||(mM.has(e)||e.removeAttribute(r),mM.delete(e)),i||e.removeAttribute(n)}),--mO||(mT=new WeakMap,mT=new WeakMap,mM=new WeakMap,mA={})}},mz=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r,i=Array.from(Array.isArray(e)?e:[e]),o=t||(r=e,"undefined"==typeof document?null:(Array.isArray(r)?r[0]:r).ownerDocument.body);return o?(i.push.apply(i,Array.from(o.querySelectorAll("[aria-live], script"))),mD(i,o,n,"aria-hidden")):function(){return null}},mR="Dialog",[mN,mF]=gv(mR),[m$,mB]=mN(mR),mU=e=>{let{__scopeDialog:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=e,a=y.useRef(null),l=y.useRef(null),[c,d]=g_({prop:r,defaultProp:i??!1,onChange:o,caller:mR});return(0,m.jsx)(m$,{scope:t,triggerRef:a,contentRef:l,contentId:gC(),titleId:gC(),descriptionId:gC(),open:c,onOpenChange:d,onOpenToggle:y.useCallback(()=>d(e=>!e),[d]),modal:s,children:n})};mU.displayName=mR;var mV="DialogTrigger";y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=mB(mV,n),o=gx(t,i.triggerRef);return(0,m.jsx)(gT.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":m9(i.open),...r,ref:o,onClick:gm(e.onClick,i.onOpenToggle)})}).displayName=mV;var mH="DialogPortal",[mK,mW]=mN(mH,{forceMount:void 0}),mG=e=>{let{__scopeDialog:t,forceMount:n,children:r,container:i}=e,o=mB(mH,t);return(0,m.jsx)(mK,{scope:t,forceMount:n,children:y.Children.map(r,e=>(0,m.jsx)(gY,{present:n||o.open,children:(0,m.jsx)(gq,{asChild:!0,container:i,children:e})}))})};mG.displayName=mH;var mq="DialogOverlay",mY=y.forwardRef((e,t)=>{let n=mW(mq,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=mB(mq,e.__scopeDialog);return o.modal?(0,m.jsx)(gY,{present:r||o.open,children:(0,m.jsx)(mZ,{...i,ref:t})}):null});mY.displayName=mq;var mX=gI("DialogOverlay.RemoveScroll"),mZ=y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=mB(mq,n);return(0,m.jsx)(mj,{as:mX,allowPinchZoom:!0,shards:[i.contentRef],children:(0,m.jsx)(gT.div,{"data-state":m9(i.open),...r,ref:t,style:{pointerEvents:"auto",...r.style}})})}),mQ="DialogContent",mJ=y.forwardRef((e,t)=>{let n=mW(mQ,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=mB(mQ,e.__scopeDialog);return(0,m.jsx)(gY,{present:r||o.open,children:o.modal?(0,m.jsx)(m0,{...i,ref:t}):(0,m.jsx)(m1,{...i,ref:t})})});mJ.displayName=mQ;var m0=y.forwardRef((e,t)=>{let n=mB(mQ,e.__scopeDialog),r=y.useRef(null),i=gx(t,n.contentRef,r);return y.useEffect(()=>{let e=r.current;if(e)return mz(e)},[]),(0,m.jsx)(m2,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:gm(e.onCloseAutoFocus,e=>{e.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:gm(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey;(2===t.button||n)&&e.preventDefault()}),onFocusOutside:gm(e.onFocusOutside,e=>e.preventDefault())})}),m1=y.forwardRef((e,t)=>{let n=mB(mQ,e.__scopeDialog),r=y.useRef(!1),i=y.useRef(!1);return(0,m.jsx)(m2,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(r.current||n.triggerRef.current?.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(r.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let o=t.target;n.triggerRef.current?.contains(o)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}})}),m2=y.forwardRef((e,t)=>{let{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=e,a=mB(mQ,n),l=y.useRef(null),c=gx(t,l);return gQ(),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(gU,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o,children:(0,m.jsx)(gD,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":m9(a.open),...s,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(yn,{titleId:a.titleId}),(0,m.jsx)(yr,{contentRef:l,descriptionId:a.descriptionId})]})]})}),m3="DialogTitle",m5=y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=mB(m3,n);return(0,m.jsx)(gT.h2,{id:i.titleId,...r,ref:t})});m5.displayName=m3;var m4="DialogDescription";y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=mB(m4,n);return(0,m.jsx)(gT.p,{id:i.descriptionId,...r,ref:t})}).displayName=m4;var m6="DialogClose",m8=y.forwardRef((e,t)=>{let{__scopeDialog:n,...r}=e,i=mB(m6,n);return(0,m.jsx)(gT.button,{type:"button",...r,ref:t,onClick:gm(e.onClick,()=>i.onOpenChange(!1))})});function m9(e){return e?"open":"closed"}m8.displayName=m6;var m7="DialogTitleWarning",[ye,yt]=function(e,t){let n=y.createContext(t),r=e=>{let{children:t,...r}=e,i=y.useMemo(()=>r,Object.values(r));return(0,m.jsx)(n.Provider,{value:i,children:t})};return r.displayName=e+"Provider",[r,function(r){let i=y.useContext(n);if(i)return i;if(void 0!==t)return t;throw Error(`\`${r}\` must be used within \`${e}\``)}]}(m7,{contentName:mQ,titleName:m3,docsSlug:"dialog"}),yn=({titleId:e})=>{let t=yt(m7),n=`\`${t.contentName}\` requires a \`${t.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${t.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${t.docsSlug}`;return y.useEffect(()=>{e&&!document.getElementById(e)&&console.error(n)},[n,e]),null},yr=({contentRef:e,descriptionId:t})=>{let n=yt("DialogDescriptionWarning"),r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${n.contentName}}.`;return y.useEffect(()=>{let n=e.current?.getAttribute("aria-describedby");t&&n&&!document.getElementById(t)&&console.warn(r)},[r,e,t]),null};let yi=()=>void 0,yo=y.createContext(null);function ys({onEvent:e,children:t}){return(0,m.jsx)(yo.Provider,{value:e??yi,children:t})}function ya(){return y.useContext(yo)??yi}let yl=(0,y.createContext)(null);function yc({children:e}){let t=i8(),n=ya(),[r,i]=(0,y.useState)([]),o=(0,y.useCallback)(e=>{let r=e.id??a$();return i(t=>[...t.filter(t=>t.id!==e.id),{...e,id:r}]),n("open-menu",{source:"dialog",id:r}),t.addOpenMenu(r),r},[t,n]),s=(0,y.useCallback)((e,r)=>(i(t=>t.map(t=>t.id===e?{...t,...r}:t)),n("open-menu",{source:"dialog",id:e}),t.addOpenMenu(e),e),[t,n]),a=(0,y.useCallback)(e=>(i(t=>t.filter(t=>t.id!==e||(t.onClose?.(),!1))),n("close-menu",{source:"dialog",id:e}),t.deleteOpenMenu(e),e),[t,n]),l=(0,y.useCallback)(()=>{i(e=>(e.forEach(e=>{e.onClose?.(),n("close-menu",{source:"dialog",id:e.id}),t.deleteOpenMenu(e.id)}),[]))},[t,n]);return(0,m.jsx)(yl.Provider,{value:{dialogs:r,addDialog:o,removeDialog:a,clearDialogs:l,updateDialog:s},children:e})}function yd(){let e=(0,y.useContext)(yl);if(!e)throw Error("useDialogs must be used within a DialogsProvider");return e}let yu=({id:e,component:t,onClose:n})=>{let{removeDialog:r}=yd(),i=oK(),o=(0,y.useCallback)(t=>{if(!t){if(n)try{n()}catch(e){console.warn(e)}r(e)}},[e,n,r]);return(0,m.jsx)(mU,{onOpenChange:o,defaultOpen:!0,children:(0,m.jsx)(mG,{container:i,children:(0,m.jsx)(mY,{dir:"ltr",className:"tlui-dialog__overlay",onClick:e=>{e.target===e.currentTarget&&o(!1)},children:(0,m.jsx)(mJ,{dir:"ltr",className:"tlui-dialog__content",children:(0,m.jsx)(t,{onClose:()=>o(!1)})})})})})},yh=y.memo(function(){let{dialogs:e}=yd();return e.map(e=>(0,m.jsx)(yu,{...e},e.id))});function yp(){let e=i8(),t=iJ("follow",()=>e.getInstanceState().followingUserId,[e]);return t?(0,m.jsx)(yf,{userId:t}):null}function yf({userId:e}){let t=sV(e);return t?(0,m.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}function yg(e){let t=e+"CollectionProvider",[n,r]=gv(t),[i,o]=n(t,{collectionRef:{current:null},itemMap:new Map}),s=e=>{let{scope:t,children:n}=e,r=y.useRef(null),o=y.useRef(new Map).current;return(0,m.jsx)(i,{scope:t,itemMap:o,collectionRef:r,children:n})};s.displayName=t;let a=e+"CollectionSlot",l=gI(a),c=y.forwardRef((e,t)=>{let{scope:n,children:r}=e,i=gx(t,o(a,n).collectionRef);return(0,m.jsx)(l,{ref:i,children:r})});c.displayName=a;let d=e+"CollectionItemSlot",u="data-radix-collection-item",h=gI(d),p=y.forwardRef((e,t)=>{let{scope:n,children:r,...i}=e,s=y.useRef(null),a=gx(t,s),l=o(d,n);return y.useEffect(()=>(l.itemMap.set(s,{ref:s,...i}),()=>void l.itemMap.delete(s))),(0,m.jsx)(h,{[u]:"",ref:a,children:r})});return p.displayName=d,[{Provider:s,Slot:c,ItemSlot:p},function(t){let n=o(e+"CollectionConsumer",t);return y.useCallback(()=>{let e=n.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${u}]`));return Array.from(n.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[n.collectionRef,n.itemMap])},r]}var ym=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),yy=y.forwardRef((e,t)=>(0,m.jsx)(gT.span,{...e,ref:t,style:{...ym,...e.style}}));yy.displayName="VisuallyHidden";var yb="ToastProvider",[yx,yv,yw]=yg("Toast"),[yS,yk]=gv("Toast",[yw]),[yC,yP]=yS(yb),y_=e=>{let{__scopeToast:t,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:s}=e,[a,l]=y.useState(null),[c,d]=y.useState(0),u=y.useRef(!1),h=y.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${yb}\`. Expected non-empty \`string\`.`),(0,m.jsx)(yx.Provider,{scope:t,children:(0,m.jsx)(yC,{scope:t,label:n,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:y.useCallback(()=>d(e=>e+1),[]),onToastRemove:y.useCallback(()=>d(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:h,children:s})})};y_.displayName=yb;var yI="ToastViewport",yE=["F8"],yj="toast.viewportPause",yT="toast.viewportResume",yM=y.forwardRef((e,t)=>{let{__scopeToast:n,hotkey:r=yE,label:i="Notifications ({hotkey})",...o}=e,s=yP(yI,n),a=yv(n),l=y.useRef(null),c=y.useRef(null),d=y.useRef(null),u=y.useRef(null),h=gx(t,u,s.onViewportChange),p=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),f=s.toastCount>0;y.useEffect(()=>{let e=e=>{0!==r.length&&r.every(t=>e[t]||e.code===t)&&u.current?.focus()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[r]),y.useEffect(()=>{let e=l.current,t=u.current;if(f&&e&&t){let n=()=>{if(!s.isClosePausedRef.current){let e=new CustomEvent(yj);t.dispatchEvent(e),s.isClosePausedRef.current=!0}},r=()=>{if(s.isClosePausedRef.current){let e=new CustomEvent(yT);t.dispatchEvent(e),s.isClosePausedRef.current=!1}},i=t=>{e.contains(t.relatedTarget)||r()},o=()=>{e.contains(document.activeElement)||r()};return e.addEventListener("focusin",n),e.addEventListener("focusout",i),e.addEventListener("pointermove",n),e.addEventListener("pointerleave",o),window.addEventListener("blur",n),window.addEventListener("focus",r),()=>{e.removeEventListener("focusin",n),e.removeEventListener("focusout",i),e.removeEventListener("pointermove",n),e.removeEventListener("pointerleave",o),window.removeEventListener("blur",n),window.removeEventListener("focus",r)}}},[f,s.isClosePausedRef]);let g=y.useCallback(({tabbingDirection:e})=>{let t=a().map(t=>{let n=t.ref.current,r=[n,...function(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}(n)];return"forwards"===e?r:r.reverse()});return("forwards"===e?t.reverse():t).flat()},[a]);return y.useEffect(()=>{let e=u.current;if(e){let t=t=>{let n=t.altKey||t.ctrlKey||t.metaKey;if("Tab"===t.key&&!n){let n=document.activeElement,r=t.shiftKey;if(t.target===e&&r){c.current?.focus();return}let i=g({tabbingDirection:r?"backwards":"forwards"}),o=i.findIndex(e=>e===n);yY(i.slice(o+1))?t.preventDefault():r?c.current?.focus():d.current?.focus()}};return e.addEventListener("keydown",t),()=>e.removeEventListener("keydown",t)}},[a,g]),(0,m.jsxs)(gz,{ref:l,role:"region","aria-label":i.replace("{hotkey}",p),tabIndex:-1,style:{pointerEvents:f?void 0:"none"},children:[f&&(0,m.jsx)(yO,{ref:c,onFocusFromOutsideViewport:()=>{yY(g({tabbingDirection:"forwards"}))}}),(0,m.jsx)(yx.Slot,{scope:n,children:(0,m.jsx)(gT.ol,{tabIndex:-1,...o,ref:h})}),f&&(0,m.jsx)(yO,{ref:d,onFocusFromOutsideViewport:()=>{yY(g({tabbingDirection:"backwards"}))}})]})});yM.displayName=yI;var yA="ToastFocusProxy",yO=y.forwardRef((e,t)=>{let{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=e,o=yP(yA,n);return(0,m.jsx)(yy,{tabIndex:0,...i,ref:t,style:{position:"fixed"},onFocus:e=>{let t=e.relatedTarget;o.viewport?.contains(t)||r()}})});yO.displayName=yA;var yL="Toast",yD=y.forwardRef((e,t)=>{let{forceMount:n,open:r,defaultOpen:i,onOpenChange:o,...s}=e,[a,l]=g_({prop:r,defaultProp:i??!0,onChange:o,caller:yL});return(0,m.jsx)(gY,{present:n||a,children:(0,m.jsx)(yN,{open:a,...s,ref:t,onClose:()=>l(!1),onPause:gA(e.onPause),onResume:gA(e.onResume),onSwipeStart:gm(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:gm(e.onSwipeMove,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:gm(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:gm(e.onSwipeEnd,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),l(!1)})})})});yD.displayName=yL;var[yz,yR]=yS(yL,{onClose(){}}),yN=y.forwardRef((e,t)=>{let{__scopeToast:n,type:r="foreground",duration:i,open:o,onClose:s,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:u,onSwipeCancel:h,onSwipeEnd:p,...f}=e,g=yP(yL,n),[b,x]=y.useState(null),v=gx(t,e=>x(e)),w=y.useRef(null),S=y.useRef(null),k=i||g.duration,C=y.useRef(0),P=y.useRef(k),_=y.useRef(0),{onToastAdd:I,onToastRemove:E}=g,j=gA(()=>{b?.contains(document.activeElement)&&g.viewport?.focus(),s()}),T=y.useCallback(e=>{e&&e!==1/0&&(window.clearTimeout(_.current),C.current=new Date().getTime(),_.current=window.setTimeout(j,e))},[j]);y.useEffect(()=>{let e=g.viewport;if(e){let t=()=>{T(P.current),c?.()},n=()=>{let e=new Date().getTime()-C.current;P.current=P.current-e,window.clearTimeout(_.current),l?.()};return e.addEventListener(yj,n),e.addEventListener(yT,t),()=>{e.removeEventListener(yj,n),e.removeEventListener(yT,t)}}},[g.viewport,k,l,c,T]),y.useEffect(()=>{o&&!g.isClosePausedRef.current&&T(k)},[o,k,g.isClosePausedRef,T]),y.useEffect(()=>(I(),()=>E()),[I,E]);let M=y.useMemo(()=>b?function e(t){let n=[];return Array.from(t.childNodes).forEach(t=>{if(t.nodeType===t.TEXT_NODE&&t.textContent&&n.push(t.textContent),t.nodeType===t.ELEMENT_NODE){let r=t.ariaHidden||t.hidden||"none"===t.style.display,i=""===t.dataset.radixToastAnnounceExclude;if(!r){if(i){let e=t.dataset.radixToastAnnounceAlt;e&&n.push(e)}else n.push(...e(t))}}}),n}(b):null,[b]);return g.viewport?(0,m.jsxs)(m.Fragment,{children:[M&&(0,m.jsx)(yF,{__scopeToast:n,role:"status","aria-live":"foreground"===r?"assertive":"polite",children:M}),(0,m.jsx)(yz,{scope:n,onClose:j,children:a8.createPortal((0,m.jsx)(yx.ItemSlot,{scope:n,children:(0,m.jsx)(gD,{asChild:!0,onEscapeKeyDown:gm(a,()=>{g.isFocusedToastEscapeKeyDownRef.current||j(),g.isFocusedToastEscapeKeyDownRef.current=!1}),children:(0,m.jsx)(gT.li,{tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":g.swipeDirection,...f,ref:v,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:gm(e.onKeyDown,e=>{"Escape"!==e.key||(a?.(e.nativeEvent),e.nativeEvent.defaultPrevented||(g.isFocusedToastEscapeKeyDownRef.current=!0,j()))}),onPointerDown:gm(e.onPointerDown,e=>{0===e.button&&(w.current={x:e.clientX,y:e.clientY})}),onPointerMove:gm(e.onPointerMove,e=>{if(!w.current)return;let t=e.clientX-w.current.x,n=e.clientY-w.current.y,r=!!S.current,i=["left","right"].includes(g.swipeDirection),o=["left","up"].includes(g.swipeDirection)?Math.min:Math.max,s=i?o(0,t):0,a=i?0:o(0,n),l="touch"===e.pointerType?10:2,c={x:s,y:a},h={originalEvent:e,delta:c};r?(S.current=c,yG("toast.swipeMove",u,h,{discrete:!1})):yq(c,g.swipeDirection,l)?(S.current=c,yG("toast.swipeStart",d,h,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>l||Math.abs(n)>l)&&(w.current=null)}),onPointerUp:gm(e.onPointerUp,e=>{let t=S.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),S.current=null,w.current=null,t){let n=e.currentTarget,r={originalEvent:e,delta:t};yq(t,g.swipeDirection,g.swipeThreshold)?yG("toast.swipeEnd",p,r,{discrete:!0}):yG("toast.swipeCancel",h,r,{discrete:!0}),n.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})})}),g.viewport)})]}):null}),yF=e=>{let{__scopeToast:t,children:n,...r}=e,i=yP(yL,t),[o,s]=y.useState(!1),[a,l]=y.useState(!1);return function(e=()=>{}){let t=gA(e);gw(()=>{let e=0,n=0;return e=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}},[t])}(()=>s(!0)),y.useEffect(()=>{let e=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(e)},[]),a?null:(0,m.jsx)(gq,{asChild:!0,children:(0,m.jsx)(yy,{...r,children:o&&(0,m.jsxs)(m.Fragment,{children:[i.label," ",n]})})})},y$=y.forwardRef((e,t)=>{let{__scopeToast:n,...r}=e;return(0,m.jsx)(gT.div,{...r,ref:t})});y$.displayName="ToastTitle";var yB=y.forwardRef((e,t)=>{let{__scopeToast:n,...r}=e;return(0,m.jsx)(gT.div,{...r,ref:t})});yB.displayName="ToastDescription";var yU="ToastAction",yV=y.forwardRef((e,t)=>{let{altText:n,...r}=e;return n.trim()?(0,m.jsx)(yW,{altText:n,asChild:!0,children:(0,m.jsx)(yK,{...r,ref:t})}):(console.error(`Invalid prop \`altText\` supplied to \`${yU}\`. Expected non-empty \`string\`.`),null)});yV.displayName=yU;var yH="ToastClose",yK=y.forwardRef((e,t)=>{let{__scopeToast:n,...r}=e,i=yR(yH,n);return(0,m.jsx)(yW,{asChild:!0,children:(0,m.jsx)(gT.button,{type:"button",...r,ref:t,onClick:gm(e.onClick,i.onClose)})})});yK.displayName=yH;var yW=y.forwardRef((e,t)=>{let{__scopeToast:n,altText:r,...i}=e;return(0,m.jsx)(gT.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:t})});function yG(e,t,n,{discrete:r}){let i=n.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?gM(i,o):i.dispatchEvent(o)}var yq=(e,t,n=0)=>{let r=Math.abs(e.x),i=Math.abs(e.y),o=r>i;return"left"===t||"right"===t?o&&r>n:!o&&i>n};function yY(e){let t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}let yX=(0,y.createContext)(null);function yZ({children:e}){let[t,n]=(0,y.useState)([]),r=(0,y.useCallback)(e=>{let t=e.id??a$();return n(n=>[...n.filter(t=>t.id!==e.id),{...e,id:t}]),t},[]),i=(0,y.useCallback)(e=>(n(t=>t.filter(t=>t.id!==e)),e),[]),o=(0,y.useCallback)(()=>{n(()=>[])},[]);return(0,m.jsx)(y_,{children:(0,m.jsx)(yX.Provider,{value:{toasts:t,addToast:r,removeToast:i,clearToasts:o},children:e})})}function yQ(){let e=(0,y.useContext)(yX);if(!e)throw Error("useToasts must be used within a ToastsProvider");return e}let yJ=y.forwardRef(function({children:e,disabled:t,type:n,...r},i){return(0,m.jsx)("button",{ref:i,type:"button",draggable:!1,disabled:t,...r,className:i0("tlui-button",`tlui-button__${n}`,r.className),children:e})});function y0({children:e}){return(0,m.jsx)("span",{className:"tlui-button__label",children:e})}let y1=(0,y.memo)(function({small:e,invertIcon:t,icon:n,color:r,className:i,...o}){let s=fs(),a=s.icons[n]??s.icons["question-mark-circle"],l=(0,y.useRef)(null);return((0,y.useLayoutEffect)(()=>{a||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),l?.current&&(l.current.style.webkitMask=`url(${a}) center 100% / 100% no-repeat`)},[l,a,n]),"none"===n)?(0,m.jsx)("div",{className:i0("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},i)}):(0,m.jsx)("div",{...o,ref:l,className:i0("tlui-icon",{"tlui-icon__small":e},i),style:{color:r,mask:`url(${a}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})}),y2={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function y3({toast:e}){let{removeToast:t}=yQ(),n=ff(),r=e.actions&&e.actions.length>0,i=e.icon||e.severity&&y2[e.severity];return(0,m.jsxs)(yD,{onOpenChange:n=>{n||t(e.id)},className:"tlui-toast__container",duration:e.keepOpen?1/0:5e3,"data-severity":e.severity,children:[i&&(0,m.jsx)("div",{className:"tlui-toast__icon",children:(0,m.jsx)(y1,{icon:i})}),(0,m.jsxs)("div",{className:"tlui-toast__main",children:[(0,m.jsxs)("div",{className:"tlui-toast__content",children:[e.title&&(0,m.jsx)(y$,{className:"tlui-toast__title",children:e.title}),e.description&&(0,m.jsx)(yB,{className:"tlui-toast__description",children:e.description})]}),e.actions&&(0,m.jsxs)("div",{className:"tlui-toast__actions",children:[e.actions.map((e,t)=>(0,m.jsx)(yV,{altText:e.label,asChild:!0,onClick:e.onClick,children:(0,m.jsx)(yJ,{type:e.type,children:(0,m.jsx)(y0,{children:e.label})})},t)),(0,m.jsx)(yK,{asChild:!0,children:(0,m.jsx)(yJ,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:(0,m.jsx)(y0,{children:e.closeLabel??n("toast.close")})})})]})]}),!r&&(0,m.jsx)(yK,{asChild:!0,children:(0,m.jsx)(yJ,{type:"normal",className:"tlui-toast__close",children:(0,m.jsx)(y0,{children:e.closeLabel??n("toast.close")})})})]})}let y5=y.memo(function(){let{toasts:e}=yQ();return e.map(e=>(0,m.jsx)(y3,{toast:e},e.id))});function y4(){let e=i8(),{toasts:t}=yQ(),[n,r]=y.useState(!1);return(y.useEffect(()=>{let n=-1;return t.length?r(!0):n=e.timers.setTimeout(()=>{r(!1)},1e3),()=>{clearTimeout(n)}},[t.length,r,e]),n)?(0,m.jsx)(yM,{className:"tlui-toast__viewport"}):null}function y6({icon:e,small:t,invertIcon:n}){return(0,m.jsx)(y1,{className:"tlui-button__icon",icon:e,small:t,invertIcon:n})}let y8=[0,390,428,468,580,640,840,1023];var y9=(e=>(e[e.ZERO=0]="ZERO",e[e.MOBILE_XXS=1]="MOBILE_XXS",e[e.MOBILE_XS=2]="MOBILE_XS",e[e.MOBILE_SM=3]="MOBILE_SM",e[e.MOBILE=4]="MOBILE",e[e.TABLET_SM=5]="TABLET_SM",e[e.TABLET=6]="TABLET",e[e.DESKTOP=7]="DESKTOP",e))(y9||{});let y7={fonts:{draw:`${lD()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${lD()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${lD()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${lD()}/fonts/IBMPlexMono-Medium.woff2`}};function be(e){return(0,y.useMemo)(()=>e?{fonts:{...y7.fonts,...e?.fonts}}:y7,[e])}let bt={...y7,icons:Object.fromEntries(["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"].map(e=>[e,`${lD()}/icons/icon/${e}.svg`])),translations:Object.fromEntries(iK.map(e=>[e.locale,`${lD()}/translations/${e.locale}.json`])),embedIcons:Object.fromEntries(ii.map(e=>[e.type,`${lD()}/embed-icons/${e.type}.png`]))};function bn({className:e,children:t}){return(0,m.jsx)("div",{className:i0("tlui-dialog__header",e),children:t})}function br({className:e,children:t}){return(0,m.jsx)(m5,{dir:"ltr",className:i0("tlui-dialog__header__title",e),children:t})}function bi(){return(0,m.jsx)("div",{className:"tlui-dialog__header__close",children:(0,m.jsx)(m8,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,m.jsx)(yJ,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:(0,m.jsx)(y6,{small:!0,icon:"cross-2"})})})})}function bo({className:e,children:t,style:n}){return(0,m.jsx)("div",{className:i0("tlui-dialog__body",e),style:n,children:t})}function bs({className:e,children:t}){return(0,m.jsx)("div",{className:i0("tlui-dialog__footer",e),children:t})}let ba=y.forwardRef(function({className:e,label:t,icon:n,iconLeft:r,autoSelect:i=!1,autoFocus:o=!1,defaultValue:s,placeholder:a,onComplete:l,onValueChange:c,onCancel:d,onFocus:u,onBlur:h,shouldManuallyMaintainScrollPositionWhenFocused:p=!1,children:f,value:g},b){let x=i8(),v=y.useRef(null);y.useImperativeHandle(b,()=>v.current);let w=ff(),S=y.useRef(s??""),k=y.useRef(s??""),[C,P]=y.useState(!1),_=y.useCallback(e=>{P(!0);let t=e.currentTarget;k.current=t.value,x.timers.requestAnimationFrame(()=>{i&&t.select()}),u?.()},[i,u,x.timers]),I=y.useCallback(e=>{let t=e.currentTarget.value;k.current=t,c?.(t)},[c]),E=y.useCallback(e=>{switch(e.key){case"Enter":e.currentTarget.blur(),oF(e),l?.(e.currentTarget.value);break;case"Escape":e.currentTarget.value=S.current,e.currentTarget.blur(),oF(e),d?.(e.currentTarget.value)}},[l,d]),j=y.useCallback(e=>{P(!1);let t=e.currentTarget.value;h?.(t)},[h]);return y.useEffect(()=>{if(!x.environment.isIos)return;let e=window.visualViewport;if(C&&p&&e){let t=()=>{v.current?.scrollIntoView({block:"center"})};return e.addEventListener("resize",t),e.addEventListener("scroll",t),x.timers.requestAnimationFrame(()=>{v.current?.scrollIntoView({block:"center"})}),()=>{e.removeEventListener("resize",t),e.removeEventListener("scroll",t)}}},[x,C,p]),(0,m.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[f,t&&(0,m.jsx)("label",{children:w(t)}),r&&(0,m.jsx)(y1,{icon:r,className:"tlui-icon-left",small:!0}),(0,m.jsx)("input",{ref:v,className:i0("tlui-input",e),type:"text",defaultValue:s,onKeyUp:E,onChange:I,onFocus:_,onBlur:j,autoFocus:o,placeholder:a,value:g}),n&&(0,m.jsx)(y1,{icon:n,small:!!t})]})}),bl=iZ(function({onClose:e}){let t=i8(),n=ff(),r=fs(),[i,o]=(0,y.useState)(null),[s,a]=(0,y.useState)(""),[l,c]=(0,y.useState)(null),[d,u]=(0,y.useState)(!1),h=(0,y.useRef)(-1);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(bn,{children:[(0,m.jsx)(br,{children:i?`${n("embed-dialog.title")} \u2014 ${i.title}`:n("embed-dialog.title")}),(0,m.jsx)(bi,{})]}),i?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(bo,{className:"tlui-embed-dialog__enter",children:[(0,m.jsx)(ba,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:e=>{a(e);let n=u3(e);c(n&&n.definition.type===i.type?n:null),u(!1),clearTimeout(h.current),h.current=t.timers.setTimeout(()=>u(!n),320)}}),""===s?(0,m.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,m.jsx)("span",{children:n("embed-dialog.instruction")})," ",i.instructionLink&&(0,m.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",(0,m.jsx)(y1,{icon:"external-link",small:!0})]})]}):(0,m.jsx)("div",{className:"tlui-embed-dialog__warning",children:d?n("embed-dialog.invalid-url"):"\xa0"})]}),(0,m.jsxs)(bs,{className:"tlui-dialog__footer__actions",children:[(0,m.jsx)(yJ,{type:"normal",onClick:()=>{o(null),c(null),a("")},children:(0,m.jsx)(y0,{children:n("embed-dialog.back")})}),(0,m.jsx)("div",{className:"tlui-embed__spacer"}),(0,m.jsx)(yJ,{type:"normal",onClick:e,children:(0,m.jsx)(y0,{children:n("embed-dialog.cancel")})}),(0,m.jsx)(yJ,{type:"primary",disabled:!l,onClick:()=>{l&&(t.putExternalContent({type:"embed",url:s,point:t.getViewportPageBounds().center,embed:l.definition}),e())},children:(0,m.jsx)(y0,{children:n("embed-dialog.create")})})]})]}):(0,m.jsx)(m.Fragment,{children:(0,m.jsx)(bo,{className:"tlui-embed-dialog__list",children:ii.map(e=>(0,m.jsxs)(yJ,{type:"menu",onClick:()=>o(e),children:[(0,m.jsx)(y0,{children:e.title}),(0,m.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[e.type]})`}})]},e.type))})})]})});function bc(){let e=i8(),t=(0,y.useRef)();return(0,y.useEffect)(()=>{let n=window.document.createElement("input");async function r(t){let r=t.target.files;r&&0!==r.length&&(e.mark("insert media"),await e.putExternalContent({type:"files",files:Array.from(r),point:e.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.type="file",n.accept=e$,n.multiple=!0,t.current=n,n.addEventListener("change",r),()=>{t.current=void 0,n.removeEventListener("change",r)}},[e]),(0,y.useCallback)(()=>{t.current?.click()},[t])}let bd=y.createContext(null);function bu({overrides:e,children:t}){let n=i8(),r=ya(),{addDialog:i}=yd(),o=bc(),s=y.useMemo(()=>{let t=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){n.setCurrentTool("select"),r("select-tool",{source:e,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){n.setCurrentTool("hand"),r("select-tool",{source:e,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(e){n.setCurrentTool("eraser"),r("select-tool",{source:e,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(e){n.setCurrentTool("draw"),r("select-tool",{source:e,id:"draw"})}},...[...ip.values].map(e=>({id:e,label:`tool.${e}`,meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){n.run(()=>{n.setStyleForNextShapes(ip,e),n.setCurrentTool("geo"),r("select-tool",{source:t,id:`geo-${e}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(e){n.setCurrentTool("arrow"),r("select-tool",{source:e,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(e){n.setCurrentTool("line"),r("select-tool",{source:e,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(e){n.setCurrentTool("frame"),r("select-tool",{source:e,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(e){n.setCurrentTool("text"),r("select-tool",{source:e,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(e){o(),r("select-tool",{source:e,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(e){n.setCurrentTool("note"),r("select-tool",{source:e,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){n.setCurrentTool("laser"),r("select-tool",{source:e,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(e){i({component:bl}),r("select-tool",{source:e,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(e){n.setCurrentTool("highlight"),r("select-tool",{source:e,id:"highlight"})}}];t.push();let s=Object.fromEntries(t.map(e=>[e.id,e]));return e?e(n,s,{insertMedia:o}):s},[e,n,r,o,i]);return(0,m.jsx)(bd.Provider,{value:s,children:t})}function bh(){let e=y.useContext(bd);if(!e)throw Error("useTools must be used within a ToolProvider");return e}let bp=y.createContext(null);function bf({forceMobile:e=!1,children:t}){let n=i8(),r=iJ("breakpoint",()=>{let{width:t}=n.getViewportScreenBounds(),r=e?y9.MOBILE_SM:y8.length-1;for(let e=0;e<r;e++)if(t>y8[e]&&t<=y8[e+1])return e;return r},[n]);return(0,m.jsx)(bp.Provider,{value:r,children:t})}function bg(){let e=(0,y.useContext)(bp);if(null===e)throw Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return e}function bm(e){return(0,y.useMemo)(()=>e,e)}function by(e){return nP.isValid(e)?{isValid:!0,hasProtocol:!0}:nP.isValid("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}let bb=iZ(function({onClose:e}){let t=i8().getOnlySelectedShape();return t&&"url"in t.props&&"string"==typeof t.props.url?(0,m.jsx)(bx,{onClose:e,selectedShape:t}):null}),bx=iZ(function({onClose:e,selectedShape:t}){let n=i8(),r=ff(),i=(0,y.useRef)(null);(0,y.useEffect)(()=>{n.timers.requestAnimationFrame(()=>i.current?.focus())},[n]);let o=(0,y.useRef)(t.props.url),[s,a]=(0,y.useState)(()=>{let e=by(t.props.url),n=!0===e.isValid?e.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:n,safe:n,valid:!0}}),l=(0,y.useCallback)(e=>{let t=e.replace(/https?:\/\/(https?:\/\/)/,(e,t)=>t),n=by(t),r=!0===n.isValid?n.hasProtocol?t:"https://"+t:"https://";a({actual:t,safe:r,valid:n.isValid})},[]),c=(0,y.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(n.updateShapes([{id:t.id,type:t.type,props:{url:""}}]),e())},[n,e]),d=(0,y.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(t&&"url"in t.props&&t.props.url!==s.safe&&n.updateShapes([{id:t.id,type:t.type,props:{url:s.safe}}]),e())},[n,e,s]),u=(0,y.useCallback)(()=>{e()},[e]);if(!t)return e(),null;let h=o.current&&!s.valid;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(bn,{children:[(0,m.jsx)(br,{children:r("edit-link-dialog.title")}),(0,m.jsx)(bi,{})]}),(0,m.jsx)(bo,{children:(0,m.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,m.jsx)(ba,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:s.actual,onValueChange:l,onComplete:d,onCancel:u}),(0,m.jsx)("div",{children:r(s.valid?"edit-link-dialog.detail":"edit-link-dialog.invalid-url")})]})}),(0,m.jsxs)(bs,{className:"tlui-dialog__footer__actions",children:[(0,m.jsx)(yJ,{type:"normal",onClick:u,onTouchEnd:u,children:(0,m.jsx)(y0,{children:r("edit-link-dialog.cancel")})}),h?(0,m.jsx)(yJ,{type:"danger",onTouchEnd:c,onClick:c,children:(0,m.jsx)(y0,{children:r("edit-link-dialog.clear")})}):(0,m.jsx)(yJ,{type:"primary",disabled:!s.valid,onTouchEnd:d,onClick:d,children:(0,m.jsx)(y0,{children:r("edit-link-dialog.save")})})]})]})});var bv=n(99716);async function bw(e,t,n){let{elements:r,files:i}=t,o={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},s=new Map,a=new Map,l=e.getCurrentPageId(),c=new Map,d=[],u=new Set;r.forEach(e=>{if(c.set(e.id,nG()),null!==e.boundElements)for(let t of e.boundElements)"text"===t.type&&u.add(t.id)});let h="a0";for(let e of r){if(u.has(e.id))continue;let t=c.get(e.id),n={id:t,typeName:"shape",parentId:l,index:h,x:e.x,y:e.y,rotation:0,isLocked:e.locked,opacity:bS(e.opacity),meta:{}};switch(0!==e.angle&&a.set(t,e.angle),e.groupIds&&e.groupIds.length>0?s.has(e.groupIds[0])?s.get(e.groupIds[0])?.push(t):s.set(e.groupIds[0],[t]):d.push(t),e.type){case"rectangle":case"ellipse":case"diamond":{let t="",i="middle";if(null!==e.boundElements){for(let n of e.boundElements)if("text"===n.type){let e=r.find(e=>e.id===n.id);e&&(t=e.text,i=bj[e.textAlign])}}let s="transparent"===e.backgroundColor?e.strokeColor:e.backgroundColor;o.shapes.push({...n,type:"geo",props:{geo:e.type,url:e.link??"",w:e.width,h:e.height,size:bk[e.strokeWidth]??"draw",color:b_[s]??"black",text:t,align:i,dash:bA(e),fill:bO(e)}});break}case"freedraw":o.shapes.push({...n,type:"draw",props:{dash:bA(e),size:bk[e.strokeWidth],color:b_[e.strokeColor]??"black",segments:[{type:"free",points:e.points.map(([e,t,n=.5])=>({x:e,y:t,z:n}))}]}});break;case"line":{if(e.points.slice().length<2)break;let t=tr(e.points.length);o.shapes.push({...n,type:"line",props:{dash:bA(e),size:bk[e.strokeWidth],color:b_[e.strokeColor]??"black",spline:e.roundness?"cubic":"line",points:{...Object.fromEntries(e.points.map(([e,n],r)=>{let i=t[r];return[i,{id:i,index:i,x:e,y:n}]}))}}});break}case"arrow":{let i="";if(null!==e.boundElements){for(let t of e.boundElements)if("text"===t.type){let e=r.find(e=>e.id===t.id);e&&(i=e.text)}}let s=e.points[0],a=e.points[e.points.length-1],l=c.get(e.startBinding?.elementId),d=c.get(e.endBinding?.elementId);o.shapes.push({...n,type:"arrow",props:{text:i,bend:function(e,t,n){let r=0;if(e.points.length>2){let i=new ot(t[0],t[1]),o=new ot(n[0],n[1]),s=new ot(e.points[1][0],e.points[1][1]),a=ot.Sub(o,i),l=ot.Per(a),c=ot.Med(o,i),d=ot.Sub(c,l),u=ot.Add(c,l),h=ot.NearestPointOnLineSegment(d,u,s,!1);r=ot.Dist(h,c),ot.Clockwise(h,o,c)&&(r*=-1)}return r}(e,s,a),dash:bA(e),size:bk[e.strokeWidth]??"m",color:b_[e.strokeColor]??"black",start:{x:s[0],y:s[1]},end:{x:a[0],y:a[1]},arrowheadEnd:bM[e.endArrowhead]??"none",arrowheadStart:bM[e.startArrowhead]??"none"}}),l&&o.bindings.push({id:n$(),typeName:"binding",type:"arrow",fromId:t,toId:l,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),d&&o.bindings.push({id:n$(),typeName:"binding",type:"arrow",fromId:t,toId:d,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{let{size:t,scale:r}=function(e){let t=bC[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}(e.fontSize);o.shapes.push({...n,type:"text",props:{size:t,scale:r,font:bP[e.fontFamily]??"draw",color:b_[e.strokeColor]??"black",text:e.text,textAlign:bT[e.textAlign]}});break}case"image":{let t=i[e.fileId];if(!t)break;let r=r3.createId();o.assets.push({id:r,typeName:"asset",type:"image",props:{w:e.width,h:e.height,fileSize:t.size,name:e.id??"Untitled",isAnimated:!1,mimeType:t.mimeType,src:t.dataURL},meta:{}}),o.shapes.push({...n,type:"image",props:{w:e.width,h:e.height,assetId:r}})}}h=tn(h)}let p=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);for(let t of(e.mark("paste"),e.putContentOntoCurrentPage(o,{point:p,select:!1,preserveIds:!0}),s.values()))if(t.length>1){e.groupShapes(t);let n=e.getShape(t[0]);n?.parentId&&nW(n.parentId)&&d.push(n.parentId)}for(let[t,n]of a)e.select(t),e.rotateShapesBy([t],n);let f=ep(d.map(t=>e.getShape(t))),g=sL.Common(f.map(t=>e.getShapePageBounds(t))),m=e.getViewportPageBounds().center;e.updateShapes(f.map(e=>{let t={x:(e.x??0)-(g.x+g.w/2),y:(e.y??0)-(g.y+g.h/2)};return{id:e.id,type:e.type,x:m.x+t.x,y:m.y+t.y}})),e.setSelectedShapes(d)}let bS=e=>{let t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},bk={1:"s",2:"m",3:"l",4:"xl"},bC={16:"s",20:"m",28:"l",36:"xl"},bP={1:"draw",2:"sans",3:"mono"},b_={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},bI={solid:"draw",dashed:"dashed",dotted:"dotted"},bE={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},bj={left:"start",center:"middle",right:"end"},bT={left:"start",center:"middle",right:"end"},bM={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"},bA=e=>{let t=bI[e.strokeStyle]??"draw";return"draw"===t&&0===e.roughness&&(t="solid"),t},bO=e=>"transparent"===e.backgroundColor?"none":bE[e.fillStyle]??"solid";async function bL(e,t,n,r){let i=(await Promise.all(t.map(async e=>await (await e_(e)).blob()))).map(e=>new File([e],"tldrawFile",{type:e.type}));e.mark("paste"),await e.putExternalContent({type:"files",files:i,point:n,ignoreParent:!1,sources:r}),t.forEach(e=>URL.revokeObjectURL(e))}async function bD(e,t,n,r){return e.mark("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:r})}let bz=e=>{try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}},bR=e=>{let t=e.split(/[\n\s]/);for(let e of t)try{let t=new URL(e);if(!("http:"===t.protocol||"https:"===t.protocol))return}catch(e){return}return el(t)},bN=e=>/^<svg/.test(e),bF=["input","select","textarea"];function b$(e){let{activeElement:t}=document;return e.getIsMenuOpen()||t&&(t.getAttribute("contenteditable")||bF.indexOf(t.tagName.toLowerCase())>-1)}let bB=e=>e.types.find(e=>e.match(/^image\//)),bU=(e,t,n,r)=>{let i=bR(t);if(i)for(let t of i)bD(e,t,n);else bz(t)?bD(e,t,n):bN(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:r})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:r}))},bV=async(e,t,n)=>{if(null!==e.getEditingShapeId())return;if(!t)throw Error("No clipboard data");let r=[];for(let e of Object.values(t.items))switch(e.kind){case"file":r.push({type:"file",source:new Promise(t=>t(e.getAsFile()))});break;case"string":"text/html"===e.type?r.push({type:"html",source:new Promise(t=>e.getAsString(t))}):"text/plain"===e.type?r.push({type:"text",source:new Promise(t=>e.getAsString(t))}):r.push({type:e.type,source:new Promise(t=>e.getAsString(t))})}bK(e,r,n)},bH=async(e,t,n)=>{let r=[];for(let e of t){if(bB(e))for(let t of e.types)t.match(/^image\//)&&r.push({type:"blob",source:e.getType(t)});e.types.includes("text/html")&&r.push({type:"html",source:(async()=>{let t=await e.getType("text/html");return await eE.blobToText(t)})()}),e.types.includes("text/uri-list")&&r.push({type:"url",source:(async()=>{let t=await e.getType("text/uri-list");return await eE.blobToText(t)})()}),e.types.includes("text/plain")&&r.push({type:"text",source:(async()=>{let t=await e.getType("text/plain");return await eE.blobToText(t)})()})}return await bK(e,r,n)};async function bK(e,t,n){let r=t.filter(e=>("file"===e.type||"blob"===e.type)&&null!==e.source);if(r.length){let t=(await Promise.all(r.map(e=>e.source))).filter(Boolean).map(e=>URL.createObjectURL(e));return await bL(e,t,n)}let i=await Promise.all(t.filter(e=>"file"!==e.type).map(e=>new Promise(t=>{if("file"===e.type){t({type:"error",data:null,reason:"unexpected file"});return}e.source.then(n=>{let r=n.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(r)try{let e=bv.decompressFromBase64(r);if(null===e){t({type:"error",data:e,reason:"found tldraw data comment but could not parse base64"});return}{let n=JSON.parse(e);if("application/tldraw"!==n.type&&t({type:"error",data:n,reason:`found tldraw data comment but JSON was of a different type: ${n.type}`}),"string"==typeof n.data){t({type:"error",data:n,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}t({type:"tldraw",data:n.data});return}}catch(e){t({type:"error",data:r,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if("html"===e.type){t({type:"text",data:n,subtype:"html"});return}if("url"===e.type){t({type:"text",data:n,subtype:"url"});return}try{let e=JSON.parse(n);if("excalidraw/clipboard"===e.type){t({type:"excalidraw",data:e});return}t({type:"text",data:n,subtype:"json"});return}catch(e){t({type:"text",data:n,subtype:"text"});return}}t({type:"error",data:n,reason:"unhandled case"})})})));for(let t of i)if("tldraw"===t.type){!function(e,t,n){let r=e.getSelectionPageBounds();e.mark("paste"),e.putContentOntoCurrentPage(t,{point:n,select:!0});let i=e.getSelectionPageBounds();r&&i&&r?.collides(i)&&(e.updateInstanceState({isChangingStyle:!0}),e.timers.setTimeout(()=>{e.updateInstanceState({isChangingStyle:!1})},150))}(e,t.data,n);return}for(let t of i)if("excalidraw"===t.type){bw(e,t.data,n);return}for(let t of i)if("text"===t.type&&"html"===t.subtype){let r=new DOMParser().parseFromString(t.data,"text/html").querySelector("body");if(r&&1===Array.from(r.children).filter(e=>1===e.nodeType).length&&r.firstElementChild&&"A"===r.firstElementChild.tagName&&r.firstElementChild.hasAttribute("href")&&""!==r.firstElementChild.getAttribute("href")){bU(e,r.firstElementChild.getAttribute("href"),n,i);return}if(!i.some(e=>"text"===e.type&&"html"!==e.subtype)&&t.data.trim()){bU(e,function(e){let t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}(t.data),n,i);return}}for(let t of i)if("text"===t.type&&"url"===t.subtype){bD(e,t.data,n,i);return}for(let t of i)if("text"===t.type&&"text"===t.subtype&&t.data.trim()){bU(e,t.data,n,i);return}}let bW=async e=>{let t=await e.resolveAssetsInContent(e.getContentFromCurrentPage(e.getSelectedShapeIds()));if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}let n=bv.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if("undefined"!=typeof navigator){let r=t.shapes.map(t=>e.isShapeOfType(t,"text")||e.isShapeOfType(t,"geo")||e.isShapeOfType(t,"arrow")?t.props.text:e.isShapeOfType(t,"bookmark")||e.isShapeOfType(t,"embed")?t.props.url:null).filter(tv);if(navigator.clipboard?.write){let e=new Blob([`<div data-tldraw>${n}</div>`],{type:"text/html"}),t=r.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${n}</div>`)}};async function bG(e,t,n){let{type:r,quality:i,scale:o,width:s,height:a}=n,[l,c]=await uJ(s*o,a*o);l=Math.floor(l),c=Math.floor(c);let d=l/s,u=URL.createObjectURL(new Blob([t],{type:"image/svg+xml"})),h=await new Promise(t=>{let n=eI();n.crossOrigin="anonymous",n.onload=async()=>{e.environment.isSafari&&await new Promise(t=>e.timers.setTimeout(t,250));let r=document.createElement("canvas"),i=r.getContext("2d");r.width=l,r.height=c,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(n,0,0,l,c),URL.revokeObjectURL(u),t(r)},n.onerror=()=>{t(null)},n.src=u});if(!h)return null;let p=await new Promise(e=>h.toBlob(t=>{(!t||t_.throwToBlob.get())&&e(null),e(t)},"image/"+r,i));if(!p)return null;if("png"!==r)return p;{let e=new DataView(await p.arrayBuffer());return eL.setPhysChunk(e,d,{type:"image/"+r})}}async function bq(e,t,n){let r=await e.getSvgString(t?.length?t:[...e.getCurrentPageShapeIds()],{scale:1,background:e.getInstanceState().exportBackground,...n});if(!r)throw Error("Could not construct SVG.");return r}async function bY(e,t,n,r={}){switch(n){case"svg":return(await bq(e,t,r))?.svg;case"json":return JSON.stringify(await e.resolveAssetsInContent(e.getContentFromCurrentPage(t)));default:ev(n)}}async function bX({editor:e,ids:t,format:n,opts:r={}}){switch(n){case"svg":return new Blob([await bY(e,t,"svg",r)],{type:"text/plain"});case"json":return new Blob([await bY(e,t,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{let i=await bq(e,t,r);if(!i)throw Error("Could not construct image.");let o=await bG(e,i.svg,{type:n,quality:1,scale:2,width:i.width,height:i.height});if(!o)throw Error("Could not construct image.");return o}default:ev(n)}}let bZ={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};async function bQ(e){await navigator.clipboard?.writeText?.(await e())}async function bJ(e,t,n="png",r,i={}){if(!r&&(r=`shapes at ${b0()}`,1===t.length)){let n=e.getShape(t[0]);r=e.isShapeOfType(n,"frame")?n.props.name??"frame":`${n.id.replace(/:/,"_")} at ${b0()}`}r+=`.${n}`;let o=await bX({editor:e,ids:t,format:n,opts:i});(function(e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=e.name,t.click(),URL.revokeObjectURL(n)})(new File([o],r,{type:o.type}))}function b0(){let e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return`${t}-${n}-${r} ${i}.${o}.${s}`}async function b1(e,t,n){let r=ep(t.map(t=>{let n=e.getShape(t);if(n&&void 0!==e.getShapeUtil(n.type).toSvg)return n}));if(0===r.length)return;if(1===r.length){let t=r[0];if(!t||e.isShapeOfType(t,"image"))return}let i=[];if(void 0!==n){let t=r.map(t=>({shape:t,bounds:e.getShapeMaskedPageBounds(t).clone().expandBy(n)}));for(let e=0;e<t.length;e++){let n=t[e];if(0===e){i[0]={shapes:[n.shape],bounds:n.bounds};continue}let r=!1;for(let e of i)if(e.bounds.includes(n.bounds)){e.shapes.push(n.shape),e.bounds.expand(n.bounds),r=!0;break}r||i.push({shapes:[n.shape],bounds:n.bounds})}}else{let t=sL.Common(r.map(t=>e.getShapeMaskedPageBounds(t)));i.push({shapes:r,bounds:t})}let o=e.options.flattenImageBoundsPadding;for(let t of i){void 0!==n&&t.bounds.expandBy(-n);let r=await e.getSvgString(t.shapes,{padding:o});if(!r?.svg)continue;let i=new Blob([r.svg],{type:"image/svg+xml"}),s=await e.getAssetForExternalContent({type:"file",file:new File([i],"asset.svg",{type:"image/svg+xml"})});s&&(t.asset=s)}let s=[];return G(()=>{for(let t of i){let n,r,i;let{asset:a,bounds:l,shapes:c}=t;if(!a)continue;let d=e.findCommonAncestor(c)??e.getCurrentPageId();if(!d)continue;let u="a1";for(let e of c)if(e.parentId===d){e.index>u&&(u=e.index);break}if(nW(d)){let t=e.getShape(d);if(!t)continue;let s=e.getPointInShapeSpace(t,{x:l.x,y:l.y});i=e.getShapePageTransform(d).rotation(),s.sub(new ot(o,o).rot(-i)),n=s.x,r=s.y}else n=l.x-o,r=l.y-o,i=0;e.deleteShapes(c),e.createAssets([{...a,id:a.id}]);let h=nG();e.createShape({id:h,type:"image",index:u,parentId:d,x:n,y:r,rotation:-i,props:{assetId:a.id,w:l.w+2*o,h:l.h+2*o}}),s.push(h)}}),s}function b2(){return void 0!==i8().store.props.collaboration}let b3=y.createContext(null);function b5(e,t){if(0===e.getSelectedShapes().length)return e.getDocumentSettings().name||t}function b4({overrides:e,children:t}){let n=i8(),r=b2(),{addDialog:i,clearDialogs:o}=yd(),{clearToasts:s,addToast:a}=yQ(),l=ff(),c=bc(),d=function(){let e=i8(),t=(0,y.useRef)(null),n=(0,y.useRef)(null);return(0,y.useCallback)(async function(){let r=document.createElement("div"),i=document.createElement("style"),o=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};o(t.current,n.current),t.current=r,n.current=i;let s=`tl-print-surface-${a$()}`;r.className=s,i.innerHTML=`
			.${s} {
				display: none;
			}

			.${s} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${s} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${s}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${s}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${s}__item__header {
					display: none;
				}

				.${s}__item__footer {
					display: none;
					text-align: right;
				}

				.${s}__item__footer__hide {
					display: none;
				}

				
			}

		`;let a=()=>{document.head.appendChild(i),document.body.appendChild(r)},l=()=>{e.once("tick",()=>{o(r,i)})};function c(e,t,n){try{r.innerHTML+=`<div class="${s}__item">
        <div class="${s}__item__header">
          ${e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${s}__item__main">
          ${n}
        </div>
        <div class="${s}__item__footer ${s}__item__footer__${t?"":"hide"}">
          ${t??""}
        </div>
      </div>`}catch(e){console.error(e)}}function d(){e.environment.isChromeForIos?(a(),window.print()):e.environment.isSafari?(a(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",a),window.addEventListener("afterprint",l);let u=e.getSelectedShapeIds(),h=e.getCurrentPageId(),p=e.getPages(),f={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.getSelectedShapeIds().length>0){let t=await e.getSvgString(u,f);if(t){let e=p.find(e=>e.id===h);c(`tldraw \u2014 ${e?.name}`,null,t.svg),d()}}else{let t=e.getCurrentPage(),n=await e.getSvgString(e.getSortedChildIdsForParent(t.id),f);n&&(c(`tldraw \u2014 ${t.name}`,null,n.svg),d())}window.removeEventListener("beforeprint",a),window.removeEventListener("afterprint",l)},[e])}(),{cut:u,copy:h,paste:p}=function(){let e=i8(),t=ya(),n=(0,y.useCallback)(async function(n){0!==e.getSelectedShapeIds().length&&(await bW(e),t("copy",{source:n}))},[e,t]),r=(0,y.useCallback)(async function(n){0!==e.getSelectedShapeIds().length&&(await bW(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:n}))},[e,t]),i=(0,y.useCallback)(async function(n,r,o){null===e.getEditingShapeId()&&(Array.isArray(n)&&n[0]instanceof ClipboardItem?(bH(e,n,o),t("paste",{source:"menu"})):navigator.clipboard.read().then(e=>{i(e,r,o)}))},[e,t]);return{copy:n,cut:r,paste:i}}(),f=function(){let e=i8(),{addToast:t}=yQ(),n=ff();return(0,y.useCallback)((r,i="svg")=>{(function(e,t,n="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(Error("Copy not supported"));if(window.navigator.clipboard.write){let{blobPromise:i,mimeType:o}=function(e,t,n,r={}){return{blobPromise:bX({editor:e,ids:t,format:n,opts:r}),mimeType:bZ[n]}}(e,t,n,r);return window.navigator.clipboard.write([new ClipboardItem({[o]:i})]).catch(e=>(console.error(e),i.then(e=>window.navigator.clipboard.write([new ClipboardItem({[o]:e})]))))}switch(n){case"json":case"svg":return bQ(async()=>bY(e,t,n,r));case"jpeg":case"png":throw Error("Copy not supported");default:ev(n)}})(e,r,i).catch(()=>{t({id:"copy-fail",severity:"warning",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[e,t,n])}(),g=function(){let e=i8(),{addToast:t}=yQ(),n=ff();return(0,y.useCallback)((r,i="png",o)=>{bJ(e,r,i,o,{scale:1,background:e.getInstanceState().exportBackground}).catch(e=>{console.error(e.message),t({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc"),severity:"error"})})},[e,t,n])}(),b=l("document.default-name"),x=ya(),v=y.useMemo(()=>{function t(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function m(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}let y=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(e){m()&&(t()||(x("edit-link",{source:e}),n.mark("edit-link"),i({component:bb})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(e){x("insert-embed",{source:e}),i({component:bl})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(e){x("insert-media",{source:e}),c()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(e){x("undo",{source:e}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(e){x("redo",{source:e}),n.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(x("export-as",{format:"svg",source:e}),g(t,"svg",b5(n,b)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(x("export-as",{format:"png",source:e}),g(t,"png",b5(n,b)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(x("export-as",{format:"json",source:e}),g(t,"json",b5(n,b)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(x("export-all-as",{format:"svg",source:e}),g(Array.from(n.getCurrentPageShapeIds()),"svg",b5(n,b)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(e){let t=Array.from(n.getCurrentPageShapeIds().values());0!==t.length&&(x("export-all-as",{format:"png",source:e}),g(t,"png",b5(n,b)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(e){let t=Array.from(n.getCurrentPageShapeIds().values());0!==t.length&&(x("export-all-as",{format:"json",source:e}),g(t,"json",b5(n,b)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(x("copy-as",{format:"svg",source:e}),f(t,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(x("copy-as",{format:"png",source:e}),f(t,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(e){let t=n.getSelectedShapeIds();0===t.length&&(t=Array.from(n.getCurrentPageShapeIds().values())),0!==t.length&&(x("copy-as",{format:"json",source:e}),f(t,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(e){if(!m()||t())return;x("toggle-auto-size",{source:e}),n.mark("toggling auto size");let r=n.getSelectedShapes().filter(e=>n.isShapeOfType(e,"text")&&!1===e.props.autoSize);n.updateShapes(r.map(e=>({id:e.id,type:e.type,props:{...e.props,w:8,autoSize:!0}}))),hf(n,r.map(e=>e.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){x("open-embed-link",{source:e});let t=n.getSelectedShapeIds(),r="No embed shapes selected";if(1!==t.length){console.error(r);return}let i=n.getShape(t[0]);if(!i||!n.isShapeOfType(i,"embed")){console.error(r);return}!function(e,t="_blank"){aD.openWindow(e,t)}(i.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){if(n.root.getCurrent()?.id!=="zoom"&&(x("zoom-tool",{source:e}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){let e=n.root.getCurrent();e&&e.getCurrent()?.id==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(e){m()&&(t()||n.run(()=>{x("convert-to-bookmark",{source:e});let t=n.getSelectedShapes(),r=[],i=[];for(let e of t){if(!e||!n.isShapeOfType(e,"embed")||!e.props.url)continue;let t=new ot(e.x,e.y);t.rot(-e.rotation),t.add(new ot(e.props.w/2-150,e.props.h/2-160)),t.rot(e.rotation);let o={id:nG(),type:"bookmark",rotation:e.rotation,x:t.x,y:t.y,opacity:1,props:{url:e.props.url}};r.push(o),i.push(e.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(i),n.createShapes(r)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(e){m()&&(t()||(x("convert-to-embed",{source:e}),n.run(()=>{let e=ep(n.getSelectedShapeIds().map(e=>n.getShape(e))),t=[],r=[];for(let i of e){if(!n.isShapeOfType(i,"bookmark"))continue;let{url:e}=i.props,o=u3(i.props.url);if(!o||!o.definition)continue;let{width:s,height:a}=o.definition,l=new ot(i.x,i.y);l.rot(-i.rotation),l.add(new ot(i.props.w/2-s/2,i.props.h/2-a/2)),l.rot(i.rotation);let c={id:nG(),type:"embed",x:l.x,y:l.y,rotation:i.rotation,props:{url:e,w:s,h:a}};t.push(c),r.push(i.id)}n.mark("convert shapes to embed"),n.deleteShapes(r),n.createShapes(t)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(e){let r,i;if(!m()||t())return;x("duplicate-shapes",{source:e});let o=n.getInstanceState();if(o.duplicateProps)r=o.duplicateProps.shapeIds,i=o.duplicateProps.offset;else{r=n.getSelectedShapeIds();let e=sL.Common(ep(r.map(e=>n.getShapePageBounds(e))));i=n.getCameraOptions().isLocked?{x:n.options.adjacentShapeMargin,y:n.options.adjacentShapeMargin}:{x:e.width+n.options.adjacentShapeMargin,y:0}}n.mark("duplicate shapes"),n.duplicateShapes(r,i),o.duplicateProps&&n.updateInstanceState({duplicateProps:{...o.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(e){m()&&(t()||(x("ungroup-shapes",{source:e}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(e){if(!m()||t())return;x("group-shapes",{source:e});let r=n.getOnlySelectedShape();r&&n.isShapeOfType(r,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(e){if(!m())return;x("remove-frame",{source:e});let t=n.getSelectedShapes();t.length>0&&t.every(e=>n.isShapeOfType(e,"frame"))&&(n.mark("remove-frame"),function(e,t){let n=ep(t.map(t=>e.getShape(t)).filter(t=>t&&e.isShapeOfType(t,"frame")));if(!n.length)return;let r=[];e.run(()=>{n.map(t=>{let n=e.getSortedChildIdsForParent(t.id);n.length&&(e.reparentShapes(n,t.parentId,t.index),r.push(...n))}),e.setSelectedShapes(r),e.deleteShapes(t)})}(n,t.map(e=>e.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(e){if(!m())return;x("fit-frame-to-content",{source:e});let t=n.getOnlySelectedShape();t&&n.isShapeOfType(t,"frame")&&(n.mark("fit-frame-to-content"),function(e,t,n={}){let r=e.getShape(t);if(!r)return;let i=e.getSortedChildIdsForParent(r.id),o=ep(i.map(t=>e.getShape(t)));if(!o.length)return;let s=sL.FromPoints(o.flatMap(t=>{let n=e.getShapeGeometry(t.id);return e.getShapeLocalTransform(t).applyToPoints(n.vertices)})),{padding:a=50}=n,l=s.w+2*a,c=s.h+2*a,d=a-s.minX,u=a-s.minY;if(0===d&&0===u&&r.props.w===l&&r.props.h===c)return;let h=new ot(d,u).rot(r.rotation);e.run(()=>{let t=i.map(t=>{let n=e.getShape(t);return{id:n.id,type:n.type,x:n.x+d,y:n.y+u}});t.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:l,h:c}}),e.updateShapes(t)})}(n,t.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(e){if(!m()||t())return;x("align-shapes",{operation:"left",source:e}),n.mark("align left");let r=n.getSelectedShapeIds();n.alignShapes(r,"left"),hf(n,r)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(e){if(!m()||t())return;x("align-shapes",{operation:"center-horizontal",source:e}),n.mark("align center horizontal");let r=n.getSelectedShapeIds();n.alignShapes(r,"center-horizontal"),hf(n,r)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(e){if(!m()||t())return;x("align-shapes",{operation:"right",source:e}),n.mark("align right");let r=n.getSelectedShapeIds();n.alignShapes(r,"right"),hf(n,r)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(e){if(!m()||t())return;x("align-shapes",{operation:"center-vertical",source:e}),n.mark("align center vertical");let r=n.getSelectedShapeIds();n.alignShapes(r,"center-vertical"),hf(n,r)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(e){if(!m()||t())return;x("align-shapes",{operation:"top",source:e}),n.mark("align top");let r=n.getSelectedShapeIds();n.alignShapes(r,"top"),hf(n,r)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(e){if(!m()||t())return;x("align-shapes",{operation:"bottom",source:e}),n.mark("align bottom");let r=n.getSelectedShapeIds();n.alignShapes(r,"bottom"),hf(n,r)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(e){if(!m()||t())return;x("distribute-shapes",{operation:"horizontal",source:e}),n.mark("distribute horizontal");let r=n.getSelectedShapeIds();n.distributeShapes(r,"horizontal"),hf(n,r)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(e){if(!m()||t())return;x("distribute-shapes",{operation:"vertical",source:e}),n.mark("distribute vertical");let r=n.getSelectedShapeIds();n.distributeShapes(r,"vertical"),hf(n,r)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(e){if(!m()||t())return;x("stretch-shapes",{operation:"horizontal",source:e}),n.mark("stretch horizontal");let r=n.getSelectedShapeIds();n.stretchShapes(r,"horizontal"),hf(n,r)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(e){if(!m()||t())return;x("stretch-shapes",{operation:"vertical",source:e}),n.mark("stretch vertical");let r=n.getSelectedShapeIds();n.stretchShapes(r,"vertical"),hf(n,r)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(e){if(!m()||t())return;x("flip-shapes",{operation:"horizontal",source:e}),n.mark("flip horizontal");let r=n.getSelectedShapeIds();n.flipShapes(r,"horizontal"),hf(n,r)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(e){if(!m()||t())return;x("flip-shapes",{operation:"vertical",source:e}),n.mark("flip vertical");let r=n.getSelectedShapeIds();n.flipShapes(r,"vertical"),hf(n,r)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(e){if(!m()||t())return;x("pack-shapes",{source:e}),n.mark("pack");let r=n.getSelectedShapeIds();n.packShapes(r,n.options.adjacentShapeMargin),hf(n,r)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(e){if(!m()||t())return;x("stack-shapes",{operation:"vertical",source:e}),n.mark("stack-vertical");let r=n.getSelectedShapeIds();n.stackShapes(r,"vertical",16),hf(n,r)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(e){if(!m()||t())return;x("stack-shapes",{operation:"horizontal",source:e}),n.mark("stack-horizontal");let r=n.getSelectedShapeIds();n.stackShapes(r,"horizontal",16),hf(n,r)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(e){m()&&(t()||(x("reorder-shapes",{operation:"toFront",source:e}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(e){m()&&(t()||(x("reorder-shapes",{operation:"forward",source:e}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(e){m()&&(t()||(x("reorder-shapes",{operation:"backward",source:e}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(e){m()&&(t()||(x("reorder-shapes",{operation:"toBack",source:e}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(e){m()&&(t()||(n.mark("cut"),u(e)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(e){m()&&(t()||h(e))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(e){navigator.clipboard?.read().then(t=>{p(t,e,"context-menu"===e?n.inputs.currentPagePoint:void 0)}).catch(()=>{a({title:l("action.paste-error-title"),description:l("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(e){n.run(()=>{t()||(x("select-all-shapes",{source:e}),n.mark("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(e){m()&&(t()||(x("select-none-shapes",{source:e}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",onSelect(e){m()&&(t()||(x("delete-shapes",{source:e}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(e){if(!m()||t())return;x("rotate-cw",{source:e}),n.mark("rotate-cw");let r=n.getSelectionRotation()%(os/2),i=ou(r,0)||ou(r,os/2),o=n.getSelectedShapeIds();n.rotateShapesBy(o,os/2-(i?0:r)),hf(n,o)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(e){if(!m()||t())return;x("rotate-ccw",{source:e}),n.mark("rotate-ccw");let r=n.getSelectionRotation()%(os/2),i=ou(r,0),o=n.getSelectedShapeIds();n.rotateShapesBy(o,i?-(os/2):-r),hf(n,o)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(e){x("zoom-in",{source:e}),n.zoomIn(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(e){x("zoom-out",{source:e}),n.zoomOut(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(e){x("reset-zoom",{source:e}),n.resetZoom(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(e){x("zoom-to-fit",{source:e}),n.zoomToFit({animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(e){m()&&(t()||(x("zoom-to-selection",{source:e}),n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(e){x("toggle-snap-mode",{source:e}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(e){let t=n.user.getIsDarkMode()?"light":"dark";x("color-scheme",{source:e,value:t}),n.user.updateUserPreferences({colorScheme:t})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(e){x("toggle-wrap-mode",{source:e}),n.user.updateUserPreferences({isWrapMode:!n.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(e){x("toggle-dynamic-size-mode",{source:e}),n.user.updateUserPreferences({isDynamicSizeMode:!n.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(e){x("toggle-paste-at-cursor",{source:e}),n.user.updateUserPreferences({isPasteAtCursorMode:!n.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(e){x("toggle-reduce-motion",{source:e}),n.user.updateUserPreferences({animationSpeed:0===n.user.getAnimationSpeed()?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(e){x("toggle-edge-scrolling",{source:e}),n.user.updateUserPreferences({edgeScrollSpeed:0===n.user.getEdgeScrollSpeed()?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(e){x("toggle-transparent",{source:e}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(e){x("toggle-tool-lock",{source:e}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(e){x("unlock-all",{source:e});let t=[];for(let e of n.getCurrentPageShapes())e.isLocked&&t.push({id:e.id,type:e.type,isLocked:!1});t.length>0&&n.updateShapes(t)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(e){n.timers.requestAnimationFrame(()=>{n.run(()=>{x("toggle-focus-mode",{source:e}),o(),s(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(e){x("toggle-grid-mode",{source:e}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(e){x("toggle-debug-mode",{source:e}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(e){x("print",{source:e}),d()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){x("exit-pen-mode",{source:e}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){x("stop-following",{source:e}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){x("zoom-to-content",{source:e});let t=n.getSelectionPageBounds()??n.getCurrentPageBounds();t&&n.zoomToBounds(t,{targetZoom:Math.min(1,n.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(e){n.mark("locking"),x("toggle-lock",{source:e}),n.toggleLock(n.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(e){let t=rb.createId(),r=n.getSelectedShapeIds();n.run(()=>{n.mark("move_shapes_to_page"),n.createPage({name:l("page-menu.new-page-initial-name"),id:t}),n.moveShapesToPage(r,t)}),x("move-to-new-page",{source:e})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(e){n.run(()=>{n.mark("change-color"),n.isIn("select")&&n.setStyleForSelectedShapes(n1,"white"),n.setStyleForNextShapes(n1,"white")}),x("set-style",{source:e,id:n1.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(e){n.run(()=>{n.mark("change-fill"),n.isIn("select")&&n.setStyleForSelectedShapes(n5,"fill"),n.setStyleForNextShapes(n5,"fill")}),x("set-style",{source:e,id:n5.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async e=>{let t=n.getSelectedShapeIds();if(0===t.length)return;n.mark("flattening to image"),x("flatten-to-image",{source:e});let r=await b1(n,t,n.options.flattenImageBoundsExpand);r?.length&&n.setSelectedShapes(r)}}];r&&y.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(e){x("open-cursor-chat",{source:e}),n.getInstanceState().isCoarsePointer||n.timers.requestAnimationFrame(()=>{n.updateInstanceState({isChatting:!0})})}});let v=Object.fromEntries(y.map(e=>[e.id,e]));return e?e(n,v,void 0):v},[n,x,e,i,a,c,g,f,u,h,p,o,s,d,l,b,r]);return(0,m.jsx)(b3.Provider,{value:v,children:t})}function b6(){let e=y.useContext(b3);if(!e)throw Error("useTools must be used within a ToolProvider");return e}function b8(e,t){return e?"string"==typeof e?e:t?e[t]??e.default:void 0:void 0}let b9=["top","right","bottom","left"],b7=Math.min,xe=Math.max,xt=Math.round,xn=Math.floor,xr=e=>({x:e,y:e}),xi={left:"right",right:"left",bottom:"top",top:"bottom"},xo={start:"end",end:"start"};function xs(e,t){return"function"==typeof e?e(t):e}function xa(e){return e.split("-")[0]}function xl(e){return e.split("-")[1]}function xc(e){return"x"===e?"y":"x"}function xd(e){return"y"===e?"height":"width"}let xu=new Set(["top","bottom"]);function xh(e){return xu.has(xa(e))?"y":"x"}function xp(e){return e.replace(/start|end/g,e=>xo[e])}let xf=["left","right"],xg=["right","left"],xm=["top","bottom"],xy=["bottom","top"];function xb(e){return e.replace(/left|right|bottom|top/g,e=>xi[e])}function xx(e){return"number"!=typeof e?{top:0,right:0,bottom:0,left:0,...e}:{top:e,right:e,bottom:e,left:e}}function xv(e){let{x:t,y:n,width:r,height:i}=e;return{width:r,height:i,top:n,left:t,right:t+r,bottom:n+i,x:t,y:n}}function xw(e,t,n){let r,{reference:i,floating:o}=e,s=xh(t),a=xc(xh(t)),l=xd(a),c=xa(t),d="y"===s,u=i.x+i.width/2-o.width/2,h=i.y+i.height/2-o.height/2,p=i[l]/2-o[l]/2;switch(c){case"top":r={x:u,y:i.y-o.height};break;case"bottom":r={x:u,y:i.y+i.height};break;case"right":r={x:i.x+i.width,y:h};break;case"left":r={x:i.x-o.width,y:h};break;default:r={x:i.x,y:i.y}}switch(xl(t)){case"start":r[a]-=p*(n&&d?-1:1);break;case"end":r[a]+=p*(n&&d?-1:1)}return r}async function xS(e,t){var n;void 0===t&&(t={});let{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=e,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:h=!1,padding:p=0}=xs(t,e),f=xx(p),g=a[h?"floating"===u?"reference":"floating":u],m=xv(await o.getClippingRect({element:null==(n=await (null==o.isElement?void 0:o.isElement(g)))||n?g:g.contextElement||await (null==o.getDocumentElement?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),y="floating"===u?{x:r,y:i,width:s.floating.width,height:s.floating.height}:s.reference,b=await (null==o.getOffsetParent?void 0:o.getOffsetParent(a.floating)),x=await (null==o.isElement?void 0:o.isElement(b))&&await (null==o.getScale?void 0:o.getScale(b))||{x:1,y:1},v=xv(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:y,offsetParent:b,strategy:l}):y);return{top:(m.top-v.top+f.top)/x.y,bottom:(v.bottom-m.bottom+f.bottom)/x.y,left:(m.left-v.left+f.left)/x.x,right:(v.right-m.right+f.right)/x.x}}let xk=async(e,t,n)=>{let{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=await (null==s.isRTL?void 0:s.isRTL(t)),c=await s.getElementRects({reference:e,floating:t,strategy:i}),{x:d,y:u}=xw(c,r,l),h=r,p={},f=0;for(let n=0;n<a.length;n++){var g;let{name:o,fn:m}=a[n],{x:y,y:b,data:x,reset:v}=await m({x:d,y:u,initialPlacement:r,placement:h,strategy:i,middlewareData:p,rects:c,platform:{...s,detectOverflow:null!=(g=s.detectOverflow)?g:xS},elements:{reference:e,floating:t}});d=null!=y?y:d,u=null!=b?b:u,p={...p,[o]:{...p[o],...x}},v&&f<=50&&(f++,"object"==typeof v&&(v.placement&&(h=v.placement),v.rects&&(c=!0===v.rects?await s.getElementRects({reference:e,floating:t,strategy:i}):v.rects),{x:d,y:u}=xw(c,h,l)),n=-1)}return{x:d,y:u,placement:h,strategy:i,middlewareData:p}};function xC(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function xP(e){return b9.some(t=>e[t]>=0)}let x_=new Set(["left","top"]);async function xI(e,t){let{placement:n,platform:r,elements:i}=e,o=await (null==r.isRTL?void 0:r.isRTL(i.floating)),s=xa(n),a=xl(n),l="y"===xh(n),c=x_.has(s)?-1:1,d=o&&l?-1:1,u=xs(t,e),{mainAxis:h,crossAxis:p,alignmentAxis:f}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&"number"==typeof f&&(p="end"===a?-1*f:f),l?{x:p*d,y:h*c}:{x:h*c,y:p*d}}function xE(){return"undefined"!=typeof window}function xj(e){return xA(e)?(e.nodeName||"").toLowerCase():"#document"}function xT(e){var t;return(null==e||null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function xM(e){var t;return null==(t=(xA(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function xA(e){return!!xE()&&(e instanceof Node||e instanceof xT(e).Node)}function xO(e){return!!xE()&&(e instanceof Element||e instanceof xT(e).Element)}function xL(e){return!!xE()&&(e instanceof HTMLElement||e instanceof xT(e).HTMLElement)}function xD(e){return!!xE()&&"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof xT(e).ShadowRoot)}let xz=new Set(["inline","contents"]);function xR(e){let{overflow:t,overflowX:n,overflowY:r,display:i}=xq(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!xz.has(i)}let xN=new Set(["table","td","th"]),xF=[":popover-open",":modal"];function x$(e){return xF.some(t=>{try{return e.matches(t)}catch(e){return!1}})}let xB=["transform","translate","scale","rotate","perspective"],xU=["transform","translate","scale","rotate","perspective","filter"],xV=["paint","layout","strict","content"];function xH(e){let t=xK(),n=xO(e)?xq(e):e;return xB.some(e=>!!n[e]&&"none"!==n[e])||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||xU.some(e=>(n.willChange||"").includes(e))||xV.some(e=>(n.contain||"").includes(e))}function xK(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}let xW=new Set(["html","body","#document"]);function xG(e){return xW.has(xj(e))}function xq(e){return xT(e).getComputedStyle(e)}function xY(e){return xO(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function xX(e){if("html"===xj(e))return e;let t=e.assignedSlot||e.parentNode||xD(e)&&e.host||xM(e);return xD(t)?t.host:t}function xZ(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=!0);let i=function e(t){let n=xX(t);return xG(n)?t.ownerDocument?t.ownerDocument.body:t.body:xL(n)&&xR(n)?n:e(n)}(e),o=i===(null==(r=e.ownerDocument)?void 0:r.body),s=xT(i);if(o){let e=xQ(s);return t.concat(s,s.visualViewport||[],xR(i)?i:[],e&&n?xZ(e):[])}return t.concat(i,xZ(i,[],n))}function xQ(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function xJ(e){let t=xq(e),n=parseFloat(t.width)||0,r=parseFloat(t.height)||0,i=xL(e),o=i?e.offsetWidth:n,s=i?e.offsetHeight:r,a=xt(n)!==o||xt(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function x0(e){return xO(e)?e:e.contextElement}function x1(e){let t=x0(e);if(!xL(t))return xr(1);let n=t.getBoundingClientRect(),{width:r,height:i,$:o}=xJ(t),s=(o?xt(n.width):n.width)/r,a=(o?xt(n.height):n.height)/i;return s&&Number.isFinite(s)||(s=1),a&&Number.isFinite(a)||(a=1),{x:s,y:a}}let x2=xr(0);function x3(e){let t=xT(e);return xK()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:x2}function x5(e,t,n,r){var i;void 0===t&&(t=!1),void 0===n&&(n=!1);let o=e.getBoundingClientRect(),s=x0(e),a=xr(1);t&&(r?xO(r)&&(a=x1(r)):a=x1(e));let l=(void 0===(i=n)&&(i=!1),r&&(!i||r===xT(s))&&i)?x3(s):xr(0),c=(o.left+l.x)/a.x,d=(o.top+l.y)/a.y,u=o.width/a.x,h=o.height/a.y;if(s){let e=xT(s),t=r&&xO(r)?xT(r):r,n=e,i=xQ(n);for(;i&&r&&t!==n;){let e=x1(i),t=i.getBoundingClientRect(),r=xq(i),o=t.left+(i.clientLeft+parseFloat(r.paddingLeft))*e.x,s=t.top+(i.clientTop+parseFloat(r.paddingTop))*e.y;c*=e.x,d*=e.y,u*=e.x,h*=e.y,c+=o,d+=s,i=xQ(n=xT(i))}}return xv({width:u,height:h,x:c,y:d})}function x4(e,t){let n=xY(e).scrollLeft;return t?t.left+n:x5(xM(e)).left+n}function x6(e,t){let n=e.getBoundingClientRect();return{x:n.left+t.scrollLeft-x4(e,n),y:n.top+t.scrollTop}}let x8=new Set(["absolute","fixed"]);function x9(e,t,n){let r;if("viewport"===t)r=function(e,t){let n=xT(e),r=xM(e),i=n.visualViewport,o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;let e=xK();(!e||e&&"fixed"===t)&&(a=i.offsetLeft,l=i.offsetTop)}let c=x4(r);if(c<=0){let e=r.ownerDocument,t=e.body,n=getComputedStyle(t),i="CSS1Compat"===e.compatMode&&parseFloat(n.marginLeft)+parseFloat(n.marginRight)||0,s=Math.abs(r.clientWidth-t.clientWidth-i);s<=25&&(o-=s)}else c<=25&&(o+=c);return{width:o,height:s,x:a,y:l}}(e,n);else if("document"===t)r=function(e){let t=xM(e),n=xY(e),r=e.ownerDocument.body,i=xe(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=xe(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),s=-n.scrollLeft+x4(e),a=-n.scrollTop;return"rtl"===xq(r).direction&&(s+=xe(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}(xM(e));else if(xO(t))r=function(e,t){let n=x5(e,!0,"fixed"===t),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=xL(e)?x1(e):xr(1),s=e.clientWidth*o.x;return{width:s,height:e.clientHeight*o.y,x:i*o.x,y:r*o.y}}(t,n);else{let n=x3(e);r={x:t.x-n.x,y:t.y-n.y,width:t.width,height:t.height}}return xv(r)}function x7(e){return"static"===xq(e).position}function ve(e,t){if(!xL(e)||"fixed"===xq(e).position)return null;if(t)return t(e);let n=e.offsetParent;return xM(e)===n&&(n=n.ownerDocument.body),n}function vt(e,t){var n;let r=xT(e);if(x$(e))return r;if(!xL(e)){let t=xX(e);for(;t&&!xG(t);){if(xO(t)&&!x7(t))return t;t=xX(t)}return r}let i=ve(e,t);for(;i&&(n=i,xN.has(xj(n)))&&x7(i);)i=ve(i,t);return i&&xG(i)&&x7(i)&&!xH(i)?r:i||function(e){let t=xX(e);for(;xL(t)&&!xG(t);){if(xH(t))return t;if(x$(t))break;t=xX(t)}return null}(e)||r}let vn=async function(e){let t=this.getOffsetParent||vt,n=this.getDimensions,r=await n(e.floating);return{reference:function(e,t,n){let r=xL(t),i=xM(t),o="fixed"===n,s=x5(e,!0,o,t),a={scrollLeft:0,scrollTop:0},l=xr(0);if(r||!r&&!o){if(("body"!==xj(t)||xR(i))&&(a=xY(t)),r){let e=x5(t,!0,o,t);l.x=e.x+t.clientLeft,l.y=e.y+t.clientTop}else i&&(l.x=x4(i))}o&&!r&&i&&(l.x=x4(i));let c=!i||r||o?xr(0):x6(i,a);return{x:s.left+a.scrollLeft-l.x-c.x,y:s.top+a.scrollTop-l.y-c.y,width:s.width,height:s.height}}(e.reference,await t(e.floating),e.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}},vr={convertOffsetParentRelativeRectToViewportRelativeRect:function(e){let{elements:t,rect:n,offsetParent:r,strategy:i}=e,o="fixed"===i,s=xM(r),a=!!t&&x$(t.floating);if(r===s||a&&o)return n;let l={scrollLeft:0,scrollTop:0},c=xr(1),d=xr(0),u=xL(r);if((u||!u&&!o)&&(("body"!==xj(r)||xR(s))&&(l=xY(r)),xL(r))){let e=x5(r);c=x1(r),d.x=e.x+r.clientLeft,d.y=e.y+r.clientTop}let h=!s||u||o?xr(0):x6(s,l);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+d.x+h.x,y:n.y*c.y-l.scrollTop*c.y+d.y+h.y}},getDocumentElement:xM,getClippingRect:function(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e,o=[..."clippingAncestors"===n?x$(t)?[]:function(e,t){let n=t.get(e);if(n)return n;let r=xZ(e,[],!1).filter(e=>xO(e)&&"body"!==xj(e)),i=null,o="fixed"===xq(e).position,s=o?xX(e):e;for(;xO(s)&&!xG(s);){let t=xq(s),n=xH(s);n||"fixed"!==t.position||(i=null),(o?!n&&!i:!n&&"static"===t.position&&!!i&&x8.has(i.position)||xR(s)&&!n&&function e(t,n){let r=xX(t);return!(r===n||!xO(r)||xG(r))&&("fixed"===xq(r).position||e(r,n))}(e,s))?r=r.filter(e=>e!==s):i=t,s=xX(s)}return t.set(e,r),r}(t,this._c):[].concat(n),r],s=o[0],a=o.reduce((e,n)=>{let r=x9(t,n,i);return e.top=xe(r.top,e.top),e.right=b7(r.right,e.right),e.bottom=b7(r.bottom,e.bottom),e.left=xe(r.left,e.left),e},x9(t,s,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:vt,getElementRects:vn,getClientRects:function(e){return Array.from(e.getClientRects())},getDimensions:function(e){let{width:t,height:n}=xJ(e);return{width:t,height:n}},getScale:x1,isElement:xO,isRTL:function(e){return"rtl"===xq(e).direction}};function vi(e,t){return e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height}let vo=e=>({name:"arrow",options:e,async fn(t){let{x:n,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=t,{element:c,padding:d=0}=xs(e,t)||{};if(null==c)return{};let u=xx(d),h={x:n,y:r},p=xc(xh(i)),f=xd(p),g=await s.getDimensions(c),m="y"===p,y=m?"clientHeight":"clientWidth",b=o.reference[f]+o.reference[p]-h[p]-o.floating[f],x=h[p]-o.reference[p],v=await (null==s.getOffsetParent?void 0:s.getOffsetParent(c)),w=v?v[y]:0;w&&await (null==s.isElement?void 0:s.isElement(v))||(w=a.floating[y]||o.floating[f]);let S=w/2-g[f]/2-1,k=b7(u[m?"top":"left"],S),C=b7(u[m?"bottom":"right"],S),P=w-g[f]-C,_=w/2-g[f]/2+(b/2-x/2),I=xe(k,b7(_,P)),E=!l.arrow&&null!=xl(i)&&_!==I&&o.reference[f]/2-(_<k?k:C)-g[f]/2<0,j=E?_<k?_-k:_-P:0;return{[p]:h[p]+j,data:{[p]:I,centerOffset:_-I-j,...E&&{alignmentOffset:j}},reset:E}}}),vs=(e,t,n)=>{let r=new Map,i={platform:vr,...n},o={...i.platform,_c:r};return xk(e,t,{...i,platform:o})};var va="undefined"!=typeof document?y.useLayoutEffect:function(){};function vl(e,t){let n,r,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((n=e.length)!==t.length)return!1;for(r=n;0!=r--;)if(!vl(e[r],t[r]))return!1;return!0}if((n=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!({}).hasOwnProperty.call(t,i[r]))return!1;for(r=n;0!=r--;){let n=i[r];if(("_owner"!==n||!e.$$typeof)&&!vl(e[n],t[n]))return!1}return!0}return e!=e&&t!=t}function vc(e){return"undefined"==typeof window?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function vd(e,t){let n=vc(e);return Math.round(t*n)/n}function vu(e){let t=y.useRef(e);return va(()=>{t.current=e}),t}let vh=e=>({name:"arrow",options:e,fn(t){let{element:n,padding:r}="function"==typeof e?e(t):e;return n&&({}).hasOwnProperty.call(n,"current")?null!=n.current?vo({element:n.current,padding:r}).fn(t):{}:n?vo({element:n,padding:r}).fn(t):{}}}),vp=(e,t)=>({...function(e){return void 0===e&&(e=0),{name:"offset",options:e,async fn(t){var n,r;let{x:i,y:o,placement:s,middlewareData:a}=t,l=await xI(t,e);return s===(null==(n=a.offset)?void 0:n.placement)&&null!=(r=a.arrow)&&r.alignmentOffset?{}:{x:i+l.x,y:o+l.y,data:{...l,placement:s}}}}}(e),options:[e,t]}),vf=(e,t)=>({...function(e){return void 0===e&&(e={}),{name:"shift",options:e,async fn(t){let{x:n,y:r,placement:i,platform:o}=t,{mainAxis:s=!0,crossAxis:a=!1,limiter:l={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...c}=xs(e,t),d={x:n,y:r},u=await o.detectOverflow(t,c),h=xh(xa(i)),p=xc(h),f=d[p],g=d[h];if(s){let e="y"===p?"top":"left",t="y"===p?"bottom":"right",n=f+u[e],r=f-u[t];f=xe(n,b7(f,r))}if(a){let e="y"===h?"top":"left",t="y"===h?"bottom":"right",n=g+u[e],r=g-u[t];g=xe(n,b7(g,r))}let m=l.fn({...t,[p]:f,[h]:g});return{...m,data:{x:m.x-n,y:m.y-r,enabled:{[p]:s,[h]:a}}}}}}(e),options:[e,t]}),vg=(e,t)=>({...function(e){return void 0===e&&(e={}),{options:e,fn(t){let{x:n,y:r,placement:i,rects:o,middlewareData:s}=t,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=xs(e,t),d={x:n,y:r},u=xh(i),h=xc(u),p=d[h],f=d[u],g=xs(a,t),m="number"==typeof g?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(l){let e="y"===h?"height":"width",t=o.reference[h]-o.floating[e]+m.mainAxis,n=o.reference[h]+o.reference[e]-m.mainAxis;p<t?p=t:p>n&&(p=n)}if(c){var y,b;let e="y"===h?"width":"height",t=x_.has(xa(i)),n=o.reference[u]-o.floating[e]+(t&&(null==(y=s.offset)?void 0:y[u])||0)+(t?0:m.crossAxis),r=o.reference[u]+o.reference[e]+(t?0:(null==(b=s.offset)?void 0:b[u])||0)-(t?m.crossAxis:0);f<n?f=n:f>r&&(f=r)}return{[h]:p,[u]:f}}}}(e),options:[e,t]}),vm=(e,t)=>({...function(e){return void 0===e&&(e={}),{name:"flip",options:e,async fn(t){var n,r,i,o,s;let{placement:a,middlewareData:l,rects:c,initialPlacement:d,platform:u,elements:h}=t,{mainAxis:p=!0,crossAxis:f=!0,fallbackPlacements:g,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:b=!0,...x}=xs(e,t);if(null!=(n=l.arrow)&&n.alignmentOffset)return{};let v=xa(a),w=xh(d),S=xa(d)===d,k=await (null==u.isRTL?void 0:u.isRTL(h.floating)),C=g||(S||!b?[xb(d)]:function(e){let t=xb(e);return[xp(e),t,xp(t)]}(d)),P="none"!==y;!g&&P&&C.push(...function(e,t,n,r){let i=xl(e),o=function(e,t,n){switch(e){case"top":case"bottom":if(n)return t?xg:xf;return t?xf:xg;case"left":case"right":return t?xm:xy;default:return[]}}(xa(e),"start"===n,r);return i&&(o=o.map(e=>e+"-"+i),t&&(o=o.concat(o.map(xp)))),o}(d,b,y,k));let _=[d,...C],I=await u.detectOverflow(t,x),E=[],j=(null==(r=l.flip)?void 0:r.overflows)||[];if(p&&E.push(I[v]),f){let e=function(e,t,n){void 0===n&&(n=!1);let r=xl(e),i=xc(xh(e)),o=xd(i),s="x"===i?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[o]>t.floating[o]&&(s=xb(s)),[s,xb(s)]}(a,c,k);E.push(I[e[0]],I[e[1]])}if(j=[...j,{placement:a,overflows:E}],!E.every(e=>e<=0)){let e=((null==(i=l.flip)?void 0:i.index)||0)+1,t=_[e];if(t&&(!("alignment"===f&&w!==xh(t))||j.every(e=>xh(e.placement)!==w||e.overflows[0]>0)))return{data:{index:e,overflows:j},reset:{placement:t}};let n=null==(o=j.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:o.placement;if(!n)switch(m){case"bestFit":{let e=null==(s=j.filter(e=>{if(P){let t=xh(e.placement);return t===w||"y"===t}return!0}).map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:s[0];e&&(n=e);break}case"initialPlacement":n=d}if(a!==n)return{reset:{placement:n}}}return{}}}}(e),options:[e,t]}),vy=(e,t)=>({...function(e){return void 0===e&&(e={}),{name:"size",options:e,async fn(t){var n,r;let i,o;let{placement:s,rects:a,platform:l,elements:c}=t,{apply:d=()=>{},...u}=xs(e,t),h=await l.detectOverflow(t,u),p=xa(s),f=xl(s),g="y"===xh(s),{width:m,height:y}=a.floating;"top"===p||"bottom"===p?(i=p,o=f===(await (null==l.isRTL?void 0:l.isRTL(c.floating))?"start":"end")?"left":"right"):(o=p,i="end"===f?"top":"bottom");let b=y-h.top-h.bottom,x=m-h.left-h.right,v=b7(y-h[i],b),w=b7(m-h[o],x),S=!t.middlewareData.shift,k=v,C=w;if(null!=(n=t.middlewareData.shift)&&n.enabled.x&&(C=x),null!=(r=t.middlewareData.shift)&&r.enabled.y&&(k=b),S&&!f){let e=xe(h.left,0),t=xe(h.right,0),n=xe(h.top,0),r=xe(h.bottom,0);g?C=m-2*(0!==e||0!==t?e+t:xe(h.left,h.right)):k=y-2*(0!==n||0!==r?n+r:xe(h.top,h.bottom))}await d({...t,availableWidth:C,availableHeight:k});let P=await l.getDimensions(c.floating);return m!==P.width||y!==P.height?{reset:{rects:!0}}:{}}}}(e),options:[e,t]}),vb=(e,t)=>({...function(e){return void 0===e&&(e={}),{name:"hide",options:e,async fn(t){let{rects:n,platform:r}=t,{strategy:i="referenceHidden",...o}=xs(e,t);switch(i){case"referenceHidden":{let e=xC(await r.detectOverflow(t,{...o,elementContext:"reference"}),n.reference);return{data:{referenceHiddenOffsets:e,referenceHidden:xP(e)}}}case"escaped":{let e=xC(await r.detectOverflow(t,{...o,altBoundary:!0}),n.floating);return{data:{escapedOffsets:e,escaped:xP(e)}}}default:return{}}}}}(e),options:[e,t]}),vx=(e,t)=>({...vh(e),options:[e,t]});var vv=y.forwardRef((e,t)=>{let{children:n,width:r=10,height:i=5,...o}=e;return(0,m.jsx)(gT.svg,{...o,ref:t,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?n:(0,m.jsx)("polygon",{points:"0,0 30,0 15,10"})})});function vw(e){let[t,n]=y.useState(void 0);return gw(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let r,i;if(!Array.isArray(t)||!t.length)return;let o=t[0];if("borderBoxSize"in o){let e=o.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,i=t.blockSize}else r=e.offsetWidth,i=e.offsetHeight;n({width:r,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}vv.displayName="Arrow";var vS="Popper",[vk,vC]=gv(vS),[vP,v_]=vk(vS),vI=e=>{let{__scopePopper:t,children:n}=e,[r,i]=y.useState(null);return(0,m.jsx)(vP,{scope:t,anchor:r,onAnchorChange:i,children:n})};vI.displayName=vS;var vE="PopperAnchor",vj=y.forwardRef((e,t)=>{let{__scopePopper:n,virtualRef:r,...i}=e,o=v_(vE,n),s=y.useRef(null),a=gx(t,s),l=y.useRef(null);return y.useEffect(()=>{let e=l.current;l.current=r?.current||s.current,e!==l.current&&o.onAnchorChange(l.current)}),r?null:(0,m.jsx)(gT.div,{...i,ref:a})});vj.displayName=vE;var vT="PopperContent",[vM,vA]=vk(vT),vO=y.forwardRef((e,t)=>{let{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:o="center",alignOffset:s=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:d=0,sticky:u="partial",hideWhenDetached:h=!1,updatePositionStrategy:p="optimized",onPlaced:f,...g}=e,b=v_(vT,n),[x,v]=y.useState(null),w=gx(t,e=>v(e)),[S,k]=y.useState(null),C=vw(S),P=C?.width??0,_=C?.height??0,I="number"==typeof d?d:{top:0,right:0,bottom:0,left:0,...d},E=Array.isArray(c)?c:[c],j=E.length>0,T={padding:I,boundary:E.filter(vR),altBoundary:j},{refs:M,floatingStyles:A,placement:O,isPositioned:L,middlewareData:D}=function(e){void 0===e&&(e={});let{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=e,[d,u]=y.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[h,p]=y.useState(r);vl(h,r)||p(r);let[f,g]=y.useState(null),[m,b]=y.useState(null),x=y.useCallback(e=>{e!==k.current&&(k.current=e,g(e))},[]),v=y.useCallback(e=>{e!==C.current&&(C.current=e,b(e))},[]),w=o||f,S=s||m,k=y.useRef(null),C=y.useRef(null),P=y.useRef(d),_=null!=l,I=vu(l),E=vu(i),j=vu(c),T=y.useCallback(()=>{if(!k.current||!C.current)return;let e={placement:t,strategy:n,middleware:h};E.current&&(e.platform=E.current),vs(k.current,C.current,e).then(e=>{let t={...e,isPositioned:!1!==j.current};M.current&&!vl(P.current,t)&&(P.current=t,a8.flushSync(()=>{u(t)}))})},[h,t,n,E,j]);va(()=>{!1===c&&P.current.isPositioned&&(P.current.isPositioned=!1,u(e=>({...e,isPositioned:!1})))},[c]);let M=y.useRef(!1);va(()=>(M.current=!0,()=>{M.current=!1}),[]),va(()=>{if(w&&(k.current=w),S&&(C.current=S),w&&S){if(I.current)return I.current(w,S,T);T()}},[w,S,T,I,_]);let A=y.useMemo(()=>({reference:k,floating:C,setReference:x,setFloating:v}),[x,v]),O=y.useMemo(()=>({reference:w,floating:S}),[w,S]),L=y.useMemo(()=>{let e={position:n,left:0,top:0};if(!O.floating)return e;let t=vd(O.floating,d.x),r=vd(O.floating,d.y);return a?{...e,transform:"translate("+t+"px, "+r+"px)",...vc(O.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:t,top:r}},[n,a,O.floating,d.x,d.y]);return y.useMemo(()=>({...d,update:T,refs:A,elements:O,floatingStyles:L}),[d,T,A,O,L])}({strategy:"fixed",placement:r+("center"!==o?"-"+o:""),whileElementsMounted:(...e)=>(function(e,t,n,r){let i;void 0===r&&(r={});let{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:a="function"==typeof ResizeObserver,layoutShift:l="function"==typeof IntersectionObserver,animationFrame:c=!1}=r,d=x0(e),u=o||s?[...d?xZ(d):[],...xZ(t)]:[];u.forEach(e=>{o&&e.addEventListener("scroll",n,{passive:!0}),s&&e.addEventListener("resize",n)});let h=d&&l?function(e,t){let n,r=null,i=xM(e);function o(){var e;clearTimeout(n),null==(e=r)||e.disconnect(),r=null}return function s(a,l){void 0===a&&(a=!1),void 0===l&&(l=1),o();let c=e.getBoundingClientRect(),{left:d,top:u,width:h,height:p}=c;if(a||t(),!h||!p)return;let f=xn(u),g=xn(i.clientWidth-(d+h)),m={rootMargin:-f+"px "+-g+"px "+-xn(i.clientHeight-(u+p))+"px "+-xn(d)+"px",threshold:xe(0,b7(1,l))||1},y=!0;function b(t){let r=t[0].intersectionRatio;if(r!==l){if(!y)return s();r?s(!1,r):n=setTimeout(()=>{s(!1,1e-7)},1e3)}1!==r||vi(c,e.getBoundingClientRect())||s(),y=!1}try{r=new IntersectionObserver(b,{...m,root:i.ownerDocument})}catch(e){r=new IntersectionObserver(b,m)}r.observe(e)}(!0),o}(d,n):null,p=-1,f=null;a&&(f=new ResizeObserver(e=>{let[r]=e;r&&r.target===d&&f&&(f.unobserve(t),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var e;null==(e=f)||e.observe(t)})),n()}),d&&!c&&f.observe(d),f.observe(t));let g=c?x5(e):null;return c&&function t(){let r=x5(e);g&&!vi(g,r)&&n(),g=r,i=requestAnimationFrame(t)}(),n(),()=>{var e;u.forEach(e=>{o&&e.removeEventListener("scroll",n),s&&e.removeEventListener("resize",n)}),null==h||h(),null==(e=f)||e.disconnect(),f=null,c&&cancelAnimationFrame(i)}})(...e,{animationFrame:"always"===p}),elements:{reference:b.anchor},middleware:[vp({mainAxis:i+_,alignmentAxis:s}),l&&vf({mainAxis:!0,crossAxis:!1,limiter:"partial"===u?vg():void 0,...T}),l&&vm({...T}),vy({...T,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{let{width:i,height:o}=t.reference,s=e.floating.style;s.setProperty("--radix-popper-available-width",`${n}px`),s.setProperty("--radix-popper-available-height",`${r}px`),s.setProperty("--radix-popper-anchor-width",`${i}px`),s.setProperty("--radix-popper-anchor-height",`${o}px`)}}),S&&vx({element:S,padding:a}),vN({arrowWidth:P,arrowHeight:_}),h&&vb({strategy:"referenceHidden",...T})]}),[z,R]=vF(O),N=gA(f);gw(()=>{L&&N?.()},[L,N]);let F=D.arrow?.x,$=D.arrow?.y,B=D.arrow?.centerOffset!==0,[U,V]=y.useState();return gw(()=>{x&&V(window.getComputedStyle(x).zIndex)},[x]),(0,m.jsx)("div",{ref:M.setFloating,"data-radix-popper-content-wrapper":"",style:{...A,transform:L?A.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:U,"--radix-popper-transform-origin":[D.transformOrigin?.x,D.transformOrigin?.y].join(" "),...D.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:(0,m.jsx)(vM,{scope:n,placedSide:z,onArrowChange:k,arrowX:F,arrowY:$,shouldHideArrow:B,children:(0,m.jsx)(gT.div,{"data-side":z,"data-align":R,...g,ref:w,style:{...g.style,animation:L?void 0:"none"}})})})});vO.displayName=vT;var vL="PopperArrow",vD={top:"bottom",right:"left",bottom:"top",left:"right"},vz=y.forwardRef(function(e,t){let{__scopePopper:n,...r}=e,i=vA(vL,n),o=vD[i.placedSide];return(0,m.jsx)("span",{ref:i.onArrowChange,style:{position:"absolute",left:i.arrowX,top:i.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[i.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[i.placedSide],visibility:i.shouldHideArrow?"hidden":void 0},children:(0,m.jsx)(vv,{...r,ref:t,style:{...r.style,display:"block"}})})});function vR(e){return null!==e}vz.displayName=vL;var vN=e=>({name:"transformOrigin",options:e,fn(t){let{placement:n,rects:r,middlewareData:i}=t,o=i.arrow?.centerOffset!==0,s=o?0:e.arrowWidth,a=o?0:e.arrowHeight,[l,c]=vF(n),d={start:"0%",center:"50%",end:"100%"}[c],u=(i.arrow?.x??0)+s/2,h=(i.arrow?.y??0)+a/2,p="",f="";return"bottom"===l?(p=o?d:`${u}px`,f=`${-a}px`):"top"===l?(p=o?d:`${u}px`,f=`${r.floating.height+a}px`):"right"===l?(p=`${-a}px`,f=o?d:`${h}px`):"left"===l&&(p=`${r.floating.width+a}px`,f=o?d:`${h}px`),{data:{x:p,y:f}}}});function vF(e){let[t,n="center"]=e.split("-");return[t,n]}var v$="Popover",[vB,vU]=gv(v$,[vC]),vV=vC(),[vH,vK]=vB(v$),vW=e=>{let{__scopePopover:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!1}=e,a=vV(t),l=y.useRef(null),[c,d]=y.useState(!1),[u,h]=g_({prop:r,defaultProp:i??!1,onChange:o,caller:v$});return(0,m.jsx)(vI,{...a,children:(0,m.jsx)(vH,{scope:t,contentId:gC(),triggerRef:l,open:u,onOpenChange:h,onOpenToggle:y.useCallback(()=>h(e=>!e),[h]),hasCustomAnchor:c,onCustomAnchorAdd:y.useCallback(()=>d(!0),[]),onCustomAnchorRemove:y.useCallback(()=>d(!1),[]),modal:s,children:n})})};vW.displayName=v$;var vG="PopoverAnchor";y.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=vK(vG,n),o=vV(n),{onCustomAnchorAdd:s,onCustomAnchorRemove:a}=i;return y.useEffect(()=>(s(),()=>a()),[s,a]),(0,m.jsx)(vj,{...o,...r,ref:t})}).displayName=vG;var vq="PopoverTrigger",vY=y.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=vK(vq,n),o=vV(n),s=gx(t,i.triggerRef),a=(0,m.jsx)(gT.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":v8(i.open),...r,ref:s,onClick:gm(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?a:(0,m.jsx)(vj,{asChild:!0,...o,children:a})});vY.displayName=vq;var vX="PopoverPortal",[vZ,vQ]=vB(vX,{forceMount:void 0}),vJ=e=>{let{__scopePopover:t,forceMount:n,children:r,container:i}=e,o=vK(vX,t);return(0,m.jsx)(vZ,{scope:t,forceMount:n,children:(0,m.jsx)(gY,{present:n||o.open,children:(0,m.jsx)(gq,{asChild:!0,container:i,children:r})})})};vJ.displayName=vX;var v0="PopoverContent",v1=y.forwardRef((e,t)=>{let n=vQ(v0,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,o=vK(v0,e.__scopePopover);return(0,m.jsx)(gY,{present:r||o.open,children:o.modal?(0,m.jsx)(v3,{...i,ref:t}):(0,m.jsx)(v5,{...i,ref:t})})});v1.displayName=v0;var v2=gI("PopoverContent.RemoveScroll"),v3=y.forwardRef((e,t)=>{let n=vK(v0,e.__scopePopover),r=y.useRef(null),i=gx(t,r),o=y.useRef(!1);return y.useEffect(()=>{let e=r.current;if(e)return mz(e)},[]),(0,m.jsx)(mj,{as:v2,allowPinchZoom:!0,children:(0,m.jsx)(v4,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:gm(e.onCloseAutoFocus,e=>{e.preventDefault(),o.current||n.triggerRef.current?.focus()}),onPointerDownOutside:gm(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;o.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:gm(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),v5=y.forwardRef((e,t)=>{let n=vK(v0,e.__scopePopover),r=y.useRef(!1),i=y.useRef(!1);return(0,m.jsx)(v4,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),t.defaultPrevented||(r.current||n.triggerRef.current?.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||(r.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let o=t.target;n.triggerRef.current?.contains(o)&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}})}),v4=y.forwardRef((e,t)=>{let{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:d,...u}=e,h=vK(v0,n),p=vV(n);return gQ(),(0,m.jsx)(gU,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o,children:(0,m.jsx)(gD,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>h.onOpenChange(!1),children:(0,m.jsx)(vO,{"data-state":v8(h.open),role:"dialog",id:h.contentId,...p,...u,ref:t,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),v6="PopoverClose";function v8(e){return e?"open":"closed"}function v9(e,t){let n=i8(),r=(0,y.useRef)(!1),i=ya(),o=(0,y.useCallback)(i=>{r.current=i,n.run(()=>{i?(n.complete(),n.addOpenMenu(e)):n.updateInstanceState({openMenus:n.getOpenMenus().filter(t=>!t.startsWith(e))}),t?.(i)})},[n,e,t]),s=iJ("is menu open",()=>n.getOpenMenus().includes(e),[n,e]);return(0,y.useEffect)(()=>(r.current&&(i("open-menu",{source:"unknown",id:e}),n.addOpenMenu(e)),()=>{r.current&&(n.deleteOpenMenu(e),n.getOpenMenus().forEach(t=>{t.startsWith(e)&&(i("close-menu",{source:"unknown",id:e}),n.deleteOpenMenu(t))}),r.current=!1)}),[n,e,i]),[s,o]}function v7({id:e,children:t,onOpenChange:n,open:r}){let[i,o]=v9(e,n);return(0,m.jsx)(vW,{onOpenChange:o,open:r||i,children:(0,m.jsx)("div",{className:"tlui-popover",children:t})})}function we({children:e}){return(0,m.jsx)(vY,{asChild:!0,dir:"ltr",children:e})}function wt({side:e,children:t,align:n="center",sideOffset:r=8,alignOffset:i=0}){let o=oK();return(0,m.jsx)(vJ,{container:o,children:(0,m.jsx)(v1,{className:"tlui-popover__content",side:e,sideOffset:r,align:n,alignOffset:i,dir:"ltr",children:t})})}y.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=vK(v6,n);return(0,m.jsx)(gT.button,{type:"button",...r,ref:t,onClick:gm(e.onClick,()=>i.onOpenChange(!1))})}).displayName=v6,y.forwardRef((e,t)=>{let{__scopePopover:n,...r}=e,i=vV(n);return(0,m.jsx)(vz,{...i,...r,ref:t})}).displayName="PopoverArrow";let wn=(0,y.createContext)(null);function wr(){let e=(0,y.useContext)(wn);if(!e)throw Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return e}function wi({type:e,sourceId:t,children:n}){return(0,m.jsx)(wn.Provider,{value:{type:e,sourceId:t},children:n})}let wo=()=>{let e=i8();return iJ("threeStackableItems",()=>(function(e){return e.getSelectedShapeIds().map(t=>e.getShape(t)).filter(t=>{if(!t)return!1;if(e.isShapeOfType(t,"arrow")){let n=ug(e,t);if(n.start||n.end)return!1}return!0})})(e).length>2,[e])},ws=()=>{let e=i8();return iJ("isInSelectState",()=>e.isIn("select"),[e])},wa=()=>{let e=i8();return iJ("allow group",()=>{let t=e.getSelectedShapes();if(t.length<2)return!1;for(let n of t)if(e.isShapeOfType(n,"arrow")){let r=ug(e,n);if(r.start&&!t.some(e=>e.id===r.start.toId)||r.end&&!t.some(e=>e.id===r.end.toId))return!1}return!0},[e])},wl=()=>{let e=i8();return iJ("allowUngroup",()=>e.getSelectedShapeIds().some(t=>e.getShape(t)?.type==="group"),[e])},wc="undefined"!=typeof window&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function wd(e,t){let n=i8();return iJ("selectedShapes",()=>{let r=n.getSelectedShapes().length;return void 0===e?void 0===t?r:r<=t:void 0===t?r>=e:r>=e&&r<=t},[n,e,t])}function wu(e,t){let n=i8();return iJ("selectedShapes",()=>{let r=n.getSelectedShapes().filter(e=>!n.isShapeOrAncestorLocked(e)).length;return void 0===e?void 0===t?r:r<=t:void 0===t?r>=e:r>=e&&r<=t},[n])}function wh(){let e=i8();return iJ("hasLinkShapeSelected",()=>{let t=e.getOnlySelectedShape();return!!(t&&"embed"!==t.type&&"url"in t.props&&!t.isLocked)},[e])}function wp(){let e=i8();return iJ("useCanRedo",()=>e.getCanRedo(),[e])}function wf(){let e=i8();return iJ("useCanUndo",()=>e.getCanUndo(),[e])}var wg=y.createContext(void 0);function wm(e){let t=y.useContext(wg);return e||t||"ltr"}var wy="rovingFocusGroup.onEntryFocus",wb={bubbles:!1,cancelable:!0},wx="RovingFocusGroup",[wv,ww,wS]=yg(wx),[wk,wC]=gv(wx,[wS]),[wP,w_]=wk(wx),wI=y.forwardRef((e,t)=>(0,m.jsx)(wv.Provider,{scope:e.__scopeRovingFocusGroup,children:(0,m.jsx)(wv.Slot,{scope:e.__scopeRovingFocusGroup,children:(0,m.jsx)(wE,{...e,ref:t})})}));wI.displayName=wx;var wE=y.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...u}=e,h=y.useRef(null),p=gx(t,h),f=wm(o),[g,b]=g_({prop:s,defaultProp:a??null,onChange:l,caller:wx}),[x,v]=y.useState(!1),w=gA(c),S=ww(n),k=y.useRef(!1),[C,P]=y.useState(0);return y.useEffect(()=>{let e=h.current;if(e)return e.addEventListener(wy,w),()=>e.removeEventListener(wy,w)},[w]),(0,m.jsx)(wP,{scope:n,orientation:r,dir:f,loop:i,currentTabStopId:g,onItemFocus:y.useCallback(e=>b(e),[b]),onItemShiftTab:y.useCallback(()=>v(!0),[]),onFocusableItemAdd:y.useCallback(()=>P(e=>e+1),[]),onFocusableItemRemove:y.useCallback(()=>P(e=>e-1),[]),children:(0,m.jsx)(gT.div,{tabIndex:x||0===C?-1:0,"data-orientation":r,...u,ref:p,style:{outline:"none",...e.style},onMouseDown:gm(e.onMouseDown,()=>{k.current=!0}),onFocus:gm(e.onFocus,e=>{let t=!k.current;if(e.target===e.currentTarget&&t&&!x){let t=new CustomEvent(wy,wb);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=S().filter(e=>e.focusable);wA([e.find(e=>e.active),e.find(e=>e.id===g),...e].filter(Boolean).map(e=>e.ref.current),d)}}k.current=!1}),onBlur:gm(e.onBlur,()=>v(!1))})})}),wj="RovingFocusGroupItem",wT=y.forwardRef((e,t)=>{let{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,children:s,...a}=e,l=gC(),c=o||l,d=w_(wj,n),u=d.currentTabStopId===c,h=ww(n),{onFocusableItemAdd:p,onFocusableItemRemove:f,currentTabStopId:g}=d;return y.useEffect(()=>{if(r)return p(),()=>f()},[r,p,f]),(0,m.jsx)(wv.ItemSlot,{scope:n,id:c,focusable:r,active:i,children:(0,m.jsx)(gT.span,{tabIndex:u?0:-1,"data-orientation":d.orientation,...a,ref:t,onMouseDown:gm(e.onMouseDown,e=>{r?d.onItemFocus(c):e.preventDefault()}),onFocus:gm(e.onFocus,()=>d.onItemFocus(c)),onKeyDown:gm(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){d.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=function(e,t,n){var r;let i=(r=e.key,"rtl"!==n?r:"ArrowLeft"===r?"ArrowRight":"ArrowRight"===r?"ArrowLeft":r);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(i))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(i)))return wM[i]}(e,d.orientation,d.dir);if(void 0!==t){if(e.metaKey||e.ctrlKey||e.altKey||e.shiftKey)return;e.preventDefault();let n=h().filter(e=>e.focusable).map(e=>e.ref.current);if("last"===t)n.reverse();else if("prev"===t||"next"===t){"prev"===t&&n.reverse();let r=n.indexOf(e.currentTarget);n=d.loop?function(e,t){return e.map((n,r)=>e[(t+r)%e.length])}(n,r+1):n.slice(r+1)}setTimeout(()=>wA(n))}}),children:"function"==typeof s?s({isCurrentTabStop:u,hasTabStop:null!=g}):s})})});wT.displayName=wj;var wM={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function wA(e,t=!1){let n=document.activeElement;for(let r of e)if(r===n||(r.focus({preventScroll:t}),document.activeElement!==n))return}var wO=["Enter"," "],wL=["ArrowUp","PageDown","End"],wD=["ArrowDown","PageUp","Home",...wL],wz={ltr:[...wO,"ArrowRight"],rtl:[...wO,"ArrowLeft"]},wR={ltr:["ArrowLeft"],rtl:["ArrowRight"]},wN="Menu",[wF,w$,wB]=yg(wN),[wU,wV]=gv(wN,[wB,vC,wC]),wH=vC(),wK=wC(),[wW,wG]=wU(wN),[wq,wY]=wU(wN),wX=e=>{let{__scopeMenu:t,open:n=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=e,a=wH(t),[l,c]=y.useState(null),d=y.useRef(!1),u=gA(o),h=wm(i);return y.useEffect(()=>{let e=()=>{d.current=!0,document.addEventListener("pointerdown",t,{capture:!0,once:!0}),document.addEventListener("pointermove",t,{capture:!0,once:!0})},t=()=>d.current=!1;return document.addEventListener("keydown",e,{capture:!0}),()=>{document.removeEventListener("keydown",e,{capture:!0}),document.removeEventListener("pointerdown",t,{capture:!0}),document.removeEventListener("pointermove",t,{capture:!0})}},[]),(0,m.jsx)(vI,{...a,children:(0,m.jsx)(wW,{scope:t,open:n,onOpenChange:u,content:l,onContentChange:c,children:(0,m.jsx)(wq,{scope:t,onClose:y.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:h,modal:s,children:r})})})};wX.displayName=wN;var wZ=y.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e,i=wH(n);return(0,m.jsx)(vj,{...i,...r,ref:t})});wZ.displayName="MenuAnchor";var wQ="MenuPortal",[wJ,w0]=wU(wQ,{forceMount:void 0}),w1=e=>{let{__scopeMenu:t,forceMount:n,children:r,container:i}=e,o=wG(wQ,t);return(0,m.jsx)(wJ,{scope:t,forceMount:n,children:(0,m.jsx)(gY,{present:n||o.open,children:(0,m.jsx)(gq,{asChild:!0,container:i,children:r})})})};w1.displayName=wQ;var w2="MenuContent",[w3,w5]=wU(w2),w4=y.forwardRef((e,t)=>{let n=w0(w2,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=wG(w2,e.__scopeMenu),s=wY(w2,e.__scopeMenu);return(0,m.jsx)(wF.Provider,{scope:e.__scopeMenu,children:(0,m.jsx)(gY,{present:r||o.open,children:(0,m.jsx)(wF.Slot,{scope:e.__scopeMenu,children:s.modal?(0,m.jsx)(w6,{...i,ref:t}):(0,m.jsx)(w8,{...i,ref:t})})})})}),w6=y.forwardRef((e,t)=>{let n=wG(w2,e.__scopeMenu),r=y.useRef(null),i=gx(t,r);return y.useEffect(()=>{let e=r.current;if(e)return mz(e)},[]),(0,m.jsx)(w7,{...e,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:gm(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),w8=y.forwardRef((e,t)=>{let n=wG(w2,e.__scopeMenu);return(0,m.jsx)(w7,{...e,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),w9=gI("MenuContent.ScrollLock"),w7=y.forwardRef((e,t)=>{let{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,disableOutsideScroll:f,...g}=e,b=wG(w2,n),x=wY(w2,n),v=wH(n),w=wK(n),S=w$(n),[k,C]=y.useState(null),P=y.useRef(null),_=gx(t,P,b.onContentChange),I=y.useRef(0),E=y.useRef(""),j=y.useRef(0),T=y.useRef(null),M=y.useRef("right"),A=y.useRef(0),O=f?mj:y.Fragment,L=e=>{let t=E.current+e,n=S().filter(e=>!e.disabled),r=document.activeElement,i=n.find(e=>e.ref.current===r)?.textValue,o=function(e,t,n){var r;let i=t.length>1&&Array.from(t).every(e=>e===t[0])?t[0]:t,o=(r=Math.max(n?e.indexOf(n):-1,0),e.map((t,n)=>e[(r+n)%e.length]));1===i.length&&(o=o.filter(e=>e!==n));let s=o.find(e=>e.toLowerCase().startsWith(i.toLowerCase()));return s!==n?s:void 0}(n.map(e=>e.textValue),t,i),s=n.find(e=>e.textValue===o)?.ref.current;(function e(t){E.current=t,window.clearTimeout(I.current),""!==t&&(I.current=window.setTimeout(()=>e(""),1e3))})(t),s&&setTimeout(()=>s.focus())};y.useEffect(()=>()=>window.clearTimeout(I.current),[]),gQ();let D=y.useCallback(e=>M.current===T.current?.side&&function(e,t){return!!t&&function(e,t){let{x:n,y:r}=e,i=!1;for(let e=0,o=t.length-1;e<t.length;o=e++){let s=t[e],a=t[o],l=s.x,c=s.y,d=a.x,u=a.y;c>r!=u>r&&n<(d-l)*(r-c)/(u-c)+l&&(i=!i)}return i}({x:e.clientX,y:e.clientY},t)}(e,T.current?.area),[]);return(0,m.jsx)(w3,{scope:n,searchRef:E,onItemEnter:y.useCallback(e=>{D(e)&&e.preventDefault()},[D]),onItemLeave:y.useCallback(e=>{D(e)||(P.current?.focus(),C(null))},[D]),onTriggerLeave:y.useCallback(e=>{D(e)&&e.preventDefault()},[D]),pointerGraceTimerRef:j,onPointerGraceIntentChange:y.useCallback(e=>{T.current=e},[]),children:(0,m.jsx)(O,{...f?{as:w9,allowPinchZoom:!0}:void 0,children:(0,m.jsx)(gU,{asChild:!0,trapped:i,onMountAutoFocus:gm(o,e=>{e.preventDefault(),P.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:s,children:(0,m.jsx)(gD,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:h,onDismiss:p,children:(0,m.jsx)(wI,{asChild:!0,...w,dir:x.dir,orientation:"vertical",loop:r,currentTabStopId:k,onCurrentTabStopIdChange:C,onEntryFocus:gm(l,e=>{x.isUsingKeyboardRef.current||e.preventDefault()}),preventScrollOnEntryFocus:!0,children:(0,m.jsx)(vO,{role:"menu","aria-orientation":"vertical","data-state":SI(b.open),"data-radix-menu-content":"",dir:x.dir,...v,...g,ref:_,style:{outline:"none",...g.style},onKeyDown:gm(g.onKeyDown,e=>{let t=e.target.closest("[data-radix-menu-content]")===e.currentTarget,n=e.ctrlKey||e.altKey||e.metaKey,r=1===e.key.length;t&&("Tab"===e.key&&e.preventDefault(),!n&&r&&L(e.key));let i=P.current;if(e.target!==i||!wD.includes(e.key))return;e.preventDefault();let o=S().filter(e=>!e.disabled).map(e=>e.ref.current);wL.includes(e.key)&&o.reverse(),function(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}(o)}),onBlur:gm(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(I.current),E.current="")}),onPointerMove:gm(e.onPointerMove,ST(e=>{let t=e.target,n=A.current!==e.clientX;if(e.currentTarget.contains(t)&&n){let t=e.clientX>A.current?"right":"left";M.current=t,A.current=e.clientX}}))})})})})})})});w4.displayName=w2;var Se=y.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,m.jsx)(gT.div,{role:"group",...r,ref:t})});Se.displayName="MenuGroup";var St=y.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,m.jsx)(gT.div,{...r,ref:t})});St.displayName="MenuLabel";var Sn="MenuItem",Sr="menu.itemSelect",Si=y.forwardRef((e,t)=>{let{disabled:n=!1,onSelect:r,...i}=e,o=y.useRef(null),s=wY(Sn,e.__scopeMenu),a=w5(Sn,e.__scopeMenu),l=gx(t,o),c=y.useRef(!1);return(0,m.jsx)(So,{...i,ref:l,disabled:n,onClick:gm(e.onClick,()=>{let e=o.current;if(!n&&e){let t=new CustomEvent(Sr,{bubbles:!0,cancelable:!0});e.addEventListener(Sr,e=>r?.(e),{once:!0}),gM(e,t),t.defaultPrevented?c.current=!1:s.onClose()}}),onPointerDown:t=>{e.onPointerDown?.(t),c.current=!0},onPointerUp:gm(e.onPointerUp,e=>{c.current||e.currentTarget?.click()}),onKeyDown:gm(e.onKeyDown,e=>{let t=""!==a.searchRef.current;!n&&(!t||" "!==e.key)&&wO.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})})});Si.displayName=Sn;var So=y.forwardRef((e,t)=>{let{__scopeMenu:n,disabled:r=!1,textValue:i,...o}=e,s=w5(Sn,n),a=wK(n),l=y.useRef(null),c=gx(t,l),[d,u]=y.useState(!1),[h,p]=y.useState("");return y.useEffect(()=>{let e=l.current;e&&p((e.textContent??"").trim())},[o.children]),(0,m.jsx)(wF.ItemSlot,{scope:n,disabled:r,textValue:i??h,children:(0,m.jsx)(wT,{asChild:!0,...a,focusable:!r,children:(0,m.jsx)(gT.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...o,ref:c,onPointerMove:gm(e.onPointerMove,ST(e=>{r?s.onItemLeave(e):(s.onItemEnter(e),e.defaultPrevented||e.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:gm(e.onPointerLeave,ST(e=>s.onItemLeave(e))),onFocus:gm(e.onFocus,()=>u(!0)),onBlur:gm(e.onBlur,()=>u(!1))})})})}),Ss=y.forwardRef((e,t)=>{let{checked:n=!1,onCheckedChange:r,...i}=e;return(0,m.jsx)(Sf,{scope:e.__scopeMenu,checked:n,children:(0,m.jsx)(Si,{role:"menuitemcheckbox","aria-checked":SE(n)?"mixed":n,...i,ref:t,"data-state":Sj(n),onSelect:gm(i.onSelect,()=>r?.(!!SE(n)||!n),{checkForDefaultPrevented:!1})})})});Ss.displayName="MenuCheckboxItem";var Sa="MenuRadioGroup",[Sl,Sc]=wU(Sa,{value:void 0,onValueChange:()=>{}}),Sd=y.forwardRef((e,t)=>{let{value:n,onValueChange:r,...i}=e,o=gA(r);return(0,m.jsx)(Sl,{scope:e.__scopeMenu,value:n,onValueChange:o,children:(0,m.jsx)(Se,{...i,ref:t})})});Sd.displayName=Sa;var Su="MenuRadioItem",Sh=y.forwardRef((e,t)=>{let{value:n,...r}=e,i=Sc(Su,e.__scopeMenu),o=n===i.value;return(0,m.jsx)(Sf,{scope:e.__scopeMenu,checked:o,children:(0,m.jsx)(Si,{role:"menuitemradio","aria-checked":o,...r,ref:t,"data-state":Sj(o),onSelect:gm(r.onSelect,()=>i.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});Sh.displayName=Su;var Sp="MenuItemIndicator",[Sf,Sg]=wU(Sp,{checked:!1}),Sm=y.forwardRef((e,t)=>{let{__scopeMenu:n,forceMount:r,...i}=e,o=Sg(Sp,n);return(0,m.jsx)(gY,{present:r||SE(o.checked)||!0===o.checked,children:(0,m.jsx)(gT.span,{...i,ref:t,"data-state":Sj(o.checked)})})});Sm.displayName=Sp;var Sy=y.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e;return(0,m.jsx)(gT.div,{role:"separator","aria-orientation":"horizontal",...r,ref:t})});Sy.displayName="MenuSeparator";var Sb=y.forwardRef((e,t)=>{let{__scopeMenu:n,...r}=e,i=wH(n);return(0,m.jsx)(vz,{...i,...r,ref:t})});Sb.displayName="MenuArrow";var Sx="MenuSub",[Sv,Sw]=wU(Sx),SS=e=>{let{__scopeMenu:t,children:n,open:r=!1,onOpenChange:i}=e,o=wG(Sx,t),s=wH(t),[a,l]=y.useState(null),[c,d]=y.useState(null),u=gA(i);return y.useEffect(()=>(!1===o.open&&u(!1),()=>u(!1)),[o.open,u]),(0,m.jsx)(vI,{...s,children:(0,m.jsx)(wW,{scope:t,open:r,onOpenChange:u,content:c,onContentChange:d,children:(0,m.jsx)(Sv,{scope:t,contentId:gC(),triggerId:gC(),trigger:a,onTriggerChange:l,children:n})})})};SS.displayName=Sx;var Sk="MenuSubTrigger",SC=y.forwardRef((e,t)=>{let n=wG(Sk,e.__scopeMenu),r=wY(Sk,e.__scopeMenu),i=Sw(Sk,e.__scopeMenu),o=w5(Sk,e.__scopeMenu),s=y.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:e.__scopeMenu},d=y.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return y.useEffect(()=>d,[d]),y.useEffect(()=>{let e=a.current;return()=>{window.clearTimeout(e),l(null)}},[a,l]),(0,m.jsx)(wZ,{asChild:!0,...c,children:(0,m.jsx)(So,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":SI(n.open),...e,ref:gb(t,i.onTriggerChange),onClick:t=>{e.onClick?.(t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:gm(e.onPointerMove,ST(t=>{o.onItemEnter(t),t.defaultPrevented||e.disabled||n.open||s.current||(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:gm(e.onPointerLeave,ST(e=>{d();let t=n.content?.getBoundingClientRect();if(t){let r=n.content?.dataset.side,i="right"===r,s=t[i?"left":"right"],l=t[i?"right":"left"];o.onPointerGraceIntentChange({area:[{x:e.clientX+(i?-5:5),y:e.clientY},{x:s,y:t.top},{x:l,y:t.top},{x:l,y:t.bottom},{x:s,y:t.bottom}],side:r}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(e),e.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:gm(e.onKeyDown,t=>{let i=""!==o.searchRef.current;!e.disabled&&(!i||" "!==t.key)&&wz[r.dir].includes(t.key)&&(n.onOpenChange(!0),n.content?.focus(),t.preventDefault())})})})});SC.displayName=Sk;var SP="MenuSubContent",S_=y.forwardRef((e,t)=>{let n=w0(w2,e.__scopeMenu),{forceMount:r=n.forceMount,...i}=e,o=wG(w2,e.__scopeMenu),s=wY(w2,e.__scopeMenu),a=Sw(SP,e.__scopeMenu),l=y.useRef(null),c=gx(t,l);return(0,m.jsx)(wF.Provider,{scope:e.__scopeMenu,children:(0,m.jsx)(gY,{present:r||o.open,children:(0,m.jsx)(wF.Slot,{scope:e.__scopeMenu,children:(0,m.jsx)(w7,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:c,align:"start",side:"rtl"===s.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{s.isUsingKeyboardRef.current&&l.current?.focus(),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:gm(e.onFocusOutside,e=>{e.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:gm(e.onEscapeKeyDown,e=>{s.onClose(),e.preventDefault()}),onKeyDown:gm(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),n=wR[s.dir].includes(e.key);t&&n&&(o.onOpenChange(!1),a.trigger?.focus(),e.preventDefault())})})})})})});function SI(e){return e?"open":"closed"}function SE(e){return"indeterminate"===e}function Sj(e){return SE(e)?"indeterminate":e?"checked":"unchecked"}function ST(e){return t=>"mouse"===t.pointerType?e(t):void 0}S_.displayName=SP;var SM="ContextMenu",[SA,SO]=gv(SM,[wV]),SL=wV(),[SD,Sz]=SA(SM),SR=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,dir:i,modal:o=!0}=e,[s,a]=y.useState(!1),l=SL(t),c=gA(r),d=y.useCallback(e=>{a(e),c(e)},[c]);return(0,m.jsx)(SD,{scope:t,open:s,onOpenChange:d,modal:o,children:(0,m.jsx)(wX,{...l,dir:i,open:s,onOpenChange:d,modal:o,children:n})})};SR.displayName=SM;var SN="ContextMenuTrigger",SF=y.forwardRef((e,t)=>{let{__scopeContextMenu:n,disabled:r=!1,...i}=e,o=Sz(SN,n),s=SL(n),a=y.useRef({x:0,y:0}),l=y.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=y.useRef(0),d=y.useCallback(()=>window.clearTimeout(c.current),[]),u=e=>{a.current={x:e.clientX,y:e.clientY},o.onOpenChange(!0)};return y.useEffect(()=>d,[d]),y.useEffect(()=>void(r&&d()),[r,d]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(wZ,{...s,virtualRef:l}),(0,m.jsx)(gT.span,{"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:gm(e.onContextMenu,e=>{d(),u(e),e.preventDefault()}),onPointerDown:r?e.onPointerDown:gm(e.onPointerDown,SX(e=>{d(),c.current=window.setTimeout(()=>u(e),700)})),onPointerMove:r?e.onPointerMove:gm(e.onPointerMove,SX(d)),onPointerCancel:r?e.onPointerCancel:gm(e.onPointerCancel,SX(d)),onPointerUp:r?e.onPointerUp:gm(e.onPointerUp,SX(d))})]})});SF.displayName=SN;var S$=e=>{let{__scopeContextMenu:t,...n}=e,r=SL(t);return(0,m.jsx)(w1,{...r,...n})};S$.displayName="ContextMenuPortal";var SB="ContextMenuContent",SU=y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=Sz(SB,n),o=SL(n),s=y.useRef(!1);return(0,m.jsx)(w4,{...o,...r,ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{e.onCloseAutoFocus?.(t),!t.defaultPrevented&&s.current&&t.preventDefault(),s.current=!1},onInteractOutside:t=>{e.onInteractOutside?.(t),t.defaultPrevented||i.modal||(s.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});SU.displayName=SB;var SV=y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(Se,{...i,...r,ref:t})});SV.displayName="ContextMenuGroup",y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(St,{...i,...r,ref:t})}).displayName="ContextMenuLabel";var SH=y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(Si,{...i,...r,ref:t})});SH.displayName="ContextMenuItem";var SK=y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(Ss,{...i,...r,ref:t})});SK.displayName="ContextMenuCheckboxItem",y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(Sd,{...i,...r,ref:t})}).displayName="ContextMenuRadioGroup",y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(Sh,{...i,...r,ref:t})}).displayName="ContextMenuRadioItem",y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(Sm,{...i,...r,ref:t})}).displayName="ContextMenuItemIndicator",y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(Sy,{...i,...r,ref:t})}).displayName="ContextMenuSeparator",y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(Sb,{...i,...r,ref:t})}).displayName="ContextMenuArrow";var SW="ContextMenuSub",SG=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,open:i,defaultOpen:o}=e,s=SL(t),[a,l]=g_({prop:i,defaultProp:o??!1,onChange:r,caller:SW});return(0,m.jsx)(SS,{...s,open:a,onOpenChange:l,children:n})};SG.displayName=SW;var Sq=y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(SC,{...i,...r,ref:t})});Sq.displayName="ContextMenuSubTrigger";var SY=y.forwardRef((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=SL(n);return(0,m.jsx)(S_,{...i,...r,ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});function SX(e){return t=>"mouse"!==t.pointerType?e(t):void 0}SY.displayName="ContextMenuSubContent";let SZ="undefined"!=typeof window&&window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,SQ=SZ?"":"Ctrl",SJ=SZ?"":"Alt";function S0(e){return e.split(",")[0].split("").map(e=>{let t=e.replace(/\$/g,SQ).replace(/\?/g,SJ).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)})}function S1(e){return" "+S0(e).join("")}function S2(e){return(0,m.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:(0,m.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,m.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,m.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,m.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}var S3="DropdownMenu",[S5,S4]=gv(S3,[wV]),S6=wV(),[S8,S9]=S5(S3),S7=e=>{let{__scopeDropdownMenu:t,children:n,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=e,l=S6(t),c=y.useRef(null),[d,u]=g_({prop:i,defaultProp:o??!1,onChange:s,caller:S3});return(0,m.jsx)(S8,{scope:t,triggerId:gC(),triggerRef:c,contentId:gC(),open:d,onOpenChange:u,onOpenToggle:y.useCallback(()=>u(e=>!e),[u]),modal:a,children:(0,m.jsx)(wX,{...l,open:d,onOpenChange:u,dir:r,modal:a,children:n})})};S7.displayName=S3;var ke="DropdownMenuTrigger",kt=y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,disabled:r=!1,...i}=e,o=S9(ke,n),s=S6(n);return(0,m.jsx)(wZ,{asChild:!0,...s,children:(0,m.jsx)(gT.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:gb(t,o.triggerRef),onPointerDown:gm(e.onPointerDown,e=>{r||0!==e.button||!1!==e.ctrlKey||(o.onOpenToggle(),o.open||e.preventDefault())}),onKeyDown:gm(e.onKeyDown,e=>{!r&&(["Enter"," "].includes(e.key)&&o.onOpenToggle(),"ArrowDown"===e.key&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})})});kt.displayName=ke;var kn=e=>{let{__scopeDropdownMenu:t,...n}=e,r=S6(t);return(0,m.jsx)(w1,{...r,...n})};kn.displayName="DropdownMenuPortal";var kr="DropdownMenuContent",ki=y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S9(kr,n),o=S6(n),s=y.useRef(!1);return(0,m.jsx)(w4,{id:i.contentId,"aria-labelledby":i.triggerId,...o,...r,ref:t,onCloseAutoFocus:gm(e.onCloseAutoFocus,e=>{s.current||i.triggerRef.current?.focus(),s.current=!1,e.preventDefault()}),onInteractOutside:gm(e.onInteractOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;(!i.modal||r)&&(s.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});ki.displayName=kr;var ko=y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(Se,{...i,...r,ref:t})});ko.displayName="DropdownMenuGroup",y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(St,{...i,...r,ref:t})}).displayName="DropdownMenuLabel";var ks=y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(Si,{...i,...r,ref:t})});ks.displayName="DropdownMenuItem";var ka=y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(Ss,{...i,...r,ref:t})});ka.displayName="DropdownMenuCheckboxItem",y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(Sd,{...i,...r,ref:t})}).displayName="DropdownMenuRadioGroup",y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(Sh,{...i,...r,ref:t})}).displayName="DropdownMenuRadioItem",y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(Sm,{...i,...r,ref:t})}).displayName="DropdownMenuItemIndicator",y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(Sy,{...i,...r,ref:t})}).displayName="DropdownMenuSeparator",y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(Sb,{...i,...r,ref:t})}).displayName="DropdownMenuArrow";var kl=y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(SC,{...i,...r,ref:t})});kl.displayName="DropdownMenuSubTrigger";var kc=y.forwardRef((e,t)=>{let{__scopeDropdownMenu:n,...r}=e,i=S6(n);return(0,m.jsx)(S_,{...i,...r,ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});kc.displayName="DropdownMenuSubContent";var kd=e=>{let{__scopeDropdownMenu:t,children:n,open:r,onOpenChange:i,defaultOpen:o}=e,s=S6(t),[a,l]=g_({prop:r,defaultProp:o??!1,onChange:i,caller:"DropdownMenuSub"});return(0,m.jsx)(SS,{...s,open:a,onOpenChange:l,children:n})};function ku({id:e,children:t,modal:n=!1,debugOpen:r=!1}){let[i,o]=v9(e);return(0,m.jsx)(S7,{open:r||i,dir:"ltr",modal:n,onOpenChange:o,children:t})}function kh({children:e,...t}){return(0,m.jsx)(kt,{dir:"ltr",asChild:!0,onTouchEnd:e=>oz(e),...t,children:e})}function kp({side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:r=8,children:i}){let o=oK();return(0,m.jsx)(kn,{container:o,children:(0,m.jsx)(ki,{className:"tlui-menu",side:e,sideOffset:n,align:t,alignOffset:r,collisionPadding:4,children:i})})}function kf({id:e,children:t}){let[n,r]=v9(e);return(0,m.jsx)(kd,{open:n,onOpenChange:r,children:t})}function kg({id:e,label:t,title:n,disabled:r}){return(0,m.jsx)(kl,{dir:"ltr",asChild:!0,disabled:r,children:(0,m.jsxs)(yJ,{"data-testid":e,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:n,children:[(0,m.jsx)(y0,{children:t}),(0,m.jsx)(y6,{icon:"chevron-right",small:!0})]})})}function km({id:e,alignOffset:t=-1,sideOffset:n=-4,size:r="small",children:i}){let o=oK();return(0,m.jsx)(kn,{container:o,children:(0,m.jsx)(kc,{"data-testid":e,className:"tlui-menu tlui-menu__submenu__content",alignOffset:t,sideOffset:n,collisionPadding:4,"data-size":r,children:i})})}function ky({children:e}){return(0,m.jsx)(ko,{dir:"ltr",className:"tlui-menu__group",children:e})}function kb({noClose:e,children:t}){return(0,m.jsx)(ks,{dir:"ltr",asChild:!0,onClick:e?oz:void 0,children:t})}function kx({children:e,visibleOnMobileLayout:t=!1}){let n=bg();return!t&&n<y9.MOBILE?null:(0,m.jsx)("kbd",{className:"tlui-kbd",children:S0(e).map((e,t)=>(0,m.jsx)("span",{children:e},t))})}function kv({disabled:e=!1,spinner:t=!1,readonlyOk:n=!1,id:r,kbd:i,label:o,icon:s,onSelect:a,noClose:l,isSelected:c}){let{type:d,sourceId:u}=wr(),h=ff(),[p,f]=(0,y.useState)(!1);if(ur()&&!n)return null;let g=b8(o,d),b=i?S1(i):void 0,x=g?h(g):void 0,v=x&&b?`${x} ${b}`:x;switch(d){case"menu":return(0,m.jsx)(kb,{children:(0,m.jsxs)(yJ,{type:"menu","data-testid":`${u}.${r}`,disabled:e,title:v,onClick:e=>{l&&oz(e),p?f(!1):a(u)},children:[(0,m.jsx)(y0,{children:x}),i&&(0,m.jsx)(kx,{children:i})]})});case"context-menu":if(e)return null;return(0,m.jsxs)(SH,{dir:"ltr",title:v,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${u}.${r}`,onSelect:e=>{l&&oz(e),p?f(!1):a(u)},children:[(0,m.jsx)("span",{className:"tlui-button__label",draggable:!1,children:x}),i&&(0,m.jsx)(kx,{children:i}),t&&(0,m.jsx)(S2,{})]});case"panel":return(0,m.jsxs)(yJ,{"data-testid":`${u}.${r}`,type:"menu",title:v,disabled:e,onClick:()=>a(u),children:[(0,m.jsx)(y0,{children:x}),s&&(0,m.jsx)(y6,{icon:s})]});case"small-icons":case"icons":return(0,m.jsx)(yJ,{"data-testid":`${u}.${r}`,type:"icon",title:v,disabled:e,onClick:()=>a(u),children:(0,m.jsx)(y6,{icon:s,small:"small-icons"===d})});case"keyboard-shortcuts":if(!i)return console.warn(`Menu item '${o}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null;return(0,m.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${u}.${r}`,children:[(0,m.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:x}),(0,m.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,m.jsx)(kx,{visibleOnMobileLayout:!0,children:i})})]});case"helper-buttons":return(0,m.jsxs)(yJ,{type:"low",onClick:()=>a(u),children:[(0,m.jsx)(y6,{icon:s}),(0,m.jsx)(y0,{children:x})]});case"toolbar":return(0,m.jsx)(yJ,{type:"tool","data-testid":`tools.${r}`,"aria-label":g,"data-value":r,onClick:()=>a("toolbar"),title:v,onTouchStart:e=>{oz(e),a("toolbar")},role:"radio","aria-checked":c?"true":"false",children:(0,m.jsx)(y6,{icon:s})});case"toolbar-overflow":return(0,m.jsx)(kb,{"aria-label":o,children:(0,m.jsx)(yJ,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${r}`,title:v,role:"radio","aria-checked":c?"true":"false","data-value":r,children:(0,m.jsx)(y6,{icon:s})})});default:throw ev(d)}}function kw(){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(kS,{}),(0,m.jsx)(kk,{}),(0,m.jsx)(kC,{}),(0,m.jsx)(kP,{}),(0,m.jsx)(k_,{}),(0,m.jsx)(kj,{}),(0,m.jsx)(kT,{}),(0,m.jsx)(kM,{})]})}function kS(){let e=b6(),t=wu(2),n=ws(),r=t&&n;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(kv,{...e["align-left"],disabled:!r}),(0,m.jsx)(kv,{...e["align-center-horizontal"],disabled:!r}),(0,m.jsx)(kv,{...e["align-right"],disabled:!r}),(0,m.jsx)(kv,{...e["stretch-horizontal"],disabled:!r}),(0,m.jsx)(kv,{...e["align-top"],disabled:!r}),(0,m.jsx)(kv,{...e["align-center-vertical"],disabled:!r}),(0,m.jsx)(kv,{...e["align-bottom"],disabled:!r}),(0,m.jsx)(kv,{...e["stretch-vertical"],disabled:!r})]})}function kk(){let e=b6(),t=wu(3),n=ws(),r=t&&n;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(kv,{...e["distribute-horizontal"],disabled:!r}),(0,m.jsx)(kv,{...e["distribute-vertical"],disabled:!r})]})}function kC(){let e=b6(),t=wo(),n=ws(),r=t&&n;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(kv,{...e["stack-horizontal"],disabled:!r}),(0,m.jsx)(kv,{...e["stack-vertical"],disabled:!r})]})}function kP(){let e=b6(),t=wu(1),n=ws(),r=t&&n;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(kv,{...e["send-to-back"],disabled:!r}),(0,m.jsx)(kv,{...e["send-backward"],disabled:!r}),(0,m.jsx)(kv,{...e["bring-forward"],disabled:!r}),(0,m.jsx)(kv,{...e["bring-to-front"],disabled:!r})]})}function k_(){return bg()<y9.TABLET_SM?(0,m.jsx)(kI,{}):(0,m.jsx)(kE,{})}function kI(){let e=b6(),t=i8(),n=iJ("zoom is 1",()=>1===t.getZoomLevel(),[t]);return(0,m.jsx)(kv,{...e["zoom-to-100"],disabled:n})}function kE(){let e=b6(),t=wu(1),n=ws();return(0,m.jsx)(kv,{...e["rotate-ccw"],disabled:!(t&&n)})}function kj(){let e=b6(),t=wu(1),n=ws();return(0,m.jsx)(kv,{...e["rotate-cw"],disabled:!(t&&n)})}function kT(){let e=b6(),t=wh(),n=ws();return(0,m.jsx)(kv,{...e["edit-link"],disabled:!(t&&n)})}function kM(){let e=wa(),t=wl();return e?(0,m.jsx)(kA,{}):t?(0,m.jsx)(kO,{}):(0,m.jsx)(kA,{})}function kA(){let e=b6(),t=wu(2),n=ws();return(0,m.jsx)(kv,{...e.group,disabled:!(t&&n)})}function kO(){let e=b6();return(0,m.jsx)(kv,{...e.ungroup})}let kL=(0,y.memo)(function({children:e}){let t=ff(),n=bg(),r=ur(),i=i8(),o=iJ("should display quick actions when in readonly",()=>i.isInAny("hand","zoom"),[i]),s=e??(0,m.jsx)(kw,{});if(!r||o)return(0,m.jsxs)(v7,{id:"actions-menu",children:[(0,m.jsx)(we,{children:(0,m.jsx)(yJ,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:(0,m.jsx)(y6,{icon:"dots-vertical",small:!0})})}),(0,m.jsx)(wt,{side:n>=y9.TABLET?"bottom":"top",sideOffset:6,children:(0,m.jsx)("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:(0,m.jsx)(wi,{type:"icons",sourceId:"actions-menu",children:s})})})]})});function kD({id:e,kbd:t,label:n,readonlyOk:r,onSelect:i,toggle:o=!1,disabled:s=!1,checked:a=!1}){let{type:l,sourceId:c}=wr(),d=ur(),u=ff();if(d&&!r)return null;let h=b8(n,l),p=h?u(h):void 0;switch(l){case"menu":return(0,m.jsxs)(ka,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:p,onSelect:e=>{i?.(c),oz(e)},disabled:s,checked:a,children:[(0,m.jsx)(y1,{small:!0,icon:o?a?"toggle-on":"toggle-off":a?"check":"none"}),p&&(0,m.jsx)("span",{className:"tlui-button__label",draggable:!1,children:p}),t&&(0,m.jsx)(kx,{children:t})]});case"context-menu":return(0,m.jsxs)(SK,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:p,onSelect:e=>{i(c),oz(e)},disabled:s,checked:a,children:[(0,m.jsx)(y1,{small:!0,icon:o?a?"toggle-on":"toggle-off":a?"check":"none"}),p&&(0,m.jsx)("span",{className:"tlui-button__label",draggable:!1,children:p}),t&&(0,m.jsx)(kx,{children:t})]},e);default:return null}}function kz({id:e,label:t,children:n}){let{type:r,sourceId:i}=wr(),o=ff(),s=b8(t,r),a=s?o(s):void 0;switch(r){case"panel":return(0,m.jsx)("div",{className:"tlui-menu__group","data-testid":`${i}-group.${e}`,children:n});case"menu":return(0,m.jsx)(ky,{"data-testid":`${i}-group.${e}`,children:n});case"context-menu":return(0,m.jsx)(SV,{dir:"ltr",className:"tlui-menu__group","data-testid":`${i}-group.${e}`,children:n});case"keyboard-shortcuts":return(0,m.jsxs)("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i}-group.${e}`,children:[(0,m.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),(0,m.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:n})]});default:return n}}function kR({id:e,disabled:t=!1,label:n,size:r="small",children:i}){let{type:o,sourceId:s}=wr(),a=oK(),l=ff(),c=n?"string"==typeof n?n:n[o]??n.default:void 0,d=c?l(c):void 0;switch(o){case"menu":return(0,m.jsxs)(kf,{id:`${s}-sub.${e}`,children:[(0,m.jsx)(kg,{id:`${s}-sub.${d?d.toLowerCase()+"-button":""}`,disabled:t,label:d,title:d}),(0,m.jsx)(km,{id:`${s}-sub.${d?d.toLowerCase()+"-content":""}`,size:r,children:i})]});case"context-menu":if(t)return null;return(0,m.jsxs)(kN,{id:`${s}-sub.${e}`,children:[(0,m.jsx)(Sq,{dir:"ltr",disabled:t,asChild:!0,children:(0,m.jsxs)(yJ,{"data-testid":`${s}-sub-trigger.${e}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[(0,m.jsx)(y0,{children:d}),(0,m.jsx)(y6,{icon:"chevron-right",small:!0})]})}),(0,m.jsx)(S$,{container:a,children:(0,m.jsx)(SY,{"data-testid":`${s}-sub-content.${e}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:i})})]});default:return i}}function kN({id:e,children:t}){let[n,r]=v9(e);return(0,m.jsx)(SG,{open:n,onOpenChange:r,children:t})}function kF(){let e=b6();return!function(){let e=i8();return iJ("showAutoSizeToggle",()=>{let t=e.getSelectedShapes();return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize},[e])}()?null:(0,m.jsx)(kv,{...e["toggle-auto-size"]})}function k$(){let e=b6();return wh()?(0,m.jsx)(kv,{...e["edit-link"]}):null}function kB(){let e=b6();return wu(1)?(0,m.jsx)(kv,{...e.duplicate}):null}function kU(){let e=b6(),t=i8();return iJ("should display flatten option",()=>{if(0===t.getSelectedShapeIds().length)return!1;let e=t.getOnlySelectedShape();return!(e&&t.isShapeOfType(e,"image"))},[t])?(0,m.jsx)(kv,{...e["flatten-to-image"]}):null}function kV(){let e=b6();return wa()?(0,m.jsx)(kv,{...e.group}):null}function kH(){let e=b6();return wl()?(0,m.jsx)(kv,{...e.ungroup}):null}function kK(){let e=i8(),t=b6();return iJ("allow unframe",()=>{let t=e.getSelectedShapes();return 0!==t.length&&t.every(t=>e.isShapeOfType(t,"frame"))},[e])?(0,m.jsx)(kv,{...t["remove-frame"]}):null}function kW(){let e=i8(),t=b6();return iJ("allow fit frame to content",()=>{let t=e.getOnlySelectedShape();return!!t&&e.isShapeOfType(t,"frame")&&e.getSortedChildIdsForParent(t).length>0},[e])?(0,m.jsx)(kv,{...t["fit-frame-to-content"]}):null}function kG(){let e=i8(),t=b6();return iJ("selected shapes",()=>e.getSelectedShapes().length>0,[e])?(0,m.jsx)(kv,{...t["toggle-lock"]}):null}function kq(){let e=b6(),t=i8(),n=iJ("isTransparentBg",()=>!t.getInstanceState().exportBackground,[t]);return(0,m.jsx)(kD,{...e["toggle-transparent"],checked:n,toggle:!0})}function kY(){let e=i8(),t=b6(),n=iJ("any shapes",()=>e.getCurrentPageShapeIds().size>0,[e]);return(0,m.jsx)(kv,{...t["unlock-all"],disabled:!n})}function kX(){let e=i8(),t=iJ("zoomed to 100",()=>1===e.getZoomLevel(),[e]),n=b6();return(0,m.jsx)(kv,{...n["zoom-to-100"],noClose:!0,disabled:t})}function kZ(){let e=i8(),t=iJ("has shapes",()=>e.getCurrentPageShapeIds().size>0,[e]),n=b6();return(0,m.jsx)(kv,{...n["zoom-to-fit"],disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function kQ(){let e=i8(),t=iJ("has shapes",()=>e.getSelectedShapeIds().length>0,[e]),n=b6();return(0,m.jsx)(kv,{...n["zoom-to-selection"],disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function kJ(){return(0,m.jsxs)(kz,{id:"clipboard",children:[(0,m.jsx)(k1,{}),(0,m.jsx)(k2,{}),(0,m.jsx)(k3,{}),(0,m.jsx)(kB,{}),(0,m.jsx)(k6,{})]})}function k0(){let e=i8(),t=b6(),n=iJ("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return(0,m.jsxs)(kR,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!n,children:[(0,m.jsxs)(kz,{id:"copy-as-group",children:[(0,m.jsx)(kv,{...t["copy-as-svg"]}),!!window.navigator.clipboard?.write&&(0,m.jsx)(kv,{...t["copy-as-png"]}),(0,m.jsx)(kv,{...t["copy-as-json"]})]}),(0,m.jsx)(kz,{id:"copy-as-bg",children:(0,m.jsx)(kq,{})})]})}function k1(){let e=b6(),t=wu(1);return(0,m.jsx)(kv,{...e.cut,disabled:!t})}function k2(){let e=b6(),t=wd(1);return(0,m.jsx)(kv,{...e.copy,disabled:!t})}function k3(){let e=b6();return(0,m.jsx)(kv,{...e.paste,disabled:!wc})}function k5(){let e=i8(),t=b6();return iJ("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e])?(0,m.jsxs)(kz,{id:"conversions",children:[(0,m.jsx)(k0,{}),(0,m.jsxs)(kR,{id:"export-as",label:"context-menu.export-as",size:"small",children:[(0,m.jsxs)(kz,{id:"export-as-group",children:[(0,m.jsx)(kv,{...t["export-as-svg"]}),(0,m.jsx)(kv,{...t["export-as-png"]}),(0,m.jsx)(kv,{...t["export-as-json"]})]}),(0,m.jsx)(kz,{id:"export-as-bg",children:(0,m.jsx)(kq,{})})]})]}):null}function k4(){let e=b6(),t=i8(),n=iJ("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return(0,m.jsx)(kv,{...e["select-all"],disabled:!n})}function k6(){let e=b6(),t=wu(1);return(0,m.jsx)(kv,{...e.delete,disabled:!t})}function k8(){return wd(1)?(0,m.jsxs)(kR,{id:"edit",label:"context-menu.edit",size:"small",children:[(0,m.jsx)(kV,{}),(0,m.jsx)(kH,{}),(0,m.jsx)(kU,{}),(0,m.jsx)(k$,{}),(0,m.jsx)(kW,{}),(0,m.jsx)(kK,{}),(0,m.jsx)(Ci,{}),(0,m.jsx)(Cr,{}),(0,m.jsx)(kF,{}),(0,m.jsx)(kG,{})]}):null}function k9(){let e=wu(2),t=function(){let e=i8();return iJ("onlyFlippableShape",()=>{let t=e.getOnlySelectedShape();return t&&(e.isShapeOfType(t,"group")||e.isShapeOfType(t,"image")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw"))},[e])}(),n=b6();return e||t?(0,m.jsxs)(kR,{id:"arrange",label:"context-menu.arrange",size:"small",children:[e&&(0,m.jsxs)(kz,{id:"align",children:[(0,m.jsx)(kv,{...n["align-left"]}),(0,m.jsx)(kv,{...n["align-center-horizontal"]}),(0,m.jsx)(kv,{...n["align-right"]}),(0,m.jsx)(kv,{...n["align-top"]}),(0,m.jsx)(kv,{...n["align-center-vertical"]}),(0,m.jsx)(kv,{...n["align-bottom"]})]}),(0,m.jsx)(k7,{}),e&&(0,m.jsxs)(kz,{id:"stretch",children:[(0,m.jsx)(kv,{...n["stretch-horizontal"]}),(0,m.jsx)(kv,{...n["stretch-vertical"]})]}),(e||t)&&(0,m.jsxs)(kz,{id:"flip",children:[(0,m.jsx)(kv,{...n["flip-horizontal"]}),(0,m.jsx)(kv,{...n["flip-vertical"]})]}),(0,m.jsx)(Ce,{})]}):null}function k7(){let e=b6();return wu(3)?(0,m.jsxs)(kz,{id:"distribute",children:[(0,m.jsx)(kv,{...e["distribute-horizontal"]}),(0,m.jsx)(kv,{...e["distribute-vertical"]})]}):null}function Ce(){let e=b6(),t=wu(2),n=wo();return t?(0,m.jsxs)(kz,{id:"order",children:[(0,m.jsx)(kv,{...e.pack}),n&&(0,m.jsx)(kv,{...e["stack-horizontal"]}),n&&(0,m.jsx)(kv,{...e["stack-vertical"]})]}):null}function Ct(){let e=b6();return wu(1)?(0,m.jsx)(kR,{id:"reorder",label:"context-menu.reorder",size:"small",children:(0,m.jsxs)(kz,{id:"reorder",children:[(0,m.jsx)(kv,{...e["bring-to-front"]}),(0,m.jsx)(kv,{...e["bring-forward"]}),(0,m.jsx)(kv,{...e["send-backward"]}),(0,m.jsx)(kv,{...e["send-to-back"]})]})}):null}function Cn(){let e=i8(),t=iJ("pages",()=>e.getPages(),[e]),n=iJ("current page id",()=>e.getCurrentPageId(),[e]),{addToast:r}=yQ(),i=b6(),o=ya();return wu(1)?(0,m.jsxs)(kR,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[(0,m.jsx)(kz,{id:"pages",children:t.map(t=>(0,m.jsx)(kv,{id:t.id,disabled:n===t.id,label:t.name,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.getSelectedShapeIds(),t.id);let i=e.getPage(t.id);i&&r({title:"Changed Page",description:`Moved to ${i.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(n)}}]}),o("move-to-page",{source:"context-menu"})}},t.id))}),(0,m.jsx)(kz,{id:"new-page",children:(0,m.jsx)(kv,{...i["move-to-new-page"]})})]}):null}function Cr(){let e=i8(),t=b6();return iJ("oneEmbedSelected",()=>{let t=e.getOnlySelectedShape();return!!t&&!!(e.isShapeOfType(t,"embed")&&t.props.url&&!e.isShapeOrAncestorLocked(t))},[e])?(0,m.jsx)(kv,{...t["convert-to-bookmark"]}):null}function Ci(){let e=i8(),t=b6();return iJ("oneEmbeddableBookmarkSelected",()=>{let t=e.getOnlySelectedShape();return!!t&&!!(e.isShapeOfType(t,"bookmark")&&t.props.url&&u3(t.props.url)&&!e.isShapeOrAncestorLocked(t))},[e])?(0,m.jsx)(kv,{...t["convert-to-embed"]}):null}function Co(){let e=b6(),t=i8(),n=iJ("isSnapMode",()=>t.user.getIsSnapMode(),[t]);return(0,m.jsx)(kD,{...e["toggle-snap-mode"],checked:n})}function Cs(){let e=b6(),t=i8(),n=iJ("isToolLock",()=>t.getInstanceState().isToolLocked,[t]);return(0,m.jsx)(kD,{...e["toggle-tool-lock"],checked:n})}function Ca(){let e=b6(),t=i8(),n=iJ("isGridMode",()=>t.getInstanceState().isGridMode,[t]);return(0,m.jsx)(kD,{...e["toggle-grid"],checked:n})}function Cl(){let e=b6(),t=i8(),n=iJ("isWrapMode",()=>t.user.getIsWrapMode(),[t]);return(0,m.jsx)(kD,{...e["toggle-wrap-mode"],checked:n})}function Cc(){let e=b6(),t=i8(),n=iJ("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]);return(0,m.jsx)(kD,{...e["toggle-focus-mode"],checked:n})}function Cd(){let e=b6(),t=i8(),n=iJ("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]);return(0,m.jsx)(kD,{...e["toggle-edge-scrolling"],checked:1===n})}function Cu(){let e=b6(),t=i8(),n=iJ("animationSpeed",()=>t.user.getAnimationSpeed(),[t]);return(0,m.jsx)(kD,{...e["toggle-reduce-motion"],checked:0===n})}function Ch(){let e=b6(),t=i8(),n=iJ("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]);return(0,m.jsx)(kD,{...e["toggle-debug-mode"],checked:n})}function Cp(){let e=b6(),t=i8(),n=iJ("dynamic resize",()=>t.user.getIsDynamicResizeMode(),[t]);return(0,m.jsx)(kD,{...e["toggle-dynamic-size-mode"],checked:n})}function Cf(){let e=b6(),t=i8(),n=iJ("paste at cursor",()=>t.user.getIsPasteAtCursorMode(),[t]);return(0,m.jsx)(kD,{...e["toggle-paste-at-cursor"],checked:n})}function Cg(){let e=i8(),t=b6();return iJ("show cursor chat",()=>"select"===e.getCurrentToolId()&&!e.getInstanceState().isCoarsePointer,[e])?(0,m.jsx)(kv,{...t["open-cursor-chat"]}):null}function Cm(){let e=i8(),t=b2();return iJ("isSelectToolActive",()=>"select"===e.getCurrentToolId(),[e])?(0,m.jsxs)(m.Fragment,{children:[t&&(0,m.jsx)(Cg,{}),(0,m.jsxs)(kz,{id:"modify",children:[(0,m.jsx)(k8,{}),(0,m.jsx)(k9,{}),(0,m.jsx)(Ct,{}),(0,m.jsx)(Cn,{})]}),(0,m.jsx)(kJ,{}),(0,m.jsx)(k5,{}),(0,m.jsx)(kz,{id:"select-all",children:(0,m.jsx)(k4,{})})]}):null}let Cy=(0,y.memo)(function({children:e}){let t=i8(),{Canvas:n}=aL(),r=(0,y.useCallback)(e=>{if(e){if(t.getInstanceState().isCoarsePointer){let e=t.getSelectedShapes(),{inputs:{currentPagePoint:n}}=t,r=t.getShapesAtPoint(n);if(!t.getSelectedShapes().length||!r.some(t=>e.includes(t))){let e=r.filter(e=>t.isShapeOrAncestorLocked(e));e.length&&t.select(...e.map(e=>e.id))}}}else{let e=t.getOnlySelectedShape();e&&t.isShapeOrAncestorLocked(e)&&t.setSelectedShapes([])}},[t]),i=oK(),[o,s]=v9("context menu",r),a=e??(0,m.jsx)(Cm,{});return(0,m.jsxs)(SR,{dir:"ltr",onOpenChange:s,modal:!1,children:[(0,m.jsx)(SF,{onContextMenu:void 0,dir:"ltr",children:n?(0,m.jsx)(n,{}):null}),o&&(0,m.jsx)(S$,{container:i,children:(0,m.jsx)(SU,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:oz,children:(0,m.jsx)(wi,{type:"context-menu",sourceId:"context-menu",children:a})})})]})}),Cb=iZ(function(){let e=i8(),{isChatting:t,chatMessage:n}=e.getInstanceState(),r=(0,y.useRef)(-1),[i,o]=(0,y.useState)("");return((0,y.useEffect)(()=>((!t&&n||t)&&(r.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},t?5e3:2e3)),()=>{clearTimeout(r.current)}),[e,n,t]),t)?(0,m.jsx)(Cw,{value:i,setValue:o,chatMessage:n}):n.trim()?(0,m.jsx)(Cv,{chatMessage:n}):null});function Cx(e){let t=i8();(0,y.useLayoutEffect)(()=>{if(!e.current)return;let{x:n,y:r}=t.inputs.currentScreenPoint;function i(n){let{minX:r,minY:i}=t.getViewportScreenBounds();e.current?.style.setProperty("transform",`translate(${n.clientX-r}px, ${n.clientY-i}px)`)}return e.current?.style.setProperty("transform",`translate(${n}px, ${r}px)`),window.addEventListener("pointermove",i),()=>{window.removeEventListener("pointermove",i)}},[e,t])}let Cv=({chatMessage:e})=>{let t=i8(),n=(0,y.useRef)(null);return Cx(n),(0,m.jsx)("div",{ref:n,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:t.user.getColor()},children:e})},Cw=iZ(function({chatMessage:e,value:t,setValue:n}){let r=i8(),i=ff(),o=(0,y.useRef)(null),s=e||i("cursor-chat.type-to-chat");Cx(o),(0,y.useLayoutEffect)(()=>{let e=o.current;if(!e)return;let n=r.textMeasure.measureText(t||s,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});e.style.setProperty("width",n.w+"px")},[r,t,s]),(0,y.useLayoutEffect)(()=>{let e=r.timers.requestAnimationFrame(()=>{o.current?.focus()});return()=>{cancelAnimationFrame(e)}},[r]);let a=(0,y.useCallback)(()=>{r.updateInstanceState({isChatting:!1}),r.focus()},[r]),l=(0,y.useCallback)(e=>{let{value:t}=e.target;n(t.slice(0,64)),r.updateInstanceState({chatMessage:t})},[r,n]),c=(0,y.useCallback)(e=>{let t=o.current;if(!t)return;let{value:r}=t;switch(e.key){case"Enter":if(oz(e),e.stopPropagation(),!r){a();return}n("");break;case"Escape":oz(e),e.stopPropagation(),a()}},[a,n]),d=(0,y.useCallback)(e=>{e.stopPropagation()},[]);return(0,m.jsx)("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:r.user.getColor()},onBlur:a,onChange:l,onKeyDown:c,onPaste:d,value:t,placeholder:s,spellCheck:!1})});function CS({checked:e}){return(0,m.jsx)(y1,{icon:e?"check":"none",className:"tlui-button__icon",small:!0})}function Ck(){let e=i8(),{addToast:t}=yQ(),{addDialog:n}=yd(),[r,i]=y.useState(!1);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(kz,{id:"items",children:[(0,m.jsx)(kv,{id:"add-toast",onSelect:()=>{t({id:a$(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),t({id:a$(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:a$(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:a$(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),(0,m.jsx)(kv,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:e})=>(0,m.jsx)(C_,{displayDontShowAgain:!0,onCancel:()=>e(),onContinue:()=>e()}),onClose:()=>{}})}}),(0,m.jsx)(kv,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>(function(e,t){let n=Array(100),r=Math.floor(Math.sqrt(100));for(let e=0;e<t;e++)CE++,n[e]={id:nG("box"+CE),type:"geo",x:e%r*132,y:132*Math.floor(e/r)};e.run(()=>{e.createShapes(n).setSelectedShapes(n.map(e=>e.id))})})(e,100)}),(0,m.jsx)(kv,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{let t=e.getSelectedShapes(),n=0===t.length?e.getRenderingShapes():t;window.alert(`Shapes ${n.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),(0,m.jsx)(kv,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"}),(0,m.jsx)(kv,{id:"hard-reset",onSelect:az,label:"Hard reset"})]}),(0,m.jsxs)(kz,{id:"flags",children:[(0,m.jsx)(CC,{}),(0,m.jsx)(CP,{})]})]})}function CC(){let e=Object.values(t_);return e.length?(0,m.jsx)(kR,{id:"debug flags",label:"Debug Flags",children:(0,m.jsx)(kz,{id:"debug flags",children:e.map(e=>(0,m.jsx)(CI,{flag:e},e.name))})}):null}function CP(){let e=Object.values(tC);return e.length?(0,m.jsx)(kR,{id:"feature flags",label:"Feature Flags",children:(0,m.jsx)(kz,{id:"feature flags",children:e.map(e=>(0,m.jsx)(CI,{flag:e},e.name))})}):null}function C_({title:e="title",body:t="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:s}){let[a,l]=y.useState(!1);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(bn,{children:[(0,m.jsx)(br,{children:e}),(0,m.jsx)(bi,{})]}),(0,m.jsx)(bo,{style:{maxWidth:350},children:t}),(0,m.jsxs)(bs,{className:"tlui-dialog__footer__actions",children:[i&&(0,m.jsxs)(yJ,{type:"normal",onClick:()=>l(!a),style:{marginRight:"auto"},children:[(0,m.jsx)(CS,{checked:a}),(0,m.jsx)(y0,{children:"Dont show again"})]}),(0,m.jsx)(yJ,{type:"normal",onClick:o,children:(0,m.jsx)(y0,{children:n})}),(0,m.jsx)(yJ,{type:"primary",onClick:async()=>s(),children:(0,m.jsx)(y0,{children:r})})]})]})}let CI=iZ(function({flag:e,onChange:t}){let n=e.get();return(0,m.jsx)(kD,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,e=>`${e[0]} ${e[1].toLowerCase()}`).replace(/^[a-z]/,e=>e.toUpperCase()),checked:n,onSelect:()=>{e.set(!n),t?.(!n)}})}),CE=0;function Cj({children:e}){let t=e??(0,m.jsx)(Ck,{});return(0,m.jsxs)(ku,{id:"debug",children:[(0,m.jsx)(kh,{children:(0,m.jsx)(yJ,{type:"icon",title:"Debug menu",children:(0,m.jsx)(y6,{icon:"dots-horizontal"})})}),(0,m.jsx)(kp,{side:"top",align:"end",alignOffset:0,children:(0,m.jsx)(wi,{type:"menu",sourceId:"debug-panel",children:t})})]})}let CT=(0,y.memo)(function(){let{DebugMenu:e}=Ia();return(0,m.jsxs)("div",{className:"tlui-debug-panel",children:[(0,m.jsx)(CM,{}),(0,m.jsx)(CA,{}),e&&(0,m.jsx)(e,{})]})}),CM=iZ(function(){!function(e=!0){let[t,n]=(0,y.useState)(0),r=i8();(0,y.useEffect)(()=>{if(!e)return;let t=()=>n(e=>e+1);return r.on("tick",t),()=>{r.off("tick",t)}},[r,e])}();let e=i8(),t=e.getPath(),n=e.getHoveredShape(),r=e.getOnlySelectedShape(),i="select.idle"!==t&&t.includes("select.")?r:n,o=i&&t.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${ot.ToInt(e.getPointInShapeSpace(i,e.inputs.currentPagePoint))}]`:"",s=t.startsWith("select.")&&!t.includes(".idle")?` / [${ot.ToInt(e.inputs.originPagePoint)}] \u2192 [${ot.ToInt(e.inputs.currentPagePoint)}] = ${ot.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return(0,m.jsx)("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${s}`})});function CA(){let e=i8(),t=iJ("show_fps",()=>t_.showFps.get(),[t_]),n=(0,y.useRef)(null);return((0,y.useEffect)(()=>{if(!t)return;let r=0,i=-1,o=performance.now(),s=0,a=0,l=!1;return function t(){if(a++,(s=performance.now()-o)>250){let e=Math.round(250/s*a*4);e>r&&(r=e);let t=.75*r;(e<t&&!l||e>=t&&l)&&(l=!l),n.current.innerHTML=`FPS ${e.toString()}`,n.current.className="tlui-debug-panel__fps"+(l?" tlui-debug-panel__fps__slow":""),s-=250,a=0,o=performance.now()}i=e.timers.requestAnimationFrame(t)}(),()=>{cancelAnimationFrame(i)}},[t,e]),t)?(0,m.jsx)("div",{ref:n}):null}let CO=(0,y.memo)(function(){let e=bg(),{MainMenu:t,QuickActions:n,ActionsMenu:r,PageMenu:i}=Ia();return t||i||!(e<6)?(0,m.jsx)("div",{className:"tlui-menu-zone",children:(0,m.jsxs)("div",{className:"tlui-buttons__horizontal",children:[t&&(0,m.jsx)(t,{}),i&&(0,m.jsx)(i,{}),e<6?null:(0,m.jsxs)(m.Fragment,{children:[n&&(0,m.jsx)(n,{}),r&&(0,m.jsx)(r,{})]})]})}):null});function CL(){let e=i8(),t=b6(),[n,r]=(0,y.useState)(!1),i=(0,y.useRef)(!1);return(iQ("toggle showback to content",()=>{let t=i.current,n=e.getCurrentPageShapeIds(),o=!1;n.size&&(o=n.size===e.getCulledShapes().size),t!==o&&(r(o),i.current=o)},[e]),n)?(0,m.jsx)(kv,{...t["back-to-content"],onSelect:()=>{t["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function CD(){let e=i8(),t=b6();return iJ("is pen mode",()=>e.getInstanceState().isPenMode,[e])?(0,m.jsx)(kv,{...t["exit-pen-mode"]}):null}function Cz(){let e=i8(),t=b6();return iJ("is following user",()=>!!e.getInstanceState().followingUserId,[e])?(0,m.jsx)(kv,{...t["stop-following"]}):null}function CR(){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(CD,{}),(0,m.jsx)(CL,{}),(0,m.jsx)(Cz,{})]})}function CN({children:e}){let t=e??(0,m.jsx)(CR,{});return(0,m.jsx)("div",{className:"tlui-helper-buttons",children:(0,m.jsx)(wi,{type:"helper-buttons",sourceId:"helper-buttons",children:t})})}function CF(){let e=b6(),t=bh(),n=b2();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(kz,{label:"shortcuts-dialog.tools",id:"tools",children:[(0,m.jsx)(kv,{...e["toggle-tool-lock"]}),(0,m.jsx)(kv,{...e["insert-media"]}),(0,m.jsx)(kv,{...t.select}),(0,m.jsx)(kv,{...t.draw}),(0,m.jsx)(kv,{...t.eraser}),(0,m.jsx)(kv,{...t.hand}),(0,m.jsx)(kv,{...t.rectangle}),(0,m.jsx)(kv,{...t.ellipse}),(0,m.jsx)(kv,{...t.arrow}),(0,m.jsx)(kv,{...t.line}),(0,m.jsx)(kv,{...t.text}),(0,m.jsx)(kv,{...t.frame}),(0,m.jsx)(kv,{...t.note}),(0,m.jsx)(kv,{...t.laser})]}),(0,m.jsxs)(kz,{label:"shortcuts-dialog.preferences",id:"preferences",children:[(0,m.jsx)(kv,{...e["toggle-dark-mode"]}),(0,m.jsx)(kv,{...e["toggle-focus-mode"]}),(0,m.jsx)(kv,{...e["toggle-grid"]})]}),(0,m.jsxs)(kz,{label:"shortcuts-dialog.edit",id:"edit",children:[(0,m.jsx)(kv,{...e.undo}),(0,m.jsx)(kv,{...e.redo}),(0,m.jsx)(kv,{...e.cut}),(0,m.jsx)(kv,{...e.copy}),(0,m.jsx)(kv,{...e.paste}),(0,m.jsx)(kv,{...e["select-all"]}),(0,m.jsx)(kv,{...e.delete}),(0,m.jsx)(kv,{...e.duplicate})]}),(0,m.jsxs)(kz,{label:"shortcuts-dialog.view",id:"view",children:[(0,m.jsx)(kv,{...e["zoom-in"]}),(0,m.jsx)(kv,{...e["zoom-out"]}),(0,m.jsx)(kv,{...e["zoom-to-100"]}),(0,m.jsx)(kv,{...e["zoom-to-fit"]}),(0,m.jsx)(kv,{...e["zoom-to-selection"]})]}),(0,m.jsxs)(kz,{label:"shortcuts-dialog.transform",id:"transform",children:[(0,m.jsx)(kv,{...e["bring-to-front"]}),(0,m.jsx)(kv,{...e["bring-forward"]}),(0,m.jsx)(kv,{...e["send-backward"]}),(0,m.jsx)(kv,{...e["send-to-back"]}),(0,m.jsx)(kv,{...e.group}),(0,m.jsx)(kv,{...e.ungroup}),(0,m.jsx)(kv,{...e["flip-horizontal"]}),(0,m.jsx)(kv,{...e["flip-vertical"]}),(0,m.jsx)(kv,{...e["align-top"]}),(0,m.jsx)(kv,{...e["align-center-vertical"]}),(0,m.jsx)(kv,{...e["align-bottom"]}),(0,m.jsx)(kv,{...e["align-left"]}),(0,m.jsx)(kv,{...e["align-center-horizontal"]}),(0,m.jsx)(kv,{...e["align-right"]})]}),n&&(0,m.jsx)(kz,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:(0,m.jsx)(kv,{...e["open-cursor-chat"]})})]})}let C$=(0,y.memo)(function({children:e}){let t=ff(),n=bg(),r=e??(0,m.jsx)(CF,{});return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)(bn,{className:"tlui-shortcuts-dialog__header",children:[(0,m.jsx)(br,{children:t("shortcuts-dialog.title")}),(0,m.jsx)(bi,{})]}),(0,m.jsx)(bo,{className:i0("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":n<=y9.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":n<=y9.TABLET}),children:(0,m.jsx)(wi,{type:"keyboard-shortcuts",sourceId:"kbd",children:r})}),(0,m.jsx)("div",{className:"tlui-dialog__scrim"})]})}),CB=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function CU(){let e=i8(),t=ya(),n=iJ("colorScheme",()=>e.user.getUserPreferences().colorScheme??e.user.getIsDarkMode()?"dark":"light",[e]);return(0,m.jsx)(kR,{id:"help menu color-scheme",label:"menu.theme",children:(0,m.jsx)(kz,{id:"languages",children:CB.map(({colorScheme:r,label:i})=>(0,m.jsx)(kD,{id:`color-scheme-${r}`,label:i,checked:r===n,onSelect:()=>{e.user.updateUserPreferences({colorScheme:r}),t("color-scheme",{source:"menu",value:r})}},r))})})}function CV(){let e=i8(),t=ya(),n=iJ("locale",()=>e.user.getLocale(),[e]);return(0,m.jsx)(kR,{id:"help menu language",label:"menu.language",children:(0,m.jsx)(kz,{id:"languages",children:iK.map(({locale:r,label:i})=>(0,m.jsx)(kD,{id:`language-${r}`,title:r,label:i,checked:r===n,onSelect:()=>{e.user.updateUserPreferences({locale:r}),t("change-language",{source:"menu",locale:r})}},r))})})}function CH(){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(CV,{}),(0,m.jsx)(CK,{})]})}function CK(){let{KeyboardShortcutsDialog:e}=Ia(),{addDialog:t}=yd();return e?(0,m.jsx)(kv,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{t({component:e})}}):null}function CW(){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(Cq,{}),(0,m.jsx)(CQ,{}),(0,m.jsx)(CG,{}),(0,m.jsx)(CJ,{}),(0,m.jsx)(C1,{}),(0,m.jsx)(C0,{})]})}function CG(){let e=b6();return(0,m.jsxs)(kR,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[(0,m.jsxs)(kz,{id:"export-all-as-group",children:[(0,m.jsx)(kv,{...e["export-all-as-svg"]}),(0,m.jsx)(kv,{...e["export-all-as-png"]}),(0,m.jsx)(kv,{...e["export-all-as-json"]})]}),(0,m.jsx)(kz,{id:"export-all-as-bg",children:(0,m.jsx)(kq,{})})]})}function Cq(){let e=i8(),t=iJ("isSelectToolActive",()=>"select"===e.getCurrentToolId(),[e]);return(0,m.jsxs)(kR,{id:"edit",label:"menu.edit",disabled:!t,children:[(0,m.jsx)(CZ,{}),(0,m.jsx)(kJ,{}),(0,m.jsx)(k5,{}),(0,m.jsx)(CY,{}),(0,m.jsx)(CX,{}),(0,m.jsx)(kz,{id:"select-all",children:(0,m.jsx)(k4,{})})]})}function CY(){return(0,m.jsxs)(kz,{id:"misc",children:[(0,m.jsx)(kV,{}),(0,m.jsx)(kH,{}),(0,m.jsx)(k$,{}),(0,m.jsx)(kF,{}),(0,m.jsx)(kK,{}),(0,m.jsx)(kW,{}),(0,m.jsx)(Ci,{}),(0,m.jsx)(Cr,{}),(0,m.jsx)(kU,{})]})}function CX(){return(0,m.jsxs)(kz,{id:"lock",children:[(0,m.jsx)(kG,{}),(0,m.jsx)(kY,{})]})}function CZ(){let e=b6(),t=wf(),n=wp();return(0,m.jsxs)(kz,{id:"undo-redo",children:[(0,m.jsx)(kv,{...e.undo,disabled:!t}),(0,m.jsx)(kv,{...e.redo,disabled:!n})]})}function CQ(){let e=b6();return(0,m.jsx)(kR,{id:"view",label:"menu.view",children:(0,m.jsxs)(kz,{id:"view-actions",children:[(0,m.jsx)(kv,{...e["zoom-in"]}),(0,m.jsx)(kv,{...e["zoom-out"]}),(0,m.jsx)(kX,{}),(0,m.jsx)(kZ,{}),(0,m.jsx)(kQ,{})]})})}function CJ(){let e=b6();return(0,m.jsxs)(kz,{id:"extras",children:[(0,m.jsx)(kv,{...e["insert-embed"]}),(0,m.jsx)(kv,{...e["insert-media"]})]})}function C0(){return(0,m.jsx)(kz,{id:"help",children:(0,m.jsx)(kR,{id:"help",label:"menu.help",children:(0,m.jsxs)(kz,{id:"help-actions",children:[(0,m.jsx)(CK,{}),(0,m.jsx)(kv,{id:"about",label:"help-menu.docs",icon:"external-link",readonlyOk:!0,onSelect:()=>{var e;e="https://tldraw.dev",window.open(e,"_blank")}})]})})})}function C1(){return(0,m.jsx)(kz,{id:"preferences",children:(0,m.jsxs)(kR,{id:"preferences",label:"menu.preferences",children:[(0,m.jsxs)(kz,{id:"preferences-actions",children:[(0,m.jsx)(Co,{}),(0,m.jsx)(Cs,{}),(0,m.jsx)(Ca,{}),(0,m.jsx)(Cl,{}),(0,m.jsx)(Cc,{}),(0,m.jsx)(Cd,{}),(0,m.jsx)(Cu,{}),(0,m.jsx)(Cp,{}),(0,m.jsx)(Cf,{}),(0,m.jsx)(Ch,{})]}),(0,m.jsx)(kz,{id:"color-scheme",children:(0,m.jsx)(CU,{})}),(0,m.jsx)(kz,{id:"language",children:(0,m.jsx)(CV,{})})]})})}let C2=(0,y.memo)(function({children:e}){let t=oK(),[n,r]=v9("main menu"),i=ff(),o=e??(0,m.jsx)(CW,{});return(0,m.jsxs)(S7,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,m.jsx)(kt,{asChild:!0,dir:"ltr",children:(0,m.jsx)(yJ,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:(0,m.jsx)(y6,{icon:"menu",small:!0})})}),(0,m.jsx)(kn,{container:t,children:(0,m.jsx)(ki,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:(0,m.jsx)(wi,{type:"menu",sourceId:"main-menu",children:o})})})]})}),C3={};function C5(e){if(C3[e])return C3[e];let t=document.createElement("canvas").getContext("2d");t.fillStyle=e,t.fillRect(0,0,1,1);let[n,r,i,o]=t.getImageData(0,0,1,1).data,s=new Float32Array([n/255,r/255,i/255,o/255]);return C3[e]=s,s}function C4(e,{center:t,radius:n,numArcSegments:r=20,startAngle:i=0,endAngle:o=oa,offset:s=0}){let a=(o-i)/r,l=s;for(let r=i;r<o;r+=a)e[l++]=t.x,e[l++]=t.y,e[l++]=t.x+Math.cos(r)*n,e[l++]=t.y+Math.sin(r)*n,e[l++]=t.x+Math.cos(r+a)*n,e[l++]=t.y+Math.sin(r+a)*n;return e}function C6(e,t,n,r,i,o){e[t++]=n,e[t++]=r,e[t++]=n,e[t++]=r+o,e[t++]=n+i,e[t++]=r,e[t++]=n+i,e[t++]=r,e[t++]=n,e[t++]=r+o,e[t++]=n+i,e[t++]=r+o}function C8(e,t){let n=e.createBuffer();if(!n)throw Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(t)}}function C9(e,t,n){let r=e.vertices.length;for(;r<t+n.length;)r*=2;if(r!=e.vertices.length){let t=new Float32Array(r);t.set(e.vertices),e.vertices=t}e.vertices.set(n,t)}var C7=Object.defineProperty,Pe=Object.getOwnPropertyDescriptor,Pt=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?Pe(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&C7(t,n,o),o};class Pn{constructor(e,t,n){this.editor=e,this.elem=t,this.container=n,this.gl=function(e){if(!e)throw Error("Canvas element not found");let t=e.getContext("webgl2",{premultipliedAlpha:!1});if(!t)throw Error("Failed to get webgl2 context");let n=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=t.createShader(t.VERTEX_SHADER);if(!r)throw Error("Failed to create vertex shader");if(t.shaderSource(r,n),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw Error("Failed to compile vertex shader");let i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,o=t.createShader(t.FRAGMENT_SHADER);if(!o)throw Error("Failed to create fragment shader");if(t.shaderSource(o,i),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS))throw Error("Failed to compile fragment shader");let s=t.createProgram();if(!s)throw Error("Failed to create program");if(t.attachShader(s,r),t.attachShader(s,o),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw Error("Failed to link program");t.useProgram(s);let a=t.getAttribLocation(s,"shapeVertexPosition");if(a<0)throw Error("Failed to get shapeVertexPosition attribute location");t.enableVertexAttribArray(a);let l=t.getUniformLocation(s,"canvasPageBounds"),c=t.getUniformLocation(s,"fillColor");if(!t.createBuffer()||!t.createBuffer())throw Error("Failed to create buffer");return{context:t,selectedShapes:C8(t,1024),unselectedShapes:C8(t,4096),viewport:C8(t,300),collaborators:C8(t,1024),prepareTriangles(e,n){t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.bufferData(t.ARRAY_BUFFER,e.vertices,t.STATIC_DRAW,0,n),t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0)},drawTrianglesTransparently(e){t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.drawArrays(t.TRIANGLES,0,e/2),t.disable(t.BLEND)},drawTriangles(e){t.drawArrays(t.TRIANGLES,0,e/2)},setFillColor(e){t.uniform4fv(c,e)},setCanvasPageBounds(e){t.uniform4fv(l,e)}}}(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",t=>{let n=e.getShapeMaskedPageBounds(t.id);if(!n)return null;let r=new Float32Array(12);return C6(r,0,n.x,n.y,n.w,n.h),r}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),B("minimap render",this.render))}disposables=[];close=()=>this.disposables.forEach(e=>e());gl;shapeGeometryCache;_getColors(){let e=getComputedStyle(this.editor.getContainer());return{shapeFill:C5(e.getPropertyValue("--color-text-3").trim()),selectFill:C5(e.getPropertyValue("--color-selected").trim()),viewportFill:C5(e.getPropertyValue("--color-muted-1").trim()),background:C5(e.getPropertyValue("--color-low").trim())}}colors;updateColors(){this.colors=this._getColors()}id=a$();getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){let e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?sL.Expand(t,e):e}getContentScreenBounds(){let e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),n=this.editor.pageToScreen(new ot(e.maxX,e.maxY));return new sL(t.x,t.y,n.x-t.x,n.y-t.y)}_getCanvasBoundingRect(){let{x:e,y:t,width:n,height:r}=this.elem.getBoundingClientRect();return new sL(e,t,n,r)}canvasBoundingClientRect=X("canvasBoundingClientRect",new sL);getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){let e=new ResizeObserver(()=>{let e=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(e)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){let e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new ot(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}originPagePoint=new ot;originPageCenter=new ot;isInViewport=!1;getCanvasPageBounds(){let e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),n=e.width/e.height,r=t.width,i=r/n;i<t.height&&(r=(i=t.height)*n);let o=new sL(0,0,r,i);return o.center=t.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){let{x:e,y:t,w:n,h:r}=this.getCanvasPageBounds();return new Float32Array([e,t,n,r])}getMinimapPagePoint=(e,t)=>{let n=this.getCanvasPageBounds(),r=this.getCanvasScreenBounds(),i=e-r.x,o=t-r.y;return i*=n.width/r.width,o*=n.height/r.height,new ot(i+=n.minX,o+=n.minY,1)};minimapScreenPointToPagePoint=(e,t,n=!1,r=!1)=>{let{editor:i}=this,o=i.getViewportPageBounds(),{x:s,y:a}=this.getMinimapPagePoint(e,t);if(r){let e=this.editor.getCurrentPageBounds()??new sL,t=e.minX-o.width/2,n=e.maxX+o.width/2,r=e.minY-o.height/2,i=e.maxY+o.height/2,l=Math.max(0,t+o.width-s),c=Math.max(0,-(n-o.width-s)),d=Math.max(0,r+o.height-a),u=Math.max(0,-(i-o.height-a));s+=(l-c)/2,a+=(d-u)/2,s=oc(s,t,n),a=oc(a,r,i)}if(n){let{originPagePoint:e}=this;Math.abs(s-e.x)>Math.abs(a-e.y)?a=e.y:s=e.x}return new ot(s,a)};render=()=>{let e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);let n=new Set(this.editor.getSelectedShapeIds()),r=this.colors,i=0,o=0,s=this.editor.getCurrentPageShapeIdsSorted();for(let e=0,t=s.length;e<t;e++){let t=s[e],r=this.shapeGeometryCache.get(t);if(!r)continue;let a=r.length;n.has(t)?(C9(this.gl.selectedShapes,i,r),i+=a):(C9(this.gl.unselectedShapes,o,r),o+=a)}this.drawShapes(this.gl.unselectedShapes,o,r.shapeFill),this.drawShapes(this.gl.selectedShapes,i,r.selectFill),this.drawViewport(),this.drawCollaborators()};drawShapes(e,t,n){this.gl.prepareTriangles(e,t),this.gl.setFillColor(n),this.gl.drawTriangles(t)}drawViewport(){let e=this.editor.getViewportPageBounds(),t=function(e,t,n){n=Math.min(n,Math.min(t.w,t.h)/2);let r=sL.ExpandBy(t,-n);if(r.w<=0||r.h<=0)return C4(e,{center:t.center,radius:n,numArcSegments:40}),240;let i=0;return C6(e,0,r.minX,r.minY,r.w,r.h),C6(e,i+=12,r.minX,t.minY,r.w,n),C6(e,i+=12,r.maxX,r.minY,n,r.h),C6(e,i+=12,r.minX,r.maxY,r.w,n),C6(e,i+=12,t.minX,r.minY,n,r.h),C4(e,{numArcSegments:10,offset:i+=12,center:r.point,radius:n,startAngle:oo,endAngle:1.5*oo}),C4(e,{numArcSegments:10,offset:i+=60,center:ot.Add(r.point,new ot(r.w,0)),radius:n,startAngle:1.5*oo,endAngle:oa}),C4(e,{numArcSegments:10,offset:i+=60,center:ot.Add(r.point,r.size),radius:n,startAngle:0,endAngle:os}),C4(e,{numArcSegments:10,offset:i+=60,center:ot.Add(r.point,new ot(0,r.h)),radius:n,startAngle:os,endAngle:oo}),300}(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),this.editor.environment.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){let e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;let t=120*e.length;this.gl.collaborators.vertices.length<t&&(this.gl.collaborators.vertices=new Float32Array(t));let n=this.gl.collaborators.vertices,r=0,i=this.getZoom();for(let{cursor:t}of e)C4(n,{center:ot.From(t),radius:3*i,offset:r,numArcSegments:20}),r+=120;for(let{color:n}of(this.gl.prepareTriangles(this.gl.collaborators,t),r=0,e))this.gl.setFillColor(C5(n)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,r/2,60),r+=120}}function Pr(){let e=i8(),t=oK(),n=y.useRef(null),r=y.useRef(!1),i=y.useRef();y.useEffect(()=>{try{let r=new Pn(e,n.current,t);return i.current=r,i.current.close}catch(t){e.annotateError(t,{origin:"minimap",willCrashApp:!1}),e.timers.setTimeout(()=>{throw t})}},[e,t]);let o=y.useCallback(t=>{if(!e.getCurrentPageShapeIds().size||!i.current)return;let n=i.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!1),r=i.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!0);i.current.originPagePoint.setTo(r),i.current.originPageCenter.setTo(e.getViewportPageBounds().center),e.centerOnPoint(n,{animation:{duration:e.options.animationMediumMs}})},[e]),s=y.useCallback(t=>{if(!i.current)return;let n=t.currentTarget;if(oR(n,t),!e.getCurrentPageShapeIds().size)return;r.current=!0,i.current.isInViewport=!1;let o=i.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!1),s=e.getViewportPageBounds(),a=i.current.getContentPageBounds();if(new sL(a.x-s.width/2,a.y-s.height/2,a.width+s.width,a.height+s.height).containsPoint(o)&&!s.containsPoint(o)){i.current.isInViewport=s.containsPoint(o);let t=ot.Sub(s.center,s.point),n=ot.Add(o,t);i.current.originPagePoint.setTo(n),i.current.originPageCenter.setTo(o),e.centerOnPoint(o,{animation:{duration:e.options.animationMediumMs}})}else{let e=i.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!0);i.current.isInViewport=s.containsPoint(e),i.current.originPagePoint.setTo(e),i.current.originPageCenter.setTo(s.center)}document.body.addEventListener("pointerup",function e(t){n&&oN(n,t),r.current=!1,document.body.removeEventListener("pointerup",e)})},[e]),a=y.useCallback(t=>{if(!i.current)return;let n=i.current.minimapScreenPointToPagePoint(t.clientX,t.clientY,t.shiftKey,!0);if(r.current){if(i.current.isInViewport){let t=i.current.originPagePoint.clone().sub(i.current.originPageCenter);e.centerOnPoint(ot.Sub(n,t));return}e.centerOnPoint(n)}let o=i.current.getMinimapPagePoint(t.clientX,t.clientY),s=e.pageToScreen(o),a={type:"pointer",target:"canvas",name:"pointer_move",...oB(t),point:s,isPen:e.getInstanceState().isPenMode};e.dispatch(a)},[e]),l=y.useCallback(t=>{let n=sT(t);e.dispatch({type:"wheel",name:"wheel",delta:n,point:new ot(t.clientX,t.clientY),shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey})},[e]),c=cD();return y.useEffect(()=>{e.timers.setTimeout(()=>{i.current?.updateColors(),i.current?.render()})},[c,e]),(0,m.jsx)("div",{className:"tlui-minimap",children:(0,m.jsx)("canvas",{role:"img","aria-label":"minimap",ref:n,className:"tlui-minimap__canvas",onDoubleClick:o,onPointerMove:a,onPointerDown:s,onWheel:l})})}Pt([es],Pn.prototype,"getDpr",1),Pt([es],Pn.prototype,"getContentPageBounds",1),Pt([es],Pn.prototype,"getContentScreenBounds",1),Pt([es],Pn.prototype,"getCanvasSize",1),Pt([es],Pn.prototype,"getCanvasClientPosition",1),Pt([es],Pn.prototype,"getCanvasPageBounds",1),Pt([es],Pn.prototype,"getZoom",1),Pt([es],Pn.prototype,"getCanvasPageBoundsArray",1);let Pi=(0,y.memo)(function(){let e=b6(),t=ff(),n=bg(),[r,i]=function(e,t){let[n,r]=y.useState(t);return y.useLayoutEffect(()=>{let t=ts(e);if(t)try{r(JSON.parse(t))}catch(t){console.error(`Could not restore value ${e} from local storage.`)}},[e]),[n,y.useCallback(t=>{r(n=>{let r="function"==typeof t?t(n):t;return ta(e,JSON.stringify(r)),r})},[e])]}("minimap",!0),o=(0,y.useCallback)(()=>{i(e=>!e)},[i]),{ZoomMenu:s,Minimap:a}=Ia();return n<y9.MOBILE?null:(0,m.jsxs)("div",{className:"tlui-navigation-panel",children:[(0,m.jsx)("div",{className:"tlui-buttons__horizontal",children:s&&n<y9.TABLET?(0,m.jsx)(s,{}):r?(0,m.jsxs)(m.Fragment,{children:[s&&(0,m.jsx)(s,{}),a&&(0,m.jsx)(yJ,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:(0,m.jsx)(y6,{icon:r?"chevrons-ne":"chevrons-sw"})})]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(yJ,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(b8(e["zoom-out"].label))} ${S1(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:(0,m.jsx)(y6,{icon:"minus"})}),s&&(0,m.jsx)(s,{}),(0,m.jsx)(yJ,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(b8(e["zoom-in"].label))} ${S1(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:(0,m.jsx)(y6,{icon:"plus"})}),a&&(0,m.jsx)(yJ,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:(0,m.jsx)(y6,{icon:r?"chevrons-ne":"chevrons-sw"})})]})}),a&&n>=y9.TABLET&&!r&&(0,m.jsx)(a,{})]})}),Po=function({name:e,id:t,isCurrentPage:n}){let r=i8(),i=ya(),o=(0,y.useRef)(null),s=(0,y.useCallback)(()=>{r.mark("rename page")},[r]),a=(0,y.useCallback)(e=>{r.renamePage(t,e||"New Page"),i("rename-page",{source:"page-menu"})},[r,t,i]);return(0,m.jsx)(ba,{className:"tlui-page-menu__item__input",ref:e=>o.current=e,defaultValue:e,onValueChange:a,onFocus:s,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:n,autoSelect:!0})},Ps=(e,t,n,r,i)=>{let o;let s=e.getPages(),a=n>r?s[r-1]:s[r],l=n>r?s[r]:s[r+1];(o=a&&!l?tn(a.index):!a&&l?e7(void 0,s[0].index,1)[0]:tt(a.index,l.index))!==s[n].index&&(e.mark("moving page"),e.updatePage({id:t,index:o}),i("move-page",{source:"page-menu"}))},Pa=iZ(function({index:e,listSize:t,item:n,onRename:r}){let i=i8(),o=ff(),s=i.getPages(),a=ya(),l=(0,y.useCallback)(()=>{i.mark("creating page");let e=rb.createId();i.duplicatePage(n.id,e),a("duplicate-page",{source:"page-menu"})},[i,n,a]),c=(0,y.useCallback)(()=>{Ps(i,n.id,e,e-1,a)},[i,n,e,a]),d=(0,y.useCallback)(()=>{Ps(i,n.id,e,e+1,a)},[i,n,e,a]),u=(0,y.useCallback)(()=>{i.mark("deleting page"),i.deletePage(n.id),a("delete-page",{source:"page-menu"})},[i,n,a]);return(0,m.jsxs)(ku,{id:`page item submenu ${e}`,children:[(0,m.jsx)(kh,{children:(0,m.jsx)(yJ,{type:"icon",title:o("page-menu.submenu.title"),children:(0,m.jsx)(y6,{icon:"dots-vertical"})})}),(0,m.jsx)(kp,{alignOffset:0,side:"right",sideOffset:-4,children:(0,m.jsxs)(wi,{type:"menu",sourceId:"page-menu",children:[(0,m.jsxs)(kz,{id:"modify",children:[r&&(0,m.jsx)(kv,{id:"rename",label:"page-menu.submenu.rename",onSelect:r}),(0,m.jsx)(kv,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:l,disabled:s.length>=i.options.maxPages}),e>0&&(0,m.jsx)(kv,{id:"move-up",onSelect:c,label:"page-menu.submenu.move-up"}),e<t-1&&(0,m.jsx)(kv,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:d})]}),t>1&&(0,m.jsx)(kz,{id:"delete",children:(0,m.jsx)(kv,{id:"delete",onSelect:u,label:"page-menu.submenu.delete"})})]})})]})}),Pl=(0,y.memo)(function(){let e=i8(),t=ya(),n=ff(),r=bg(),[i,o]=v9("page-menu",(0,y.useCallback)(()=>f(!1),[])),s=(0,y.useRef)(null),a=iJ("pages",()=>e.getPages(),[e]),l=iJ("currentPage",()=>e.getCurrentPage(),[e]),c=iJ("currentPageId",()=>e.getCurrentPageId(),[e]),d=ur(),u=iJ("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),h=iJ("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[p,f]=(0,y.useState)(!1),g=(0,y.useCallback)(()=>{d||f(e=>!e)},[d]),b=(0,y.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[x,v]=(0,y.useState)(Object.fromEntries(a.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])));(0,y.useLayoutEffect)(()=>{v(Object.fromEntries(a.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])))},[36,a]),(0,y.useEffect)(()=>{i&&e.timers.requestAnimationFrame(()=>{let e=document.querySelector(`[data-testid="page-menu-item-${c}"]`);if(e){let t=s.current;if(!t)return;let n=e.offsetTop;n<t.scrollTop&&t.scrollTo({top:n});let r=n+36;r>t.scrollTop+t.offsetHeight&&t.scrollTo({top:r-t.offsetHeight})}})},[36,c,i,e]);let w=(0,y.useCallback)(e=>{let{clientY:t,currentTarget:n}=e,{dataset:{id:r,index:i}}=n;if(!r||!i)return;let o=b.current;oR(e.currentTarget,e),o.status="pointing",o.pointing={id:r,index:+i};let s=x[r].y;o.startY=t,o.startIndex=Math.max(0,Math.min(Math.round(s/36),a.length-1))},[36,a.length,x]),S=(0,y.useCallback)(e=>{let t=b.current;if("pointing"===t.status){let{clientY:n}=e;Math.abs(n-t.startY)>5&&(t.status="dragging")}if("dragging"===t.status){let{clientY:n}=e,r=n-t.startY,i=x[t.pointing.id],{startIndex:o,pointing:s}=t,l=Math.max(0,Math.min(Math.round((i.y+r)/36),a.length-1)),c={...x};if(c[s.id]={y:i.y,offsetY:r,isSelected:!0},l!==t.dragIndex){t.dragIndex=l;for(let e=0;e<a.length;e++){let n=a[e];if(n.id===t.pointing.id)continue;let{y:r}=c[n.id];l===o?r=36*e:l<o?r=l<=e&&e<o?(e+1)*36:36*e:l>o&&(r=l>=e&&e>o?(e-1)*36:36*e),r!==c[n.id].y&&(c[n.id]={y:r,offsetY:0,isSelected:!0})}}v(c)}},[36,a,x]),k=(0,y.useCallback)(n=>{let r=b.current;if("dragging"===r.status){let{id:n,index:i}=r.pointing;Ps(e,n,i,r.dragIndex,t)}oN(n.currentTarget,n),r.status="idle"},[e,t]),C=(0,y.useCallback)(e=>{let t=b.current;"Escape"===e.key&&("dragging"===t.status&&v(Object.fromEntries(a.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}]))),t.status="idle")},[36,a]),P=(0,y.useCallback)(()=>{d||(e.run(()=>{e.mark("creating page");let t=rb.createId();e.createPage({name:n("page-menu.new-page-initial-name"),id:t}),e.setCurrentPage(t),f(!0)}),t("new-page",{source:"page-menu"}))},[e,n,d,t]),_=(0,y.useCallback)(n=>{e.setCurrentPage(n),t("change-page",{source:"page-menu"})},[e,t]),I=(0,y.useCallback)((n,r)=>{e.renamePage(n,r),t("rename-page",{source:"page-menu"})},[e,t]);return(0,m.jsxs)(v7,{id:"pages",onOpenChange:o,open:i,children:[(0,m.jsx)(we,{"data-testid":"main.page-menu",children:(0,m.jsxs)(yJ,{type:"menu",title:l.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[(0,m.jsx)("div",{className:"tlui-page-menu__name",children:l.name}),(0,m.jsx)(y6,{icon:"chevron-down",small:!0})]})}),(0,m.jsx)(wt,{side:"bottom",align:"start",sideOffset:6,children:(0,m.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,m.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,m.jsx)("div",{className:"tlui-page-menu__header__title",children:n("page-menu.title")}),!d&&(0,m.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,m.jsx)(yJ,{type:"icon","data-testid":"page-menu.edit",title:n(p?"page-menu.edit-done":"page-menu.edit-start"),onClick:g,children:(0,m.jsx)(y6,{icon:p?"check":"edit"})}),(0,m.jsx)(yJ,{type:"icon","data-testid":"page-menu.create",title:n(u?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:u,onClick:P,children:(0,m.jsx)(y6,{icon:"plus"})})]})]}),(0,m.jsx)("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:36*a.length+4},ref:s,children:a.map((t,i)=>{let o=x[t.id]??{position:40*i,offsetY:0};return p?(0,m.jsxs)("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:t.id===l.id?888:i,transform:`translate(0px, ${o.y+o.offsetY}px)`},children:[(0,m.jsx)(yJ,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:w,onPointerUp:k,onPointerMove:S,onKeyDown:C,"data-id":t.id,"data-index":i,children:(0,m.jsx)(y6,{icon:"drag-handle-dots"})}),r<y9.TABLET_SM&&h?(0,m.jsxs)(yJ,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{let e=window.prompt("Rename page",t.name);e&&e!==t.name&&I(t.id,e)},onDoubleClick:g,children:[(0,m.jsx)(CS,{checked:t.id===l.id}),(0,m.jsx)(y0,{children:t.name})]}):(0,m.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:36},children:(0,m.jsx)(Po,{id:t.id,name:t.name,isCurrentPage:t.id===l.id})}),!d&&(0,m.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":p,children:(0,m.jsx)(Pa,{index:i,item:t,listSize:a.length})})]},t.id+"_editing"):(0,m.jsxs)("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[(0,m.jsxs)(yJ,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>_(t.id),onDoubleClick:g,title:n("page-menu.go-to-page"),children:[(0,m.jsx)(CS,{checked:t.id===l.id}),(0,m.jsx)(y0,{children:t.name})]}),!d&&(0,m.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,m.jsx)(Pa,{index:i,item:t,listSize:a.length,onRename:()=>{if(e.environment.isIos){let e=window.prompt("Rename page",t.name);e&&e!==t.name&&I(t.id,e)}else f(!0),c!==t.id&&_(t.id)}})})]},t.id)})})]})})]})});function Pc(){let e=b6(),t=i8(),n=wf(),r=wp(),i=wu(1),o=ur(),s=iJ("should display quick actions",()=>t.isInAny("select","hand","zoom"),[t]),a=ws(),l=i&&a;if(!o||s)return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(kv,{...e.undo,disabled:!n}),(0,m.jsx)(kv,{...e.redo,disabled:!r}),(0,m.jsx)(kv,{...e.delete,disabled:!l}),(0,m.jsx)(kv,{...e.duplicate,disabled:!l})]})}let Pd=(0,y.memo)(function({children:e}){let t=e??(0,m.jsx)(Pc,{});return(0,m.jsx)(wi,{type:"small-icons",sourceId:"quick-actions",children:t})});function Pu({userId:e}){let t=sV(e);return t?(0,m.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:t.color},children:"New User"===t.userName?"":t.userName[0]??""},e):null}let Ph=iZ(function({userId:e}){let t=i8(),n=ff(),r=ya(),i=sV(e),o=(0,y.useCallback)(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),r("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),r("start-following",{source:"people-menu"}))},[t,e,r]),s=i?.followingUserId===t.user.getId(),a=t.getInstanceState().followingUserId===e;return i?(0,m.jsxs)("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[(0,m.jsxs)(yJ,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:o,children:[(0,m.jsx)(y1,{icon:"color",color:i.color}),(0,m.jsx)("div",{className:"tlui-people-menu__name",children:i.userName??"New User"})]}),(0,m.jsx)(yJ,{type:"icon",className:"tlui-people-menu__item__follow",title:n(s?"people-menu.leading":a?"people-menu.following":"people-menu.follow"),onClick:o,disabled:s,"data-active":a||s,children:(0,m.jsx)(y6,{icon:s?"leading":a?"following":"follow"})})]}):null});function Pp({count:e}){return(0,m.jsx)("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(e)})}let Pf=iZ(function(){let e=i8(),t=oK(),n=ff(),r=ya(),i=(0,y.useRef)(!1),[o,s]=(0,y.useState)(!1),a=(0,y.useCallback)(e=>{s(e)},[]),l=e.user.getColor(),c=(0,y.useCallback)(t=>{e.user.updateUserPreferences({color:t}),r("set-color",{source:"people-menu"})},[e,r]),{handleButtonClick:d,handleButtonPointerDown:u,handleButtonPointerEnter:h,handleButtonPointerUp:p}=y.useMemo(()=>{let e=()=>{i.current=!1,window.removeEventListener("pointerup",e)};return{handleButtonClick:e=>{let{id:t}=e.currentTarget.dataset;t&&l!==t&&c(t)},handleButtonPointerDown:t=>{let{id:n}=t.currentTarget.dataset;n&&(c(n),i.current=!0,window.addEventListener("pointerup",e))},handleButtonPointerEnter:e=>{if(!i.current)return;let{id:t}=e.currentTarget.dataset;t&&c(t)},handleButtonPointerUp:e=>{let{id:t}=e.currentTarget.dataset;t&&c(t)}}},[l,c]);return(0,m.jsxs)(vW,{onOpenChange:a,open:o,children:[(0,m.jsx)(vY,{dir:"ltr",asChild:!0,children:(0,m.jsx)(yJ,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:n("people-menu.change-color"),children:(0,m.jsx)(y6,{icon:"color"})})}),(0,m.jsx)(vJ,{container:t,children:(0,m.jsx)(v1,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:(0,m.jsx)("div",{className:"tlui-buttons__grid",children:aK.map(e=>(0,m.jsx)(yJ,{type:"icon","data-id":e,"data-testid":e,"aria-label":e,"data-state":l===e?"hinted":void 0,title:e,className:"tlui-button-grid__button",style:{color:e},onPointerEnter:h,onPointerDown:u,onPointerUp:p,onClick:d,children:(0,m.jsx)(y6,{icon:"color"})},e))})})})]})});function Pg(){let e=i8(),t=ya(),n=iJ("userName",()=>e.user.getName(),[]),r=ff(),i=(0,y.useRef)(n),o=(0,y.useRef)(n),[s,a]=(0,y.useState)(!1),l=(0,y.useCallback)(()=>{a(e=>!e)},[]),c=(0,y.useCallback)(t=>{o.current=t,e.user.updateUserPreferences({name:t})},[e]),d=(0,y.useCallback)(()=>{i.current!==o.current&&(t("change-user-name",{source:"people-menu"}),i.current=o.current)},[t]);return(0,m.jsxs)("div",{className:"tlui-people-menu__user",children:[(0,m.jsx)(Pf,{}),s?(0,m.jsx)(ba,{className:"tlui-people-menu__user__input",defaultValue:n,onValueChange:c,onComplete:l,onCancel:l,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{s||a(!0)},children:n}),"New User"===n?(0,m.jsx)("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),(0,m.jsx)(yJ,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:l,children:(0,m.jsx)(y6,{icon:s?"check":"edit"})})]})}let Pm=iZ(function({children:e}){let t=ff(),n=oK(),r=i8(),i=sU(),o=iJ("user",()=>r.user.getColor(),[r]),s=iJ("user",()=>r.user.getName(),[r]),[a,l]=v9("people menu");return(0,m.jsxs)(vW,{onOpenChange:l,open:a,children:[(0,m.jsx)(vY,{dir:"ltr",asChild:!0,children:(0,m.jsxs)("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:[i.length>5&&(0,m.jsx)(Pp,{count:i.length-5}),(0,m.jsxs)("div",{className:"tlui-people-menu__avatars",children:[i.slice(-5).map(e=>(0,m.jsx)(Pu,{userId:e},e)),(0,m.jsx)("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:"New User"===s?"":s[0]??""})]})]})}),(0,m.jsx)(vJ,{container:n,children:(0,m.jsx)(v1,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,children:(0,m.jsxs)("div",{className:"tlui-people-menu__wrapper",children:[(0,m.jsx)("div",{className:"tlui-people-menu__section",children:(0,m.jsx)(Pg,{})}),i.length>0&&(0,m.jsx)("div",{className:"tlui-people-menu__section",children:i.map(e=>(0,m.jsx)(Ph,{userId:e},e+"_presence"))}),e]})})})]})});function Py(){return(0,m.jsx)("div",{className:"tlui-share-zone",draggable:!1,children:(0,m.jsx)(Pm,{})})}let Pb=Object.freeze([n1,n3,n5,n8]);function Px(e=Pb){let t=i8();return iJ("getRelevantStyles",()=>{let n=new lL(t.getSharedStyles()),r=!!t.root.getCurrent()?.shapeType,i=t.isIn("select")&&t.getSelectedShapeIds().length>0;if(0===n.size&&t.isIn("select")&&0===t.getSelectedShapeIds().length)for(let r of e)n.applyValue(r,t.getStyleForNextShape(r));return r||i||n.size>0?n:null},[t])}let Pv={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},Pw=(0,y.memo)(function(e){let{uiType:t,items:n,title:r,style:i,value:o,onValueChange:s,theme:a}=e,l=i8(),c=ff(),d=(0,y.useRef)(!1),u=(0,y.useRef)(null),{handleButtonClick:h,handleButtonPointerDown:p,handleButtonPointerEnter:f,handleButtonPointerUp:g}=(0,y.useMemo)(()=>{let e=()=>{d.current=!1,window.removeEventListener("pointerup",e);let t=u.current;t&&["TEXTAREA","INPUT"].includes(t.nodeName)&&t.focus(),u.current=null};return{handleButtonClick:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&(l.mark("point picker item"),s(i,t))},handleButtonPointerDown:t=>{let{id:n}=t.currentTarget.dataset;l.mark("point picker item"),s(i,n),d.current=!0,u.current=document.activeElement,window.addEventListener("pointerup",e)},handleButtonPointerEnter:e=>{if(!d.current)return;let{id:t}=e.currentTarget.dataset;s(i,t)},handleButtonPointerUp:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&s(i,t)}}},[o,l,s,i]);return(0,m.jsx)("div",{"data-testid":`style.${t}`,className:i0("tlui-buttons__grid"),children:n.map(e=>(0,m.jsx)(yJ,{type:"icon","data-id":e.value,"data-testid":`style.${t}.${e.value}`,"aria-label":e.value,"data-state":"shared"===o.type&&o.value===e.value?"hinted":void 0,title:r+"  "+c(`${t}-style.${e.value}`),className:i0("tlui-button-grid__button"),style:i===n1?{color:a[e.value].solid}:void 0,onPointerEnter:f,onPointerDown:p,onPointerUp:g,onClick:h,children:(0,m.jsx)(y6,{icon:e.icon})},e.value))})});function PS(e,[t,n]){return Math.min(n,Math.max(t,e))}var Pk=["PageUp","PageDown"],PC=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],PP={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},P_="Slider",[PI,PE,Pj]=yg(P_),[PT,PM]=gv(P_,[Pj]),[PA,PO]=PT(P_),PL=y.forwardRef((e,t)=>{let{name:n,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:d,onValueChange:u=()=>{},onValueCommit:h=()=>{},inverted:p=!1,form:f,...g}=e,b=y.useRef(new Set),x=y.useRef(0),v="horizontal"===s?PR:PN,[w=[],S]=g_({prop:d,defaultProp:c,onChange:e=>{let t=[...b.current];t[x.current]?.focus(),u(e)}}),k=y.useRef(w);function C(e,t,{commit:n}={commit:!1}){let s=(String(o).split(".")[1]||"").length,a=PS(function(e,t){let n=Math.pow(10,t);return Math.round(e*n)/n}(Math.round((e-r)/o)*o+r,s),[r,i]);S((e=[])=>{var r,i;let s=function(e=[],t,n){let r=[...e];return r[n]=t,r.sort((e,t)=>e-t)}(e,a,t);if(r=s,!(!((i=l*o)>0)||Math.min(...r.slice(0,-1).map((e,t)=>r[t+1]-e))>=i))return e;{x.current=s.indexOf(a);let t=String(s)!==String(e);return t&&n&&h(s),t?s:e}})}return(0,m.jsx)(PA,{scope:e.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:x,thumbs:b.current,values:w,orientation:s,form:f,children:(0,m.jsx)(PI.Provider,{scope:e.__scopeSlider,children:(0,m.jsx)(PI.Slot,{scope:e.__scopeSlider,children:(0,m.jsx)(v,{"aria-disabled":a,"data-disabled":a?"":void 0,...g,ref:t,onPointerDown:gm(g.onPointerDown,()=>{a||(k.current=w)}),min:r,max:i,inverted:p,onSlideStart:a?void 0:function(e){let t=function(e,t){if(1===e.length)return 0;let n=e.map(e=>Math.abs(e-t)),r=Math.min(...n);return n.indexOf(r)}(w,e);C(e,t)},onSlideMove:a?void 0:function(e){C(e,x.current)},onSlideEnd:a?void 0:function(){let e=k.current[x.current];w[x.current]!==e&&h(w)},onHomeKeyDown:()=>!a&&C(r,0,{commit:!0}),onEndKeyDown:()=>!a&&C(i,w.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!a){let n=Pk.includes(e.key)||e.shiftKey&&PC.includes(e.key),r=x.current;C(w[r]+o*(n?10:1)*t,r,{commit:!0})}}})})})})});PL.displayName=P_;var[PD,Pz]=PT(P_,{startEdge:"left",endEdge:"right",size:"width",direction:1}),PR=y.forwardRef((e,t)=>{let{min:n,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...d}=e,[u,h]=y.useState(null),p=gx(t,e=>h(e)),f=y.useRef(void 0),g=wm(i),b="ltr"===g,x=b&&!o||!b&&o;function v(e){let t=f.current||u.getBoundingClientRect(),i=PY([0,t.width],x?[n,r]:[r,n]);return f.current=t,i(e-t.left)}return(0,m.jsx)(PD,{scope:e.__scopeSlider,startEdge:x?"left":"right",endEdge:x?"right":"left",direction:x?1:-1,size:"width",children:(0,m.jsx)(PF,{dir:g,"data-orientation":"horizontal",...d,ref:p,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=v(e.clientX);s?.(t)},onSlideMove:e=>{let t=v(e.clientX);a?.(t)},onSlideEnd:()=>{f.current=void 0,l?.()},onStepKeyDown:e=>{let t=PP[x?"from-left":"from-right"].includes(e.key);c?.({event:e,direction:t?-1:1})}})})}),PN=y.forwardRef((e,t)=>{let{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=e,d=y.useRef(null),u=gx(t,d),h=y.useRef(void 0),p=!i;function f(e){let t=h.current||d.current.getBoundingClientRect(),i=PY([0,t.height],p?[r,n]:[n,r]);return h.current=t,i(e-t.top)}return(0,m.jsx)(PD,{scope:e.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:(0,m.jsx)(PF,{"data-orientation":"vertical",...c,ref:u,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=f(e.clientY);o?.(t)},onSlideMove:e=>{let t=f(e.clientY);s?.(t)},onSlideEnd:()=>{h.current=void 0,a?.()},onStepKeyDown:e=>{let t=PP[p?"from-bottom":"from-top"].includes(e.key);l?.({event:e,direction:t?-1:1})}})})}),PF=y.forwardRef((e,t)=>{let{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=e,d=PO(P_,n);return(0,m.jsx)(gT.span,{...c,ref:t,onKeyDown:gm(e.onKeyDown,e=>{"Home"===e.key?(s(e),e.preventDefault()):"End"===e.key?(a(e),e.preventDefault()):Pk.concat(PC).includes(e.key)&&(l(e),e.preventDefault())}),onPointerDown:gm(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),d.thumbs.has(t)?t.focus():r(e)}),onPointerMove:gm(e.onPointerMove,e=>{e.target.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:gm(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),o(e))})})}),P$="SliderTrack",PB=y.forwardRef((e,t)=>{let{__scopeSlider:n,...r}=e,i=PO(P$,n);return(0,m.jsx)(gT.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:t})});PB.displayName=P$;var PU="SliderRange",PV=y.forwardRef((e,t)=>{let{__scopeSlider:n,...r}=e,i=PO(PU,n),o=Pz(PU,n),s=gx(t,y.useRef(null)),a=i.values.length,l=i.values.map(e=>Pq(e,i.min,i.max)),c=a>1?Math.min(...l):0,d=100-Math.max(...l);return(0,m.jsx)(gT.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:s,style:{...e.style,[o.startEdge]:c+"%",[o.endEdge]:d+"%"}})});PV.displayName=PU;var PH="SliderThumb",PK=y.forwardRef((e,t)=>{let n=PE(e.__scopeSlider),[r,i]=y.useState(null),o=gx(t,e=>i(e)),s=y.useMemo(()=>r?n().findIndex(e=>e.ref.current===r):-1,[n,r]);return(0,m.jsx)(PW,{...e,ref:o,index:s})}),PW=y.forwardRef((e,t)=>{let{__scopeSlider:n,index:r,name:i,...o}=e,s=PO(PH,n),a=Pz(PH,n),[l,c]=y.useState(null),d=gx(t,e=>c(e)),u=!l||s.form||!!l.closest("form"),h=vw(l),p=s.values[r],f=void 0===p?0:Pq(p,s.min,s.max),g=function(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}(r,s.values.length),b=h?.[a.size],x=b?function(e,t,n){let r=e/2,i=PY([0,50],[0,r]);return(r-i(t)*n)*n}(b,f,a.direction):0;return y.useEffect(()=>{if(l)return s.thumbs.add(l),()=>{s.thumbs.delete(l)}},[l,s.thumbs]),(0,m.jsxs)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${f}% + ${x}px)`},children:[(0,m.jsx)(PI.ItemSlot,{scope:e.__scopeSlider,children:(0,m.jsx)(gT.span,{role:"slider","aria-label":e["aria-label"]||g,"aria-valuemin":s.min,"aria-valuenow":p,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...o,ref:d,style:void 0===p?{display:"none"}:e.style,onFocus:gm(e.onFocus,()=>{s.valueIndexToChangeRef.current=r})})}),u&&(0,m.jsx)(PG,{name:i??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:p},r)]})});PK.displayName=PH;var PG=y.forwardRef(({__scopeSlider:e,value:t,...n},r)=>{let i=y.useRef(null),o=gx(i,r),s=function(e){let t=y.useRef({value:e,previous:e});return y.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}(t);return y.useEffect(()=>{let e=i.current;if(!e)return;let n=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"value").set;if(s!==t&&n){let r=new Event("input",{bubbles:!0});n.call(e,t),e.dispatchEvent(r)}},[s,t]),(0,m.jsx)(gT.input,{style:{display:"none"},...n,ref:o,defaultValue:t})});function Pq(e,t,n){return PS(100/(n-t)*(e-t),[0,100])}function PY(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}PG.displayName="RadioBubbleInput";let PX=(0,y.memo)(function(e){let{title:t,steps:n,value:r,label:i,onValueChange:o}=e,s=i8(),a=ff(),l=(0,y.useCallback)(e=>{o(e[0])},[o]),c=(0,y.useCallback)(()=>{s.mark("click slider")},[s]),d=(0,y.useCallback)(()=>{r&&o(r)},[r,o]);return(0,m.jsx)("div",{className:"tlui-slider__container",children:(0,m.jsxs)(PL,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:n,step:1,value:r?[r]:void 0,onPointerDown:c,onValueChange:l,onPointerUp:d,title:t+"  "+a(i),children:[(0,m.jsx)(PB,{className:"tlui-slider__track",dir:"ltr",children:null!==r&&(0,m.jsx)(PV,{className:"tlui-slider__range",dir:"ltr"})}),null!==r&&(0,m.jsx)(PK,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),PZ=y.memo(function({label:e,uiTypeA:t,uiTypeB:n,labelA:r,labelB:i,itemsA:o,itemsB:s,styleA:a,styleB:l,valueA:c,valueB:d,onValueChange:u}){let h=ff(),p=y.useMemo(()=>o.find(e=>"shared"===c.type&&c.value===e.value)?.icon??"mixed",[o,c]),f=y.useMemo(()=>s.find(e=>"shared"===d.type&&d.value===e.value)?.icon??"mixed",[s,d]);return void 0===c&&void 0===d?null:(0,m.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,m.jsx)("div",{title:h(e),className:"tlui-style-panel__double-select-picker-label",children:h(e)}),(0,m.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,m.jsxs)(ku,{id:`style panel ${t} A`,children:[(0,m.jsx)(kh,{children:(0,m.jsx)(yJ,{type:"icon","data-testid":`style.${t}`,title:h(r)+"  "+(null===c||"mixed"===c.type?h("style-panel.mixed"):h(`${t}-style.${c.value}`)),children:(0,m.jsx)(y6,{icon:p,small:!0,invertIcon:!0})})}),(0,m.jsx)(kp,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:(0,m.jsx)("div",{className:"tlui-buttons__grid",children:o.map((e,n)=>(0,m.jsx)(kb,{"data-testid":`style.${t}.${e.value}`,children:(0,m.jsx)(yJ,{type:"icon",onClick:()=>u(a,e.value),title:`${h(r)} \u2014 ${h(`${t}-style.${e.value}`)}`,children:(0,m.jsx)(y6,{icon:e.icon,invertIcon:!0})},e.value)},n))})})]}),(0,m.jsxs)(ku,{id:`style panel ${n}`,children:[(0,m.jsx)(kh,{children:(0,m.jsx)(yJ,{type:"icon","data-testid":`style.${n}`,title:h(i)+"  "+(null===d||"mixed"===d.type?h("style-panel.mixed"):h(`${n}-style.${d.value}`)),children:(0,m.jsx)(y6,{icon:f,small:!0})})}),(0,m.jsx)(kp,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:(0,m.jsx)("div",{className:"tlui-buttons__grid",children:s.map(e=>(0,m.jsx)(kb,{children:(0,m.jsx)(yJ,{type:"icon",title:`${h(i)} \u2014 ${h(`${n}-style.${e.value}`)}`,"data-testid":`style.${n}.${e.value}`,onClick:()=>u(l,e.value),children:(0,m.jsx)(y6,{icon:e.icon})})},e.value))})})]})]})]})}),PQ=y.memo(function({id:e,label:t,uiType:n,style:r,items:i,type:o,value:s,onValueChange:a}){let l=ff(),c=i8(),d=y.useMemo(()=>i.find(e=>"shared"===s.type&&e.value===s.value)?.icon,[i,s]),u="mixed"===s.type?l("style-panel.mixed"):l(`${n}-style.${s.value}`),h=t?l(t):"";return(0,m.jsxs)(ku,{id:`style panel ${e}`,children:[(0,m.jsx)(kh,{children:(0,m.jsxs)(yJ,{type:o,"data-testid":`style.${n}`,title:u,children:[(0,m.jsx)(y0,{children:h}),(0,m.jsx)(y6,{icon:d??"mixed"})]})}),(0,m.jsx)(kp,{side:"left",align:"center",alignOffset:0,children:(0,m.jsx)("div",{className:"tlui-buttons__grid",children:i.map(e=>(0,m.jsx)(kb,{children:(0,m.jsx)(yJ,{type:"icon","data-testid":`style.${n}.${e.value}`,title:l(`${n}-style.${e.value}`),onClick:()=>{c.mark("select style dropdown item"),a(r,e.value)},children:(0,m.jsx)(y6,{icon:e.icon})})},e.value))})})]})});function PJ({styles:e}){let t=cD();if(!e)return null;let n=e.get(ip),r=e.get(re),i=e.get(n7),o=e.get(i_),s=e.get(n4),a=n0({isDarkMode:t});return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(P1,{theme:a,styles:e}),void 0!==s&&(0,m.jsx)(P2,{theme:a,styles:e}),!(void 0===n&&void 0===r&&void 0===i&&void 0===o)&&(0,m.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[(0,m.jsx)(P3,{styles:e}),(0,m.jsx)(P4,{styles:e}),(0,m.jsx)(P5,{styles:e})]})]})}function P0(){let e=i8(),t=ya();return y.useMemo(()=>function(n,r){e.run(()=>{e.isIn("select")&&e.setStyleForSelectedShapes(n,r),e.setStyleForNextShapes(n,r),e.updateInstanceState({isChangingStyle:!0})}),t("set-style",{source:"style-panel",id:n.id,value:r})},[e,t])}function P1({styles:e,theme:t}){let n=ff(),r=i8(),i=P0(),o=e.get(n1),s=e.get(n5),a=e.get(n3),l=e.get(n8);return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[void 0===o?null:(0,m.jsx)(Pw,{title:n("style-panel.color"),uiType:"color",style:n1,items:Pv.color,value:o,onValueChange:i,theme:t}),(0,m.jsx)(P8,{})]}),(void 0!==s||void 0!==a||void 0!==l)&&(0,m.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[void 0===s?null:(0,m.jsx)(Pw,{title:n("style-panel.fill"),uiType:"fill",style:n5,items:Pv.fill,value:s,onValueChange:i,theme:t}),void 0===a?null:(0,m.jsx)(Pw,{title:n("style-panel.dash"),uiType:"dash",style:n3,items:Pv.dash,value:a,onValueChange:i,theme:t}),void 0===l?null:(0,m.jsx)(Pw,{title:n("style-panel.size"),uiType:"size",style:n8,items:Pv.size,value:l,onValueChange:(e,t)=>{i(e,t);let n=r.getSelectedShapeIds();n.length>0&&hf(r,n)},theme:t})]})]})}function P2({theme:e,styles:t}){let n=ff(),r=P0(),i=t.get(n4),o=t.get(iL),s=t.get(iu),a=t.get(ih);return void 0===i&&void 0===s?null:(0,m.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[void 0===i?null:(0,m.jsx)(Pw,{title:n("style-panel.font"),uiType:"font",style:n4,items:Pv.font,value:i,onValueChange:r,theme:e}),void 0===o?null:(0,m.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,m.jsx)(Pw,{title:n("style-panel.align"),uiType:"align",style:iL,items:Pv.textAlign,value:o,onValueChange:r,theme:e}),(0,m.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:(0,m.jsx)(yJ,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,m.jsx)(y6,{icon:"vertical-align-middle"})})})]}),void 0===s?null:(0,m.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,m.jsx)(Pw,{title:n("style-panel.align"),uiType:"align",style:iu,items:Pv.horizontalAlign,value:s,onValueChange:r,theme:e}),(0,m.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:void 0===a?(0,m.jsx)(yJ,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,m.jsx)(y6,{icon:"vertical-align-middle"})}):(0,m.jsx)(PQ,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:ih,items:Pv.verticalAlign,value:a,onValueChange:r})})]})]})}function P3({styles:e}){let t=P0(),n=e.get(ip);return void 0===n?null:(0,m.jsx)(PQ,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:ip,items:Pv.geo,value:n,onValueChange:t})}function P5({styles:e}){let t=P0(),n=e.get(i_);return void 0===n?null:(0,m.jsx)(PQ,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:i_,items:Pv.spline,value:n,onValueChange:t})}function P4({styles:e}){let t=P0(),n=e.get(re),r=e.get(n7);return n&&r?(0,m.jsx)(PZ,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:n7,itemsA:Pv.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:re,itemsB:Pv.arrowheadEnd,valueB:n,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}let P6=[.1,.25,.5,.75,1];function P8(){let e=i8(),t=iJ("opacity",()=>e.getSharedOpacity(),[e]),n=ya(),r=ff(),i=y.useCallback(t=>{let r=P6[t];e.run(()=>{e.isIn("select")&&e.setOpacityForSelectedShapes(r),e.setOpacityForNextShapes(r),e.updateInstanceState({isChangingStyle:!0})}),n("set-style",{source:"style-panel",id:"opacity",value:t})},[e,n]);if(void 0===t)return null;let o="mixed"===t.type?-1:P6.indexOf(function(e,t){let n;let r=1/0;for(let i of e){let e=t(i);e<r&&(n=i,r=e)}return n}(P6,e=>Math.abs(e-t.value)));return(0,m.jsx)(PX,{"data-testid":"style.opacity",value:o>=0?o:P6.length-1,label:"mixed"===t.type?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:i,steps:P6.length-1,title:r("style-panel.opacity")})}let P9=(0,y.memo)(function({isMobile:e,children:t}){let n=i8(),r=Px(),i=(0,y.useCallback)(()=>{e||n.updateInstanceState({isChangingStyle:!1})},[n,e]),o=t??(0,m.jsx)(PJ,{styles:r});return(0,m.jsx)("div",{className:i0("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:i,children:o})});function P7(){let e=i8(),t=ff(),n=Px(),r=n?.get(n1),i=n0({isDarkMode:e.user.getIsDarkMode()}),o=(r?.type==="shared"?i[r.value]:i.black).solid,s=iJ("disable style panel",()=>e.isInAny("hand","zoom","eraser","laser"),[e]),a=(0,y.useCallback)(t=>{t||e.updateInstanceState({isChangingStyle:!1})},[e]),{StylePanel:l}=Ia();return l?(0,m.jsxs)(v7,{id:"mobile style menu",onOpenChange:a,children:[(0,m.jsx)(we,{children:(0,m.jsx)(yJ,{type:"tool","data-testid":"mobile-styles.button",style:{color:s?"var(--color-muted-1)":o},title:t("style-panel.title"),disabled:s,children:(0,m.jsx)(y6,{icon:s?"blob":r?.type==="mixed"?"mixed":"blob"})})}),(0,m.jsx)(wt,{side:"top",align:"end",children:l&&(0,m.jsx)(l,{isMobile:!0})})]}):null}function _e(){return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(_n,{}),(0,m.jsx)(_r,{}),(0,m.jsx)(_i,{}),(0,m.jsx)(_o,{}),(0,m.jsx)(_s,{}),(0,m.jsx)(_a,{}),(0,m.jsx)(_l,{}),(0,m.jsx)(_c,{}),(0,m.jsx)(_d,{}),(0,m.jsx)(_u,{}),(0,m.jsx)(_p,{}),(0,m.jsx)(_h,{}),(0,m.jsx)(_m,{}),(0,m.jsx)(_x,{}),(0,m.jsx)(_f,{}),(0,m.jsx)(_b,{}),(0,m.jsx)(_y,{}),(0,m.jsx)(_g,{}),(0,m.jsx)(_v,{}),(0,m.jsx)(_w,{}),(0,m.jsx)(_S,{}),(0,m.jsx)(_k,{}),(0,m.jsx)(_C,{}),(0,m.jsx)(_P,{}),(0,m.jsx)(__,{}),(0,m.jsx)(_I,{}),(0,m.jsx)(_j,{}),(0,m.jsx)(_E,{})]})}function _t({tool:e}){let t=bh(),n=function(e){let t=i8(),n=e.meta?.geo;return iJ("is tool selected",()=>{let r=t.getCurrentToolId(),i=t.getSharedStyles().getAsKnownValue(ip);return n?"geo"===r&&i===n:r===e.id},[t,e.id,n])}(t[e]);return(0,m.jsx)(kv,{...t[e],isSelected:n})}function _n(){return(0,m.jsx)(_t,{tool:"select"})}function _r(){return(0,m.jsx)(_t,{tool:"hand"})}function _i(){return(0,m.jsx)(_t,{tool:"draw"})}function _o(){return(0,m.jsx)(_t,{tool:"eraser"})}function _s(){return(0,m.jsx)(_t,{tool:"arrow"})}function _a(){return(0,m.jsx)(_t,{tool:"text"})}function _l(){return(0,m.jsx)(_t,{tool:"note"})}function _c(){let e=bh();return(0,m.jsx)(kv,{...e.asset})}function _d(){return(0,m.jsx)(_t,{tool:"rectangle"})}function _u(){return(0,m.jsx)(_t,{tool:"ellipse"})}function _h(){return(0,m.jsx)(_t,{tool:"diamond"})}function _p(){return(0,m.jsx)(_t,{tool:"triangle"})}function _f(){return(0,m.jsx)(_t,{tool:"rhombus"})}function _g(){return(0,m.jsx)(_t,{tool:"heart"})}function _m(){return(0,m.jsx)(_t,{tool:"hexagon"})}function _y(){return(0,m.jsx)(_t,{tool:"cloud"})}function _b(){return(0,m.jsx)(_t,{tool:"star"})}function _x(){return(0,m.jsx)(_t,{tool:"oval"})}function _v(){return(0,m.jsx)(_t,{tool:"x-box"})}function _w(){return(0,m.jsx)(_t,{tool:"check-box"})}function _S(){return(0,m.jsx)(_t,{tool:"arrow-left"})}function _k(){return(0,m.jsx)(_t,{tool:"arrow-up"})}function _C(){return(0,m.jsx)(_t,{tool:"arrow-down"})}function _P(){return(0,m.jsx)(_t,{tool:"arrow-right"})}function __(){return(0,m.jsx)(_t,{tool:"line"})}function _I(){return(0,m.jsx)(_t,{tool:"highlight"})}function _E(){return(0,m.jsx)(_t,{tool:"frame"})}function _j(){return(0,m.jsx)(_t,{tool:"laser"})}let _T="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function _M(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),n)}function _A(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent&&e.detachEvent("on".concat(t),n)}function _O(e,t){let n=t.slice(0,t.length-1);for(let t=0;t<n.length;t++)n[t]=e[n[t].toLowerCase()];return n}function _L(e){"string"!=typeof e&&(e="");let t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}let _D={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":_T?173:189,"=":_T?61:187,";":_T?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},_z={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},_R={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},_N={16:!1,18:!1,17:!1,91:!1},_F={};for(let e=1;e<20;e++)_D["f".concat(e)]=111+e;let _$=[],_B=null,_U="all",_V=new Map,_H=e=>_D[e.toLowerCase()]||_z[e.toLowerCase()]||e.toUpperCase().charCodeAt(0),_K=e=>Object.keys(_D).find(t=>_D[t]===e),_W=e=>Object.keys(_z).find(t=>_z[t]===e);function _G(e){_U=e||"all"}function _q(){return _U||"all"}function _Y(e){if(void 0===e)Object.keys(_F).forEach(e=>{Array.isArray(_F[e])&&_F[e].forEach(e=>_X(e)),delete _F[e]}),_0(null);else if(Array.isArray(e))e.forEach(e=>{e.key&&_X(e)});else if("object"==typeof e)e.key&&_X(e);else if("string"==typeof e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];let[i,o]=n;"function"==typeof i&&(o=i,i=""),_X({key:e,scope:i,method:o,splitKey:"+"})}}let _X=e=>{let{key:t,scope:n,method:r,splitKey:i="+"}=e;_L(t).forEach(e=>{let t=e.split(i),o=t.length,s=t[o-1],a="*"===s?"*":_H(s);if(!_F[a])return;n||(n=_q());let l=o>1?_O(_z,t):[],c=[];_F[a]=_F[a].filter(e=>{let t=(!r||e.method===r)&&e.scope===n&&function(e,t){let n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0;for(let e=0;e<n.length;e++)-1===r.indexOf(n[e])&&(i=!1);return i}(e.mods,l);return t&&c.push(e.element),!t}),c.forEach(e=>_0(e))})};function _Z(e,t,n,r){let i;if(t.element===r&&(t.scope===n||"all"===t.scope)){for(let e in i=t.mods.length>0,_N)Object.prototype.hasOwnProperty.call(_N,e)&&(!_N[e]&&t.mods.indexOf(+e)>-1||_N[e]&&-1===t.mods.indexOf(+e))&&(i=!1);(0!==t.mods.length||_N[16]||_N[18]||_N[17]||_N[91])&&!i&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(_$),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function _Q(e,t){let n=_F["*"],r=e.keyCode||e.which||e.charCode;if(e.key&&"capslock"===e.key.toLowerCase()||!_J.filter.call(this,e))return;if((93===r||224===r)&&(r=91),-1===_$.indexOf(r)&&229!==r&&_$.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(t=>{let n=_R[t];e[t]&&-1===_$.indexOf(n)?_$.push(n):!e[t]&&_$.indexOf(n)>-1?_$.splice(_$.indexOf(n),1):"metaKey"===t&&e[t]&&(_$=_$.filter(e=>e in _R||e===r))}),r in _N){for(let t in _N[r]=!0,_z)if(Object.prototype.hasOwnProperty.call(_z,t)){let n=_R[_z[t]];_J[t]=e[n]}if(!n)return}for(let t in _N)Object.prototype.hasOwnProperty.call(_N,t)&&(_N[t]=e[_R[t]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===_$.indexOf(17)&&_$.push(17),-1===_$.indexOf(18)&&_$.push(18),_N[17]=!0,_N[18]=!0);let i=_q();if(n)for(let r=0;r<n.length;r++)n[r].scope===i&&("keydown"===e.type&&n[r].keydown||"keyup"===e.type&&n[r].keyup)&&_Z(e,n[r],i,t);if(!(r in _F))return;let o=_F[r],s=o.length;for(let n=0;n<s;n++)if(("keydown"===e.type&&o[n].keydown||"keyup"===e.type&&o[n].keyup)&&o[n].key){let r=o[n],{splitKey:s}=r,a=r.key.split(s),l=[];for(let e=0;e<a.length;e++)l.push(_H(a[e]));l.sort().join("")===_$.sort().join("")&&_Z(e,r,i,t)}}function _J(e,t,n){_$=[];let r=_L(e),i=[],o="all",s=document,a=0,l=!1,c=!0,d="+",u=!1,h=!1;for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(o=t.scope),t.element&&(s=t.element),t.keyup&&(l=t.keyup),void 0!==t.keydown&&(c=t.keydown),void 0!==t.capture&&(u=t.capture),"string"==typeof t.splitKey&&(d=t.splitKey),!0===t.single&&(h=!0)),"string"==typeof t&&(o=t),h&&_Y(e,o);a<r.length;a++)e=r[a].split(d),i=[],e.length>1&&(i=_O(_z,e)),(e="*"===(e=e[e.length-1])?"*":_H(e))in _F||(_F[e]=[]),_F[e].push({keyup:l,keydown:c,scope:o,mods:i,shortcut:r[a],method:n,key:r[a],splitKey:d,element:s});if(void 0!==s&&window){if(!_V.has(s)){let e=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;return _Q(e,s)},t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.event;_Q(e,s),function(e){let t=e.keyCode||e.which||e.charCode;e.key&&"capslock"===e.key.toLowerCase()&&(t=_H(e.key));let n=_$.indexOf(t);if(n>=0&&_$.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&_$.splice(0,_$.length),(93===t||224===t)&&(t=91),t in _N)for(let e in _N[t]=!1,_z)_z[e]===t&&(_J[e]=!1)}(e)};_V.set(s,{keydownListener:e,keyupListenr:t,capture:u}),_M(s,"keydown",e,u),_M(s,"keyup",t,u)}if(!_B){let e=()=>{_$=[]};_B={listener:e,capture:u},_M(window,"focus",e,u)}}}function _0(e){let t=Object.values(_F).flat();if(0>t.findIndex(t=>{let{element:n}=t;return n===e})){let{keydownListener:t,keyupListenr:n,capture:r}=_V.get(e)||{};t&&n&&(_A(e,"keyup",n,r),_A(e,"keydown",t,r),_V.delete(e))}if((t.length<=0||_V.size<=0)&&(Object.keys(_V).forEach(e=>{let{keydownListener:t,keyupListenr:n,capture:r}=_V.get(e)||{};t&&n&&(_A(e,"keyup",n,r),_A(e,"keydown",t,r),_V.delete(e))}),_V.clear(),Object.keys(_F).forEach(e=>delete _F[e]),_B)){let{listener:e,capture:t}=_B;_A(window,"focus",e,t),_B=null}}let _1={getPressedKeyString:function(){return _$.map(e=>_K(e)||_W(e)||String.fromCharCode(e))},setScope:_G,getScope:_q,deleteScope:function(e,t){let n,r;for(let t in e||(e=_q()),_F)if(Object.prototype.hasOwnProperty.call(_F,t))for(r=0,n=_F[t];r<n.length;)n[r].scope===e?n.splice(r,1).forEach(e=>{let{element:t}=e;return _0(t)}):r++;_q()===e&&_G(t||"all")},getPressedKeyCodes:function(){return _$.slice(0)},getAllKeyCodes:function(){let e=[];return Object.keys(_F).forEach(t=>{_F[t].forEach(t=>{let{key:n,scope:r,mods:i,shortcut:o}=t;e.push({scope:r,shortcut:o,mods:i,keys:n.split("+").map(e=>_H(e))})})}),e},isPressed:function(e){return"string"==typeof e&&(e=_H(e)),-1!==_$.indexOf(e)},filter:function(e){let t=e.target||e.srcElement,{tagName:n}=t,r=!0,i="INPUT"===n&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(t.type);return(t.isContentEditable||(i||"TEXTAREA"===n||"SELECT"===n)&&!t.readOnly)&&(r=!1),r},trigger:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(_F).forEach(n=>{_F[n].filter(n=>n.scope===t&&n.shortcut===e).forEach(e=>{e&&e.method&&e.method()})})},unbind:_Y,keyMap:_D,modifier:_z,modifierMap:_R};for(let e in _1)Object.prototype.hasOwnProperty.call(_1,e)&&(_J[e]=_1[e]);if("undefined"!=typeof window){let e=window.hotkeys;_J.noConflict=t=>(t&&window.hotkeys===_J&&(window.hotkeys=e),_J),window.hotkeys=_J}let _2=["copy","cut","paste","asset"];function _3(e){return(function(e){"string"!=typeof e&&(e="");let t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t})(e).map(e=>{let t=e.split("");return 1===t.length?t[0]:"!"===t[0]?`shift+${t[1]}`:"?"===t[0]?3===t.length&&"!"===t[1]?`alt+shift+${t[2]}`:`alt+${t[1]}`:"$"===t[0]?"!"===t[1]?`cmd+shift+${t[2]},ctrl+shift+${t[2]}`:"?"===t[1]?`cmd+\u2325+${t[2]},ctrl+alt+${t[2]}`:`cmd+${t[1]},ctrl+${t[1]}`:e}).join(",")}function _5(e){return e.getIsMenuOpen()||null!==e.getEditingShapeId()||e.getCrashingError()}let _4=(0,y.createContext)(!1);function _6({children:e}){let t=i8(),n=ad(),r=bg(),i=ff(),o=Math.min(8,5+r),[s,a]=(0,y.useState)(0),l=(0,y.useRef)(null),[c,d]=(0,y.useState)(null),u=(0,y.useMemo)(()=>{let e=c?`:not([data-value="${c}"])`:"";return`
			#${n}_main > *:nth-child(n + ${o+(c?1:2)})${e} {
				display: none;
			}
			#${n}_more > *:nth-child(-n + ${o}) {
				display: none;
			}
        `},[c,n,o]),h=cV(()=>{if(!l.current)return;let e=Array.from(l.current.children);a(e.length),e.findIndex(e=>e.getAttribute("data-value")===c)<=o&&d(null);let t=Array.from(l.current.children).findIndex(e=>"true"===e.getAttribute("aria-checked"));-1!==t&&t>=o&&d(e[t].getAttribute("data-value"))});return(0,y.useLayoutEffect)(()=>{h()}),(0,y.useLayoutEffect)(()=>{if(!l.current)return;let e=new MutationObserver(h);return e.observe(l.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{e.disconnect()}},[h]),(0,y.useEffect)(()=>{for(let[e,n]of[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]])_J(e,e=>{if(_5(t))return;oz(e);let r=Array.from(l.current?.children??[]).filter(e=>e instanceof HTMLElement&&"button"===e.tagName.toLowerCase()&&!!(e.offsetWidth||e.offsetHeight))[n];r&&r.click()});return()=>{_J.unbind("1,2,3,4,5,6,7,8,9,0")}},[t]),(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("style",{children:u}),(0,m.jsxs)("div",{className:i0("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<y9.TABLET_SM}),role:"radiogroup",children:[(0,m.jsx)("div",{id:`${n}_main`,ref:l,className:"tlui-toolbar__tools__list",children:(0,m.jsx)(wi,{type:"toolbar",sourceId:"toolbar",children:e})}),s>o+1&&(0,m.jsx)(_4.Provider,{value:!0,children:(0,m.jsxs)(ku,{id:"toolbar overflow",modal:!1,children:[(0,m.jsx)(kh,{children:(0,m.jsx)(yJ,{title:i("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:(0,m.jsx)(y6,{icon:"chevron-up"})})}),(0,m.jsx)(kp,{side:"top",align:"center",children:(0,m.jsx)("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${n}_more`,children:(0,m.jsx)(wi,{type:"toolbar-overflow",sourceId:"toolbar",children:e})})})]})})]})]})}function _8({activeToolId:e}){let t=i8(),n=bg(),r=ff(),i=iJ("is tool locked",()=>t.getInstanceState().isToolLocked,[t]),o=iJ("current tool",()=>t.getCurrentTool(),[t]);return e&&o.isLockable?(0,m.jsx)(yJ,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:i0("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<y9.TABLET_SM}),onClick:()=>t.updateInstanceState({isToolLocked:!i}),children:(0,m.jsx)(y6,{icon:i?"lock":"unlock",small:!0})}):null}let _9=(0,y.memo)(function({children:e}){let t=i8(),n=bg(),r=ur(),i=iJ("current tool id",()=>t.getCurrentToolId(),[t]),{ActionsMenu:o,QuickActions:s}=Ia();return(0,m.jsx)("div",{className:"tlui-toolbar",children:(0,m.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,m.jsxs)("div",{className:"tlui-toolbar__left",children:[!r&&(0,m.jsxs)("div",{className:"tlui-toolbar__extras",children:[n<y9.TABLET&&(0,m.jsxs)("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[s&&(0,m.jsx)(s,{}),o&&(0,m.jsx)(o,{})]}),(0,m.jsx)(_8,{activeToolId:i})]}),(0,m.jsx)(_6,{children:e??(0,m.jsx)(_e,{})})]}),n<y9.TABLET_SM&&!r&&(0,m.jsx)("div",{className:"tlui-toolbar__tools",children:(0,m.jsx)(P7,{})})]})})});function _7(){let e=ff();return(0,m.jsxs)("div",{className:i0("tlui-offline-indicator"),children:[e("status.offline"),(0,m.jsx)(y1,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function Ie({maxWidth:e=420,ignoreRightWidth:t=0,stylePanelWidth:n=148,marginBetweenZones:r=12,squeezeAmount:i=52,children:o}){let s=(0,y.useRef)(null),a=bg(),l=(0,y.useCallback)(()=>{let o=s.current;if(!o)return;let l=o.parentElement.parentElement,c=l.querySelector(".tlui-layout__top__left"),d=l.querySelector(".tlui-layout__top__right"),u=l.offsetWidth,h=c.offsetWidth,p=d.offsetWidth,f=(u-(o.offsetWidth-t))/2;u%2!=0&&(f-=.5);let g=h+r,m=o.offsetLeft,y=Math.min(u-p-h-2*r,e),b=Math.max(f,g)-m;d.offsetWidth>n&&a<=6?o.style.setProperty("max-width",y-i+"px"):o.style.setProperty("max-width",y+"px"),o.style.setProperty("transform",`translate(${b}px, 0px)`)},[a,t,r,e,i,n]);return(0,y.useLayoutEffect)(()=>{let e=s.current;if(!e)return;let t=e.parentElement.parentElement,n=t.querySelector(".tlui-layout__top__left"),r=t.querySelector(".tlui-layout__top__right"),i=new ResizeObserver(l);return i.observe(n),i.observe(r),i.observe(t),i.observe(e),l(),()=>{i.disconnect()}},[l]),(0,y.useLayoutEffect)(()=>{l()}),(0,m.jsx)("div",{ref:s,className:"tlui-top-panel__container",children:o})}function It(){let e="offline"===function(){let e=i8();return iJ("sync status",()=>e.store.props.collaboration?.status?e.store.props.collaboration.status.get():null,[e])}();return(0,m.jsx)(Ie,{children:e&&(0,m.jsx)(_7,{})})}function In(){let e=b6();return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(kv,{...e["zoom-in"],noClose:!0}),(0,m.jsx)(kv,{...e["zoom-out"],noClose:!0}),(0,m.jsx)(kX,{}),(0,m.jsx)(kZ,{}),(0,m.jsx)(kQ,{})]})}let Ir=(0,y.memo)(function({children:e}){let t=oK(),[n,r]=v9("zoom menu"),i=e??(0,m.jsx)(In,{});return(0,m.jsxs)(S7,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,m.jsx)(kt,{asChild:!0,dir:"ltr",children:(0,m.jsx)(Ii,{})}),(0,m.jsx)(kn,{container:t,children:(0,m.jsx)(ki,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:(0,m.jsx)(wi,{type:"menu",sourceId:"zoom-menu",children:i})})})]})}),Ii=(0,y.forwardRef)(function(e,t){let n=i8(),r=bg(),i=iJ("zoom",()=>n.getZoomLevel(),[n]),o=ff(),s=(0,y.useCallback)(()=>{n.resetZoom(n.getViewportScreenCenter(),{animation:{duration:n.options.animationMediumMs}})},[n]);return(0,m.jsx)(yJ,{ref:t,...e,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:r<y9.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:s,icon:r<y9.MOBILE?"zoom-in":void 0,children:r<y9.MOBILE?null:(0,m.jsxs)("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(100*i),"%"]})})}),Io=(0,y.createContext)(null);function Is({overrides:e={},children:t}){let n=aT(e,aM),r=b2();return(0,m.jsx)(Io.Provider,{value:(0,y.useMemo)(()=>({ContextMenu:Cy,ActionsMenu:kL,HelpMenu:null,ZoomMenu:Ir,MainMenu:C2,Minimap:Pr,StylePanel:P9,PageMenu:Pl,NavigationPanel:Pi,Toolbar:_9,KeyboardShortcutsDialog:C$,QuickActions:Pd,HelperButtons:CN,DebugPanel:CT,DebugMenu:Cj,MenuPanel:CO,SharePanel:r?Py:null,CursorChatBubble:r?Cb:null,TopPanel:r?It:null,...n}),[n,r]),children:t})}function Ia(){let e=(0,y.useContext)(Io);if(!e)throw Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return e}function Il({overrides:e,components:t,assetUrls:n,onUiEvent:r,forceMobile:i,children:o}){return(0,m.jsx)(fo,{assetUrls:n?{fonts:Object.assign({...bt.fonts},{...n?.fonts}),icons:Object.assign({...bt.icons},{...n?.icons}),embedIcons:Object.assign({...bt.embedIcons},{...n?.embedIcons}),translations:Object.assign({...bt.translations},{...n?.translations})}:bt,children:(0,m.jsx)(fp,{overrides:function(e){let t=bm(null==e?[]:Array.isArray(e)?e:[e]);return(0,y.useMemo)(()=>{let e={};for(let n of t)if(n.translations)for(let[t,r]of eq(n.translations)){let n=e[t];n||(n=e[t]={}),Object.assign(n,r)}return e},[t])}(e),children:(0,m.jsx)(ys,{onEvent:r,children:(0,m.jsx)(yZ,{children:(0,m.jsx)(yc,{children:(0,m.jsx)(bf,{forceMobile:i,children:(0,m.jsx)(Is,{overrides:t,children:(0,m.jsx)(Ic,{overrides:e,children:o})})})})})})})})}function Ic({overrides:e,children:t}){let n=function(e){let t=function(){let{addToast:e,removeToast:t,clearToasts:n}=yQ(),{addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s}=yd(),a=bg()<y9.TABLET_SM,l=ff();return(0,y.useMemo)(()=>({addToast:e,removeToast:t,clearToasts:n,addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:s,msg:l,isMobile:a}),[r,e,i,n,l,o,t,s,a])}(),n=bm(null==e?[]:Array.isArray(e)?e:[e]);return(0,y.useMemo)(()=>(function(e,t){let n={};for(let t of e)if(t.translations)for(let[e,r]of eq(t.translations)){let t=n[e];t||(t=n[e]={}),Object.assign(t,r)}return{actions:(n,r)=>{for(let i of e)i.actions&&(r=i.actions(n,r,t));return r},tools:(n,r,i)=>{for(let o of e)o.tools&&(r=o.tools(n,r,{...t,...i}));return r},translations:n}})(n,t),[n,t])}(e);return(0,m.jsx)(b4,{overrides:n.actions,children:(0,m.jsx)(bu,{overrides:n.tools,children:t})})}let Id=y.memo(function({renderDebugMenuItems:e,children:t,hideUi:n,components:r,...i}){return(0,m.jsx)(Il,{...i,components:r,children:(0,m.jsx)(Iu,{hideUi:n,renderDebugMenuItems:e,children:t})})}),Iu=y.memo(function({children:e,hideUi:t,...n}){return(0,m.jsxs)(m.Fragment,{children:[e,t?null:(0,m.jsx)(Ih,{...n})]})}),Ih=y.memo(function(){let e=i8(),t=ff(),n=bg(),r=ur(),i=iJ("focus",()=>e.getInstanceState().isFocusMode,[e]),o=iJ("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:s,TopPanel:a,MenuPanel:l,StylePanel:c,Toolbar:d,HelpMenu:u,NavigationPanel:h,HelperButtons:p,DebugPanel:f,CursorChatBubble:g}=Ia();(function(){let e=i8(),t=ur(),n=b6(),r=bh(),i=iJ("is focused",()=>e.getInstanceState().isFocused,[e]);(0,y.useEffect)(()=>{var o;if(!i)return;let s=[],a=(e,t)=>{_J(e,{element:document.body},t),s.push(()=>{_J.unbind(e,t)})};for(let r of Object.values(n))r.kbd&&(!t||r.readonlyOk)&&(_2.includes(r.id)||a(_3(r.kbd),t=>{_5(e)||(oz(t),r.onSelect("kbd"))}));for(let t of Object.values(r))t.kbd&&(t.readonlyOk||!e.getInstanceState().isReadonly)&&(_2.includes(t.id)||a(_3(t.kbd),n=>{_5(e)||(oz(n),t.onSelect("kbd"))}));return a(",",t=>{if(_5(e)||e.inputs.keys.has("Comma"))return;oz(t),e.focus(),e.inputs.keys.add("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,o={type:"pointer",name:"pointer_down",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(o)}),o=t=>{if(_5(e)||!e.inputs.keys.has("Comma"))return;e.inputs.keys.delete("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,o={type:"pointer",name:"pointer_up",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(o)},_J(",",{element:document.body,keyup:!0,keydown:!1},o),s.push(()=>{_J.unbind(",",o)}),()=>{s.forEach(e=>e())}},[n,r,t,e,i])})(),function(){let e=i8(),t=ya(),n=iJ("editor.isFocused",()=>e.getInstanceState().isFocused,[e]);(0,y.useEffect)(()=>{if(!n)return;let r=async n=>{0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||b$(e)||(oz(n),await bW(e),t("copy",{source:"kbd"}))};async function i(n){0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||b$(e)||(oz(n),await bW(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let o=!1,s=t=>{1===t.button&&(o=!0,e.timers.requestAnimationFrame(()=>{o=!1}))},a=n=>{let r;if(o){oF(n);return}if(null!==e.getEditingShapeId()||b$(e))return;let i=!1;e.inputs.shiftKey&&(i=!0),e.user.getIsPasteAtCursorMode()&&(i=!i),i&&(r=e.inputs.currentPagePoint),n.clipboardData&&!e.inputs.shiftKey?bV(e,n.clipboardData,r):navigator.clipboard.read().then(t=>{Array.isArray(t)&&t[0]instanceof ClipboardItem&&bH(e,t,r)}),oz(n),t("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[e,t,n])}(),function(){let e=i8(),{addToast:t}=yQ();(0,y.useEffect)(()=>{function n({name:e,count:n}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${e} (${n}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return e.addListener("max-shapes",n),()=>{e.removeListener("max-shapes",n)}},[e,t])}();let{"toggle-focus-mode":b}=b6();return(0,m.jsxs)("div",{className:i0("tlui-layout",{"tlui-layout__mobile":n<y9.TABLET_SM}),"data-breakpoint":n,children:[i?(0,m.jsx)("div",{className:"tlui-layout__top",children:(0,m.jsx)(yJ,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>b.onSelect("menu"),children:(0,m.jsx)(y6,{icon:"dot"})})}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{className:"tlui-layout__top",children:[(0,m.jsxs)("div",{className:"tlui-layout__top__left",children:[l&&(0,m.jsx)(l,{}),p&&(0,m.jsx)(p,{})]}),(0,m.jsx)("div",{className:"tlui-layout__top__center",children:a&&(0,m.jsx)(a,{})}),(0,m.jsxs)("div",{className:"tlui-layout__top__right",children:[s&&(0,m.jsx)(s,{}),c&&n>=y9.TABLET_SM&&!r&&(0,m.jsx)(c,{})]})]}),(0,m.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,m.jsxs)("div",{className:"tlui-layout__bottom__main",children:[h&&(0,m.jsx)(h,{}),d&&(0,m.jsx)(d,{}),u&&(0,m.jsx)(u,{})]}),o&&f&&(0,m.jsx)(f,{})]})]}),(0,m.jsx)(y5,{}),(0,m.jsx)(yh,{}),(0,m.jsx)(y4,{}),(0,m.jsx)(yp,{}),g&&(0,m.jsx)(g,{})]})});async function Ip(e,t){let{url:n,style:r="normal",weight:i="500",display:o,featureSettings:s,stretch:a,unicodeRange:l,variant:c,format:d}=t,u=new FontFace(e,`url(${n})`,{style:r,weight:i,display:o,featureSettings:s,stretch:a,unicodeRange:l,variant:c});return await u.load(),document.fonts.add(u),u.$$_url=n,u.$$_fontface=`
@font-face {
	font-family: ${u.family};
	font-stretch: ${u.stretch};
	font-weight: ${u.weight};
	font-style: ${u.style};
	src: url("${n}") format("${d}")
}`,u}var If=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED",e[e.WAITING=2]="WAITING",e))(If||{});let Ig=(e,t)=>{let[n,r]=(0,y.useState)(2);return(0,y.useEffect)(()=>{let n=!1;return r(2),Ip(e,t).then(()=>{n||r(0)}).catch(e=>{n||(console.error(e),r(1))}),()=>{n=!0}},[e,t]),n};function Im(e){let t=(0,y.useMemo)(()=>({draw:{url:e.fonts.draw,format:e.fonts.draw.split(".").pop()},serif:{url:e.fonts.serif,format:e.fonts.serif.split(".").pop()},sansSerif:{url:e.fonts.sansSerif,format:e.fonts.sansSerif.split(".").pop()},monospace:{url:e.fonts.monospace,format:e.fonts.monospace.split(".").pop()}}),[e]),n=[Ig("tldraw_draw",t.draw),Ig("tldraw_serif",t.serif),Ig("tldraw_sans",t.sansSerif),Ig("tldraw_mono",t.monospace)];return{error:n.some(e=>1===e),done:!n.some(e=>2===e)}}function Iy(e){let{children:t,maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s,components:a={},shapeUtils:l=[],bindingUtils:c=[],tools:d=[],...u}=e,h=aT(a,aM),p=(0,y.useMemo)(()=>({Scribble:ut,ShapeIndicators:uc,CollaboratorScribble:ut,SelectionForeground:uo,SelectionBackground:un,Handles:d3,...h}),[h]),f=aT(l,eg),g=(0,y.useMemo)(()=>[...fC,...f],[f]),b=aT(c,eg),x=(0,y.useMemo)(()=>[...uT,...b],[b]),v=aT(d,eg),w=(0,y.useMemo)(()=>[...gg,...hM,...v],[v]),{done:S,error:k}=Im(be(u.assetUrls));return k?(0,m.jsx)(dN,{children:"Could not load assets. Please refresh the page."}):S?(0,m.jsx)(dT,{initialState:"select",...u,components:p,shapeUtils:g,bindingUtils:x,tools:w,children:(0,m.jsxs)(Id,{...u,components:p,children:[(0,m.jsx)(Ib,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s}),t]})}):(0,m.jsx)(dR,{children:(0,m.jsx)(aE,{})})}function Ib({maxImageDimension:e=5e3,maxAssetSize:t=0xa00000,acceptedImageMimeTypes:n=eN,acceptedVideoMimeTypes:r=eF,onMount:i}){let o=i8(),s=yQ(),a=ff();dF(()=>{let l=[];return l.push(o.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){let n=o.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?n||o.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&n&&o.setCurrentTool("select.idle")}e.editingShapeId!==t.editingShapeId&&(!e.editingShapeId&&t.editingShapeId?o.isIn("select.editing_shape")||o.setCurrentTool("select.editing_shape"):e.editingShapeId&&!t.editingShapeId&&o.isIn("select.editing_shape")&&o.setCurrentTool("select.idle"))}}})),function(e,{maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i},{toasts:o,msg:s}){e.registerExternalAssetHandler("file",async({file:a})=>{let l=a.name,c=a,d=r.includes(c.type),u=i.includes(c.type);d||u||o.addToast({title:s("assets.files.type-not-allowed"),severity:"error"}),ew(d||u,`File type not allowed: ${c.type}`),c.size>n&&o.addToast({title:s("assets.files.size-too-big"),severity:"error"}),ew(c.size<=n,`File size too big: ${(c.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),"video/quicktime"===c.type&&(c=new File([c],c.name,{type:"video/mp4"}));let h=d?await eB.getImageSize(c):await eB.getVideoSize(c),p=await eB.isAnimated(c)||u,f=function(e){let t=new DataView(e),n=0;for(let e=0;e<t.byteLength;e++)n=(n<<5)-n+t.getUint8(e)|0;return n+""}(await c.arrayBuffer());if(isFinite(t)){let e=function(e,t){let n=e.w/t.w,r=e.h/t.h;return n<=1&&r<=1?e:n>r?{w:e.w/n,h:e.h/n}:{w:e.w/r,h:e.h/r}}(h,{w:t,h:t});h!==e&&eB.isStaticImageType(c.type)&&(h=e)}let g={id:r3.createId(f),type:d?"image":"video",typeName:"asset",props:{name:l,src:"",w:h.w,h:h.h,fileSize:c.size,mimeType:c.type,isAnimated:p}};return g.props.src=await e.uploadAsset(g,c),r3.create(g)}),e.registerExternalAssetHandler("url",async({url:e})=>{let t;try{let n=await e_(e,{method:"GET",mode:"no-cors"}),r=await n.text(),i=new DOMParser().parseFromString(r,"text/html");(t={image:i.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:i.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??i.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:i.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??e,description:i.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""}).image.startsWith("http")||(t.image=new URL(t.image,e).href),t.favicon.startsWith("http")||(t.favicon=new URL(t.favicon,e).href)}catch(e){console.error(e),o.addToast({title:s("assets.url.failed"),severity:"error"}),t={image:"",favicon:"",title:"",description:""}}return{id:r3.createId(ej(e)),typeName:"asset",type:"bookmark",props:{src:e,description:t.description,image:t.image,favicon:t.favicon,title:t.title},meta:{}}}),e.registerExternalContentHandler("svg-text",async({point:t,text:n})=>{let r=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),i=new DOMParser().parseFromString(n,"image/svg+xml").querySelector("svg");if(!i)throw Error("No <svg/> element present");let o=parseFloat(i.getAttribute("width")||"0"),s=parseFloat(i.getAttribute("height")||"0");if(!(o&&s)){document.body.appendChild(i);let e=i.getBoundingClientRect();document.body.removeChild(i),o=e.width,s=e.height}let a=await e.getAssetForExternalContent({type:"file",file:new File([n],"asset.svg",{type:"image/svg+xml"})});if(!a)throw Error("Could not create an asset");u8(e,[a],r)}),e.registerExternalContentHandler("embed",({point:t,url:n,embed:r})=>{let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),{width:o,height:s}=r,a=nG(),l={id:a,type:"embed",x:i.x-(o||450)/2,y:i.y-(s||450)/2,props:{w:o,h:s,url:n}};e.createShapes([l]).select(a)}),e.registerExternalContentHandler("files",async({point:t,files:a})=>{let l=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),c=new ot(l.x,l.y),d=[];await Promise.all(a.map(async(t,a)=>{if(t.size>n)return o.addToast({title:s("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(t.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),null;if(!t.type)throw Error("No mime type");if(!r.concat(i).includes(t.type))return o.addToast({title:s("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${t.name} not loaded - Extension not allowed.`),null;try{let n=await e.getAssetForExternalContent({type:"file",file:t});if(!n)throw Error("Could not create an asset");d[a]=n}catch(e){return o.addToast({title:s("assets.files.upload-failed"),severity:"error"}),console.error(e),null}})),u8(e,ep(d),c)}),e.registerExternalContentHandler("text",async({point:t,text:n})=>{let r,i,o;let s=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),a=e.getShapeUtil("text").getDefaultProps(),l=(function(e){let t=e.split("\n");for(;t[0]&&0===t[0].trim().length;)t.shift();let n=1/0;for(let e of t)if(e.trim().length>0){let t=e.length-e.trimStart().length;n=Math.min(n,t)}return t.map(e=>e.slice(n)).join("\n")})(n.replace(/\t/g,"  ")).replace(/[ \t]+$/gm,"").replace(/\n+$/,""),c=e.getOnlySelectedShape();if(c&&"text"in c.props){e.updateShapes([{id:c.id,type:c.type,props:{text:l}}]);return}let d="middle",u=l.split("\n").length>1,h=u6.test(l);u&&(d=u?h?"end":"start":"middle");let p=e.textMeasure.measureText(l,{...uM,fontFamily:uz[a.font],fontSize:uO[a.size],maxWidth:null}),f=Math.min(u?.9*e.getViewportPageBounds().width:920,Math.max(200,.9*e.getViewportPageBounds().width));if(p.w>f){let t=e.textMeasure.measureText(l,{...uM,fontFamily:uz[a.font],fontSize:uO[a.size],maxWidth:f});r=t.w,i=t.h,o=!1,d=h?"end":"start"}else r=p.w,i=p.h,o=!0;s.y-i/2<e.getViewportPageBounds().minY+40&&(s.y=e.getViewportPageBounds().minY+40+i/2),e.createShapes([{id:nG(),type:"text",x:s.x-r/2,y:s.y-i/2,props:{text:l,textAlign:d,autoSize:o,w:r}}])}),e.registerExternalContentHandler("url",async({point:t,url:n})=>{let r=u3(n);if(r)return e.putExternalContent({type:"embed",url:r.url,point:t,embed:r.definition});let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageBounds().center),a=r3.createId(ej(n)),l=function(e,t,n){let r={id:nG(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:t}};return e.run(()=>{e.createShapes([r]).select(r.id),u9(e,n)}),e.getShape(r.id)}(e,n,i),c=e.getAsset(a),d=!1;if(!c){d=!0;try{let t=await e.getAssetForExternalContent({type:"url",url:n});if(!t)throw Error("Could not create an asset");c=t}catch(e){o.addToast({title:s("assets.url.failed"),severity:"error"});return}}e.run(()=>{d&&e.createAssets([c]),e.updateShapes([{id:l.id,type:l.type,props:{assetId:c.id}}])})})}(o,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r},{toasts:s,msg:a}),l.push(o.store.props.onMount(o)),l.push(i?.(o)),()=>{l.forEach(e=>e?.())}});let{Canvas:l}=aL(),{ContextMenu:c}=Ia();return c?(0,m.jsx)(c,{}):l?(0,m.jsx)(l,{}):null}(0,y.memo)(function(e){let[t,n]=(0,y.useState)(null),[r,i]=(0,y.useState)(null),o=aT(e.shapeUtils??[],eg),s=(0,y.useMemo)(()=>[...fC,...o],[o]),a=aT(e.bindingUtils??[],eg),l=(0,y.useMemo)(()=>[...uT,...a],[a]),c=function(e){let[t,n]=(0,y.useState)(()=>({store:cW(e),opts:e}));if(!eQ(t.opts,e)){let t={store:cW(e),opts:e};return n(t),t.store}return t.store}({snapshot:e.snapshot,shapeUtils:s}),{done:d,error:u}=Im(be()),{pageId:h,bounds:p,scale:f,background:g,padding:b,darkMode:x,preserveAspectRatio:v,format:w="svg",licenseKey:S}=e;return((0,y.useLayoutEffect)(()=>{if(!r||!c||!d)return;let e=!1,t=document.createElement("div");r.appendChild(t),r.classList.add("tl-container","tl-theme__light");let i=new cT({store:c,shapeUtils:s,bindingUtils:l,tools:[],getContainer:()=>t,licenseKey:S});h&&i.setCurrentPage(h);let o=i.getCurrentPageShapeIds();return async function(){let t=await i.getSvgString([...o],{bounds:p,scale:f,background:g,padding:b,darkMode:x,preserveAspectRatio:v});if(t&&!e){if("svg"===w){if(!e){let e=new Blob([t.svg],{type:"image/svg+xml"});n(URL.createObjectURL(e))}}else if("png"===w){let r=await bG(i,t.svg,{type:w,quality:1,scale:2,width:t.width,height:t.height});r&&!e&&n(URL.createObjectURL(r))}}i.dispose()}(),()=>{e=!0}},[w,r,c,s,l,h,p,f,g,b,x,v,d,u,S]),u)?(0,m.jsx)(dN,{children:"Could not load assets."}):d?(0,m.jsx)("div",{ref:i,style:{position:"relative",width:"100%",height:"100%"},children:t&&(0,m.jsx)("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):(0,m.jsx)(dR,{children:(0,m.jsx)(aE,{})})}),(0,y.memo)(function({children:e}){let t=ff(),n=bg(),r=e??(0,m.jsx)(CH,{});return n<y9.MOBILE?null:(0,m.jsx)("div",{className:"tlui-help-menu",children:(0,m.jsxs)(ku,{id:"help menu",children:[(0,m.jsx)(kh,{children:(0,m.jsx)(yJ,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:(0,m.jsx)(y6,{icon:"question-mark",small:!0})})}),(0,m.jsx)(kp,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:(0,m.jsx)(wi,{type:"menu",sourceId:"help-menu",children:r})})]})})});var Ix=(e=>(e.Sticky="sticky",e.Ellipse="ellipse",e.Rectangle="rectangle",e.Triangle="triangle",e.Draw="draw",e.Arrow="arrow",e.Text="text",e.Group="group",e.Image="image",e.Video="video",e))(Ix||{}),Iv=(e=>(e.White="white",e.LightGray="lightGray",e.Gray="gray",e.Black="black",e.Green="green",e.Cyan="cyan",e.Blue="blue",e.Indigo="indigo",e.Violet="violet",e.Red="red",e.Orange="orange",e.Yellow="yellow",e))(Iv||{}),Iw=(e=>(e.Small="small",e.Medium="medium",e.Large="large",e))(Iw||{}),IS=(e=>(e.Draw="draw",e.Solid="solid",e.Dashed="dashed",e.Dotted="dotted",e))(IS||{}),Ik=(e=>(e.Start="start",e.Middle="middle",e.End="end",e.Justify="justify",e))(Ik||{}),IC=(e=>(e.Script="script",e.Sans="sans",e.Serif="serif",e.Mono="mono",e))(IC||{}),IP=(e=>(e.Arrow="arrow",e))(IP||{}),I_=(e=>(e.Image="image",e.Video="video",e))(I_||{});let II=nf({schemaVersion:nu(1),storeVersion:nl,recordVersions:ny(nr,nf({version:nl,subTypeVersions:ny(nr,nl).optional(),subTypeKey:nr.optional()}))}),IE=nf({schemaVersion:nu(2),sequences:ny(nr,nl)});function Ij({projectId:e,onSave:t,snapshot:n}){return(0,m.jsx)("div",{className:"h-[600px] w-full rounded border border-gray-200 dark:border-gray-700",children:(0,m.jsx)(Iy,{persistenceKey:e??"illustration-canvas",snapshot:n,onMount:e=>{t&&e.store.listen(()=>{t(e.store.getSnapshot())},{source:"user",scope:"document"})}})})}function IT({imageUrl:e,styleProfileId:t,onBgRemoved:n,onSvgReady:r}){let[i,o]=(0,y.useState)(null),[s,a]=(0,y.useState)(null),[l,c]=(0,y.useState)(null),[d,u]=(0,y.useState)(null),h=async()=>{c("bg"),u(null);try{let r=await fetch("/api/process/remove-bg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e,styleProfileId:t})}),i=await r.json();if(!r.ok)throw Error(i.error??"Failed");o(i.imageUrl),n?.(i.imageUrl)}catch(e){u(e instanceof Error?e.message:"BG removal failed")}finally{c(null)}},p=async()=>{let t=i??e;c("svg"),u(null);try{let e=await fetch("/api/process/to-svg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pngUrl:t})}),n=await e.json();if(!e.ok)throw Error(n.error??"Failed");a(n.svgUrl),r?.(n.svgUrl)}catch(e){u(e instanceof Error?e.message:"SVG conversion failed")}finally{c(null)}};return(0,m.jsxs)("div",{className:"space-y-4 rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,m.jsx)("h3",{className:"font-medium",children:"Post-processing"}),d&&(0,m.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:d}),(0,m.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,m.jsx)("button",{type:"button",onClick:h,disabled:null!==l,className:"rounded bg-gray-800 px-3 py-2 text-sm text-white hover:bg-gray-700 disabled:opacity-50 dark:bg-gray-700 dark:hover:bg-gray-600",children:"bg"===l?"Removing":"Remove background"}),(0,m.jsx)("button",{type:"button",onClick:p,disabled:null!==l,className:"rounded bg-gray-800 px-3 py-2 text-sm text-white hover:bg-gray-700 disabled:opacity-50 dark:bg-gray-700 dark:hover:bg-gray-600",children:"svg"===l?"Converting":"Convert to SVG"})]}),i&&(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm text-gray-500",children:"Background removed"}),(0,m.jsx)("img",{src:i,alt:"No background",className:"mt-1 max-h-40 rounded border object-contain"})]}),s&&(0,m.jsxs)("div",{children:[(0,m.jsx)("p",{className:"text-sm text-gray-500",children:"SVG result"}),(0,m.jsx)("a",{href:s,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 underline dark:text-blue-400",children:"Open SVG"})]})]})}function IM(){let[e,t]=(0,y.useState)(null),[n,r]=(0,y.useState)("");return(0,m.jsxs)("main",{className:"min-h-screen p-8",children:[(0,m.jsx)("h1",{className:"text-2xl font-bold",children:"Illustration Agent"}),(0,m.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"AI-powered illustration agent with style memory, multi-provider generation, and feedback-driven learning."}),(0,m.jsxs)("div",{className:"mt-8 grid gap-8 lg:grid-cols-2",children:[(0,m.jsxs)("div",{className:"space-y-6",children:[(0,m.jsx)(w,{selectedStyleId:e,onSelect:t}),(0,m.jsx)(v,{onCreated:t}),(0,m.jsx)(S,{styleProfileId:e}),(0,m.jsxs)("div",{className:"rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,m.jsx)("h3",{className:"font-medium",children:"Post-process an image"}),(0,m.jsx)("input",{type:"url",value:n,onChange:e=>r(e.target.value),placeholder:"Paste image URL",className:"mt-2 w-full rounded border border-gray-300 px-3 py-2 dark:border-gray-600 dark:bg-gray-800"}),n&&(0,m.jsx)("div",{className:"mt-4",children:(0,m.jsx)(IT,{imageUrl:n,styleProfileId:e??void 0})})]})]}),(0,m.jsx)("div",{children:(0,m.jsx)(Ij,{projectId:e??void 0})})]})]})}nf({tldrawFileFormatVersion:nc,schema:function(e,t){return new t7(e,t,(n,r)=>{throw new t3(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])},!0)}("schemaVersion",{1:II,2:IE}),records:np(nf({id:nr,typeName:nr}).allowUnknownProperties())}),n(34553)},71354:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o,metadata:()=>i});var r=n(62740);n(61135);let i={title:"Illustration Agent",description:"AI-powered illustration agent with style memory and feedback loops"};function o({children:e}){return(0,r.jsx)("html",{lang:"en",children:(0,r.jsx)("body",{className:"antialiased",children:e})})}},61377:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>r});let r=(0,n(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/berriesdesign/Documents/repos/illustration-agent/src/app/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/berriesdesign/Documents/repos/illustration-agent/src/app/page.tsx","default")},34553:()=>{},61135:()=>{},56073:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function i(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=o(e,function(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return i.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=o(t,n));return t}(n)))}return e}function o(e,t){return t?e?e+" "+t:e+t:e}e.exports?(i.default=i,e.exports=i):void 0!==(n=(function(){return i}).apply(t,[]))&&(e.exports=n)}()},70952:(e,t,n)=>{"use strict";n(36162);var r=n(2408);e.exports=r("Array","at")},51421:(e,t,n)=>{"use strict";n(99571),n(36284);var r=n(2408);e.exports=r("Array","flatMap")},54502:(e,t,n)=>{"use strict";n(56460),n(77483);var r=n(2408);e.exports=r("Array","flat")},15148:(e,t,n)=>{"use strict";n(68374);var r=n(2408);e.exports=r("String","at")},6667:(e,t,n)=>{"use strict";n(89084),n(69081),n(20587);var r=n(2408);e.exports=r("String","replaceAll")},6765:(e,t,n)=>{"use strict";var r=n(21616),i=n(88366),o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not a function")}},34802:(e,t,n)=>{"use strict";var r=n(88050),i=n(79133),o=n(39298).f,s=r("unscopables"),a=Array.prototype;void 0===a[s]&&o(a,s,{configurable:!0,value:i(null)}),e.exports=function(e){a[s][e]=!0}},32466:(e,t,n)=>{"use strict";var r=n(24008).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},72642:(e,t,n)=>{"use strict";var r=n(82319),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not an object")}},71274:(e,t,n)=>{"use strict";var r=n(99752),i=n(26331),o=n(8601),s=function(e){return function(t,n,s){var a,l=r(t),c=o(l);if(0===c)return!e&&-1;var d=i(s,c);if(e&&n!=n){for(;c>d;)if((a=l[d++])!=a)return!0}else for(;c>d;d++)if((e||d in l)&&l[d]===n)return e||d||0;return!e&&-1}};e.exports={includes:s(!0),indexOf:s(!1)}},24664:(e,t,n)=>{"use strict";var r=n(26671),i=n(82146),o=n(82319),s=n(88050)("species"),a=Array;e.exports=function(e){var t;return r(e)&&(i(t=e.constructor)&&(t===a||r(t.prototype))?t=void 0:o(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?a:t}},44582:(e,t,n)=>{"use strict";var r=n(24664);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},51557:(e,t,n)=>{"use strict";var r=n(93613),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},39726:(e,t,n)=>{"use strict";var r=n(73493),i=n(21616),o=n(51557),s=n(88050)("toStringTag"),a=Object,l="Arguments"===o(function(){return arguments}()),c=function(e,t){try{return e[t]}catch(e){}};e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=c(t=a(e),s))?n:l?o(t):"Object"===(r=o(t))&&i(t.callee)?"Arguments":r}},45525:(e,t,n)=>{"use strict";var r=n(60810),i=n(33732),o=n(90676),s=n(39298);e.exports=function(e,t,n){for(var a=i(t),l=s.f,c=o.f,d=0;d<a.length;d++){var u=a[d];r(e,u)||n&&r(n,u)||l(e,u,c(t,u))}}},23148:(e,t,n)=>{"use strict";var r=n(34289),i=n(39298),o=n(84867);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},84867:e=>{"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},89845:(e,t,n)=>{"use strict";var r=n(34289),i=n(39298),o=n(84867);e.exports=function(e,t,n){r?i.f(e,t,o(0,n)):e[t]=n}},88977:(e,t,n)=>{"use strict";var r=n(21616),i=n(39298),o=n(26050),s=n(98254);e.exports=function(e,t,n,a){a||(a={});var l=a.enumerable,c=void 0!==a.name?a.name:t;if(r(n)&&o(n,c,a),a.global)l?e[t]=n:s(t,n);else{try{a.unsafe?e[t]&&(l=!0):delete e[t]}catch(e){}l?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},98254:(e,t,n)=>{"use strict";var r=n(5153),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},34289:(e,t,n)=>{"use strict";var r=n(84402);e.exports=!r(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},92038:(e,t,n)=>{"use strict";var r=n(5153),i=n(82319),o=r.document,s=i(o)&&i(o.createElement);e.exports=function(e){return s?o.createElement(e):{}}},34130:e=>{"use strict";var t=TypeError;e.exports=function(e){if(e>0x1fffffffffffff)throw t("Maximum allowed index exceeded");return e}},2408:(e,t,n)=>{"use strict";var r=n(5153),i=n(93613);e.exports=function(e,t){return i(r[e].prototype[t])}},6322:e=>{"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},33368:(e,t,n)=>{"use strict";var r=n(5153).navigator,i=r&&r.userAgent;e.exports=i?String(i):""},10524:(e,t,n)=>{"use strict";var r,i,o=n(5153),s=n(33368),a=o.process,l=o.Deno,c=a&&a.versions||l&&l.version,d=c&&c.v8;d&&(i=(r=d.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&s&&(!(r=s.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=s.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},19457:(e,t,n)=>{"use strict";var r=n(5153),i=n(90676).f,o=n(23148),s=n(88977),a=n(98254),l=n(45525),c=n(55485);e.exports=function(e,t){var n,d,u,h,p,f=e.target,g=e.global,m=e.stat;if(n=g?r:m?r[f]||a(f,{}):r[f]&&r[f].prototype)for(d in t){if(h=t[d],u=e.dontCallGetSet?(p=i(n,d))&&p.value:n[d],!c(g?d:f+(m?".":"#")+d,e.forced)&&void 0!==u){if(typeof h==typeof u)continue;l(h,u)}(e.sham||u&&u.sham)&&o(h,"sham",!0),s(n,d,h,e)}}},84402:e=>{"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},65371:(e,t,n)=>{"use strict";n(89084);var r=n(39444),i=n(88977),o=n(76342),s=n(84402),a=n(88050),l=n(23148),c=a("species"),d=RegExp.prototype;e.exports=function(e,t,n,u){var h=a(e),p=!s(function(){var t={};return t[h]=function(){return 7},7!==""[e](t)}),f=p&&!s(function(){var t=!1,n=/a/;if("split"===e){var r={};r[c]=function(){return n},(n={constructor:r,flags:""})[h]=/./[h]}return n.exec=function(){return t=!0,null},n[h](""),!t});if(!p||!f||n){var g=/./[h],m=t(h,""[e],function(e,t,n,i,s){var a=t.exec;return a===o||a===d.exec?p&&!s?{done:!0,value:r(g,t,n,i)}:{done:!0,value:r(e,n,t,i)}:{done:!1}});i(String.prototype,e,m[0]),i(d,h,m[1])}u&&l(d[h],"sham",!0)}},22324:(e,t,n)=>{"use strict";var r=n(26671),i=n(8601),o=n(34130),s=n(34729),a=n(89845),l=function(e,t,n,c,d,u,h,p){for(var f,g,m=d,y=0,b=!!h&&s(h,p);y<c;)y in n&&(f=b?b(n[y],y,t):n[y],u>0&&r(f)?(g=i(f),m=l(e,t,f,g,m,u-1)-1):(o(m+1),a(e,m,f)),m++),y++;return m};e.exports=l},50006:(e,t,n)=>{"use strict";var r=n(12583),i=Function.prototype,o=i.apply,s=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?s.bind(o):function(){return s.apply(o,arguments)})},34729:(e,t,n)=>{"use strict";var r=n(51099),i=n(6765),o=n(12583),s=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?s(e,t):function(){return e.apply(t,arguments)}}},12583:(e,t,n)=>{"use strict";var r=n(84402);e.exports=!r(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},39444:(e,t,n)=>{"use strict";var r=n(12583),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},25199:(e,t,n)=>{"use strict";var r=n(34289),i=n(60810),o=Function.prototype,s=r&&Object.getOwnPropertyDescriptor,a=i(o,"name"),l=a&&(!r||r&&s(o,"name").configurable);e.exports={EXISTS:a,PROPER:a&&"something"===(function(){}).name,CONFIGURABLE:l}},51099:(e,t,n)=>{"use strict";var r=n(51557),i=n(93613);e.exports=function(e){if("Function"===r(e))return i(e)}},93613:(e,t,n)=>{"use strict";var r=n(12583),i=Function.prototype,o=i.call,s=r&&i.bind.bind(o,o);e.exports=r?s:function(e){return function(){return o.apply(e,arguments)}}},74032:(e,t,n)=>{"use strict";var r=n(5153),i=n(21616);e.exports=function(e,t){var n;return arguments.length<2?i(n=r[e])?n:void 0:r[e]&&r[e][t]}},88525:(e,t,n)=>{"use strict";var r=n(6765),i=n(77230);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},19813:(e,t,n)=>{"use strict";var r=n(93613),i=n(19176),o=Math.floor,s=r("".charAt),a=r("".replace),l=r("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,r,u,h){var p=n+e.length,f=r.length,g=d;return void 0!==u&&(u=i(u),g=c),a(h,g,function(i,a){var c;switch(s(a,0)){case"$":return"$";case"&":return e;case"`":return l(t,0,n);case"'":return l(t,p);case"<":c=u[l(a,1,-1)];break;default:var d=+a;if(0===d)return i;if(d>f){var h=o(d/10);if(0===h)return i;if(h<=f)return void 0===r[h-1]?s(a,1):r[h-1]+s(a,1);return i}c=r[d-1]}return void 0===c?"":c})}},5153:function(e){"use strict";var t=function(e){return e&&e.Math===Math&&e};e.exports=t("object"==typeof globalThis&&globalThis)||t("object"==typeof window&&window)||t("object"==typeof self&&self)||t("object"==typeof global&&global)||t("object"==typeof this&&this)||function(){return this}()||Function("return this")()},60810:(e,t,n)=>{"use strict";var r=n(93613),i=n(19176),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},96656:e=>{"use strict";e.exports={}},8786:(e,t,n)=>{"use strict";var r=n(74032);e.exports=r("document","documentElement")},45358:(e,t,n)=>{"use strict";var r=n(34289),i=n(84402),o=n(92038);e.exports=!r&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},12228:(e,t,n)=>{"use strict";var r=n(93613),i=n(84402),o=n(51557),s=Object,a=r("".split);e.exports=i(function(){return!s("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?a(e,""):s(e)}:s},86329:(e,t,n)=>{"use strict";var r=n(93613),i=n(21616),o=n(82086),s=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return s(e)}),e.exports=o.inspectSource},52966:(e,t,n)=>{"use strict";var r,i,o,s=n(41717),a=n(5153),l=n(82319),c=n(23148),d=n(60810),u=n(82086),h=n(39028),p=n(96656),f="Object already initialized",g=a.TypeError,m=a.WeakMap;if(s||u.state){var y=u.state||(u.state=new m);y.get=y.get,y.has=y.has,y.set=y.set,r=function(e,t){if(y.has(e))throw new g(f);return t.facade=e,y.set(e,t),t},i=function(e){return y.get(e)||{}},o=function(e){return y.has(e)}}else{var b=h("state");p[b]=!0,r=function(e,t){if(d(e,b))throw new g(f);return t.facade=e,c(e,b,t),t},i=function(e){return d(e,b)?e[b]:{}},o=function(e){return d(e,b)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!l(t)||(n=i(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return n}}}},26671:(e,t,n)=>{"use strict";var r=n(51557);e.exports=Array.isArray||function(e){return"Array"===r(e)}},21616:e=>{"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},82146:(e,t,n)=>{"use strict";var r=n(93613),i=n(84402),o=n(21616),s=n(39726),a=n(74032),l=n(86329),c=function(){},d=a("Reflect","construct"),u=/^\s*(?:class|function)\b/,h=r(u.exec),p=!u.test(c),f=function(e){if(!o(e))return!1;try{return d(c,[],e),!0}catch(e){return!1}},g=function(e){if(!o(e))return!1;switch(s(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return p||!!h(u,l(e))}catch(e){return!0}};g.sham=!0,e.exports=!d||i(function(){var e;return f(f.call)||!f(Object)||!f(function(){e=!0})||e})?g:f},55485:(e,t,n)=>{"use strict";var r=n(84402),i=n(21616),o=/#|\.prototype\./,s=function(e,t){var n=l[a(e)];return n===d||n!==c&&(i(t)?r(t):!!t)},a=s.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=s.data={},c=s.NATIVE="N",d=s.POLYFILL="P";e.exports=s},77230:e=>{"use strict";e.exports=function(e){return null==e}},82319:(e,t,n)=>{"use strict";var r=n(21616);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},48630:e=>{"use strict";e.exports=!1},83189:(e,t,n)=>{"use strict";var r=n(82319),i=n(51557),o=n(88050)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"===i(e))}},33636:(e,t,n)=>{"use strict";var r=n(74032),i=n(21616),o=n(27042),s=n(40029),a=Object;e.exports=s?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&o(t.prototype,a(e))}},8601:(e,t,n)=>{"use strict";var r=n(33747);e.exports=function(e){return r(e.length)}},26050:(e,t,n)=>{"use strict";var r=n(93613),i=n(84402),o=n(21616),s=n(60810),a=n(34289),l=n(25199).CONFIGURABLE,c=n(86329),d=n(52966),u=d.enforce,h=d.get,p=String,f=Object.defineProperty,g=r("".slice),m=r("".replace),y=r([].join),b=a&&!i(function(){return 8!==f(function(){},"length",{value:8}).length}),x=String(String).split("String"),v=e.exports=function(e,t,n){"Symbol("===g(p(t),0,7)&&(t="["+m(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!s(e,"name")||l&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),b&&n&&s(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&s(n,"constructor")&&n.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=u(e);return s(r,"source")||(r.source=y(x,"string"==typeof t?t:"")),e};Function.prototype.toString=v(function(){return o(this)&&h(this).source||c(this)},"toString")},11918:e=>{"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},79133:(e,t,n)=>{"use strict";var r,i=n(72642),o=n(87166),s=n(6322),a=n(96656),l=n(8786),c=n(92038),d=n(39028),u="prototype",h="script",p=d("IE_PROTO"),f=function(){},g=function(e){return"<"+h+">"+e+"</"+h+">"},m=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},y=function(){var e,t=c("iframe");return t.style.display="none",l.appendChild(t),t.src=String("java"+h+":"),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F},b=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}b="undefined"!=typeof document?document.domain&&r?m(r):y():m(r);for(var e=s.length;e--;)delete b[u][s[e]];return b()};a[p]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(f[u]=i(e),n=new f,f[u]=null,n[p]=e):n=b(),void 0===t?n:o.f(n,t)}},87166:(e,t,n)=>{"use strict";var r=n(34289),i=n(30139),o=n(39298),s=n(72642),a=n(99752),l=n(63205);t.f=r&&!i?Object.defineProperties:function(e,t){s(e);for(var n,r=a(t),i=l(t),c=i.length,d=0;c>d;)o.f(e,n=i[d++],r[n]);return e}},39298:(e,t,n)=>{"use strict";var r=n(34289),i=n(45358),o=n(30139),s=n(72642),a=n(60764),l=TypeError,c=Object.defineProperty,d=Object.getOwnPropertyDescriptor,u="enumerable",h="configurable",p="writable";t.f=r?o?function(e,t,n){if(s(e),t=a(t),s(n),"function"==typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var r=d(e,t);r&&r[p]&&(e[t]=n.value,n={configurable:h in n?n[h]:r[h],enumerable:u in n?n[u]:r[u],writable:!1})}return c(e,t,n)}:c:function(e,t,n){if(s(e),t=a(t),s(n),i)try{return c(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new l("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},90676:(e,t,n)=>{"use strict";var r=n(34289),i=n(39444),o=n(12740),s=n(84867),a=n(99752),l=n(60764),c=n(60810),d=n(45358),u=Object.getOwnPropertyDescriptor;t.f=r?u:function(e,t){if(e=a(e),t=l(t),d)try{return u(e,t)}catch(e){}if(c(e,t))return s(!i(o.f,e,t),e[t])}},13913:(e,t,n)=>{"use strict";var r=n(11579),i=n(6322).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},47680:(e,t)=>{"use strict";t.f=Object.getOwnPropertySymbols},27042:(e,t,n)=>{"use strict";var r=n(93613);e.exports=r({}.isPrototypeOf)},11579:(e,t,n)=>{"use strict";var r=n(93613),i=n(60810),o=n(99752),s=n(71274).indexOf,a=n(96656),l=r([].push);e.exports=function(e,t){var n,r=o(e),c=0,d=[];for(n in r)!i(a,n)&&i(r,n)&&l(d,n);for(;t.length>c;)i(r,n=t[c++])&&(~s(d,n)||l(d,n));return d}},63205:(e,t,n)=>{"use strict";var r=n(11579),i=n(6322);e.exports=Object.keys||function(e){return r(e,i)}},12740:(e,t)=>{"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},759:(e,t,n)=>{"use strict";var r=n(39444),i=n(21616),o=n(82319),s=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&i(n=e.toString)&&!o(a=r(n,e))||i(n=e.valueOf)&&!o(a=r(n,e))||"string"!==t&&i(n=e.toString)&&!o(a=r(n,e)))return a;throw new s("Can't convert object to primitive value")}},33732:(e,t,n)=>{"use strict";var r=n(74032),i=n(93613),o=n(13913),s=n(47680),a=n(72642),l=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(a(e)),n=s.f;return n?l(t,n(e)):t}},12589:(e,t,n)=>{"use strict";var r=n(39444),i=n(72642),o=n(21616),s=n(51557),a=n(76342),l=TypeError;e.exports=function(e,t){var n=e.exec;if(o(n)){var c=r(n,e,t);return null!==c&&i(c),c}if("RegExp"===s(e))return r(a,e,t);throw new l("RegExp#exec called on incompatible receiver")}},76342:(e,t,n)=>{"use strict";var r=n(39444),i=n(93613),o=n(27994),s=n(57264),a=n(87700),l=n(77058),c=n(79133),d=n(52966).get,u=n(15192),h=n(17941),p=l("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,g=f,m=i("".charAt),y=i("".indexOf),b=i("".replace),x=i("".slice),v=function(){var e=/a/,t=/b*/g;return r(f,e,"a"),r(f,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),w=a.BROKEN_CARET,S=void 0!==/()??/.exec("")[1];(v||S||w||u||h)&&(g=function(e){var t,n,i,a,l,u,h,k=d(this),C=o(e),P=k.raw;if(P)return P.lastIndex=this.lastIndex,t=r(g,P,C),this.lastIndex=P.lastIndex,t;var _=k.groups,I=w&&this.sticky,E=r(s,this),j=this.source,T=0,M=C;if(I&&(-1===y(E=b(E,"y",""),"g")&&(E+="g"),M=x(C,this.lastIndex),this.lastIndex>0&&(!this.multiline||this.multiline&&"\n"!==m(C,this.lastIndex-1))&&(j="(?: "+j+")",M=" "+M,T++),n=RegExp("^(?:"+j+")",E)),S&&(n=RegExp("^"+j+"$(?!\\s)",E)),v&&(i=this.lastIndex),a=r(f,I?n:this,M),I?a?(a.input=x(a.input,T),a[0]=x(a[0],T),a.index=this.lastIndex,this.lastIndex+=a[0].length):this.lastIndex=0:v&&a&&(this.lastIndex=this.global?a.index+a[0].length:i),S&&a&&a.length>1&&r(p,a[0],n,function(){for(l=1;l<arguments.length-2;l++)void 0===arguments[l]&&(a[l]=void 0)}),a&&_)for(l=0,a.groups=u=c(null);l<_.length;l++)u[(h=_[l])[0]]=a[h[1]];return a}),e.exports=g},62434:(e,t,n)=>{"use strict";var r=n(5153),i=n(84402),o=r.RegExp,s=!i(function(){var e=!0;try{o(".","d")}catch(t){e=!1}var t={},n="",r=e?"dgimsy":"gimsy",i=function(e,r){Object.defineProperty(t,e,{get:function(){return n+=r,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(s.hasIndices="d"),s)i(a,s[a]);return Object.getOwnPropertyDescriptor(o.prototype,"flags").get.call(t)!==r||n!==r});e.exports={correct:s}},57264:(e,t,n)=>{"use strict";var r=n(72642);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},34197:(e,t,n)=>{"use strict";var r=n(39444),i=n(60810),o=n(27042),s=n(62434),a=n(57264),l=RegExp.prototype;e.exports=s.correct?function(e){return e.flags}:function(e){return!s.correct&&o(l,e)&&!i(e,"flags")?r(a,e):e.flags}},87700:(e,t,n)=>{"use strict";var r=n(84402),i=n(5153).RegExp,o=r(function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")}),s=o||r(function(){return!i("a","y").sticky}),a=o||r(function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")});e.exports={BROKEN_CARET:a,MISSED_STICKY:s,UNSUPPORTED_Y:o}},15192:(e,t,n)=>{"use strict";var r=n(84402),i=n(5153).RegExp;e.exports=r(function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})},17941:(e,t,n)=>{"use strict";var r=n(84402),i=n(5153).RegExp;e.exports=r(function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})},52257:(e,t,n)=>{"use strict";var r=n(77230),i=TypeError;e.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}},39028:(e,t,n)=>{"use strict";var r=n(77058),i=n(62429),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},82086:(e,t,n)=>{"use strict";var r=n(48630),i=n(5153),o=n(98254),s="__core-js_shared__",a=e.exports=i[s]||o(s,{});(a.versions||(a.versions=[])).push({version:"3.48.0",mode:r?"pure":"global",copyright:"\xa9 20132025 Denis Pushkarev (zloirock.ru), 20252026 CoreJS Company (core-js.io). All rights reserved.",license:"https://github.com/zloirock/core-js/blob/v3.48.0/LICENSE",source:"https://github.com/zloirock/core-js"})},77058:(e,t,n)=>{"use strict";var r=n(82086);e.exports=function(e,t){return r[e]||(r[e]=t||{})}},24008:(e,t,n)=>{"use strict";var r=n(93613),i=n(30444),o=n(27994),s=n(52257),a=r("".charAt),l=r("".charCodeAt),c=r("".slice),d=function(e){return function(t,n){var r,d,u=o(s(t)),h=i(n),p=u.length;return h<0||h>=p?e?"":void 0:(r=l(u,h))<55296||r>56319||h+1===p||(d=l(u,h+1))<56320||d>57343?e?a(u,h):r:e?c(u,h,h+2):(r-55296<<10)+(d-56320)+65536}};e.exports={codeAt:d(!1),charAt:d(!0)}},47996:(e,t,n)=>{"use strict";var r=n(10524),i=n(84402),o=n(5153).String;e.exports=!!Object.getOwnPropertySymbols&&!i(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41})},26331:(e,t,n)=>{"use strict";var r=n(30444),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},99752:(e,t,n)=>{"use strict";var r=n(12228),i=n(52257);e.exports=function(e){return r(i(e))}},30444:(e,t,n)=>{"use strict";var r=n(11918);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},33747:(e,t,n)=>{"use strict";var r=n(30444),i=Math.min;e.exports=function(e){var t=r(e);return t>0?i(t,0x1fffffffffffff):0}},19176:(e,t,n)=>{"use strict";var r=n(52257),i=Object;e.exports=function(e){return i(r(e))}},94578:(e,t,n)=>{"use strict";var r=n(39444),i=n(82319),o=n(33636),s=n(88525),a=n(759),l=n(88050),c=TypeError,d=l("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var n,l=s(e,d);if(l){if(void 0===t&&(t="default"),!i(n=r(l,e,t))||o(n))return n;throw new c("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},60764:(e,t,n)=>{"use strict";var r=n(94578),i=n(33636);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},73493:(e,t,n)=>{"use strict";var r=n(88050)("toStringTag"),i={};i[r]="z",e.exports="[object z]"===String(i)},27994:(e,t,n)=>{"use strict";var r=n(39726),i=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},88366:e=>{"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},62429:(e,t,n)=>{"use strict";var r=n(93613),i=0,o=Math.random(),s=r(1.1.toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+s(++i+o,36)}},40029:(e,t,n)=>{"use strict";var r=n(47996);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},30139:(e,t,n)=>{"use strict";var r=n(34289),i=n(84402);e.exports=r&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},41717:(e,t,n)=>{"use strict";var r=n(5153),i=n(21616),o=r.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},88050:(e,t,n)=>{"use strict";var r=n(5153),i=n(77058),o=n(60810),s=n(62429),a=n(47996),l=n(40029),c=r.Symbol,d=i("wks"),u=l?c.for||c:c&&c.withoutSetter||s;e.exports=function(e){return o(d,e)||(d[e]=a&&o(c,e)?c[e]:u("Symbol."+e)),d[e]}},36162:(e,t,n)=>{"use strict";var r=n(19457),i=n(19176),o=n(8601),s=n(30444),a=n(34802);r({target:"Array",proto:!0},{at:function(e){var t=i(this),n=o(t),r=s(e),a=r>=0?r:n+r;return a<0||a>=n?void 0:t[a]}}),a("at")},99571:(e,t,n)=>{"use strict";var r=n(19457),i=n(22324),o=n(6765),s=n(19176),a=n(8601),l=n(44582);r({target:"Array",proto:!0},{flatMap:function(e){var t,n=s(this),r=a(n);return o(e),i(t=l(n,0),n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},56460:(e,t,n)=>{"use strict";var r=n(19457),i=n(22324),o=n(19176),s=n(8601),a=n(30444),l=n(44582);r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=o(this),n=s(t),r=l(t,0);return i(r,t,t,n,0,void 0===e?1:a(e)),r}})},36284:(e,t,n)=>{"use strict";n(34802)("flatMap")},77483:(e,t,n)=>{"use strict";n(34802)("flat")},89084:(e,t,n)=>{"use strict";var r=n(19457),i=n(76342);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},68374:(e,t,n)=>{"use strict";var r=n(19457),i=n(93613),o=n(52257),s=n(30444),a=n(27994),l=n(84402),c=i("".charAt);r({target:"String",proto:!0,forced:l(function(){return"\uD842"!=="\uD842\uDFB7".at(-2)})},{at:function(e){var t=a(o(this)),n=t.length,r=s(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:c(t,i)}})},20587:(e,t,n)=>{"use strict";var r=n(19457),i=n(39444),o=n(93613),s=n(52257),a=n(21616),l=n(82319),c=n(83189),d=n(27994),u=n(88525),h=n(34197),p=n(19813),f=n(88050),g=n(48630),m=f("replace"),y=TypeError,b=o("".indexOf),x=o("".replace),v=o("".slice),w=Math.max;r({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,o,f,S,k,C,P,_,I=s(this),E=0,j="";if(l(e)){if((n=c(e))&&!~b(d(s(h(e))),"g"))throw new y("`.replaceAll` does not allow non-global regexes");if(r=u(e,m))return i(r,e,I,t);if(g&&n)return x(d(I),e,t)}for(o=d(I),f=d(e),(S=a(t))||(t=d(t)),C=w(1,k=f.length),P=b(o,f);-1!==P;)_=S?d(t(f,P,o)):p(f,o,P,[],void 0,t),j+=v(o,E,P)+_,E=P+k,P=P+C>o.length?-1:b(o,f,P+C);return E<o.length&&(j+=v(o,E)),j}})},69081:(e,t,n)=>{"use strict";var r=n(50006),i=n(39444),o=n(93613),s=n(65371),a=n(84402),l=n(72642),c=n(21616),d=n(82319),u=n(30444),h=n(33747),p=n(27994),f=n(52257),g=n(32466),m=n(88525),y=n(19813),b=n(34197),x=n(12589),v=n(88050)("replace"),w=Math.max,S=Math.min,k=o([].concat),C=o([].push),P=o("".indexOf),_=o("".slice),I="$0"==="a".replace(/./,"$0"),E=!!/./[v]&&""===/./[v]("a","$0");s("replace",function(e,t,n){var o=E?"$":"$0";return[function(e,n){var r=f(this),o=d(e)?m(e,v):void 0;return o?i(o,e,r,n):i(t,p(r),e,n)},function(e,i){var s=l(this),a=p(e);if("string"==typeof i&&-1===P(i,o)&&-1===P(i,"$<")){var d=n(t,s,a,i);if(d.done)return d.value}var f=c(i);f||(i=p(i));var m=p(b(s)),v=-1!==P(m,"g");v&&(A=-1!==P(m,"u"),s.lastIndex=0);for(var I=[];null!==(O=x(s,a))&&(C(I,O),v);)""===p(O[0])&&(s.lastIndex=g(a,h(s.lastIndex),A));for(var E="",j=0,T=0;T<I.length;T++){for(var M,A,O,L,D=p((O=I[T])[0]),z=w(S(u(O.index),a.length),0),R=[],N=1;N<O.length;N++)C(R,void 0===(M=O[N])?M:String(M));var F=O.groups;if(f){var $=k([D],R,z,a);void 0!==F&&C($,F),L=p(r(i,void 0,$))}else L=y(D,a,z,R,F,i);z>=j&&(E+=_(a,j,z)+L,j=z+D.length)}return E+_(a,j)}]},!!a(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!I||E)},8217:(e,t,n)=>{"use strict";var r=n(70952);e.exports=r},37632:(e,t,n)=>{"use strict";var r=n(51421);e.exports=r},15247:(e,t,n)=>{"use strict";var r=n(54502);e.exports=r},94779:(e,t,n)=>{"use strict";var r=n(15148);e.exports=r},8126:(e,t,n)=>{"use strict";var r=n(6667);e.exports=r}};var t=require("../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[638,403],()=>n(23687));module.exports=r})();