(()=>{var e={};e.id=820,e.ids=[820],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},25702:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>A,routeModule:()=>y,serverHooks:()=>b,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>x});var a={};t.r(a),t.d(a,{POST:()=>g});var o=t(42706),s=t(28203),i=t(45994),n=t(39187),l=t(65658);let p=process.env.AIARTY_ENDPOINT??"https://api.aiarty.com/matting";async function u(e){let r=process.env.REMOVE_BG_API_KEY;if(!r)return null;let t=await fetch("https://api.remove.bg/v1.0/removebg",{method:"POST",headers:{"X-Api-Key":r,"Content-Type":"application/json"},body:JSON.stringify({image_url:e,size:"auto"})});if(!t.ok)return null;let a=await t.blob(),o=Buffer.from(await a.arrayBuffer()).toString("base64");return`data:image/png;base64,${o}`}async function d(e){let r=process.env.AIARTY_API_KEY;if(!r)return null;let t=await fetch(p,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify({image_url:e})});return t.ok?(await t.json()).result_url??null:null}async function c(e,r){let t=process.env.FLUX_API_KEY??process.env.TOGETHER_API_KEY;if(!t)return null;let a=process.env.FLUX_BASE_URL??"https://api.bfl.ml",o=await fetch(`${a}/v1/images/edits`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({image:e,prompt:"Remove the background completely, preserve all fine details of the illustration"})});if(!o.ok)return null;let s=await o.json(),i=s.data?.[0]?.url;return i?{url:i,needsApproval:!0}:null}let f=["remove-bg","aiarty","flux-kontext-edit"];async function v(e,r){for(let r of f)try{if("remove-bg"===r){let r=await u(e);if(r)return{imageUrl:r,provider:"remove-bg"}}else if("aiarty"===r){let r=await d(e);if(r)return{imageUrl:r,provider:"aiarty"}}else if("flux-kontext-edit"===r){let r=await c(e,"Remove the background completely, preserve all fine details");if(r)return{imageUrl:r.url,provider:"flux-kontext-edit",needsApproval:r.needsApproval}}}catch(e){continue}throw Error("All BG removal providers failed")}let m=l.Ik({imageUrl:l.Yj().url(),styleProfileId:l.Yj().uuid().optional()});async function g(e){let r=await e.json().catch(()=>({})),t=m.safeParse(r);if(!t.success)return n.NextResponse.json({error:"Invalid body",details:t.error.flatten()},{status:400});let{imageUrl:a,styleProfileId:o}=t.data;try{let e=await v(a,o);return n.NextResponse.json({imageUrl:e.imageUrl,provider:e.provider,needsApproval:e.needsApproval??!1})}catch(e){return console.error(e),n.NextResponse.json({error:e instanceof Error?e.message:"BG removal failed"},{status:500})}}let y=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/process/remove-bg/route",pathname:"/api/process/remove-bg",filename:"route",bundlePath:"app/api/process/remove-bg/route"},resolvedPagePath:"/Users/berriesdesign/Documents/repos/illustration-agent/src/app/api/process/remove-bg/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:h,workUnitAsyncStorage:x,serverHooks:b}=y;function A(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:x})}},96487:()=>{},78335:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[638,452,658],()=>t(25702));module.exports=a})();