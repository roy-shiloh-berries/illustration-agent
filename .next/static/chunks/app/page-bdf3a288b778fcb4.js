(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{9114:(e,r,a)=>{Promise.resolve().then(a.bind(a,8535))},8535:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>u});var t=a(5155),s=a(2115);function l(e){let{onCreated:r}=e,[a,l]=(0,s.useState)(""),[n,d]=(0,s.useState)([]),[o,i]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null),m=async e=>{if(e.preventDefault(),!a.trim()||0===n.length){u("Name and at least one image are required");return}i(!0),u(null);try{var t;let e=new FormData;e.set("name",a.trim()),n.forEach(r=>e.append("files",r));let s=await fetch("/api/styles",{method:"POST",headers:{"X-User-Id":"dev-user"},body:e}),o=await s.json();if(!s.ok)throw Error(null!==(t=o.error)&&void 0!==t?t:"Failed to create style");null==r||r(o.id),l(""),d([])}catch(e){u(e instanceof Error?e.message:"Failed")}finally{i(!1)}};return(0,t.jsxs)("form",{onSubmit:m,className:"space-y-4 rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Create style profile"}),c&&(0,t.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:c}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Name"}),(0,t.jsx)("input",{type:"text",value:a,onChange:e=>l(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-3 py-2 dark:border-gray-600 dark:bg-gray-800",placeholder:"My illustration style"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Reference images"}),(0,t.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{var r;return d(Array.from(null!==(r=e.target.files)&&void 0!==r?r:[]))},className:"mt-1 w-full text-sm"})]}),(0,t.jsx)("button",{type:"submit",disabled:o,className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:o?"Creating…":"Create style"})]})}function n(e){let{selectedStyleId:r,onSelect:a}=e,[l,n]=(0,s.useState)([]),[d,o]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{fetch("/api/styles",{headers:{"X-User-Id":"dev-user"}}).then(e=>e.ok?e.json():[]).then(e=>n(Array.isArray(e)?e:[])).catch(()=>n([])).finally(()=>o(!1))},[]),d)?(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Loading styles…"}):0===l.length?null:(0,t.jsxs)("div",{className:"space-y-2 rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Select style profile"}),(0,t.jsxs)("select",{value:null!=r?r:"",onChange:e=>a(e.target.value||null),className:"w-full rounded border border-gray-300 px-3 py-2 dark:border-gray-600 dark:bg-gray-800",children:[(0,t.jsx)("option",{value:"",children:"— Pick a style —"}),l.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]})}function d(e){let{styleProfileId:r,onJobStarted:a}=e,[l,n]=(0,s.useState)(""),[d,o]=(0,s.useState)(!1),[i,c]=(0,s.useState)(null),[u,m]=(0,s.useState)(null),g=async e=>{if(e.preventDefault(),!r||!l.trim()){c("Select a style and enter a prompt");return}o(!0),c(null);try{var t;let e=await fetch("/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({styleProfileId:r,userPrompt:l.trim()})}),s=await e.json();if(!e.ok)throw Error(null!==(t=s.error)&&void 0!==t?t:"Failed to start generation");m(s.jobId),null==a||a(s.jobId)}catch(e){c(e instanceof Error?e.message:"Failed")}finally{o(!1)}};return(0,t.jsxs)("div",{className:"space-y-4 rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Generate illustrations"}),i&&(0,t.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:i}),!r&&(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Create or select a style profile first."}),(0,t.jsxs)("form",{onSubmit:g,className:"space-y-2",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium",children:"Prompt"}),(0,t.jsx)("textarea",{value:l,onChange:e=>n(e.target.value),className:"mt-1 w-full rounded border border-gray-300 px-3 py-2 dark:border-gray-600 dark:bg-gray-800",rows:2,placeholder:"A cat sitting on a windowsill, morning light",disabled:!r})]}),(0,t.jsx)("button",{type:"submit",disabled:d||!r,className:"rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 disabled:opacity-50",children:d?"Queuing…":"Generate 3 options"})]}),u&&(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Job ",u," queued. Poll GET /api/generate/job/",u," for result."]})]})}var o=a(8833);function i(e){let{projectId:r,onSave:a,snapshot:s}=e;return(0,t.jsx)("div",{className:"h-[600px] w-full rounded border border-gray-200 dark:border-gray-700",children:(0,t.jsx)(o.Z1z,{persistenceKey:null!=r?r:"illustration-canvas",snapshot:s,onMount:e=>{a&&e.store.listen(()=>{a(e.store.getSnapshot())},{source:"user",scope:"document"})}})})}function c(e){let{imageUrl:r,styleProfileId:a,onBgRemoved:l,onSvgReady:n}=e,[d,o]=(0,s.useState)(null),[i,c]=(0,s.useState)(null),[u,m]=(0,s.useState)(null),[g,h]=(0,s.useState)(null),y=async()=>{m("bg"),h(null);try{var e;let t=await fetch("/api/process/remove-bg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:r,styleProfileId:a})}),s=await t.json();if(!t.ok)throw Error(null!==(e=s.error)&&void 0!==e?e:"Failed");o(s.imageUrl),null==l||l(s.imageUrl)}catch(e){h(e instanceof Error?e.message:"BG removal failed")}finally{m(null)}},p=async()=>{let e=null!=d?d:r;m("svg"),h(null);try{var a;let r=await fetch("/api/process/to-svg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({pngUrl:e})}),t=await r.json();if(!r.ok)throw Error(null!==(a=t.error)&&void 0!==a?a:"Failed");c(t.svgUrl),null==n||n(t.svgUrl)}catch(e){h(e instanceof Error?e.message:"SVG conversion failed")}finally{m(null)}};return(0,t.jsxs)("div",{className:"space-y-4 rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Post-processing"}),g&&(0,t.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:g}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,t.jsx)("button",{type:"button",onClick:y,disabled:null!==u,className:"rounded bg-gray-800 px-3 py-2 text-sm text-white hover:bg-gray-700 disabled:opacity-50 dark:bg-gray-700 dark:hover:bg-gray-600",children:"bg"===u?"Removing…":"Remove background"}),(0,t.jsx)("button",{type:"button",onClick:p,disabled:null!==u,className:"rounded bg-gray-800 px-3 py-2 text-sm text-white hover:bg-gray-700 disabled:opacity-50 dark:bg-gray-700 dark:hover:bg-gray-600",children:"svg"===u?"Converting…":"Convert to SVG"})]}),d&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Background removed"}),(0,t.jsx)("img",{src:d,alt:"No background",className:"mt-1 max-h-40 rounded border object-contain"})]}),i&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"SVG result"}),(0,t.jsx)("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 underline dark:text-blue-400",children:"Open SVG"})]})]})}function u(){let[e,r]=(0,s.useState)(null),[a,o]=(0,s.useState)("");return(0,t.jsxs)("main",{className:"min-h-screen p-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Illustration Agent"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:"AI-powered illustration agent with style memory, multi-provider generation, and feedback-driven learning."}),(0,t.jsxs)("div",{className:"mt-8 grid gap-8 lg:grid-cols-2",children:[(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(n,{selectedStyleId:e,onSelect:r}),(0,t.jsx)(l,{onCreated:r}),(0,t.jsx)(d,{styleProfileId:e}),(0,t.jsxs)("div",{className:"rounded border border-gray-200 p-4 dark:border-gray-700",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Post-process an image"}),(0,t.jsx)("input",{type:"url",value:a,onChange:e=>o(e.target.value),placeholder:"Paste image URL",className:"mt-2 w-full rounded border border-gray-300 px-3 py-2 dark:border-gray-600 dark:bg-gray-800"}),a&&(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)(c,{imageUrl:a,styleProfileId:null!=e?e:void 0})})]})]}),(0,t.jsx)("div",{children:(0,t.jsx)(i,{projectId:null!=e?e:void 0})})]})]})}a(8871)}},e=>{var r=r=>e(e.s=r);e.O(0,[518,51,318,441,517,358],()=>r(9114)),_N_E=e.O()}]);